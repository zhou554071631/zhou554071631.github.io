!function(){"use strict";var PlaceType,EventType,ExtraConfigType,UpgradeUIType,DoubleType,aldEventType,CacheDataType;!function(PlaceType){PlaceType[PlaceType.daoChe=1]="daoChe",PlaceType[PlaceType.ceFangWei=2]="ceFangWei",PlaceType[PlaceType.sQuXian=3]="sQuXian",PlaceType[PlaceType.shangPo=4]="shangPo",PlaceType[PlaceType.zhiJiao=5]="zhiJiao"}(PlaceType||(PlaceType={}));class PlaceConfig{initData(data){this.id=JSON.parse(data.Id),this.placeType=JSON.parse(data.placeType),this.order=JSON.parse(data.order),this.posX=JSON.parse(data.posX),this.posZ=JSON.parse(data.posZ),this.rotateY=JSON.parse(data.rotateY),this.waitX=JSON.parse(data.waitX),this.waitZ=JSON.parse(data.waitZ),this.waitRotateY=JSON.parse(data.waitRotateY)}}class CostConfig{initData(data){this.id=JSON.parse(data.Id),this.priceCost=JSON.parse(data.priceCost),this.priceAward=JSON.parse(data.priceAward),this.time=JSON.parse(data.time),this.carLevel=JSON.parse(data.carLevel),this.placeId=JSON.parse(data.placeId)}}!function(EventType){EventType.carAnimComplete="carAnimComplete",EventType.getOnCarComplete="getOnCarComplete",EventType.buyCarClick="buyCarClick",EventType.addPriceClick="addPriceClick",EventType.addSpeedClickStart="addSpeedClickStart",EventType.addSpeedClickOver="addSpeedClickOver",EventType.upgradeSpeedClick="upgradeSpeedClick",EventType.updateGold="updateGold",EventType.updateDiamond="updateDiamond",EventType.updateExp="updateExp",EventType.upgradeLevel="upgradeLevel",EventType.upgradeCarAir="upgradeCarAir",EventType.upgradeRedPacket="upgradeRedPacket",EventType.upgradeAd="upgradeAd",EventType.doubleSpeedStart="doubleSpeedStart",EventType.doubleSpeedOver="doubleSpeedOver",EventType.doubleGoldStart="doubleGoldStart",EventType.doubleGoldOver="doubleGoldOver",EventType.upgradeManager="upgradeManager",EventType.newGuide_StartNextStep="newGuideStartNextStep",EventType.newGuide_CompleteStep="newGuideCompleteStep",EventType.roadTestStartMove="roadTestStartMove",EventType.roadTestStopMove="roadTestStopMove",EventType.driftStartGame="driftStartGame",EventType.driftGameOver="driftGameOver",EventType.driftReviveGame="driftReviveGame",EventType.driftStarCameraFollow="driftStarCameraFollow",EventType.driftStartMove="driftStartMove",EventType.driftMouseDownLeft="driftMouseDownLeft",EventType.driftMouseUpLeft="driftMouseUpLeft",EventType.driftMouseDownRight="driftMouseDownRight",EventType.driftMouseUpRight="driftMouseUpRight",EventType.driftCarTriggerEnter="driftCarTriggerEnter",EventType.driftKillCarUpdate="driftKillCarUpdate",EventType.driftSelfCarBloodUpdate="driftSelfCarBloodUpdate"}(EventType||(EventType={})),function(ExtraConfigType){ExtraConfigType[ExtraConfigType.carAir=0]="carAir",ExtraConfigType[ExtraConfigType.redPacket=1]="redPacket",ExtraConfigType[ExtraConfigType.ad=2]="ad"}(ExtraConfigType||(ExtraConfigType={})),function(UpgradeUIType){UpgradeUIType[UpgradeUIType.upgrade=0]="upgrade",UpgradeUIType[UpgradeUIType.offline=1]="offline",UpgradeUIType[UpgradeUIType.doubleSpeed=2]="doubleSpeed",UpgradeUIType[UpgradeUIType.doubleGold=3]="doubleGold",UpgradeUIType[UpgradeUIType.flyGold=4]="flyGold"}(UpgradeUIType||(UpgradeUIType={})),function(DoubleType){DoubleType[DoubleType.gold=0]="gold",DoubleType[DoubleType.speed=1]="speed"}(DoubleType||(DoubleType={}));class Utils{static getGuid(){return++Utils.GUID}static removeArr(arr,ele){var index=arr.indexOf(ele);return index>-1&&arr.splice(index,1),arr}static getAnimByPlaceType(placeType){switch(placeType){case PlaceType.ceFangWei:return"ceFangWei";case PlaceType.daoChe:return"daoche";case PlaceType.sQuXian:return"sQuXian";case PlaceType.shangPo:return"shangPo";case PlaceType.zhiJiao:return"sQuXian"}return"Idle"}static convert(num){if(num<1e3)return parseInt(num);let arr=["K","M","G","B","T","aa","ab","ac","ad","ae","af","ag","ah","ai","aj","ak","al","am","an","ao","ap","aq","ar","as","at","au","av","aw","ax","ay","az","ba"],temp=1e3,index=-1;for(;temp<num;)index++,temp*=1e3;return-1==index?num:index>=arr.length?num:Math.floor(100*num*1e3/temp)/100+arr[index]}static random(minNum,maxNum){return parseInt(Math.random()*(maxNum-minNum+1)+minNum,10)}static vibrate(){Laya.Browser.onMiniGame&&wx.vibrateShort({success:null,fail:null,complete:null})}static vibrateLong(){Laya.Browser.onMiniGame&&wx.vibrateLong({success:null,fail:null,complete:null})}static shareByPath(shareType,path){path="https://mmocgame.qpic.cn/wechatgame/AQ7gpWvyGT0K8r0dtO3mMDZywMvtoAlfXBGiaTYmzagxM7pRSf4qia9N3cKDViciaicgG/0";let num=Utils.random(0,1);0==num||1==num&&(path="https://mmocgame.qpic.cn/wechatgame/AQ7gpWvyGT1lq49mticrbdDjkicOeBQx6N5PvjCr1EpZVJ5s6CNdvV7ggaoZEJjRA7/0");let shareTitle="老司机告诉你，如何一次性过科目二？",shareTitleNum=Utils.random(0,6);0==shareTitleNum||(shareTitle=1==shareTitleNum?"模拟驾校经营，你就是教练":2==shareTitleNum?"模拟驾校经营，你就是校长":3==shareTitleNum?"老司机教你，教练骂人怎么办？":4==shareTitleNum?"老司机教你，如何快速倒车入库":"学手动挡好，还是学自动挡好？"),Laya.Browser.onMiniGame&&wx.aldShareAppMessage({imageUrl:path,title:shareTitle,ald_desc:shareType})}static isShareSuccess(callBack){let time1=(new Date).getTime();if(Laya.Browser.onMiniGame){let isSuccess=function(res){let success=!1;((new Date).getTime()-time1)/1e3>=3&&(success=!0),wx.offShow(isSuccess),callBack&&callBack(success)};wx.onShow(isSuccess)}else callBack&&callBack(!0)}static wxShowNotice(callBack){if(Laya.Browser.onMiniGame){let data={title:"提示",content:"操作失败，请尝试不同群",showCancel:!0,confirmText:"去分享",confirmColor:"#5194b9",success:function(res){res.cancel?callBack&&callBack(!1):callBack&&callBack(!0)}};wx.showModal(data)}}static showSystemNotice(title){if(Laya.Browser.onMiniGame){let noticeData={title:title,icon:"fail",duration:2e3};wx.showToast(noticeData)}}static setRankData(data){if(Laya.Browser.onMiniGame){var kvDataList=[],obj={wxgame:{}};obj.wxgame.value1=data,obj.wxgame.update_time=Laya.Browser.now(),kvDataList.push({key:"goldRank",value:JSON.stringify(obj)}),console.log(JSON.stringify(obj)),wx.setUserCloudStorage({KVDataList:kvDataList,success:function(e){console.log("-----success:"+JSON.stringify(e))},fail:function(e){console.log("-----fail:"+JSON.stringify(e))},complete:function(e){console.log("-----complete:"+JSON.stringify(e))}})}}static aldEventByType(eventType){Laya.Browser.onMiniGame&&wx.aldSendEvent(eventType)}static aldEventByTypeParam(eventType,param,str){Laya.Browser.onMiniGame&&wx.aldSendEvent(eventType,{param:str})}}Utils.GUID=1,function(aldEventType){aldEventType.share_Offline="离线奖励分享",aldEventType.share_Upgrade="用户升级分享",aldEventType.share_double_gold="双倍金币分享",aldEventType.share_double_speed="双倍速度分享",aldEventType.share_manager_upgrade="升级管理员分享",aldEventType.share_fly="飞行物分享",aldEventType.share_drift_revive="漂移复活分享",aldEventType.share_drift_gold="漂移3倍领取分享",aldEventType.share_lottery="抽奖分享",aldEventType.ald_user_level="玩家等级",aldEventType.ald_drift_level="漂移等级",aldEventType.ald_drift_times="漂移次数",aldEventType.ald_car_level="车辆等级",aldEventType.ald_price_level="学费等级",aldEventType.ald_speed_level="速度等级",aldEventType.ald_air_level="空调等级",aldEventType.ald_red_level="红包等级",aldEventType.ald_ad_level="广告等级",aldEventType.ald_newGuide="新手引导完成",aldEventType.ald_lock_scene="解锁新场景"}(aldEventType||(aldEventType={}));class EventManager{constructor(){}static get instance(){return null==EventManager._instance&&(EventManager._instance=new EventManager),EventManager._instance}init(){this.event=new Laya.EventDispatcher}on(type,self,listener){this.event.on(type,self,listener)}off(type,self,listener){this.event.off(type,self,listener,!1)}fire(type,data){this.event.event(type,data)}fire2(type,data1,data2,data3){let data=[];null!=data1&&data.push(data1),null!=data2&&data.push(data2),null!=data3&&data.push(data3),this.event.event(type,data)}}class ExtraConfig{initData(data){this.id=JSON.parse(data.Id),this.redCost=JSON.parse(data.redCost),this.redPacketAward=JSON.parse(data.redPacketAward),this.airConditionerAward=JSON.parse(data.airConditionerAward),this.adAward=JSON.parse(data.adAward)}}class UserConfig{initData(data){this.id=JSON.parse(data.id),this.exp=JSON.parse(data.exp),this.award=JSON.parse(data.award)}}!function(CacheDataType){CacheDataType.loginTime="loginTime",CacheDataType.levelData="levelData",CacheDataType.goldData="goldData",CacheDataType.expData="expData",CacheDataType.carLevel="carLevel",CacheDataType.speedLevel="speedLevel",CacheDataType.priceLevel="priceLevel",CacheDataType.carAirLevel="carAirLevel",CacheDataType.redPacketLevel="redPacketLevel",CacheDataType.adLevel="adLevel",CacheDataType.doubleSpeedTime="doubleSpeedTime",CacheDataType.doubleGoldTime="doubleGoldTime",CacheDataType.loginTime_common="loginTime_common",CacheDataType.diamondData="diamondData",CacheDataType.lotteryData="lotteryData",CacheDataType.managerLevel="managerLevel",CacheDataType.rankAllGold="rankAllGold"}(CacheDataType||(CacheDataType={}));class UserData{constructor(){this.placeConfigs=[],this.costConfigs=[],this.extraConfig=[],this.userConfig=[]}init(){this.mSceneIndex=0,this.mLevel=1,this.mGold=30,this.mDiamond=100,this.mExp=0,this.offlineTime=0,this.curDays=2,this.mIsSign=!1,this.mSignTimes=0,this.mIsLottery=!0,this.mCarLevel=1,this.mSpeedLevel=1,this.mPriceLevel=1,this.mCarAirLevel=0,this.mRedPacketLevel=0,this.mAdLevel=0,this.mOtherSceneLevels=[],this.curDoubleSpeedTime=0,this.curDoubleGoldTime=0,this.mManagerLevel=0,this.mRankAllGold=0}getCacheStorage(key){return key+=this.mSceneIndex,localStorage.getItem(key)}getCacheStorageBySceneIndex(key,index){return key+=index,localStorage.getItem(key)}setCacheStorage(key,val){key+=this.mSceneIndex;try{localStorage.setItem(key,val)}catch(error){}}loadCache(sceneIndex){console.log("loadCache  sceneIndex = "+sceneIndex),this.mSceneIndex=sceneIndex,localStorage.clear();var levelData=this.getCacheStorage(CacheDataType.levelData);null!=levelData&&""!=levelData&&(this.mLevel=JSON.parse(levelData));var goldData=this.getCacheStorage(CacheDataType.goldData);null!=goldData&&""!=goldData&&(this.mGold=JSON.parse(goldData));var expData=this.getCacheStorage(CacheDataType.expData);null!=expData&&""!=expData&&(this.mExp=JSON.parse(expData));var diamondData=localStorage.getItem(CacheDataType.diamondData);null!=diamondData&&""!=diamondData&&(this.mDiamond=JSON.parse(diamondData));var carLevel=this.getCacheStorage(CacheDataType.carLevel);null!=carLevel&&""!=carLevel&&(this.mCarLevel=JSON.parse(carLevel));var priceLevel=this.getCacheStorage(CacheDataType.priceLevel);null!=priceLevel&&""!=priceLevel&&(this.mPriceLevel=JSON.parse(priceLevel));var speedLevel=this.getCacheStorage(CacheDataType.speedLevel);null!=speedLevel&&""!=speedLevel&&(this.mSpeedLevel=JSON.parse(speedLevel));var carAirLevel=this.getCacheStorage(CacheDataType.carAirLevel);null!=carAirLevel&&""!=carAirLevel&&(this.mCarAirLevel=JSON.parse(carAirLevel));var redPacketLevel=this.getCacheStorage(CacheDataType.redPacketLevel);null!=redPacketLevel&&""!=redPacketLevel&&(this.mRedPacketLevel=JSON.parse(redPacketLevel));var adLevel=this.getCacheStorage(CacheDataType.adLevel);null!=adLevel&&""!=adLevel&&(this.mAdLevel=JSON.parse(adLevel));var doubleSpeedTime=this.getCacheStorage(CacheDataType.doubleSpeedTime);null!=doubleSpeedTime&&""!=doubleSpeedTime&&(this.curDoubleSpeedTime=JSON.parse(doubleSpeedTime));var doubleGoldTime=this.getCacheStorage(CacheDataType.doubleGoldTime);null!=doubleGoldTime&&""!=doubleGoldTime&&(this.curDoubleGoldTime=JSON.parse(doubleGoldTime));var managerLevel=localStorage.getItem(CacheDataType.managerLevel);null!=managerLevel&&""!=managerLevel?this.mManagerLevel=JSON.parse(managerLevel):null!=(managerLevel=this.getCacheStorage(CacheDataType.managerLevel))&&""!=managerLevel&&(this.mManagerLevel=JSON.parse(managerLevel));var lotteryData=localStorage.getItem(CacheDataType.lotteryData);null!=lotteryData&&""!=lotteryData&&(this.mIsLottery=JSON.parse(lotteryData)),this.mRankAllGold=this.mGold;var rankAllGold=localStorage.getItem(CacheDataType.rankAllGold);null!=rankAllGold&&""!=rankAllGold&&(this.mRankAllGold=JSON.parse(rankAllGold));var days=this.getCacheStorage(CacheDataType.loginTime),timeDate=new Date;let time=timeDate.getTime(),day=timeDate.getDate(),month=timeDate.getMonth();if(null!=days&&""!=days){let loginData=JSON.parse(days);this.offlineTime=(time-loginData.time)/1e3}let loginData={time:time,day:day,month:month,num:1};this.setCacheStorage(CacheDataType.loginTime,JSON.stringify(loginData));let loginTime_common=localStorage.getItem(CacheDataType.loginTime_common),signNumTemp=this.mSignTimes;if(null!=loginTime_common&&""!=loginTime_common){let loginData_Common=JSON.parse(loginTime_common);signNumTemp=loginData_Common.signDayNum,time-864e5>=loginData_Common.time||day>loginData_Common.day||month>loginData_Common.month?(this.curDays=loginData_Common.num+1,this.mIsSign=!1,this.mSignTimes=loginData_Common.signDayNum+1,this.mSignTimes>=7&&(this.mSignTimes=0),this.mIsLottery=!0,localStorage.setItem(CacheDataType.lotteryData,JSON.stringify(this.mIsLottery))):(this.curDays=loginData_Common.num,this.mIsSign=loginData_Common.sign,this.mSignTimes=loginData_Common.signDayNum)}let loginData_Common={time:time,day:day,month:month,num:this.curDays,sign:this.mIsSign,signDayNum:signNumTemp};localStorage.setItem(CacheDataType.loginTime_common,JSON.stringify(loginData_Common))}getOtherSceneLevelByIndex(sceneIndex){if(sceneIndex==this.mSceneIndex)return this.mLevel;for(let i=0;i<this.mOtherSceneLevels.length;i++){let element=this.mOtherSceneLevels[i];if(element.sceneIndex==sceneIndex)return element.level}let data={sceneIndex:sceneIndex,level:0};var levelData=this.getCacheStorageBySceneIndex(CacheDataType.levelData,sceneIndex.toString());if(null!=levelData&&""!=levelData){let level=JSON.parse(levelData);return data.level=level,this.mOtherSceneLevels.push(data),level}return this.mOtherSceneLevels.push(data),0}setLoginTime(){var timeDate=new Date;let loginData={time:timeDate.getTime(),day:timeDate.getDate(),month:timeDate.getMonth(),num:1};this.setCacheStorage(CacheDataType.loginTime,JSON.stringify(loginData))}sign(){this.mIsSign=!0;var timeDate=new Date;let loginData_Common={time:timeDate.getTime(),day:timeDate.getDate(),month:timeDate.getMonth(),num:this.curDays,sign:this.mIsSign,signDayNum:this.mSignTimes};localStorage.setItem(CacheDataType.loginTime_common,JSON.stringify(loginData_Common))}lottery(){this.mIsLottery=!1,localStorage.setItem(CacheDataType.lotteryData,JSON.stringify(this.mIsLottery))}addDiamond(num){num=Math.floor(num),this.mDiamond+=num,EventManager.instance.fire(EventType.updateDiamond),localStorage.setItem(CacheDataType.diamondData,this.mDiamond.toString())}decDiamond(num){num=Math.floor(num),this.mDiamond<num||(this.mDiamond-=num,EventManager.instance.fire(EventType.updateDiamond),localStorage.setItem(CacheDataType.diamondData,this.mDiamond.toString()))}addGold(num){num=Math.floor(num),this.mGold+=num,EventManager.instance.fire(EventType.updateGold),this.setCacheStorage(CacheDataType.goldData,this.mGold.toString()),this.mRankAllGold+=num,localStorage.setItem(CacheDataType.rankAllGold,this.mRankAllGold.toString()),Utils.setRankData(this.mRankAllGold.toString())}descGold(num){(num=Math.floor(num))>this.mGold||(this.mGold-=num,EventManager.instance.fire(EventType.updateGold),this.setCacheStorage(CacheDataType.goldData,this.mGold.toString()))}addExp(num){num=Math.floor(num),this.mExp+=num,this.setCacheStorage(CacheDataType.expData,this.mExp.toString()),EventManager.instance.fire(EventType.updateExp)}upgradeLevel(){this.mLevel++,this.mExp=0,this.setCacheStorage(CacheDataType.levelData,this.mLevel.toString()),this.setCacheStorage(CacheDataType.expData,this.mExp.toString()),EventManager.instance.fire(EventType.updateExp),EventManager.instance.fire(EventType.upgradeLevel),Utils.aldEventByTypeParam(aldEventType.ald_user_level,aldEventType.ald_user_level,this.mLevel.toString())}getUserConfig(){return this.mLevel>=this.userConfig.length?this.userConfig[this.userConfig.length-1]:this.userConfig[this.mLevel-1]}getUserConfigByLevel(level){return level<1&&(level=1),this.userConfig[level-1]}calculateGoldCoefficientScene(num){if(0==this.mSceneIndex)return num;{let Coefficient=2.5;for(let i=0;i<this.mSceneIndex;i++)Coefficient*=2;num*=Coefficient}return num}getCostConfigById(id){return this.costConfigs[id-1]}getPlaceConfigById(id){return this.placeConfigs[id-1]}buyCar(){this.mCarLevel++,EventManager.instance.fire(EventType.buyCarClick),this.setCacheStorage(CacheDataType.carLevel,this.mCarLevel.toString()),Utils.aldEventByTypeParam(aldEventType.ald_car_level,aldEventType.ald_car_level,this.mCarLevel.toString())}upgradePrice(){this.mPriceLevel++,EventManager.instance.fire(EventType.addPriceClick),this.setCacheStorage(CacheDataType.priceLevel,this.mPriceLevel.toString()),Utils.aldEventByTypeParam(aldEventType.ald_price_level,aldEventType.ald_price_level,this.mPriceLevel.toString())}upgradeSpeed(){this.mSpeedLevel++,EventManager.instance.fire(EventType.upgradeSpeedClick),this.setCacheStorage(CacheDataType.speedLevel,this.mSpeedLevel.toString()),Utils.aldEventByTypeParam(aldEventType.ald_speed_level,aldEventType.ald_speed_level,this.mSpeedLevel.toString())}getSpeedTime(isCalculateDouble){null==isCalculateDouble&&(isCalculateDouble=!0);let time=this.getCostConfigById(this.mSpeedLevel).time;return time-=time*this.getRedPacketConfig().redPacketAward/100,this.curDoubleSpeedTime>0&&isCalculateDouble&&(time-=.5*time),time}startDoubleSpeed(time){this.curDoubleSpeedTime+=time,this.setCacheStorage(CacheDataType.doubleSpeedTime,this.curDoubleSpeedTime.toString()),EventManager.instance.fire(EventType.doubleSpeedStart,[DoubleType.speed,this.curDoubleSpeedTime])}setDoubleSpeedTime(num){this.curDoubleSpeedTime=num;let time=Math.floor(num);(time%5e3==0||time<=0)&&(time<=0&&(this.curDoubleSpeedTime=0,EventManager.instance.fire(EventType.doubleSpeedOver)),this.setCacheStorage(CacheDataType.doubleSpeedTime,this.curDoubleSpeedTime.toString()))}startDoubleGold(time){this.curDoubleGoldTime+=time,this.setCacheStorage(CacheDataType.doubleGoldTime,this.curDoubleGoldTime.toString()),EventManager.instance.fire(EventType.doubleGoldStart,[DoubleType.gold,this.curDoubleGoldTime])}setDoubleGoldTime(time){this.curDoubleGoldTime=time,((time=Math.floor(time))%5e3==0||time<=0)&&(time<=0&&(this.curDoubleGoldTime=0,EventManager.instance.fire(EventType.doubleGoldOver)),this.setCacheStorage(CacheDataType.doubleGoldTime,this.curDoubleGoldTime.toString()))}getCurAwardByPlaceLevel(level,isCalculateDouble){null==isCalculateDouble&&(isCalculateDouble=!0);let conf=this.getCostConfigById(this.mPriceLevel),num=conf.priceAward+conf.priceAward*(level-1)*.5;return num=this.calculateGoldCoefficientScene(num),num+=this.getCarAirConfig().airConditionerAward,num+=num*this.getAdConfig().adAward,this.curDoubleGoldTime>0&&isCalculateDouble&&(num*=2),num}getCurEarning(){let count=0,num=0,time=0;for(let i=this.mCarLevel;i>=1&&!(count>=16);i--){let element=this.getCostConfigById(i);num+=this.getCurAwardByPlaceLevel(element.carLevel,!1),time+=this.getSpeedTime(!1),count++}return count*num/time}upgradeCarAir(){this.mCarAirLevel++,EventManager.instance.fire(EventType.upgradeCarAir),this.setCacheStorage(CacheDataType.carAirLevel,this.mCarAirLevel.toString()),Utils.aldEventByTypeParam(aldEventType.ald_air_level,aldEventType.ald_air_level,this.mCarAirLevel.toString())}upgradeRedPacket(){this.mRedPacketLevel++,EventManager.instance.fire(EventType.upgradeCarAir),this.setCacheStorage(CacheDataType.redPacketLevel,this.mRedPacketLevel.toString()),Utils.aldEventByTypeParam(aldEventType.ald_red_level,aldEventType.ald_red_level,this.mRedPacketLevel.toString())}upgradeAd(){this.mAdLevel++,EventManager.instance.fire(EventType.upgradeAd),this.setCacheStorage(CacheDataType.adLevel,this.mAdLevel.toString()),Utils.aldEventByTypeParam(aldEventType.ald_ad_level,aldEventType.ald_ad_level,this.mAdLevel.toString())}getExtraConfigByType(extraConfigType){switch(extraConfigType){case ExtraConfigType.carAir:return this.extraConfig[this.mCarAirLevel];case ExtraConfigType.redPacket:return this.extraConfig[this.mRedPacketLevel];case ExtraConfigType.ad:return this.extraConfig[this.mAdLevel]}}getCarAirConfig(){return this.extraConfig[this.mCarAirLevel]}getRedPacketConfig(){return this.extraConfig[this.mRedPacketLevel]}getAdConfig(){return this.extraConfig[this.mAdLevel]}upgradeManager(){this.mManagerLevel++,EventManager.instance.fire(EventType.upgradeManager),localStorage.setItem(CacheDataType.managerLevel,this.mManagerLevel.toString())}getManagerAwardTime(){return 60*(60+10*(this.mManagerLevel-1))}loadCostConfig(data){for(let i=0;i<data.length;i++){const element=data[i];let con=new CostConfig;con.initData(element),this.costConfigs.push(con)}}loadPlaceConfig(data){for(let i=0;i<data.length;i++){const element=data[i];let con=new PlaceConfig;con.initData(element),this.placeConfigs.push(con)}}loadExtraConfig(data){for(let i=0;i<data.length;i++){const element=data[i];let con=new ExtraConfig;con.initData(element),this.extraConfig.push(con)}}loadUserConfig(data){for(let i=0;i<data.length;i++){const element=data[i];let con=new UserConfig;con.initData(element),this.userConfig.push(con)}}}class ScenesManager{init(){}openScene(sceneName,callBack,isCloseOther){null==isCloseOther&&(isCloseOther=!0);let args=[callBack];Laya.Scene.open(sceneName,isCloseOther,null,Laya.Handler.create(this,this.onOpenCompleteScene,args))}onOpenCompleteScene(callBack,scene){callBack&&callBack.runWith(scene)}loadScene(sceneName,callBack){let args=[callBack];Laya.Scene.load(sceneName,Laya.Handler.create(this,this.onCompleteScene,args))}onCompleteScene(callBack,scene){callBack&&callBack.runWith(scene)}loadScene3D(name,callBack){let args=[callBack];Laya.Scene3D.load(name,Laya.Handler.create(this,this.onCompleteScene3D,args))}onCompleteScene3D(callBack,scene){this.scene3D=scene,scene.ambientColor=new Laya.Vector3(.2,.2,.2),console.log("scene.reflectionIntensity = "+scene.reflectionIntensity),Laya.stage.addChildAt(scene,0),callBack&&callBack.runWith(scene)}}class LoadManager{constructor(){}init(){}loadPrefab3D(path,callBack,self,args){Laya.Sprite3D.load(path,Laya.Handler.create(self,callBack,args))}load(path,callBack){Laya.loader.load(path,Laya.Handler.create(this,callBack))}}class TimeManager{constructor(){}init(){}onceExecute(delay,self,callBack,agrs){delay*=1e3,Laya.timer.once(delay,self,callBack,agrs)}clear(self,callBack){Laya.timer.clear(self,callBack)}clearAll(self){Laya.timer.clearAll(self)}loop(delay,self,callBack,args){delay*=1e3,Laya.timer.loop(delay,self,callBack,args)}framLoop(self,callBack,args){Laya.timer.frameLoop(1,self,callBack,args)}}class ConstantConfig{}ConstantConfig.mainScene="MainScene.scene",ConstantConfig.mainView="MainView.scene",ConstantConfig.managerUI="ManagerUI.scene",ConstantConfig.worldMapDialog="WorldMapDialog.scene",ConstantConfig.signDialog="SignDialog.scene",ConstantConfig.RankDialog="RankDialog.scene",ConstantConfig.lotteryDialog="LotteryDialog.scene",ConstantConfig.upgradeDialog="UpgradeDialog.scene",ConstantConfig.awardLittleAnim="AwardLittleAnim.scene",ConstantConfig.doubleEffectDialog="DoubleEffectDialog.scene",ConstantConfig.battleLoadingView="BattleLoadingView.scene",ConstantConfig.roadTestMainView="RoadTestMainView.scene",ConstantConfig.driftMainView="DriftMainView.scene",ConstantConfig.car3DPath="unity/Conventional/CarPrefab",ConstantConfig.student3DPath="unity/Conventional/Student.lh",ConstantConfig.goldAnim3DPath="unity/Conventional/GoldAnim.lh",ConstantConfig.mainScene3DPath="unity/Conventional/Main1",ConstantConfig.roadTestScene3DPath="unity/Conventional/Battle1.ls",ConstantConfig.driftScene3DPath="unity/Conventional/Drift.ls",ConstantConfig.driftCar3DPath="unity/Conventional/DriftCarPrefab1.lh",ConstantConfig.startScene="LoadingScene.scene",ConstantConfig.SelectSceneIdCache="SelectSceneIdCache",ConstantConfig.Anim_Time=10,ConstantConfig.QueueStudentNum=4,ConstantConfig.CarCoefficient=.6,ConstantConfig.SpeedCoefficient=.4,ConstantConfig.AirCoefficient=.4,ConstantConfig.AdCoefficient=2,ConstantConfig.CAR_TYPE_NUM=3,ConstantConfig.SCREEN_FIT_TOP=60,ConstantConfig.FLY_COIN_TIME=180,ConstantConfig.DRIFT_KILL_CAR_COUNT=5,ConstantConfig.DRIFT_MAX_ENEMY_CAR_COUNT=15,ConstantConfig.DRIFT_KILL_CAR_COUNT_CACHE="DRIFT_KILL_CAR_COUNT_CACHE",ConstantConfig.DRIFT_LOCK_LEVEL=5,ConstantConfig.upgradeAir=10,ConstantConfig.upgradeRedPackage=20,ConstantConfig.upgradeAd=30;var ui,DoubleState,REG=Laya.ClassUtils.regClass;!function(ui){class DriftMainViewUI extends Laya.View{constructor(){super()}createChildren(){super.createChildren(),this.loadScene("DriftMainView")}}ui.DriftMainViewUI=DriftMainViewUI,REG("ui.DriftMainViewUI",DriftMainViewUI);class NewGuiViewUI extends Laya.View{constructor(){super()}createChildren(){super.createChildren(),this.loadScene("NewGuiView")}}ui.NewGuiViewUI=NewGuiViewUI,REG("ui.NewGuiViewUI",NewGuiViewUI);class RoadTestMainViewUI extends Laya.View{constructor(){super()}createChildren(){super.createChildren(),this.loadScene("RoadTestMainView")}}ui.RoadTestMainViewUI=RoadTestMainViewUI,REG("ui.RoadTestMainViewUI",RoadTestMainViewUI);class testanimUIUI extends Laya.View{constructor(){super()}createChildren(){super.createChildren(),this.loadScene("testanimUI")}}ui.testanimUIUI=testanimUIUI,REG("ui.testanimUIUI",testanimUIUI)}(ui||(ui={})),function(ui){!function(test){class TestSceneUI extends Laya.Scene{constructor(){super()}createChildren(){super.createChildren(),this.loadScene("test/TestScene")}}(ui.test||(ui.test={})).TestSceneUI=TestSceneUI,REG("ui.test.TestSceneUI",TestSceneUI)}()}(ui||(ui={}));class NewGuiViewUIScr extends ui.NewGuiViewUI{constructor(){super()}onAwake(){}onEnable(){this.MaskObj.cacheAs="bitmap",this.showStep()}onDisable(){}init(step){this.step=step}showStep(){let stepName="step"+this.step,stepObj=this.MaskObj.getChildByName(stepName);this.drawMaskRect(stepObj),this.showHand(stepObj)}showHand(stepObj){stepObj.width,stepObj.height,this.noticeLabel.visible=!1,1==this.step?(this.handObj.pos(stepObj.x,stepObj.y),this.handObj.rotation=150):2!=this.step&&3!=this.step&&4!=this.step||(this.handObj.rotation=-30,this.handObj.pos(stepObj.x+stepObj.width,stepObj.y+stepObj.height),2==this.step&&(this.noticeLabel.visible=!0,this.noticeLabel.pos(stepObj.x,stepObj.y+stepObj.height+100),this.noticeLabel.text="连续点击屏幕，加速车辆"))}drawMaskRect(stepObj){this.maskArea=new Laya.Sprite,this.maskArea.alpha=stepObj.alpha,this.maskArea.graphics.drawRect(0,0,Laya.stage.width,Laya.stage.height,"#000000"),this.MaskObj.addChild(this.maskArea),this.rectBg=new Laya.Sprite,this.rectBg.blendMode="destination-out",this.MaskObj.addChild(this.rectBg),this.rectBg.graphics.drawRect(stepObj.x,stepObj.y,stepObj.width,stepObj.height,"#000000"),this.hitArea=new Laya.HitArea,this.hitArea.hit.drawRect(0,0,Laya.stage.width,Laya.stage.height,"#000000"),this.mouseEnabled=!0,this.hitArea.unHit.drawRect(stepObj.x,stepObj.y,stepObj.width,stepObj.height,"#000000")}completeStep(){this.maskArea.destroy(!0),this.rectBg.destroy(!0),this.hitArea.unHit.clear(),this.close(),this.removeSelf(),this.destroy(!0)}}class NewGuideManager{constructor(){this.allStep=4,this.curStep=1,this.NEW_GUIDE_COMPLETE="newGuideComplete"}onEnable(){}onDisable(){}init(){this.isCompleteGuid=!1;let newGuideComplete=localStorage.getItem("newGuideComplete");null!=newGuideComplete&&""!=newGuideComplete&&(this.isCompleteGuid=!0),this.isCompleteGuid||(localStorage.setItem("newGuideComplete","1"),this.curStep=0,EventManager.instance.on(EventType.newGuide_StartNextStep,this,this.nextStep),EventManager.instance.on(EventType.newGuide_CompleteStep,this,this.completeStep))}nextStep(){if(console.log("nextStep"),this.curStep>=this.allStep)return console.log("completeStep  all"),this.newGuideUI=null,this.isCompleteGuid=!0,void Utils.aldEventByType(aldEventType.ald_newGuide);this.curStep++,this.newGuideUI=new NewGuiViewUIScr,this.newGuideUI.init(this.curStep),this.newGuideUI.open(!1)}completeStep(){this.newGuideUI.completeStep(),console.log("completeStep == "+this.curStep),3==this.curStep||this.nextStep()}}class UIManager{constructor(){}init(){this.curRootUI=null}}class AdManager{constructor(){this.adUnitId1="adunit-bd608b63edd8bff0",this.adUnitId2="",this.adUnitId3=""}init(){if(Laya.Browser.onMiniGame){let winSize=wx.getSystemInfoSync();this.bannerAd=wx.createBannerAd({adUnitId:"adunit-0caf3422d96a9f20",adIntervals:60,style:{left:(winSize.windowWidth-300)/2,top:winSize.windowHeight-80,width:300}}),this.bannerAd.onResize(res=>{this.bannerAd.style.top=winSize.windowHeight-this.bannerAd.style.realHeight}),this.bannerAd.onError(function(res){console.log(res)})}}showBannerAd(){Laya.Browser.onMiniGame&&null!=this.bannerAd&&this.bannerAd.show()}hideBannerAd(){Laya.Browser.onMiniGame&&null!=this.bannerAd&&this.bannerAd.hide()}showRecommendAdIcon(){if(!Laya.Browser.onMiniGame||null==this.bannerAd)return;let iconAd=null;wx.getSystemInfoSync(),wx.createGameIcon&&(iconAd=wx.createGameIcon({adUnitId:"PBgAAflgUpHlTHQg",count:1})),iconAd&&iconAd.load().then(()=>{iconAd.show()}).catch(err=>{console.error(err)})}showAd(index,callBack){if(!Laya.Browser.onMiniGame)return void(callBack&&callBack(!0));console.log("开始广告");let adUnitId=this.adUnitId1;adUnitId=1===index?this.adUnitId1:2===index?this.adUnitId2:this.adUnitId3,this.RewardedVideoAd=wx.createRewardedVideoAd({adUnitId:adUnitId}),this.RewardedVideoAd.onError(function(res){console.log("加载广告失败"+JSON.stringify(res)),self.showToastFail("加载广告失败"),callBack&&callBack(!1)});let self=this;this.RewardedVideoAd.offClose(),this.RewardedVideoAd.onClose(function(res){console.log("关闭广告"),res&&res.isEnded||void 0===res?(console.log("视频回调成功"),callBack&&callBack(!0)):(console.log("关闭视频无奖励"),self.showToastFail("未看完,无奖励"),callBack&&callBack(!1))}),self.RewardedVideoAd.show().catch(function(err){self.RewardedVideoAd.load().then(function(){self.RewardedVideoAd.show()})})}showToastFail(title){let noticeData={title:title,icon:"fail",duration:2e3};wx.showToast(noticeData)}}class Game{constructor(){console.log("game")}static get instance(){return null==Game._instance&&(Game._instance=new Game),Game._instance}init(){this.battleType=-2,this.userData=new UserData,this.userData.init(),this.eventManager=EventManager.instance,this.eventManager.init(),this.scenesManager=new ScenesManager,this.scenesManager.init(),this.loadManager=new LoadManager,this.loadManager.init(),this.timeManager=new TimeManager,this.timeManager.init(),this.newGuide=new NewGuideManager,this.newGuide.init(),this.uiManager=new UIManager,this.uiManager.init(),this.ad=new AdManager,this.ad.init(),this.loadScene()}loadCacheData(sceneIndex){this.userData.loadCache(sceneIndex)}loadScene(){this.scenesManager.openScene(ConstantConfig.startScene,Laya.Handler.create(this,this.onCompleteScene),!0)}onCompleteScene(scene){this.log("onCompleteScene"),this.setSceneUI(scene)}log(str){console.log(str)}setScene3D(scene){this.scene3D=scene,this.camera=scene.getChildByName("Main Camera"),this.camera.enableHDR=!1,console.log(""+Laya.stage.width),console.log(""+Laya.stage.height),Laya.stage.height/Laya.stage.width>=2&&(this.camera.fieldOfView=7)}setRoadTestScene3D(scene){this.scene3D=scene,this.camera=scene.getChildByName("Main Camera"),this.camera.enableHDR=!1}setDriftScene3D(scene){this.scene3D=scene;let cameraParent=scene.getChildByName("CameraParent");this.camera=cameraParent.getChildByName("Main Camera"),this.camera.enableHDR=!1,scene.getChildByName("CarExplode").active=!1}setSceneUI(scene){this.sceneUI=scene}reloadNewGameBySceneIndex(index){this.scene3D.destroy(!0),this.scene3D.removeSelf(),this.userData=new UserData,this.userData.init(),Game.instance.battleType=-2,this.loadScene()}startRoadTest(){console.log("开始路考"),this.scene3D.destroy(!0),this.scene3D.removeSelf(),this.battleType=0,this.scenesManager.openScene(ConstantConfig.battleLoadingView,Laya.Handler.create(this,function(scene){this.setSceneUI(scene)}),!0)}startDriftGame(){Utils.aldEventByType(aldEventType.ald_drift_times),console.log("开始进入漂移"),this.scene3D.destroy(!0),this.scene3D.removeSelf(),this.battleType=1,this.driftKillCarCountTarget=ConstantConfig.DRIFT_KILL_CAR_COUNT;var killCount=localStorage.getItem(ConstantConfig.DRIFT_KILL_CAR_COUNT_CACHE);null!=killCount&&""!=killCount&&(this.driftKillCarCountTarget=JSON.parse(killCount)),Utils.aldEventByTypeParam(aldEventType.ald_drift_level,aldEventType.ald_drift_level,this.driftKillCarCountTarget.toString()),this.scenesManager.openScene(ConstantConfig.battleLoadingView,Laya.Handler.create(this,function(scene){this.setSceneUI(scene)}),!0)}backMainGame(){this.scene3D.destroy(!0),this.scene3D.removeSelf(),this.battleType=-1,this.scenesManager.openScene(ConstantConfig.battleLoadingView,Laya.Handler.create(this,function(scene){this.setSceneUI(scene)}),!0)}}class RoadTestCarManager{constructor(){}init(){this.loadCar(),Game.instance.eventManager.on(EventType.roadTestStartMove,this,this.startMove),Game.instance.eventManager.on(EventType.roadTestStopMove,this,this.stopMove)}onUpdate(){}loadCar(){let car1=Game.instance.scene3D.getChildByName("Car");this.carObj=car1.getChildByName("Car3")}startMove(){console.log("startMove")}stopMove(){console.log("stopMove")}clearData(){}}class RoadTestMapManager{constructor(){}init(){}clearData(){}}class RoadTestNpcCarManager{constructor(){}init(){}clearData(){}}class RoadTestManager extends Laya.Script{constructor(){super()}onEnable(){this.init()}onDisable(){this.clearData()}onUpdate(){null!=this.carManager&&this.carManager.onUpdate()}init(){this.mapManager=new RoadTestMapManager,this.mapManager.init(),this.carManager=new RoadTestCarManager,this.carManager.init(),this.npcCarManager=new RoadTestNpcCarManager,this.npcCarManager.init()}clearData(){this.mapManager.clearData(),this.carManager.clearData(),this.npcCarManager.clearData()}}class DriftCarScr extends Laya.Script3D{constructor(){super()}onEnable(){let pc=this.owner.getComponent(Laya.PhysicsCollider),r=this.owner.getComponent(Laya.Rigidbody3D);if(null==pc&&null==r){pc=this.owner.addComponent(Laya.PhysicsCollider);var planeShape=new Laya.BoxColliderShape(.3,.3,.82);planeShape.localOffset=new Laya.Vector3(0,.15,0),pc.colliderShape=planeShape}}onDisable(){}init(guid){this.guid=guid}onTriggerEnter(other){Game.instance.eventManager.fire(EventType.driftCarTriggerEnter,this.guid)}onTriggerStay(other){}onTriggerExit(other){}}class EffectDelayAutoDestroy extends Laya.Script3D{constructor(){super()}onEnable(){Game.instance.timeManager.onceExecute(3,this,function(){this.owner.removeSelf(),this.owner.destroy(!0)})}onDisable(){}}class DriftCarBase{constructor(){this.rotateDir=0,this.moveSpeed=5,this.noDamageAllTime=3e3,this.curNoDamageTime=0,this.isNoDamage=!1}init(){this.rotateDir=0,this.carBody=null,this.dieEffect=null,this.moveSpeed=8,this.guid=Utils.getGuid(),this.blood=3,this.isNoDamage=!1,this.loadCar()}loadCar(){let path=ConstantConfig.car3DPath+1+".lh";Game.instance.loadManager.loadPrefab3D(path,this.onCompleteCar,this)}onCompleteCar(prefab){let carPrefab=prefab.getChildByName("Car");this.owner=Laya.Sprite3D.instantiate(carPrefab),Game.instance.scene3D.addChild(this.owner),this.setInitPos(),this.owner.addComponent(DriftCarScr).init(this.guid);let car4=carPrefab.getChildByName("Root").getChildByName("Car").getChildByName("Car").getChildByName("body_1");this.carBody=car4,car4.meshRenderer.castShadow=!0,this.defaultColor=car4.meshRenderer.sharedMaterial.albedoColor;let Dust=Game.instance.scene3D.getChildByName("Dust");Dust.active=!1,this.effect=Laya.Sprite3D.instantiate(Dust),this.owner.addChild(this.effect),this.effect.particleSystem.emission.emissionRate=0,this.effect.active=!0,this.effect.transform.localPosition=new Laya.Vector3(0,0,-.5)}setInitPos(){this.owner.transform.localPosition=new Laya.Vector3(0,0,0),this.owner.transform.localRotationEuler=new Laya.Vector3(0,0,0)}onUpdate(){if(null!=this.owner&&(this.move(),this.rotate(),this.isNoDamage)){if(this.curNoDamageTime+=Laya.timer.delta,this.curNoDamageTime>=this.noDamageAllTime)return this.isNoDamage=!1,this.curNoDamageTime=0,void this.resetColor();this.changeColor()}}resetColor(){this.carBody.meshRenderer.sharedMaterial.albedoColor=this.defaultColor}changeColor(){Math.round(this.curNoDamageTime/50)%2==0?this.carBody.meshRenderer.sharedMaterial.albedoColor=new Laya.Vector4(158/255,0,0,1):this.resetColor()}move(){let dir=new Laya.Vector3(0,0,1);Laya.Vector3.scale(dir,Laya.timer.delta*this.moveSpeed/1e3,dir),this.owner.transform.translate(dir,!0)}setRotateDirection(rotateDirection){this.rotateDir=rotateDirection}rotate(){if(0!=this.rotateDir){let dir=new Laya.Vector3(0,1,0);Laya.Vector3.scale(dir,-Laya.timer.delta*this.rotateDir*200/1e3,dir);let euler=new Laya.Vector3(0,1,0);Laya.Vector3.add(dir,this.owner.transform.localRotationEuler,euler),this.owner.transform.localRotationEuler=euler;let car2=this.owner.getChildByName("Root").getChildByName("Car"),car3=car2.getChildByName("Car"),numZ=10*this.rotateDir,z=Laya.MathUtil.lerp(car3.transform.localRotationEuler.z,numZ,5*Laya.timer.delta/1e3);car3.transform.localRotationEuler=new Laya.Vector3(0,0,z);let numY=50*this.rotateDir,carY=Laya.MathUtil.lerp(car2.transform.localRotationEuler.y,-numY,Laya.timer.delta/1e3);car2.transform.localRotationEuler=new Laya.Vector3(0,carY,0);let wheel_F_R=car2.getChildByName("Wheel_F_R"),wheel_F_L=car2.getChildByName("Wheel_F_L"),angle=Laya.MathUtil.lerp(wheel_F_R.transform.localRotationEuler.y,30*-this.rotateDir,5*Laya.timer.delta/1e3),angleV=new Laya.Vector3(0,angle,0);wheel_F_R.transform.localRotationEuler=angleV,wheel_F_L.transform.localRotationEuler=angleV,this.effect.particleSystem.emission.emissionRate=30}else{this.effect.particleSystem.emission.emissionRate=0;let car2=this.owner.getChildByName("Root").getChildByName("Car"),car3=car2.getChildByName("Car"),z=Laya.MathUtil.lerp(car3.transform.localRotationEuler.z,0,10*Laya.timer.delta/1e3);car3.transform.localRotationEuler=new Laya.Vector3(0,0,z);let carY=Laya.MathUtil.lerp(car2.transform.localRotationEuler.y,0,10*Laya.timer.delta/1e3);car2.transform.localRotationEuler=new Laya.Vector3(0,carY,0);let wheel_F_R=car2.getChildByName("Wheel_F_R"),wheel_F_L=car2.getChildByName("Wheel_F_L"),angle=Laya.MathUtil.lerp(wheel_F_R.transform.localRotationEuler.y,0,10*Laya.timer.delta/1e3),angleV=new Laya.Vector3(0,angle,0);wheel_F_R.transform.localRotationEuler=angleV,wheel_F_L.transform.localRotationEuler=angleV}}decBlood(){this.blood--}setNoDamage(){this.isNoDamage=!0,this.curNoDamageTime=0}revive(){this.blood=3,this.setNoDamage(),this.owner.active=!0}selfDie(){let CarExplode=Game.instance.scene3D.getChildByName("CarExplode"),effect=Laya.Sprite3D.instantiate(CarExplode);Game.instance.scene3D.addChild(effect),effect.transform.position=this.owner.transform.position,effect.active=!0,this.dieEffect=effect,this.owner.active=!1,this.resetColor()}die(){let CarExplode=Game.instance.scene3D.getChildByName("CarExplode"),effect=Laya.Sprite3D.instantiate(CarExplode);Game.instance.scene3D.addChild(effect),effect.transform.position=this.owner.transform.position,effect.active=!0,effect.addComponent(EffectDelayAutoDestroy),this.clearData()}clearData(){this.resetColor(),this.owner.removeSelf(),this.owner.destroy(!0),this.owner=null,this.carBody=null,this.effect=null,null!=this.dieEffect&&(this.dieEffect.removeSelf(),this.dieEffect.destroy(!0),this.dieEffect=null)}}class DriftcCarNpc extends DriftCarBase{constructor(){super()}initTarget(target){this.targetCar=target,this.init(),this.moveSpeed*=1.04,this.blood=1}loadCar(){let path=ConstantConfig.driftCar3DPath;Game.instance.loadManager.loadPrefab3D(path,this.onCompleteCar,this)}setInitPos(){let targetPosition=this.targetCar.owner.transform.position;this.owner.transform.position=targetPosition;let dir=new Laya.Vector3(0,0,0),randAngle=Utils.random(0,360),randDis=.5*Utils.random(8,15);this.owner.transform.rotationEuler=new Laya.Vector3(0,randAngle,0);let forward=new Laya.Vector3(0,0,1);Laya.Vector3.scale(forward,randDis,dir),this.owner.transform.translate(dir,!0)}onUpdate(){null!=this.owner&&(super.onUpdate(),this.followTarget())}followTarget(){let targetPosition=this.targetCar.owner.transform.position,dir=new Laya.Vector3(0,0,1);Laya.Vector3.subtract(targetPosition,this.owner.transform.position,dir);let forward=new Laya.Vector3(0,0,1);if(this.owner.transform.getForward(forward),forward=new Laya.Vector3(-forward.x,-forward.y,-forward.z),Laya.Vector3.normalize(dir,dir),Laya.Vector3.normalize(forward,forward),180*Math.acos(Laya.Vector3.dot(forward,dir))/Math.PI>=30){let temp=new Laya.Vector3(0,0,1);Laya.Vector3.cross(new Laya.Vector3(0,1,0),forward,temp),new Laya.Vector3(0,0,1),Laya.Vector3.dot(temp,dir)>0?this.setRotateDirection(-1):this.setRotateDirection(1)}else this.setRotateDirection(0)}}class DriftCarManager{constructor(){this.isStartGame=!1,this.npcRefreshTime=3e3,this.curNpcRefreshTime=5e3,this.killCarCount=0,this.npcCarList=[]}init(){this.npcCarList=[],this.createSelfCar(),Game.instance.eventManager.on(EventType.driftMouseDownLeft,this,this.onLeftCtrlDown),Game.instance.eventManager.on(EventType.driftMouseUpLeft,this,this.onLeftCtrlUp),Game.instance.eventManager.on(EventType.driftMouseDownRight,this,this.onRightCtrlDown),Game.instance.eventManager.on(EventType.driftMouseUpRight,this,this.onRightCtrlUp),Game.instance.eventManager.on(EventType.driftStartGame,this,this.startGame),Game.instance.eventManager.on(EventType.driftCarTriggerEnter,this,this.carTriggerEnter),Game.instance.eventManager.on(EventType.driftReviveGame,this,this.reviveGame)}clearData(){Game.instance.eventManager.off(EventType.driftMouseDownLeft,this,this.onLeftCtrlDown),Game.instance.eventManager.off(EventType.driftMouseUpLeft,this,this.onLeftCtrlUp),Game.instance.eventManager.off(EventType.driftMouseDownRight,this,this.onRightCtrlDown),Game.instance.eventManager.off(EventType.driftMouseUpRight,this,this.onRightCtrlUp),Game.instance.eventManager.off(EventType.driftStartGame,this,this.startGame),Game.instance.eventManager.off(EventType.driftCarTriggerEnter,this,this.carTriggerEnter),Game.instance.eventManager.off(EventType.driftReviveGame,this,this.reviveGame),null!=this.selfCar&&this.selfCar.clearData();for(let i=0;i<this.npcCarList.length;i++)this.npcCarList[i].clearData()}onUpdate(){if(this.isStartGame){null!=this.selfCar&&this.selfCar.onUpdate();for(let i=0;i<this.npcCarList.length;i++)this.npcCarList[i].onUpdate();this.refreshNpc()}}createSelfCar(){this.selfCar=new DriftCarBase,this.selfCar.init()}createNpcCar(){let car=new DriftcCarNpc;car.initTarget(this.selfCar),this.npcCarList.push(car)}refreshNpc(){this.npcCarList.length>=ConstantConfig.DRIFT_MAX_ENEMY_CAR_COUNT||(this.curNpcRefreshTime+=Laya.timer.delta,this.curNpcRefreshTime>=this.npcRefreshTime&&(this.curNpcRefreshTime=0,this.createNpcCar()))}startGame(){Game.instance.eventManager.fire(EventType.driftStarCameraFollow,this.selfCar.owner),Game.instance.eventManager.fire(EventType.driftStartMove,this.selfCar.owner),this.isStartGame=!0}reviveGame(){this.isStartGame=!0,this.selfCar.revive(),Game.instance.eventManager.fire(EventType.driftSelfCarBloodUpdate,this.selfCar.blood)}getCarByGuid(guid){for(let i=0;i<this.npcCarList.length;i++){const element=this.npcCarList[i];if(element.guid==guid)return element}return null}removeCar(car){this.npcCarList=Utils.removeArr(this.npcCarList,car)}startMove(){console.log("startMove")}stopMove(){console.log("stopMove")}onLeftCtrlDown(){this.selfCar&&this.selfCar.setRotateDirection(-1)}onLeftCtrlUp(){this.selfCar&&this.selfCar.setRotateDirection(0)}onRightCtrlDown(){this.selfCar&&this.selfCar.setRotateDirection(1)}onRightCtrlUp(){this.selfCar&&this.selfCar.setRotateDirection(0)}carTriggerEnter(guid){if(this.selfCar.guid==guid){if(this.selfCar.isNoDamage)return;return this.selfCar.decBlood(),Utils.vibrateLong(),Game.instance.eventManager.fire(EventType.driftSelfCarBloodUpdate,this.selfCar.blood),this.selfCar.setNoDamage(),void(this.selfCar.blood<=0&&(this.isStartGame=!1,this.selfCar.selfDie(),Game.instance.eventManager.fire(EventType.driftGameOver,!1)))}let car=this.getCarByGuid(guid);if(null!=car)return car.decBlood(),Utils.vibrate(),void(car.blood<=0&&(car.die(),this.removeCar(car),this.killCarCount++,Game.instance.eventManager.fire(EventType.driftKillCarUpdate,this.killCarCount),this.killCarCount>=Game.instance.driftKillCarCountTarget&&(this.isStartGame=!1,Game.instance.eventManager.fire2(EventType.driftGameOver,!0,this.selfCar.blood))))}}class DriftNpcCarManager{constructor(){}init(){}clearData(){}}class DriftMapManager{constructor(){this.isStartMove=!1,this.isStartFollow=!1,this.groundTextureSpeed=-.2}init(){this.isStartMove=!1,this.isStartFollow=!1;let light=Game.instance.scene3D.getChildByName("Directional Light");light.shadow=!0,light.shadowDistance=3e3,light.shadowResolution=2048,light.shadowPSSMCount=1,light.shadowPCFType=3,this.groundObj=Game.instance.scene3D.getChildByName("Ground"),this.groundObj.meshRenderer.receiveShadow=!0,Game.instance.eventManager.on(EventType.driftStarCameraFollow,this,this.initFollowTarget),Game.instance.eventManager.on(EventType.driftStartMove,this,this.initStartMove)}clearData(){this.isStartMove=!1,this.groundObj=null,this.targetObj=null,Game.instance.eventManager.off(EventType.driftStarCameraFollow,this,this.initFollowTarget),Game.instance.eventManager.off(EventType.driftStartMove,this,this.initStartMove)}onLateUpdate(){this.follow(),this.move()}initFollowTarget(target){this.targetObj=target,this.isStartFollow=!0}initStartMove(){this.isStartMove=!0}follow(){this.isStartFollow&&null!=this.targetObj&&null!=this.groundObj&&(this.groundObj.transform.position=this.targetObj.transform.position)}move(){if(!this.isStartMove)return;let x=-this.groundObj.transform.position.x,z=this.groundObj.transform.position.z,bpm=this.groundObj.meshRenderer.sharedMaterial;bpm.tilingOffsetZ=x*this.groundTextureSpeed,bpm.tilingOffsetW=z*this.groundTextureSpeed}}class DriftCameraFollow extends Laya.Script{constructor(){super(),this.isStartFollow=!1}onEnable(){}onDisable(){}onLateUpdate(){this.follow()}init(){this.isStartFollow=!1,this.cameraObj=Game.instance.scene3D.getChildByName("CameraParent"),Game.instance.eventManager.on(EventType.driftStarCameraFollow,this,this.starCameraFollow)}starCameraFollow(target){this.targetObj=target,this.isStartFollow=!0}follow(){this.isStartFollow&&null!=this.targetObj&&null!=this.cameraObj&&(this.cameraObj.transform.position=this.targetObj.transform.position)}clearData(){this.isStartFollow=!1,this.cameraObj=null,this.targetObj=null,Game.instance.eventManager.off(EventType.driftStarCameraFollow,this,this.starCameraFollow)}}class DriftManager extends Laya.Script{constructor(){super()}onEnable(){this.init()}onDisable(){this.clearData()}onUpdate(){null!=this.carManager&&this.carManager.onUpdate()}onLateUpdate(){null!=this.cameraFollow&&this.cameraFollow.onLateUpdate(),null!=this.mapManager&&this.mapManager.onLateUpdate()}init(){this.cameraFollow=new DriftCameraFollow,this.cameraFollow.init(),this.mapManager=new DriftMapManager,this.mapManager.init(),this.carManager=new DriftCarManager,this.carManager.init(),this.npcCarManager=new DriftNpcCarManager,this.npcCarManager.init()}clearData(){this.mapManager.clearData(),this.carManager.clearData(),this.npcCarManager.clearData()}getSelfCar(){}}class SchoolCarBase{constructor(){this.isClickAddSpeed=!1}init(placeConfig,level,isAddCarClick){null==isAddCarClick&&(isAddCarClick=!1),this.isPlaying=!1,this.mLevel=level,this.placeConfig=placeConfig,this.carAnim=null,this.isClickAddSpeed=!1,this.animName=Utils.getAnimByPlaceType(this.placeConfig.placeType),Game.instance.eventManager.on(EventType.getOnCarComplete,this,this.getOnCarComplete),isAddCarClick?this.loadUpgradeCar():this.loadCar()}carUpgrade(level){this.isPlaying=!1,this.mLevel=level,this.owner.destroy(!0),this.loadUpgradeCar()}loadUpgradeCar(){let level=(this.mLevel-1)%ConstantConfig.CAR_TYPE_NUM+1,path=ConstantConfig.car3DPath+level+".lh";Game.instance.loadManager.loadPrefab3D(path,this.onCompleteUpgradeCar,this)}onCompleteUpgradeCar(prefab){let carPrefab=prefab.getChildByName("Car");this.owner=Laya.Sprite3D.instantiate(carPrefab),Game.instance.scene3D.addChild(this.owner),this.owner.transform.localPosition=new Laya.Vector3(-this.placeConfig.posX,0,this.placeConfig.posZ),this.owner.transform.localRotationEuler=new Laya.Vector3(0,-this.placeConfig.rotateY,0);let startPercent=0;if(null!=this.carAnim){let state=this.carAnim.getCurrentAnimatorPlayState(0);startPercent=null!=state&&state.normalizedTime?state.normalizedTime:0}this.carAnim=this.owner.getComponent(Laya.Animator),this.setSpeed(),this.carAnim.play(this.animName,0,startPercent),this.isPlaying=!0}onUpdate(){this.checkAnim()}loadCar(){let level=(this.mLevel-1)%ConstantConfig.CAR_TYPE_NUM+1,path=ConstantConfig.car3DPath+level+".lh";Game.instance.loadManager.loadPrefab3D(path,this.onComplete,this)}onComplete(prefab){let carPrefab=prefab.getChildByName("Car");this.owner=Laya.Sprite3D.instantiate(carPrefab),Game.instance.scene3D.addChild(this.owner),this.owner.transform.localPosition=new Laya.Vector3(-this.placeConfig.posX,0,this.placeConfig.posZ),this.owner.transform.localRotationEuler=new Laya.Vector3(0,-this.placeConfig.rotateY,0),this.carAnim=this.owner.getComponent(Laya.Animator),this.firstAnim()}checkAnim(){if(!this.isPlaying||null==this.carAnim)return;let state=this.carAnim.getCurrentAnimatorPlayState(0);null!=state&&state.normalizedTime?state.normalizedTime>=1&&(this.isPlaying=!1,this.animComplete()):console.log("carAnim 没有动画状态")}doubleSpeedStart(){this.setSpeed()}doubleSpeedOver(){this.setSpeed()}addSpeedClickStart(){this.isClickAddSpeed=!0,this.setSpeed()}addSpeedClickOver(){this.isClickAddSpeed=!1,this.setSpeed()}upgradeSpeedClick(){this.setSpeed()}playAnim(){this.setSpeed(),this.carAnim.play(this.animName,0,0),this.isPlaying=!0}setSpeed(){if(null==this.carAnim)return;let curAllTime=Game.instance.userData.getSpeedTime();this.isClickAddSpeed&&(curAllTime-=.5*curAllTime);let animatorState=this.carAnim.getControllerLayer().getAnimatorState(this.animName);animatorState.clip.islooping=!1;let speed=animatorState.clip.duration()/curAllTime;animatorState.speed=speed}firstAnim(){this.setSpeed();let startPercent=Utils.random(1,9)/10;this.carAnim.play(this.animName,0,startPercent),this.isPlaying=!0}animComplete(){Game.instance.userData.addExp(1),Game.instance.eventManager.fire2(EventType.carAnimComplete,this.placeConfig,this.mLevel)}getOnCarComplete(placeId){placeId==this.placeConfig.id&&Game.instance.timeManager.onceExecute(.5,this,this.playAnim)}clearData(){Game.instance.eventManager.off(EventType.getOnCarComplete,this,this.getOnCarComplete),Game.instance.timeManager.clearAll(this),this.owner.destroy(!0),this.isPlaying=!1}}class SchoolCarManager{constructor(){this.carList=[]}init(){this.carList=[],this.load(),Game.instance.eventManager.on(EventType.buyCarClick,this,this.addCarClick),Game.instance.eventManager.on(EventType.upgradeSpeedClick,this,this.upgradeSpeedClick),Game.instance.eventManager.on(EventType.carAnimComplete,this,this.carAnimComplte),Game.instance.eventManager.on(EventType.addSpeedClickStart,this,this.addSpeedClickStart),Game.instance.eventManager.on(EventType.addSpeedClickOver,this,this.addSpeedClickOver),Game.instance.eventManager.on(EventType.doubleSpeedStart,this,this.doubleSpeedStart),Game.instance.eventManager.on(EventType.doubleSpeedOver,this,this.doubleSpeedOver)}onUpdate(){for(let i=0;i<this.carList.length;i++)this.carList[i].onUpdate()}load(){let count=0;for(let i=Game.instance.userData.mCarLevel;i>=1&&!(count>=16);i--){let element=Game.instance.userData.getCostConfigById(i),placeConfig=Game.instance.userData.getPlaceConfigById(element.placeId),car=new SchoolCarBase;car.init(placeConfig,element.carLevel),this.carList.push(car),count++}}upgradeSpeedClick(){for(let i=0;i<this.carList.length;i++)this.carList[i].upgradeSpeedClick()}doubleSpeedStart(){for(let i=0;i<this.carList.length;i++)this.carList[i].doubleSpeedStart()}doubleSpeedOver(){for(let i=0;i<this.carList.length;i++)this.carList[i].doubleSpeedOver()}addSpeedClickStart(){for(let i=0;i<this.carList.length;i++)this.carList[i].addSpeedClickStart()}addSpeedClickOver(){for(let i=0;i<this.carList.length;i++)this.carList[i].addSpeedClickOver()}addCarClick(){let carLevel=Game.instance.userData.mCarLevel,element=Game.instance.userData.getCostConfigById(carLevel),carBase=this.getCarByPlaceId(element.placeId);if(null==carBase){let placeConfig=Game.instance.userData.getPlaceConfigById(element.placeId),car=new SchoolCarBase;car.init(placeConfig,element.carLevel,!0),this.carList.push(car)}else carBase.carUpgrade(element.carLevel)}getCarByPlaceId(placeId){for(let i=0;i<this.carList.length;i++){var element=this.carList[i];if(element.placeConfig.id==placeId)return element}return null}carAnimComplte(placeConfig){this.showGoldAnim(placeConfig)}showGoldAnim(placeConfig){let goldObj=Laya.Pool.getItem("GoldObj");null==goldObj?Game.instance.loadManager.loadPrefab3D(ConstantConfig.goldAnim3DPath,function(prefab){let goldPrefab=prefab.getChildByName("GoldAnim"),goldAnim=Laya.Sprite3D.instantiate(goldPrefab);this.playGoldAnim(placeConfig,goldAnim)},this):this.playGoldAnim(placeConfig,goldObj)}playGoldAnim(placeConfig,goldAnim){Game.instance.scene3D.addChild(goldAnim),goldAnim.transform.localPosition=new Laya.Vector3(-placeConfig.posX,.4,placeConfig.posZ);let anim=goldAnim.getComponent(Laya.Animator),animatorState=anim.getControllerLayer().getAnimatorState("GoldAnim");animatorState.clip.islooping=!1;let animTime=animatorState.clip.duration();goldAnim.active=!0,anim.play("GoldAnim",0,0),Game.instance.timeManager.onceExecute(animTime,this,function(){goldAnim.active=!1,Laya.Pool.recover("GoldObj",goldAnim)})}clearData(){Game.instance.eventManager.off(EventType.buyCarClick,this,this.addCarClick),Game.instance.eventManager.off(EventType.upgradeSpeedClick,this,this.upgradeSpeedClick),Game.instance.eventManager.off(EventType.carAnimComplete,this,this.carAnimComplte),Game.instance.eventManager.off(EventType.addSpeedClickStart,this,this.addSpeedClickStart),Game.instance.eventManager.off(EventType.addSpeedClickOver,this,this.addSpeedClickOver),Game.instance.eventManager.off(EventType.doubleSpeedStart,this,this.doubleSpeedStart),Game.instance.eventManager.off(EventType.doubleSpeedOver,this,this.doubleSpeedOver),Game.instance.timeManager.clearAll(this);for(let i=0;i<this.carList.length;i++)this.carList[i].clearData();this.carList=[],Laya.Pool.clearBySign("GoldObj")}}class StudentBase{constructor(){this.speed=.01}init(index,parent,placeId){this.index=index,this.studentParent=parent,this.isStartMove=!1,this.placeId=placeId,this.load()}setSittingCar(){this.index=-1,this.gameObjet.active=!1}onUpdate(){if(!this.isStartMove||null==this.gameObjet)return;let curPos=this.gameObjet.transform.localPosition,deltaPos=new Laya.Vector3;Laya.Vector3.subtract(this.tartgetPos,curPos,deltaPos);let dis=Laya.Vector3.distance(this.tartgetPos,curPos),dir=new Laya.Vector3;Laya.Vector3.normalize(deltaPos,dir);let nextPos=new Laya.Vector3;Laya.Vector3.scale(dir,this.speed,nextPos),Laya.Vector3.scalarLength(nextPos)>=dis?(this.isStartMove=!1,this.gameObjet.transform.localPosition=this.tartgetPos,this.moveComplete()):(Laya.Vector3.add(nextPos,curPos,nextPos),this.gameObjet.transform.localPosition=nextPos)}load(){Game.instance.loadManager.loadPrefab3D(ConstantConfig.student3DPath,this.onComplete,this)}onComplete(prefab){let studentName="Student";studentName+=Utils.random(1,3);let studentPrefab=prefab.getChildByName(studentName);this.gameObjet=Laya.Sprite3D.instantiate(studentPrefab),this.studentParent.addChild(this.gameObjet),-1!=this.index?this.gameObjet.transform.localPosition=this.getLinePos():this.setSittingCar()}getOnCar(){this.index=-1,this.move(new Laya.Vector3(0,0,.3))}moveComplete(){-1==this.index&&(this.setSittingCar(),Game.instance.eventManager.fire(EventType.getOnCarComplete,this.placeId)),this.gameObjet.transform.localRotationEuler=new Laya.Vector3(0,0,0)}getOffCar(){this.gameObjet.transform.localPosition=new Laya.Vector3(.2,.05,.3),this.gameObjet.active=!0,this.index=ConstantConfig.QueueStudentNum}moveNextPos(){this.index-=1,this.move(this.getLinePos())}move(pos){this.isStartMove=!0,this.tartgetPos=pos;let curPos=this.gameObjet.transform.localPosition,deltaPos=new Laya.Vector3;Laya.Vector3.subtract(this.tartgetPos,curPos,deltaPos);let dir=new Laya.Vector3;Laya.Vector3.normalize(deltaPos,dir);let angle=180*Math.atan2(dir.x,dir.z)/Math.PI;this.gameObjet.transform.localRotationEuler=new Laya.Vector3(0,angle,0)}getLinePos(){return 0==this.index?new Laya.Vector3(0,0,0):new Laya.Vector3(0,0,-.3-.2*(this.index-1))}getIndex(){return this.index}clearData(){this.gameObjet.destroy(!0)}}class StudentLogic{constructor(){this.studentList=[]}init(placeConfig){this.placeConfig=placeConfig,this.curCarStudent=null,this.initParent(),this.loadStudent(),Game.instance.eventManager.on(EventType.carAnimComplete,this,this.carAnimComplete)}onUpdate(){for(let i=0;i<this.studentList.length;i++)this.studentList[i].onUpdate();null!=this.curCarStudent&&this.curCarStudent.onUpdate()}initParent(){this.studentParent=new Laya.Sprite3D,Game.instance.scene3D.addChild(this.studentParent),this.studentParent.transform.localPosition=new Laya.Vector3(-this.placeConfig.waitX,.05,this.placeConfig.waitZ),this.studentParent.transform.localRotationEuler=new Laya.Vector3(0,-this.placeConfig.waitRotateY,0)}loadStudent(){for(let i=0;i<ConstantConfig.QueueStudentNum;i++){let student=new StudentBase;student.init(i,this.studentParent,this.placeConfig.id),this.studentList.push(student)}let student=new StudentBase;student.init(-1,this.studentParent,this.placeConfig.id),this.curCarStudent=student}carAnimComplete(placeConfig){this.placeConfig.id==placeConfig.id&&(this.getOffCar(),this.getOnCar())}getOnCar(){let student=this.getFirstStudent();student.getOnCar(),this.curCarStudent=student,this.studentList.shift();for(let i=0;i<this.studentList.length;i++){const element=this.studentList[i];-1!=element.getIndex()&&element.moveNextPos()}}getOffCar(){this.curCarStudent.getOffCar(),this.studentList.push(this.curCarStudent)}getFirstStudent(){for(let i=0;i<this.studentList.length;i++){const element=this.studentList[i];if(0==element.getIndex())return element}}clearData(){Game.instance.eventManager.off(EventType.carAnimComplete,this,this.carAnimComplete);for(let i=0;i<this.studentList.length;i++)this.studentList[i].clearData();this.studentList=[],this.studentParent.destroy(!0)}}class StudentManager{constructor(){this.studentLogicList=[]}init(){this.studentLogicList=[],this.load(),Game.instance.eventManager.on(EventType.buyCarClick,this,this.addStudent)}onUpdate(){for(let i=0;i<this.studentLogicList.length;i++)this.studentLogicList[i].onUpdate()}load(){let carLevel=Game.instance.userData.mCarLevel;for(let i=1;i<=carLevel;i++){let element=Game.instance.userData.getCostConfigById(i),placeConfig=Game.instance.userData.getPlaceConfigById(element.placeId),student=new StudentLogic;student.init(placeConfig),this.studentLogicList.push(student)}}addStudent(){let carLevel=Game.instance.userData.mCarLevel,element=Game.instance.userData.getCostConfigById(carLevel);if(null==this.getStudentsByPlace(element.placeId)){let placeConfig=Game.instance.userData.getPlaceConfigById(element.placeId),student=new StudentLogic;student.init(placeConfig),this.studentLogicList.push(student)}}getStudentsByPlace(placeId){for(let i=0;i<this.studentLogicList.length;i++){let element=this.studentLogicList[i];if(element.placeConfig.id==placeId)return element}return null}clearData(){Game.instance.eventManager.off(EventType.buyCarClick,this,this.addStudent);for(let i=0;i<this.studentLogicList.length;i++)this.studentLogicList[i].clearData();this.studentLogicList=[]}}class SchoolManager extends Laya.Script{constructor(){super()}onAwake(){}onEnable(){this.init()}onDisable(){console.log("SchoolManager   onDisable"),this.clearData()}onUpdate(){null!=this.studentManager&&this.studentManager.onUpdate(),null!=this.schoolCarManager&&this.schoolCarManager.onUpdate()}init(){console.log("SchoolManager init"),this.schoolCarManager=new SchoolCarManager,this.schoolCarManager.init(),this.studentManager=new StudentManager,this.studentManager.init()}clearData(){this.schoolCarManager.clearData(),this.studentManager.clearData()}}class AwardLittleAnim extends Laya.Script{constructor(){super()}onEnable(){Laya.Dialog.manager.maskLayer.removeSelf()}onDisable(){Game.instance.timeManager.clearAll(this)}init(num){this.goldNum=num,this.initObj(),this.showInfo()}initObj(){this.goldLabel=this.owner.getChildByName("Gold")}showInfo(){this.goldLabel.text="+"+Utils.convert(this.goldNum),Game.instance.timeManager.onceExecute(1.5,this,this.animComplete)}animComplete(){this.owner.close(),this.owner.removeSelf(),this.owner.destroy(!0),Laya.Dialog.manager.maskLayer.removeSelf()}}class BattleLoadingView extends Laya.Script{constructor(){super()}onEnable(){this.init()}onDisable(){}init(){this.initObj(),this.loadScene3D()}initObj(){}loadScene3D(){let path=ConstantConfig.roadTestScene3DPath;if(0==Game.instance.battleType)path=ConstantConfig.roadTestScene3DPath;else if(1==Game.instance.battleType)path=ConstantConfig.driftScene3DPath;else if(-1==Game.instance.battleType){let sceneIndex=0;var selectSceneIdCache=localStorage.getItem(ConstantConfig.SelectSceneIdCache);null!=selectSceneIdCache&&""!=selectSceneIdCache&&(sceneIndex=JSON.parse(selectSceneIdCache)),path=ConstantConfig.mainScene3DPath+sceneIndex+".ls"}Game.instance.scenesManager.loadScene3D(path,Laya.Handler.create(this,this.scene3DComplete))}scene3DComplete(scene){let path=ConstantConfig.roadTestMainView;0==Game.instance.battleType?(Game.instance.setRoadTestScene3D(scene),path=ConstantConfig.roadTestMainView,scene.addComponent(RoadTestManager)):1==Game.instance.battleType?(Game.instance.setDriftScene3D(scene),path=ConstantConfig.driftMainView,scene.addComponent(DriftManager)):-1==Game.instance.battleType&&(path=ConstantConfig.mainView,Game.instance.setScene3D(scene),Game.instance.scene3D.addComponent(SchoolManager)),Game.instance.scenesManager.openScene(path,Laya.Handler.create(this,function(sceneUI){Game.instance.setSceneUI(sceneUI),-1==Game.instance.battleType&&Game.instance.battleAwardNum>0&&Game.instance.scenesManager.loadScene(ConstantConfig.awardLittleAnim,Laya.Handler.create(this,function(scene){Game.instance.sceneUI.addChild(scene),scene.addComponent(AwardLittleAnim).init(Game.instance.battleAwardNum),Game.instance.battleAwardNum=0}))}),!0)}}class DoubleEffectDialog extends Laya.Script{constructor(){super(),this.GOLD_PREFAB_SIGNER="GOLD_PREFAB_SIGNER"}onAwake(){Game.instance.eventManager.on(EventType.doubleGoldOver,this,this.doubleOver),Game.instance.eventManager.on(EventType.doubleSpeedOver,this,this.doubleOver),Game.instance.eventManager.on(EventType.doubleGoldStart,this,this.showInfo),Game.instance.eventManager.on(EventType.doubleSpeedStart,this,this.showInfo),this.init()}onEnable(){}onDisable(){Game.instance.eventManager.off(EventType.doubleGoldOver,this,this.doubleOver),Game.instance.eventManager.off(EventType.doubleSpeedOver,this,this.doubleOver),Game.instance.eventManager.off(EventType.doubleGoldStart,this,this.showInfo),Game.instance.eventManager.off(EventType.doubleSpeedStart,this,this.showInfo),Game.instance.timeManager.clearAll(this)}onUpdate(){Game.instance.userData.curDoubleSpeedTime>0?this.doubleType=DoubleType.speed:Game.instance.userData.curDoubleGoldTime>0&&(this.doubleType=DoubleType.gold)}init(){this.initObj()}initObj(){this.speedEffect=this.owner.getChildByName("speedEffect")}showInfo(doubleType,time){this.doubleType=doubleType,this.doubleType==DoubleType.speed?(this.speedEffect.visible=!0,this.showSpeedEffect(),Game.instance.timeManager.loop(3,this,this.showSpeedEffect)):(this.speedEffect.visible=!1,Game.instance.timeManager.loop(.3,this,this.createGoldAnim))}createGoldAnim(){let gold=Laya.Pool.getItemByCreateFun(this.GOLD_PREFAB_SIGNER,this.goldPrefab.create,this.goldPrefab),x=Utils.random(10,700);this.owner.addChild(gold),gold.pos(x,0),gold.visible=!0,gold.rotation=0,Laya.Tween.to(gold,{y:1e3,rotation:360},3e3,null,Laya.Handler.create(this,function(){gold.visible=!1,Laya.Pool.recover(this.GOLD_PREFAB_SIGNER,gold)}))}showSpeedEffect(){this.speedEffect.rotation=0,Laya.Tween.to(this.speedEffect,{rotation:360},3e3,null,Laya.Handler.create(this,function(){}))}doubleOver(){Game.instance.timeManager.clearAll(this),this.speedEffect.visible=!1}}class DriftMainView extends ui.DriftMainViewUI{constructor(){super(),this.isLeft=!1,this.isRight=!1,this.awardNum=0,this.shareTimes=0}onEnable(){this.init()}onDisable(){Game.instance.eventManager.off(EventType.driftGameOver,this,this.showGamOver),Game.instance.eventManager.off(EventType.driftKillCarUpdate,this,this.KillCarUpdate),Game.instance.eventManager.off(EventType.driftSelfCarBloodUpdate,this,this.selfCarBloodUpdate),Game.instance.timeManager.clearAll(this)}init(){this.isLeft=!1,this.isRight=!1,this.handNotice.visible=!1,this.startBtn.visible=!0,this.GameOver.visible=!1,this.isClickShareBtn=!1,this.isClickReviveShareBtn=!1,this.isClickGetBtn=!1,this.isClickExitBtn=!1,this.awardNum=0,this.shareTimes=0,this.initObj(),this.KillCarUpdate(0),Game.instance.eventManager.on(EventType.driftGameOver,this,this.showGamOver),Game.instance.eventManager.on(EventType.driftKillCarUpdate,this,this.KillCarUpdate),Game.instance.eventManager.on(EventType.driftSelfCarBloodUpdate,this,this.selfCarBloodUpdate)}initObj(){this.leftCtrl.on(Laya.Event.MOUSE_DOWN,this,this.onLeftCtrlDown),this.leftCtrl.on(Laya.Event.MOUSE_UP,this,this.onLeftCtrlUp),this.rightCtrl.on(Laya.Event.MOUSE_DOWN,this,this.onRightCtrlDown),this.rightCtrl.on(Laya.Event.MOUSE_UP,this,this.onRightCtrlUp),this.startBtn.on(Laya.Event.CLICK,this,this.startGame),this.getAwardBtn.on(Laya.Event.CLICK,this,this.onGetAwardBtnClick),this.getAwardBtnOne.on(Laya.Event.CLICK,this,this.onGetAwardBtnOneClick),this.exitBtn.on(Laya.Event.CLICK,this,this.onExitBtnClick),this.reviveBtn.on(Laya.Event.CLICK,this,this.onReviveBtnClick)}selfCarBloodUpdate(blood){0==blood?(this.blood1.visible=!1,this.blood2.visible=!1,this.blood3.visible=!1):1==blood?(this.blood1.visible=!0,this.blood2.visible=!1,this.blood3.visible=!1):2==blood?(this.blood1.visible=!0,this.blood2.visible=!0,this.blood3.visible=!1):3==blood&&(this.blood1.visible=!0,this.blood2.visible=!0,this.blood3.visible=!0)}KillCarUpdate(killCount){this.killCarLabel.text=killCount.toString()+"/"+Game.instance.driftKillCarCountTarget}startGame(){Game.instance.eventManager.fire(EventType.driftStartGame),this.handNotice.visible=!0,this.startBtn.visible=!1}showGamOver(isSuccess,blood){Game.instance.timeManager.onceExecute(2,this,function(){if(this.GameOver.visible=!0,isSuccess){this.victory.visible=!0,this.fail.visible=!1;let earning=Game.instance.userData.getCurEarning();earning*=60,this.awardNum=earning,this.goldLabel.text="+"+Utils.convert(earning);let killCount=5;null!=Game.instance.driftKillCarCountTarget&&Game.instance.driftKillCarCountTarget>killCount&&(killCount=Game.instance.driftKillCarCountTarget),blood>=2&&++killCount>=30&&(killCount=30);try{localStorage.setItem(ConstantConfig.DRIFT_KILL_CAR_COUNT_CACHE,killCount.toString())}catch(error){}}else this.victory.visible=!1,this.fail.visible=!0})}onLeftCtrlDown(){this.handNotice.visible=!1,this.isRight=!1,this.isLeft=!0,Game.instance.eventManager.fire(EventType.driftMouseDownLeft)}onLeftCtrlUp(){this.isLeft&&Game.instance.eventManager.fire(EventType.driftMouseUpLeft),this.isLeft=!1}onRightCtrlDown(){this.handNotice.visible=!1,this.isRight=!0,this.isLeft=!1,Game.instance.eventManager.fire(EventType.driftMouseDownRight)}onRightCtrlUp(){this.isRight&&Game.instance.eventManager.fire(EventType.driftMouseUpRight),this.isRight=!1}onExitBtnClick(){this.isClickExitBtn||(this.isClickExitBtn=!0,Game.instance.battleAwardNum=0,Game.instance.backMainGame())}onReviveBtnClick(){if(this.isClickReviveShareBtn)return;this.isClickReviveShareBtn=!0,this.shareTimes++;let self=this;Utils.isShareSuccess(function(isSuccess){self.isClickReviveShareBtn=!1,isSuccess?(self.shareTimes=0,self.reviveShareSuccess()):self.shareTimes>=3?(self.shareTimes=0,self.reviveShareSuccess()):Utils.wxShowNotice(function(params){params&&self.onReviveBtnClick()})}),Utils.shareByPath(aldEventType.share_drift_revive)}reviveShareSuccess(){this.GameOver.visible=!1,Game.instance.eventManager.fire(EventType.driftReviveGame)}onGetAwardBtnClick(){if(this.isClickShareBtn)return;this.isClickShareBtn=!0,this.shareTimes++;let self=this;Utils.isShareSuccess(function(isSuccess){self.isClickShareBtn=!1,isSuccess?(self.shareTimes=0,self.getAwardShareSuccess()):self.shareTimes>=3?(self.shareTimes=0,self.getAwardShareSuccess()):Utils.wxShowNotice(function(params){params&&self.onGetAwardBtnClick()})}),Utils.shareByPath(aldEventType.share_drift_gold)}getAwardShareSuccess(){Game.instance.battleAwardNum=3*this.awardNum,Game.instance.backMainGame()}onGetAwardBtnOneClick(){this.isClickGetBtn||(this.isClickGetBtn=!0,Game.instance.battleAwardNum=this.awardNum,Game.instance.backMainGame())}}class ButtonScale extends Laya.Button{constructor(){super(),this.on(Laya.Event.CLICK,this,this.onBtnClick)}onBtnClick(){Laya.Tween.to(this,{scaleX:1.1,scaleY:1.1},100,null,Laya.Handler.create(this,function(){Laya.Tween.to(this,{scaleX:1,scaleY:1},100)}))}}class LoadingScene extends Laya.Script{constructor(){super(),this.allLoadCount=0,this.curLoadCount=0,this.isLoading=!1,this.sceneIndex=0}onAwake(){this.init()}onUpdate(){this.isLoading&&this.curLoadCount>=this.allLoadCount&&(this.isLoading=!1,Game.instance.loadCacheData(this.sceneIndex),console.log("切换 = "+ConstantConfig.mainView),Game.instance.scenesManager.openScene(ConstantConfig.mainView,Laya.Handler.create(this,function(scene){Game.instance.setSceneUI(scene),Game.instance.scene3D.addComponent(SchoolManager)})))}init(){this.allLoadCount=0,this.curLoadCount=0,this.sceneIndex=0,this.isLoading=!1;var selectSceneIdCache=localStorage.getItem(ConstantConfig.SelectSceneIdCache);null!=selectSceneIdCache&&""!=selectSceneIdCache&&(this.sceneIndex=JSON.parse(selectSceneIdCache)),this.loadScene(),this.loadConfig()}loadScene(){this.allLoadCount++;let self=this,scenePath=ConstantConfig.mainScene3DPath+this.sceneIndex+".ls";Laya.Browser.onMiniGame?(wx.loadSubpackage({name:"sub",success:function(res){console.log("js loadSubpackage success"),console.log(res)},fail:function(res){console.log("loadSubpackage fail"),console.log(res)}}),wx.loadSubpackage({name:"unity",success:function(res){console.log("loadSubpackage success"),console.log(res),Game.instance.scenesManager.loadScene3D(scenePath,Laya.Handler.create(this,function(scene){Game.instance.setScene3D(scene),self.curLoadCount++}))},fail:function(res){console.log("loadSubpackage fail"),console.log(res)}})):Game.instance.scenesManager.loadScene3D(scenePath,Laya.Handler.create(this,function(scene){Game.instance.setScene3D(scene),self.curLoadCount++}))}loadScene3DComplete(){}loadConfig(){this.isLoading=!0,this.load("config/CostConfig.json",function(data){Game.instance.userData.loadCostConfig(data)}),this.load("config/PlaceConfig.json",function(data){Game.instance.userData.loadPlaceConfig(data)}),this.load("config/ExtraConfig.json",function(data){Game.instance.userData.loadExtraConfig(data)}),this.load("config/UserConfig.json",function(data){Game.instance.userData.loadUserConfig(data)})}load(pathName,callBack){this.allLoadCount++;let self=this;Game.instance.loadManager.load(pathName,function(res){callBack(res),self.curLoadCount++})}}class DialogBase extends Laya.Script{constructor(){super()}onEnable(){Game.instance.ad.showBannerAd()}onDisable(){Game.instance.ad.hideBannerAd()}}class LotteryDialog extends DialogBase{constructor(){super(),this.isStarting=!1,this.isAdLottery=!1,this.shareTimes=0,this.isClickShareBtn=!1}onEnable(){super.onEnable(),this.init()}onDisable(){super.onDisable()}init(){this.isAdLottery=!1,this.isStarting=!1,this.isClickShareBtn=!1,this.targetAngle=0,this.randomIndex=4,this.shareTimes=0,this.initObj(),this.showInfo(),this.ShowBtnInfo()}initObj(){this.closeBtn=this.owner.getChildByName("CloseBtn"),this.closeBtn.on(Laya.Event.CLICK,this,this.onCloseBtnClick),this.lotteryObj=this.owner.getChildByName("lotteryObj"),this.goldMin=this.lotteryObj.getChildByName("Gold1"),this.goldMax=this.lotteryObj.getChildByName("Gold2"),this.goldMaxMax=this.lotteryObj.getChildByName("Gold3"),this.freeBtn=this.owner.getChildByName("freeBtn"),this.freeBtn.on(Laya.Event.CLICK,this,this.onFreeBtnClick),this.freeBtnShareBg=this.freeBtn.getChildByName("shareBg"),this.freeBtnAdBg=this.freeBtn.getChildByName("adBg")}onUpdate(){this.isStarting&&this.rotateObj()}showInfo(){let curEarning=Game.instance.userData.getCurEarning(),num1=60*curEarning;this.goldMin.text=Utils.convert(num1);let num2=240*curEarning;this.goldMax.text=Utils.convert(num2);let num3=660*curEarning;this.goldMaxMax.text=Utils.convert(num3)}ShowBtnInfo(){this.freeBtn.disabled=!1,this.closeBtn.disabled=!1,Game.instance.userData.mIsLottery?(this.freeBtnShareBg.visible=!1,this.freeBtnAdBg.visible=!1):(this.isAdLottery=!1,Utils.random(1,10)<=7?(this.isAdLottery=!0,this.freeBtnShareBg.visible=!1,this.freeBtnAdBg.visible=!0):(this.freeBtnShareBg.visible=!0,this.freeBtnAdBg.visible=!1))}rotateObj(){let a=this.lotteryObj.rotation,angle=Laya.MathUtil.lerp(a,this.targetAngle,.02);this.lotteryObj.rotation=angle,Math.abs(this.targetAngle-this.lotteryObj.rotation)<=1&&(console.log("完成"),this.isStarting=!1,this.completeLottery())}completeLottery(){let curEarning=Game.instance.userData.getCurEarning(),awardNum=0,awardType=0;switch(this.randomIndex){case 5:awardNum=240*curEarning;break;case 0:awardNum=20,awardType=1;break;case 1:awardNum=660*curEarning;break;case 2:awardNum=100,awardType=1;break;case 3:awardNum=60*curEarning;break;case 4:awardNum=10,awardType=1}this.showAwardAnim(awardNum,awardType)}showAwardAnim(awardNum,awardType){let imagePath="UI/Gold.png",pos=new Laya.Vector2(300,50);1==awardType&&(imagePath="UI/icon_gem.png",pos=new Laya.Vector2(430,50));for(let i=0;i<15;i++){let image=new Laya.Image(imagePath);this.owner.addChild(image);let w=300,x=360+Utils.random(0,w)-w/2,y=620+Utils.random(0,w)-w/2;image.pos(x,y),1==awardType&&(image.width*=2,image.height*=2);let time=Utils.random(700,1e3);Laya.Tween.to(image,{x:pos.x,y:50},time,null,Laya.Handler.create(this,function(){image.removeSelf(),image.destroy()}))}let label=new Laya.Label("+"+Utils.convert(awardNum));label.bold=!0,label.fontSize=50,label.color=0==awardType?"#ebff08":"#83d0fa",label.stroke=2,label.strokeColor="#535353",label.font="Microsoft YaHei",this.owner.addChild(label),label.pos(360,620),Laya.Tween.to(label,{x:pos.x,y:50},1200,null,Laya.Handler.create(this,function(){label.removeSelf(),label.destroy(),1==awardType?Game.instance.userData.addDiamond(awardNum):Game.instance.userData.addGold(awardNum),this.ShowBtnInfo()}))}startLottery(){this.lotteryObj.rotation=0;let rand=Utils.random(0,99),index=0;index=rand>=0&&rand<13?5:rand>=13&&rand<23?0:23==rand?1:rand>=24&&rand<25?2:rand>=25&&rand<70?3:4;let angleRand=Utils.random(10,50)+60*index;this.targetAngle=1800-angleRand,this.randomIndex=index,console.log("随机数："+rand),console.log(index),this.isStarting=!0}onFreeBtnClick(){if(Game.instance.userData.mIsLottery)this.shareSuccess();else{if(!this.isAdLottery)return void this.shareLottery();this.adLottery()}}adLottery(){if(this.isClickShareBtn)return;this.isClickShareBtn=!0;let self=this;Game.instance.ad.showAd(1,function(isSuccess){self.isClickShareBtn=!1,isSuccess&&self.shareSuccess()});let maskArea=new Laya.Sprite;maskArea.alpha=.3,maskArea.graphics.drawRect(0,0,Laya.stage.width,Laya.stage.height,"#000000"),this.owner.addChild(maskArea),maskArea.on(Laya.Event.CLICK,this,function(){}),maskArea.hitArea=new Laya.HitArea,maskArea.hitArea.hit.drawRect(0,0,Laya.stage.width,Laya.stage.height,"#000000"),Game.instance.timeManager.onceExecute(2,this,function(){maskArea.removeSelf(),maskArea.destroy(!0)})}shareLottery(){if(this.isClickShareBtn)return;this.isClickShareBtn=!0,this.shareTimes++;let self=this;Utils.isShareSuccess(function(isSuccess){self.isClickShareBtn=!1,isSuccess?(self.shareTimes=0,self.shareSuccess()):self.shareTimes>=3?(self.shareTimes=0,self.shareSuccess()):Utils.wxShowNotice(function(params){params&&self.shareLottery()})}),Utils.shareByPath(aldEventType.share_lottery)}shareSuccess(){this.startLottery(),this.freeBtn.disabled=!0,this.closeBtn.disabled=!0,Game.instance.userData.lottery()}onCloseBtnClick(){this.owner.removeSelf(),this.owner.destroy(!0),Laya.Dialog.manager.maskLayer.removeSelf()}}class SpeakWord extends Laya.Script{constructor(){super(),this.words=[],this.showAllTime=5,this.showInterval=15}onEnable(){this.init()}onDisable(){Game.instance.timeManager.clearAll(this)}init(){this.words.push("我上次倒车入库压线了"),this.words.push("我上次侧方位压线了"),this.words.push("我真是太笨了！"),this.words.push("科目二我考第五次了"),this.words.push("始终倒不进去0.0"),this.words.push("上坡起步熄火了"),this.words.push("又压线了"),this.words.push("又熄火了"),this.words.push("S曲线压线了"),this.words.push("开车不喝酒，幸福更长久"),this.words.push("道路千万条，安全第一条"),this.words.push("大路朝天，请走右边"),this.words.push("行万里平安路 做百年长乐人"),this.words.push("太难了"),this.words.push("老司机带带我"),this.initObj(),Game.instance.timeManager.loop(this.showInterval,this,function(){this.showWord()})}initObj(){this.wordLabel=this.owner.getChildByName("word")}showWord(){let selfOwner=this.owner;selfOwner.visible=!0;let carLevel=Game.instance.userData.mCarLevel,count=carLevel;carLevel>16&&(count=16);let rand=Utils.random(1,count),placeConfig=Game.instance.userData.getPlaceConfigById(rand),pos=new Laya.Vector3;Game.instance.camera.worldToViewportPoint(new Laya.Vector3(-placeConfig.waitX,.4,placeConfig.waitZ),pos),selfOwner.pos(pos.x,pos.y);let index=Utils.random(0,this.words.length-1);this.wordLabel.text=this.words[index],Game.instance.timeManager.onceExecute(this.showAllTime,this,function(){selfOwner.visible=!1})}}class UpgradeMask extends Laya.Script{constructor(){super(),this.isPlaying=!1}onEnable(){this.init()}onDisable(){}init(){this.isPlaying=!1,this.showData(),Game.instance.eventManager.on(EventType.updateExp,this,this.showData)}showData(){let oo=this.owner;if(null==oo)return;if(Game.instance.userData.mLevel>=Game.instance.userData.userConfig.length)return oo.width=Math.floor(147),void(this.isPlaying=!1);let userConfig=Game.instance.userData.getUserConfig();if(userConfig.exp<=Game.instance.userData.mExp)oo.width=Math.floor(147),this.isPlaying||this.animPlay();else{let percent=0;(percent=Game.instance.userData.mExp/userConfig.exp)>1&&(percent=1),oo.width=Math.floor(147*percent)}}animPlay(){this.isPlaying=!0,Laya.Tween.to(this.owner.parent,{scaleX:1.1,scaleY:1.1},300,null,Laya.Handler.create(this,function(){Laya.Tween.to(this.owner.parent,{scaleX:1,scaleY:1},300,null,Laya.Handler.create(this,function(){this.isPlaying=!1,this.showData()}))}))}}class UpgradeDialog extends DialogBase{constructor(){super(),this.shareTimes=0}onEnable(){super.onEnable(),Laya.Dialog.manager.maskLayer.removeSelf()}onDisable(){super.onDisable(),Game.instance.timeManager.clearAll(this)}init(uiType,callBack){this.uiType=uiType,this.awardNum=0,this.callBack=callBack,this.shareTimes=0,this.isClickShareBtn=!1,this.initObj(),this.showData(),this.showBtnInfo(),Game.instance.newGuide.isCompleteGuid||3!=Game.instance.newGuide.curStep||(console.log("UpgradeDialog"),Game.instance.eventManager.fire(EventType.newGuide_StartNextStep)),Game.instance.timeManager.onceExecute(2,this,function(){})}initObj(){this.titleLabel=this.owner.getChildByName("Title");let getBtn=this.owner.getChildByName("Get");getBtn.on(Laya.Event.CLICK,this,this.onGetBtnClick),this.btnShareBg=getBtn.getChildByName("shareBg"),this.btnAdBg=getBtn.getChildByName("adBg"),this.goldLabel=this.owner.getChildByName("Gold"),this.getBtnLabel=this.owner.getChildByName("btnLabel"),this.noticeLabel=this.owner.getChildByName("Notice"),this.goldIcon=this.owner.getChildByName("moneyIcon"),this.SpeedIcon=this.owner.getChildByName("speedIcon"),this.owner.getChildByName("CloseBtn").on(Laya.Event.CLICK,this,this.onCloseBtnClick)}showData(){switch(this.noticeLabel.visible=!1,this.goldLabel.visible=!0,this.uiType){case UpgradeUIType.upgrade:let conf=Game.instance.userData.getUserConfig();this.goldLabel.text="+"+Utils.convert(conf.award),this.awardNum=Game.instance.userData.calculateGoldCoefficientScene(conf.award),this.titleLabel.text="恭喜升级",this.getBtnLabel.text="x3",this.goldIcon.visible=!0,this.SpeedIcon.visible=!1;break;case UpgradeUIType.offline:this.titleLabel.text="欢迎回来",this.getBtnLabel.text="x3";let earning=Game.instance.userData.getCurEarning(),offlineTime=Game.instance.userData.offlineTime;if(Game.instance.userData.mManagerLevel>=1){let time=Game.instance.userData.getManagerAwardTime();offlineTime>360+(time/=60)&&(offlineTime=time+360)}else offlineTime>360&&(offlineTime=360);this.awardNum=offlineTime*earning*.5,this.goldLabel.text="+"+Utils.convert(this.awardNum),this.goldIcon.visible=!0,this.SpeedIcon.visible=!1;break;case UpgradeUIType.doubleGold:this.titleLabel.text="双倍金币",this.goldIcon.visible=!0,this.SpeedIcon.visible=!1,this.noticeLabel.text="90秒内学费收益x2",this.getBtnLabel.text="领取",this.goldLabel.visible=!1,this.noticeLabel.visible=!0;break;case UpgradeUIType.doubleSpeed:this.titleLabel.text="双倍速度",this.goldIcon.visible=!1,this.SpeedIcon.visible=!0,this.noticeLabel.text="90秒内车辆速度x2",this.getBtnLabel.text="领取",this.goldLabel.visible=!1,this.noticeLabel.visible=!0;break;case UpgradeUIType.flyGold:this.titleLabel.text="金币奖励",this.goldIcon.visible=!0,this.SpeedIcon.visible=!1,this.noticeLabel.text="学员给的红包奖励",this.getBtnLabel.text="领取",this.goldLabel.visible=!0,this.noticeLabel.visible=!0;let curEarning=Game.instance.userData.getCurEarning();this.awardNum=180*curEarning,this.goldLabel.text="+"+Utils.convert(this.awardNum)}}showBtnInfo(){if(Game.instance.newGuide.isCompleteGuid)switch(this.uiType){case UpgradeUIType.upgrade:case UpgradeUIType.offline:this.btnShareBg.visible=!0,this.btnAdBg.visible=!1;break;case UpgradeUIType.doubleGold:case UpgradeUIType.doubleSpeed:case UpgradeUIType.flyGold:this.btnShareBg.visible=!1,this.btnAdBg.visible=!0}else this.btnShareBg.visible=!1,this.btnAdBg.visible=!1}onGetBtnClick(){if(!Game.instance.newGuide.isCompleteGuid)return void this.shareSuccess();switch(this.uiType){case UpgradeUIType.upgrade:case UpgradeUIType.offline:this.shareLogic();break;case UpgradeUIType.doubleGold:case UpgradeUIType.doubleSpeed:case UpgradeUIType.flyGold:this.adLogic()}let maskArea=new Laya.Sprite;maskArea.alpha=.3,maskArea.graphics.drawRect(0,0,Laya.stage.width,Laya.stage.height,"#000000"),this.owner.addChild(maskArea),maskArea.on(Laya.Event.CLICK,this,function(){}),maskArea.hitArea=new Laya.HitArea,maskArea.hitArea.hit.drawRect(0,0,Laya.stage.width,Laya.stage.height,"#000000"),Game.instance.timeManager.onceExecute(2,this,function(){maskArea.removeSelf(),maskArea.destroy(!0)})}adLogic(){if(this.isClickShareBtn)return;this.isClickShareBtn=!0;let self=this;Game.instance.ad.showAd(1,function(isSuccess){self.isClickShareBtn=!1,isSuccess&&self.shareSuccess()})}shareLogic(){if(this.isClickShareBtn)return;this.isClickShareBtn=!0,this.shareTimes++;let self=this;Utils.isShareSuccess(function(isSuccess){self.isClickShareBtn=!1,isSuccess?(self.shareTimes=0,self.shareSuccess()):self.shareTimes>=3?(self.shareTimes=0,self.shareSuccess()):Utils.wxShowNotice(function(params){params&&self.onGetBtnClick()})});let shareType=aldEventType.share_Upgrade;switch(this.uiType){case UpgradeUIType.upgrade:shareType=aldEventType.share_Upgrade;break;case UpgradeUIType.offline:shareType=aldEventType.share_Offline;break;case UpgradeUIType.doubleGold:shareType=aldEventType.share_double_gold;break;case UpgradeUIType.doubleSpeed:shareType=aldEventType.share_double_speed;break;case UpgradeUIType.flyGold:shareType=aldEventType.share_fly}Utils.shareByPath(shareType)}shareSuccess(){switch(this.uiType){case UpgradeUIType.upgrade:Game.instance.userData.upgradeLevel(),this.award(3*this.awardNum),Game.instance.newGuide.isCompleteGuid||4!=Game.instance.newGuide.curStep||Game.instance.eventManager.fire(EventType.newGuide_CompleteStep);break;case UpgradeUIType.offline:this.award(3*this.awardNum);break;case UpgradeUIType.doubleGold:case UpgradeUIType.doubleSpeed:this.callBack&&this.callBack.runWith(!0),this.closeWin();break;case UpgradeUIType.flyGold:this.award(this.awardNum)}}onCloseBtnClick(){switch(this.uiType){case UpgradeUIType.upgrade:Game.instance.userData.upgradeLevel(),this.award(this.awardNum);break;case UpgradeUIType.offline:this.award(this.awardNum);break;case UpgradeUIType.doubleGold:case UpgradeUIType.doubleSpeed:this.callBack&&this.callBack.runWith(!1),this.closeWin();break;case UpgradeUIType.flyGold:this.closeWin()}}closeWin(){try{this.owner.removeSelf(),this.owner.destroy(!0),Laya.Dialog.manager.maskLayer.removeSelf()}catch(error){console.log(error)}}award(num){Game.instance.userData.addGold(num),this.closeWin(),Game.instance.scenesManager.loadScene(ConstantConfig.awardLittleAnim,Laya.Handler.create(this,function(scene){Game.instance.sceneUI.addChild(scene),scene.addComponent(AwardLittleAnim).init(num)}))}}class ManagerUI extends DialogBase{constructor(){super(),this.placeItems=[],this.shareTimes=0}onEnable(){super.onEnable()}onDisable(){super.onDisable(),Game.instance.eventManager.off(EventType.updateGold,this,this.showPlaceInfo),Game.instance.eventManager.off(EventType.upgradeCarAir,this,this.showPlaceInfo),Game.instance.eventManager.off(EventType.upgradeRedPacket,this,this.showPlaceInfo),Game.instance.eventManager.off(EventType.upgradeAd,this,this.showPlaceInfo),Game.instance.timeManager.clearAll(this)}init(index){this.index=index,this.shareTimes=0,this.isClickUpgradeManagerBtn=!1,this.initObj(),this.tabBtn.selectedIndex=this.index,0==index&&this.onTabSelect(index),Game.instance.eventManager.on(EventType.upgradeCarAir,this,this.showPlaceInfo),Game.instance.eventManager.on(EventType.upgradeRedPacket,this,this.showPlaceInfo),Game.instance.eventManager.on(EventType.upgradeAd,this,this.showPlaceInfo),Game.instance.eventManager.on(EventType.updateGold,this,this.showPlaceInfo)}initObj(){this.tabBtn=this.owner.getChildByName("Tab"),this.tabBtn.selectHandler=new Laya.Handler(this,this.onTabSelect),this.manager=this.owner.getChildByName("Manager"),this.getManagerBtn=this.manager.getChildByName("Get"),this.getManagerBtn.on(Laya.Event.CLICK,this,this.onGetManagerBtnClick),this.upgradeBox=this.manager.getChildByName("upgradeBox"),this.upgradeManagerBtn=this.upgradeBox.getChildByName("upgradeDiamondBtn"),this.upgradeManagerBtn.on(Laya.Event.CLICK,this,this.onDiamondUpgradeBtnClick),this.upgradeBox.getChildByName("upgradeBtn").on(Laya.Event.CLICK,this,this.onUpgradeAdBtnClick),this.secondDayLabel=this.manager.getChildByName("secondDayLabel"),this.managerTime=this.manager.getChildByName("time"),this.place=this.owner.getChildByName("place");let item1=this.place.getChildByName("Item1"),item2=this.place.getChildByName("Item2"),item3=this.place.getChildByName("Item3");this.placeItems=[],this.placeItems.push(item1),this.placeItems.push(item2),this.placeItems.push(item3);for(let i=0;i<this.placeItems.length;i++){let upgradeBtn=this.placeItems[i].getChildByName("UpgradeBtn");i==ExtraConfigType.carAir?upgradeBtn.on(Laya.Event.CLICK,this,this.onCarAirUpgradeBtnClick):i==ExtraConfigType.redPacket?upgradeBtn.on(Laya.Event.CLICK,this,this.onRedPacketUpgradeBtnClick):i==ExtraConfigType.ad&&upgradeBtn.on(Laya.Event.CLICK,this,this.onAdUpgradeBtnClick)}this.owner.getChildByName("CloseBtn").on(Laya.Event.CLICK,this,this.onCloseBtnClick)}onTabSelect(index){console.log(index),0==index?(this.place.visible=!1,this.manager.visible=!0,this.showManagerInfo()):1==index&&(this.place.visible=!0,this.manager.visible=!1,this.showPlaceInfo())}showManagerInfo(){if(Game.instance.userData.curDays>=2)if(Game.instance.userData.mManagerLevel<=0)this.getManagerBtn.disabled=!1,this.upgradeBox.visible=!1,this.getManagerBtn.visible=!0,this.secondDayLabel.visible=!1,this.managerTime.text="最高1小时";else{this.upgradeBox.visible=!0,this.secondDayLabel.visible=!0,this.getManagerBtn.disabled=!0,this.getManagerBtn.visible=!1,this.secondDayLabel.color="#999999";let time=Game.instance.userData.getManagerAwardTime()/60,hours=Math.floor(time/60),min=time%60;this.managerTime.text="最高"+hours+"小时"+min+"分钟",this.secondDayLabel.text="每次升级，训练时间延长10分钟"}else this.getManagerBtn.disabled=!0,this.secondDayLabel.visible=!0,this.upgradeBox.visible=!1,this.getManagerBtn.visible=!0,this.secondDayLabel.text="明日登录免费领取",this.secondDayLabel.color="#ff0400",this.managerTime.text="最高1小时"}showPlaceInfo(){for(let i=0;i<this.placeItems.length;i++){const element=this.placeItems[i];let upgradeBtn=element.getChildByName("UpgradeBtn"),desc=element.getChildByName("Desc"),diamondBg=upgradeBtn.getChildByName("diamondBg"),costLabel=upgradeBtn.getChildByName("Num");upgradeBtn.label="";let conf=Game.instance.userData.getExtraConfigByType(i),costDiamond=5;i==ExtraConfigType.carAir?(costDiamond=ConstantConfig.upgradeAir,desc.text="额外收益+"+conf.airConditionerAward):i==ExtraConfigType.redPacket?(costDiamond=ConstantConfig.upgradeRedPackage,desc.text="额外速度+"+conf.redPacketAward+"%"):i==ExtraConfigType.ad&&(costDiamond=ConstantConfig.upgradeAd,desc.text="额外收益提升+"+conf.adAward+"%"),-1==conf.redCost?(upgradeBtn.disabled=!0,upgradeBtn.label="满级",diamondBg.visible=!1,costLabel.visible=!1):(costLabel.text=costDiamond.toString(),costDiamond>Game.instance.userData.mDiamond?(upgradeBtn.disabled=!0,diamondBg.visible=!0,costLabel.visible=!0):(upgradeBtn.disabled=!1,diamondBg.visible=!0,costLabel.visible=!0))}}getCostByType(extraConfigType){Game.instance.userData.getExtraConfigByType(extraConfigType)}onCarAirUpgradeBtnClick(){console.log("onCarAirUpgradeBtnClick"),Game.instance.userData.mDiamond<ConstantConfig.upgradeAir||(Game.instance.userData.decDiamond(ConstantConfig.upgradeAir),Game.instance.userData.upgradeCarAir())}onRedPacketUpgradeBtnClick(){Game.instance.userData.mDiamond<ConstantConfig.upgradeRedPackage||(Game.instance.userData.decDiamond(ConstantConfig.upgradeRedPackage),Game.instance.userData.upgradeRedPacket())}onAdUpgradeBtnClick(){Game.instance.userData.mDiamond<ConstantConfig.upgradeAd||(Game.instance.userData.decDiamond(ConstantConfig.upgradeAd),Game.instance.userData.upgradeAd())}onCloseBtnClick(){this.owner.close(),this.owner.removeSelf(),this.owner.destroy(!0)}onGetManagerBtnClick(){Game.instance.userData.upgradeManager(),this.showManagerInfo()}onDiamondUpgradeBtnClick(){Game.instance.userData.mDiamond>=50?(Game.instance.userData.decDiamond(50),this.shareSuccess()):Utils.showSystemNotice("钻石不足！")}onUpgradeAdBtnClick(){let self=this;Game.instance.ad.showAd(1,function(isSuccess){isSuccess&&self.shareSuccess()});let maskArea=new Laya.Sprite;maskArea.alpha=.3,maskArea.graphics.drawRect(0,0,Laya.stage.width,Laya.stage.height,"#000000"),this.owner.addChild(maskArea),maskArea.on(Laya.Event.CLICK,this,function(){}),maskArea.hitArea=new Laya.HitArea,maskArea.hitArea.hit.drawRect(0,0,Laya.stage.width,Laya.stage.height,"#000000"),Game.instance.timeManager.onceExecute(2,this,function(){maskArea.removeSelf(),maskArea.destroy(!0)})}shareSuccess(){Game.instance.userData.upgradeManager(),this.showManagerInfo()}}class MainView extends Laya.Script{constructor(){super(),this.FLY_COIN_PARENT="FLY_COIN_PARENT",this.GOLD_NOTICE_ANIM="GoldNoticeAnim",this.clickAddSpeedTime=500,this.curClickTime=0,this.isAddSpeed=!1}onEnable(){this.init(),Game.instance.eventManager.fire(EventType.newGuide_StartNextStep)}onDisable(){Game.instance.eventManager.off(EventType.carAnimComplete,this,this.carAnimComplte),Game.instance.eventManager.off(EventType.updateGold,this,this.showData),Game.instance.eventManager.off(EventType.updateExp,this,this.showUserInfo),Game.instance.eventManager.off(EventType.upgradeLevel,this,this.showUserInfo),Game.instance.eventManager.off(EventType.upgradeManager,this,this.showManager),Game.instance.eventManager.off(EventType.updateDiamond,this,this.showDiamondInfo),Game.instance.timeManager.clearAll(this)}onUpdate(){this.checkClickAddSpeed(),this.RefreshOnlineTime()}RefreshOnlineTime(){}checkClickAddSpeed(){this.isAddSpeed&&(this.curClickTime+=Laya.timer.delta,this.curClickTime>=this.clickAddSpeedTime&&(this.curClickTime=0,this.isAddSpeed=!1,Game.instance.eventManager.fire(EventType.addSpeedClickOver)))}init(){this.initObj(),this.showData(),this.showUserInfo(),this.showDoubleInfo(),this.showOfflineAward(),this.showManager(),this.showFlyObj(),this.showDiamondInfo(),Game.instance.eventManager.on(EventType.carAnimComplete,this,this.carAnimComplte),Game.instance.eventManager.on(EventType.updateGold,this,this.showData),Game.instance.eventManager.on(EventType.updateExp,this,this.showUserInfo),Game.instance.eventManager.on(EventType.upgradeLevel,this,this.showUserInfo),Game.instance.eventManager.on(EventType.upgradeManager,this,this.showManager),Game.instance.eventManager.on(EventType.updateDiamond,this,this.showDiamondInfo)}showData(){this.mCarLevel.text="等级"+Game.instance.userData.mCarLevel,this.mSpeedLevel.text="等级"+Game.instance.userData.mSpeedLevel,this.mPriceLevel.text="等级"+Game.instance.userData.mPriceLevel;let configCar=Game.instance.userData.getCostConfigById(Game.instance.userData.mCarLevel);this.carCostNum=Game.instance.userData.calculateGoldCoefficientScene(configCar.priceCost*ConstantConfig.CarCoefficient);let carCost=Utils.convert(this.carCostNum);this.mCarCost.text=carCost;let isCarMaxLevel=-1==configCar.priceCost;isCarMaxLevel&&(this.mCarCost.text="满级");let configPrice=Game.instance.userData.getCostConfigById(Game.instance.userData.mPriceLevel);this.priceCostNum=Game.instance.userData.calculateGoldCoefficientScene(configPrice.priceCost);let priceCost=Utils.convert(this.priceCostNum);this.mPriceCost.text=priceCost;let isPriceMaxLevel=-1==configPrice.priceCost;isPriceMaxLevel&&(this.mPriceCost.text="满级");let configSpeed=Game.instance.userData.getCostConfigById(Game.instance.userData.mSpeedLevel);this.speedCostNum=Game.instance.userData.calculateGoldCoefficientScene(configSpeed.priceCost*ConstantConfig.SpeedCoefficient);let speedCost=Utils.convert(this.speedCostNum);this.mSpeedCost.text=speedCost;let isSpeedMaxLevel=-1==configSpeed.priceCost;isSpeedMaxLevel&&(this.mSpeedCost.text="满级"),this.carCostNum>Game.instance.userData.mGold||isCarMaxLevel?this.mCarBtn.disabled=!0:this.mCarBtn.disabled=!1,this.priceCostNum>Game.instance.userData.mGold||isPriceMaxLevel?this.mPriceBtn.disabled=!0:this.mPriceBtn.disabled=!1,this.speedCostNum>Game.instance.userData.mGold||isSpeedMaxLevel?this.mSpeedBtn.disabled=!0:this.mSpeedBtn.disabled=!1,this.mGoldNum.text=Utils.convert(Game.instance.userData.mGold)}showDiamondInfo(){this.mDiamondNum.text=Game.instance.userData.mDiamond.toString()}showFlyObj(){Game.instance.timeManager.loop(ConstantConfig.FLY_COIN_TIME,this,function(){let flyCoin=Laya.Pool.getItemByCreateFun(this.FLY_COIN_PARENT,this.flyPrefab.create,this.flyPrefab);this.flyParent.addChild(flyCoin),flyCoin.visible=!0})}showUserInfo(){if(Game.instance.userData.mLevel>=ConstantConfig.DRIFT_LOCK_LEVEL?(this.driftLockBox.visible=!1,this.driftBtn.disabled=!1):(this.driftLockBox.visible=!0,this.driftBtn.disabled=!0),Game.instance.userData.mLevel>=Game.instance.userData.userConfig.length)return this.mLevelNum.text="满级",void(this.mUpgradeBtn.disabled=!0);Game.instance.userData.getUserConfig().exp<=Game.instance.userData.mExp?(this.mUpgradeBtn.disabled=!1,this.mLevelNum.text="升级！",Game.instance.newGuide.isCompleteGuid||2!=Game.instance.newGuide.curStep||Game.instance.eventManager.fire(EventType.newGuide_CompleteStep)):(this.mUpgradeBtn.disabled=!0,this.mLevelNum.text="等级"+Game.instance.userData.mLevel)}showDoubleInfo(){this.doubleGoldParent.visible=!1}showManager(){if(console.log("登陆天数 ="+Game.instance.userData.curDays),Game.instance.userData.curDays>=2){let managerLevel=Game.instance.userData.mManagerLevel;if(managerLevel<=0)this.mManagerlabel.text="经理：可领取";else{let maxLevel=3*(Game.instance.userData.curDays-1)+1;this.mManagerlabel.text=managerLevel>=maxLevel?"经理：上班":"经理：可升级"}}else this.mManagerlabel.text="经理：明日可领取"}showOfflineAward(){-2==Game.instance.battleType&&(console.log(Game.instance.userData.offlineTime),Game.instance.userData.offlineTime>30&&Game.instance.scenesManager.openScene(ConstantConfig.upgradeDialog,Laya.Handler.create(this,function(scene){scene.getComponent(UpgradeDialog).init(UpgradeUIType.offline)}),!1),Game.instance.timeManager.loop(30,this,function(){Game.instance.userData.setLoginTime()}))}initObj(){let bottom=this.owner.getChildByName("Bottom");this.mCarBtn=bottom.getChildByName("CarBtn"),this.mCarBtn.on(Laya.Event.CLICK,this,this.onCarBtnClick),this.mCarLevel=bottom.getChildByName("CarLevel"),this.mCarCost=bottom.getChildByName("CarCost"),this.mPriceBtn=bottom.getChildByName("PriceBtn"),this.mPriceBtn.on(Laya.Event.CLICK,this,this.onPriceBtnClick),this.mPriceLevel=bottom.getChildByName("PriceLevel"),this.mPriceCost=bottom.getChildByName("PriceCost"),this.mSpeedBtn=bottom.getChildByName("SpeedBtn"),this.mSpeedBtn.on(Laya.Event.CLICK,this,this.onSpeedBtnClick),this.mSpeedLevel=bottom.getChildByName("SpeedLevel"),this.mSpeedCost=bottom.getChildByName("SpeedCost");let top=this.owner.getChildByName("Top");this.mGoldNum=top.getChildByName("GoldNum"),this.mDiamondNum=top.getChildByName("DiamondNum");let levelInfo=top.getChildByName("LevelInfo");this.mUpgradeBtn=levelInfo.getChildByName("Upgrade"),this.mLevelNum=levelInfo.getChildByName("Level"),this.mUpgradeBtn.on(Laya.Event.CLICK,this,this.mUpgradeBtnClick),console.log(""+Laya.stage.width),console.log(""+Laya.stage.height),Laya.stage.height/Laya.stage.width>=2&&(top.top+=ConstantConfig.SCREEN_FIT_TOP);let addManagerBtn=top.getChildByName("addManagerBtn");this.mManagerlabel=top.getChildByName("managerLabel"),addManagerBtn.on(Laya.Event.CLICK,this,this.onAddManagerBtnClick),this.owner.getChildByName("addSpeedClick").on(Laya.Event.CLICK,this,this.addSpeedClick),this.owner.getChildByName("TopRight");let bottomLeft=this.owner.getChildByName("BottomLeft");bottomLeft.getChildByName("ManagerBtn").on(Laya.Event.CLICK,this,this.onManagerBtnClick),bottomLeft.getChildByName("MapBtn").on(Laya.Event.CLICK,this,this.onMapBtnClick),this.doubleGoldParent=this.owner.getChildByName("doubleGold"),this.flyParent=this.owner.getChildByName("flyParent");let bottomRight=this.owner.getChildByName("BottomRight");this.driftBtn=bottomRight.getChildByName("driftBtn"),this.driftBtn.on(Laya.Event.CLICK,this,this.onDriftBtnClick),this.driftLockBox=this.driftBtn.getChildByName("driftLock");let middleLeft=this.owner.getChildByName("MiddleLeft"),lotteryBtn=middleLeft.getChildByName("LotteryBtn"),signBtn=middleLeft.getChildByName("SignBtn"),rankBtn=middleLeft.getChildByName("RankBtn");lotteryBtn.on(Laya.Event.CLICK,this,this.onLotteryBtnClick),signBtn.on(Laya.Event.CLICK,this,this.onSignBtnClick),rankBtn.on(Laya.Event.CLICK,this,this.onRankBtnClick)}carAnimComplte(placeConfig,carLevel){let pos=new Laya.Vector3;Game.instance.camera.worldToViewportPoint(new Laya.Vector3(-placeConfig.posX,.4,placeConfig.posZ),pos);let goldNoticeAnimUi=Laya.Pool.getItemByCreateFun(this.GOLD_NOTICE_ANIM,this.goldNoticeAnim.create,this.goldNoticeAnim);goldNoticeAnimUi.pos(pos.x,pos.y-50);let goldNoticeLable=goldNoticeAnimUi.getChildByName("GoldNotice");this.owner.addChild(goldNoticeAnimUi),goldNoticeAnimUi.visible=!0,goldNoticeLable.y=35;let num=Game.instance.userData.getCurAwardByPlaceLevel(carLevel);goldNoticeLable.text="+"+Utils.convert(num),Laya.Tween.to(goldNoticeLable,{y:-15},1e3,null,Laya.Handler.create(this,function(){goldNoticeAnimUi.visible=!1,Laya.Pool.recover(this.GOLD_NOTICE_ANIM,goldNoticeAnimUi)})),Game.instance.userData.addGold(num)}onPriceBtnClick(){this.priceCostNum>Game.instance.userData.mGold||(Game.instance.userData.descGold(this.priceCostNum),Game.instance.userData.upgradePrice(),this.showData())}onSpeedBtnClick(){this.speedCostNum>Game.instance.userData.mGold||(Game.instance.userData.descGold(this.speedCostNum),Game.instance.userData.upgradeSpeed(),this.showData())}onCarBtnClick(){this.carCostNum>Game.instance.userData.mGold||(Game.instance.userData.descGold(this.carCostNum),Game.instance.userData.buyCar(),this.showData(),Game.instance.newGuide.isCompleteGuid||Game.instance.eventManager.fire(EventType.newGuide_CompleteStep))}addSpeedClick(){Utils.vibrate(),0==this.isAddSpeed&&(this.isAddSpeed=!0,Game.instance.eventManager.fire(EventType.addSpeedClickStart)),this.curClickTime=0}onMapBtnClick(){Game.instance.scenesManager.openScene(ConstantConfig.worldMapDialog,Laya.Handler.create(this,function(scene){}))}onSignBtnClick(){console.log("onSignBtnClick"),Game.instance.scenesManager.openScene(ConstantConfig.signDialog,Laya.Handler.create(this,function(scene){}))}onRankBtnClick(){Game.instance.scenesManager.openScene(ConstantConfig.RankDialog,Laya.Handler.create(this,function(scene){}))}onManagerBtnClick(){Game.instance.scenesManager.openScene(ConstantConfig.managerUI,Laya.Handler.create(this,function(scene){scene.getComponent(ManagerUI).init(1)}))}onLotteryBtnClick(){console.log("onLotteryBtnClick"),Game.instance.scenesManager.openScene(ConstantConfig.lotteryDialog,Laya.Handler.create(this,function(scene){}))}mUpgradeBtnClick(){Game.instance.newGuide.isCompleteGuid||3!=Game.instance.newGuide.curStep||Game.instance.eventManager.fire(EventType.newGuide_CompleteStep),Game.instance.scenesManager.openScene(ConstantConfig.upgradeDialog,Laya.Handler.create(this,function(scene){scene.getComponent(UpgradeDialog).init(UpgradeUIType.upgrade)}),!1)}onAddManagerBtnClick(){Game.instance.scenesManager.openScene(ConstantConfig.managerUI,Laya.Handler.create(this,function(scene){scene.getComponent(ManagerUI).init(0)}))}onRoadTestBtnClick(){Game.instance.startRoadTest()}onDriftBtnClick(){Game.instance.startDriftGame()}}!function(DoubleState){DoubleState[DoubleState.hide=0]="hide",DoubleState[DoubleState.anim=1]="anim",DoubleState[DoubleState.progress=2]="progress"}(DoubleState||(DoubleState={}));class DoubleGoldScr extends Laya.Script{constructor(){super(),this.curHideTime=0,this.hideAllTime=15e3,this.progressAllTime=9e4,this.curProgressTime=0}onEnable(){this.init()}onUpdate(){this.mDoubleState==DoubleState.hide?(this.curHideTime+=Laya.timer.delta,this.curHideTime>=this.hideAllTime&&(this.changeToAnimState(),this.curHideTime=0)):this.mDoubleState==DoubleState.anim||this.mDoubleState==DoubleState.progress&&(this.curProgressTime+=Laya.timer.delta,this.drawPie(),this.mDoubleType==DoubleType.gold?Game.instance.userData.setDoubleGoldTime(this.progressAllTime-this.curProgressTime):this.mDoubleType==DoubleType.speed&&Game.instance.userData.setDoubleSpeedTime(this.progressAllTime-this.curProgressTime),this.curProgressTime>=this.progressAllTime&&(this.graphicsObj.graphics.clear(!0),this.curProgressTime=0,this.changtoHideState()))}onDisable(){}init(){this.curHideTime=0,this.initObj(),Game.instance.userData.curDoubleSpeedTime>0?(this.mDoubleType=DoubleType.speed,this.changeToProgress(),this.curProgressTime=this.progressAllTime-Game.instance.userData.curDoubleSpeedTime,Game.instance.eventManager.fire(EventType.doubleSpeedStart,[this.mDoubleType,this.curProgressTime])):Game.instance.userData.curDoubleGoldTime>0?(this.mDoubleType=DoubleType.gold,this.changeToProgress(),this.curProgressTime=this.progressAllTime-Game.instance.userData.curDoubleSpeedTime,Game.instance.eventManager.fire(EventType.doubleGoldStart,[this.mDoubleType,this.curProgressTime])):this.changtoHideState()}initObj(){this.animObj=this.owner.getChildByName("doubleGold"),this.doubleGoldProgress=this.owner.getChildByName("doubleGoldProgress"),this.doubleBtn=this.animObj.getChildByName("doubleGold"),this.doubleBtn.on(Laya.Event.CLICK,this,this.onAnimBtnClick),this.doubleBtnGoldBg=this.doubleBtn.getChildByName("goldBg"),this.doubleBtnSpeedBg=this.doubleBtn.getChildByName("speedBg"),this.progressGoldBgRing=this.doubleGoldProgress.getChildByName("goldBgRing"),this.progressSpeedBgRing=this.doubleGoldProgress.getChildByName("speedBgRing"),this.progressGoldBgIcon=this.doubleGoldProgress.getChildByName("goldBgIcon"),this.progressSpeedBgIcon=this.doubleGoldProgress.getChildByName("SpeedBgIcon"),this.graphicsObj=this.doubleGoldProgress.getChildByName("graphicsObj"),Laya.stage.height/Laya.stage.width>=2&&(this.owner.top+=ConstantConfig.SCREEN_FIT_TOP)}showInfo(){this.mDoubleType==DoubleType.gold?(this.doubleBtnGoldBg.visible=!0,this.doubleBtnSpeedBg.visible=!1,this.progressGoldBgRing.visible=!0,this.progressSpeedBgRing.visible=!1,this.progressGoldBgIcon.visible=!0,this.progressSpeedBgIcon.visible=!1):this.mDoubleType==DoubleType.speed&&(this.doubleBtnGoldBg.visible=!1,this.doubleBtnSpeedBg.visible=!0,this.progressGoldBgRing.visible=!1,this.progressSpeedBgRing.visible=!0,this.progressGoldBgIcon.visible=!1,this.progressSpeedBgIcon.visible=!0)}changtoHideState(){this.mDoubleState=DoubleState.hide,this.owner.visible=!1,this.curHideTime=0}changeToAnimState(){this.mDoubleState=DoubleState.anim,this.owner.visible=!0,this.animObj.visible=!0,this.doubleGoldProgress.visible=!1;let rand=Utils.random(10,20);this.mDoubleType=rand<=15?DoubleType.gold:DoubleType.speed,this.showInfo()}changeToProgress(){this.mDoubleState=DoubleState.progress,this.owner.visible=!0,this.animObj.visible=!1,this.doubleGoldProgress.visible=!0,this.curProgressTime=0,this.showInfo()}drawPie(){let ang=this.curProgressTime/this.progressAllTime*360;this.graphicsObj.graphics.clear(!0);let color="#c97a10";this.mDoubleType==DoubleType.gold?color="#c97a10":this.mDoubleType==DoubleType.speed&&(color="#1857b8"),this.graphicsObj.graphics.drawPie(50,50,50,-90,-90+ang,color,color)}onAnimBtnClick(){Game.instance.scenesManager.openScene(ConstantConfig.upgradeDialog,Laya.Handler.create(this,function(scene){let scr=scene.getComponent(UpgradeDialog),upgradeUIType=UpgradeUIType.doubleGold;this.mDoubleType==DoubleType.gold?upgradeUIType=UpgradeUIType.doubleGold:this.mDoubleType==DoubleType.speed&&(upgradeUIType=UpgradeUIType.doubleSpeed),scr.init(upgradeUIType,Laya.Handler.create(this,this.confirmCallBack))}),!1)}confirmCallBack(isConfirm){isConfirm?(this.changeToProgress(),this.mDoubleType==DoubleType.gold?Game.instance.userData.startDoubleGold(this.progressAllTime):this.mDoubleType==DoubleType.speed&&Game.instance.userData.startDoubleSpeed(this.progressAllTime)):this.changtoHideState()}showEffect(time){}}class ScreenFitIphoneX extends Laya.Box{constructor(){super()}onAwake(){Laya.stage.height/Laya.stage.width>=2&&(this.top+=ConstantConfig.SCREEN_FIT_TOP)}onEnable(){}onDisable(){}}class RankDialog extends Laya.Script{constructor(){super()}onEnable(){this.init()}onDisable(){}init(){this.initObj(),this.load()}initObj(){this.owner.getChildByName("CloseBtn").on(Laya.Event.CLICK,this,this.onCloseBtnClick)}load(){Laya.Browser.onMiniGame&&Laya.loader.load(["res/atlas/test.atlas"],Laya.Handler.create(null,function(){Laya.MiniAdpter.sendAtlasToOpenDataContext("res/atlas/test.atlas")}))}onCloseBtnClick(){this.owner.close()}}class RoadTestMainView extends ui.RoadTestMainViewUI{constructor(){super()}onEnable(){console.log("RoadTestMainView onEnable"),this.init()}onDisable(){Game.instance.timeManager.clearAll(this)}onUpdate(){}init(){Game.instance.timeManager.framLoop(this,this.onUpdate),this.initObj(),console.log(this.press)}initObj(){this.press.on(Laya.Event.MOUSE_DOWN,this,this.onPressDown),this.press.on(Laya.Event.MOUSE_UP,this,this.onPressUp)}onPressDown(){console.log("onPressDown"),Game.instance.eventManager.fire(EventType.roadTestStartMove)}onPressUp(){console.log("onPressUp"),Game.instance.eventManager.fire(EventType.roadTestStopMove)}}class SignDialog extends DialogBase{constructor(){super(),this.items=[],this.curAward=0}onEnable(){super.onEnable(),this.init()}onDisable(){super.onDisable()}init(){this.items=[],this.isClickShareBtn=!1,this.initObj(),this.showInfo()}initObj(){this.owner.getChildByName("CloseBtn").on(Laya.Event.CLICK,this,this.onCloseBtnClick),this.hadSignObj=this.owner.getChildByName("HadSignObj"),this.signObj=this.owner.getChildByName("signObj"),this.signObj.getChildByName("Get").on(Laya.Event.CLICK,this,this.onSignBtnClick),this.signObj.getChildByName("GetThree").on(Laya.Event.CLICK,this,this.onThreeBtnClick);for(let i=1;i<=7;i++){let itemName="Item"+i,item=this.owner.getChildByName(itemName);item.getChildByName("day"),this.items.push(item)}}showInfo(){let signTimes=Game.instance.userData.mSignTimes;this.hadSignObj.visible=Game.instance.userData.mIsSign,this.signObj.visible=!Game.instance.userData.mIsSign;for(let i=0;i<this.items.length;i++){const element=this.items[i];let yesBg=element.getChildByName("yesBg"),numLabel=element.getChildByName("Num"),diamondBg=element.getChildByName("diamondBg"),num=10*(i+2);numLabel.text="x"+num.toString(),numLabel.fontSize=35,yesBg.visible=!1,numLabel.visible=!0,diamondBg.visible=!0,i<signTimes?(yesBg.visible=!0,numLabel.visible=!1,diamondBg.visible=!1):i==signTimes&&(Game.instance.userData.mIsSign?(yesBg.visible=!0,numLabel.visible=!1,diamondBg.visible=!1):this.curAward=num)}}showAwardAnim(awardNum){let pos=new Laya.Vector2(430,50);for(let i=0;i<15;i++){let image=new Laya.Image("UI/icon_gem.png");this.owner.addChild(image);let w=300,x=360+Utils.random(0,w)-w/2,y=620+Utils.random(0,w)-w/2;image.pos(x,y),image.width*=2,image.height*=2;let time=Utils.random(700,1e3);Laya.Tween.to(image,{x:pos.x,y:50},time,null,Laya.Handler.create(this,function(){image.removeSelf(),image.destroy()}))}let label=new Laya.Label("+"+Utils.convert(awardNum));label.bold=!0,label.fontSize=50,label.color="#83d0fa",label.stroke=2,label.strokeColor="#535353",label.font="Microsoft YaHei",this.owner.addChild(label),label.pos(360,620),Laya.Tween.to(label,{x:pos.x,y:50},1200,null,Laya.Handler.create(this,function(){label.removeSelf(),label.destroy()}))}onSignBtnClick(){Game.instance.userData.addDiamond(this.curAward),Game.instance.userData.sign(),this.showInfo(),this.showAwardAnim(this.curAward)}onThreeBtnClick(){if(this.isClickShareBtn)return;this.isClickShareBtn=!0;let self=this;Game.instance.ad.showAd(1,function(isSuccess){self.isClickShareBtn=!1,isSuccess&&self.adSuccess()});let maskArea=new Laya.Sprite;maskArea.alpha=.3,maskArea.graphics.drawRect(0,0,Laya.stage.width,Laya.stage.height,"#000000"),this.owner.addChild(maskArea),maskArea.on(Laya.Event.CLICK,this,function(){}),maskArea.hitArea=new Laya.HitArea,maskArea.hitArea.hit.drawRect(0,0,Laya.stage.width,Laya.stage.height,"#000000"),Game.instance.timeManager.onceExecute(2,this,function(){maskArea.removeSelf(),maskArea.destroy(!0)})}adSuccess(){Game.instance.userData.addDiamond(3*this.curAward),Game.instance.userData.sign(),this.showInfo(),this.showAwardAnim(3*this.curAward)}onCloseBtnClick(){Laya.Tween.clearAll(this),this.owner.removeSelf(),this.owner.destroy(!0),Laya.Dialog.manager.maskLayer.removeSelf()}}class GameUI extends ui.test.TestSceneUI{constructor(){super();var scene=Laya.stage.addChild(new Laya.Scene3D),camera=scene.addChild(new Laya.Camera(0,.1,100));camera.transform.translate(new Laya.Vector3(0,3,3)),camera.transform.rotate(new Laya.Vector3(-30,0,0),!0,!1);var directionLight=scene.addChild(new Laya.DirectionLight);directionLight.color=new Laya.Vector3(.6,.6,.6),directionLight.transform.worldMatrix.setForward(new Laya.Vector3(1,-1,0));var box=scene.addChild(new Laya.MeshSprite3D(Laya.PrimitiveMesh.createBox(1,1,1)));box.transform.rotate(new Laya.Vector3(0,45,0),!1,!1);var material=new Laya.BlinnPhongMaterial;Laya.Texture2D.load("res/layabox.png",Laya.Handler.create(null,function(tex){material.albedoTexture=tex})),box.meshRenderer.material=material}}class WorldMapDialog extends DialogBase{constructor(){super(),this.placeItems=[]}onEnable(){super.onEnable(),this.init()}onDisable(){super.onDisable()}init(){this.initObj(),this.showInfo()}initObj(){let place=this.owner.getChildByName("Place"),item1=place.getChildByName("Item1"),item2=place.getChildByName("Item2"),item3=place.getChildByName("Item3"),item4=place.getChildByName("Item4");this.placeItems=[],this.placeItems.push(item1),this.placeItems.push(item2),this.placeItems.push(item3),this.placeItems.push(item4),this.owner.getChildByName("CloseBtn").on(Laya.Event.CLICK,this,this.onCloseBtnClick)}showInfo(){for(let i=0;i<this.placeItems.length;i++){let element=this.placeItems[i],selectBtn=element.getChildByName("selectBtn"),lockBtn=element.getChildByName("LockBtn"),desc=element.getChildByName("Desc");i>=4?(lockBtn.visible=!0,selectBtn.visible=!1):(lockBtn.visible=!1,selectBtn.visible=!0,i==Game.instance.userData.mSceneIndex?(selectBtn.selected=!0,desc.visible=!0,selectBtn.on(Laya.Event.CLICK,this,this.onSelectClick,[i]),desc.text="当前选择"):0==i?(selectBtn.selected=!1,desc.visible=!1,selectBtn.on(Laya.Event.CLICK,this,this.onSelectClick,[i])):Game.instance.userData.getOtherSceneLevelByIndex(i-1)>=10+10*i?(selectBtn.selected=!1,desc.visible=!1,selectBtn.on(Laya.Event.CLICK,this,this.onSelectClick,[i])):(lockBtn.visible=!0,selectBtn.visible=!1))}}onSelectClick(index){if(console.log(index),index!=Game.instance.userData.mSceneIndex){try{localStorage.setItem(ConstantConfig.SelectSceneIdCache,index.toString())}catch(error){}Utils.aldEventByTypeParam(aldEventType.ald_lock_scene,aldEventType.ald_lock_scene,index.toString()),this.onCloseBtnClick(),Game.instance.reloadNewGameBySceneIndex(index)}}onCloseBtnClick(){this.owner.close(),this.owner.removeSelf(),this.owner.destroy(!0)}}class FlyGoldScr extends Laya.Script{constructor(){super(),this.isLeft=!1,this.isRotation=!1,this.moveTimes=0,this.moveAllTimes=7}onEnable(){this.init()}onDisable(){Laya.Tween.clearAll(this)}init(){this.initObj(),this.showData(),this.isLeft=!0,this.isRotation=!0,this.owner.pos(-20,700),this.moveTimes=0,this.move(),this.rotationAnim()}initObj(){this.numLabel=this.owner.getChildByName("num"),this.flyIcon=this.owner.getChildByName("FlyIcon"),this.flyIcon.on(Laya.Event.CLICK,this,this.onSelfClick)}onSelfClick(){console.log("onSelfClick"),Game.instance.scenesManager.openScene(ConstantConfig.upgradeDialog,Laya.Handler.create(this,function(scene){scene.getComponent(UpgradeDialog).init(UpgradeUIType.flyGold)}),!1),this.closeClick()}showData(){let num=180*Game.instance.userData.getCurEarning();this.numLabel.text=Utils.convert(num)}rotationAnim(){let tartgetR=10,tartgetScaleX=1,tartgetScaleY=1;this.isRotation||(tartgetR=-10,tartgetScaleX=.8,tartgetScaleY=.8),Laya.Tween.to(this.flyIcon,{rotation:tartgetR,scaleX:tartgetScaleX,scaleY:tartgetScaleY},1e3,null,Laya.Handler.create(this,function(){this.isRotation=!this.isRotation,this.rotationAnim()}))}move(){let x2=Laya.stage.width,tartgetY=Utils.random(300,700),targetX=-20;this.isLeft&&(targetX=x2),this.moveTimes++,Laya.Tween.to(this.owner,{y:tartgetY,x:targetX},5e3,null,Laya.Handler.create(this,function(){this.isLeft=!this.isLeft,this.moveTimes>=this.moveAllTimes?this.closeClick():this.move()}))}closeClick(){this.owner.removeSelf(),this.owner.destroy(!0)}}class GameConfig{constructor(){}static init(){var reg=Laya.ClassUtils.regClass;reg("View/BattleLoadingView.ts",BattleLoadingView),reg("View/DoubleEffectDialog.ts",DoubleEffectDialog),reg("View/Drift/DriftMainView.ts",DriftMainView),reg("script/ButtonScale.ts",ButtonScale),reg("View/LoadingScene.ts",LoadingScene),reg("View/LotteryDialog.ts",LotteryDialog),reg("script/SpeakWord.ts",SpeakWord),reg("script/UpgradeMask.ts",UpgradeMask),reg("View/MainView.ts",MainView),reg("script/DoubleGoldScr.ts",DoubleGoldScr),reg("View/ManagerUI.ts",ManagerUI),reg("ScreenFitIphoneX.ts",ScreenFitIphoneX),reg("View/RankDialog.ts",RankDialog),reg("View/RoadTest/RoadTestMainView.ts",RoadTestMainView),reg("View/SignDialog.ts",SignDialog),reg("script/GameUI.ts",GameUI),reg("View/UpgradeDialog.ts",UpgradeDialog),reg("View/WorldMapDialog.ts",WorldMapDialog),reg("View/FlyGoldScr.ts",FlyGoldScr)}}GameConfig.width=720,GameConfig.height=1280,GameConfig.scaleMode="fixedwidth",GameConfig.screenMode="vertical",GameConfig.alignV="top",GameConfig.alignH="left",GameConfig.startScene="LoadingScene.scene",GameConfig.sceneRoot="",GameConfig.debug=!1,GameConfig.stat=!1,GameConfig.physicsDebug=!1,GameConfig.exportSceneToJson=!0,GameConfig.init(),new class{constructor(){window.Laya3D?Laya3D.init(GameConfig.width,GameConfig.height):Laya.init(GameConfig.width,GameConfig.height,Laya.WebGL),Laya.Physics&&Laya.Physics.enable(),Laya.DebugPanel&&Laya.DebugPanel.enable(),Laya.stage.scaleMode=GameConfig.scaleMode,Laya.stage.screenMode=GameConfig.screenMode,Laya.stage.alignV=GameConfig.alignV,Laya.stage.alignH=GameConfig.alignH,Laya.URL.exportSceneToJson=GameConfig.exportSceneToJson,(GameConfig.debug||"true"==Laya.Utils.getQueryString("debug"))&&Laya.enableDebugPanel(),GameConfig.physicsDebug&&Laya.PhysicsDebugDraw&&Laya.PhysicsDebugDraw.enable(),GameConfig.stat&&Laya.Stat.show(),Laya.alertGlobalError=!0,Laya.ResourceVersion.enable("version.json",Laya.Handler.create(this,this.onVersionLoaded),Laya.ResourceVersion.FILENAME_VERSION)}onVersionLoaded(){Laya.AtlasInfoManager.enable("fileconfig.json",Laya.Handler.create(this,this.onConfigLoaded))}onConfigLoaded(){Game.instance.init()}}}();