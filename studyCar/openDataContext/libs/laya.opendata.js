var Laya=window.Laya=function(window,document){var Laya={__internals:[],__packages:{},__classmap:{Object:Object,Function:Function,Array:Array,String:String},__sysClass:{object:"Object",array:"Array",string:"String",dictionary:"Dictionary"},__propun:{writable:!0,enumerable:!1,configurable:!0},__presubstr:String.prototype.substr,__substr:function(ofs,sz){return 1==arguments.length?Laya.__presubstr.call(this,ofs):Laya.__presubstr.call(this,ofs,sz>0?sz:this.length+sz)},__init:function(_classs){_classs.forEach(function(o){o.__init$&&o.__init$()})},__isClass:function(o){return o&&(o.__isclass||o==Object||o==String||o==Array)},__newvec:function(sz,value){var d=[];d.length=sz;for(var i=0;i<sz;i++)d[i]=value;return d},__extend:function(d,b){for(var p in b)if(b.hasOwnProperty(p)){var gs=Object.getOwnPropertyDescriptor(b,p),g=gs.get,s=gs.set;g||s?g&&s?Object.defineProperty(d,p,gs):(g&&Object.defineProperty(d,p,g),s&&Object.defineProperty(d,p,s)):d[p]=b[p]}function __(){Laya.un(this,"constructor",d)}__.prototype=b.prototype,d.prototype=new __,Laya.un(d.prototype,"__imps",Laya.__copy({},b.prototype.__imps))},__copy:function(dec,src){if(!src)return null;for(var i in dec=dec||{},src)dec[i]=src[i];return dec},__package:function(name,o){if(!Laya.__packages[name]){Laya.__packages[name]=!0;var p=window,strs=name.split(".");if(strs.length>1)for(var i=0,sz=strs.length-1;i<sz;i++){p=p[strs[i]]||(p[strs[i]]={})}p[strs[strs.length-1]]||(p[strs[strs.length-1]]=o||{})}},__hasOwnProperty:function(name,o){return o=o||this,Object.hasOwnProperty.call(o,name)||function classHas(name,o){if(Object.hasOwnProperty.call(o.prototype,name))return!0;var s=o.prototype.__super;return null==s?null:classHas(name,s)}(name,o.__class)},__typeof:function(o,value){if(!o||!value)return!1;if(value===String)return"string"==typeof o;if(value===Number)return"number"==typeof o;if(value.__interface__)value=value.__interface__;else if("string"!=typeof value)return o instanceof value;return o.__imps&&o.__imps[value]||o.__class==value},__as:function(value,type){return this.__typeof(value,type)?value:null},__int:function(value){return value?parseInt(value):0},interface:function(name,_super){Laya.__package(name,{});var ins=Laya.__internals,a=ins[name]=ins[name]||{self:name};if(_super){var supers=_super.split(",");a.extend=[];for(var i=0;i<supers.length;i++){var nm=supers[i];ins[nm]=ins[nm]||{self:nm},a.extend.push(ins[nm])}}var o=window,words=name.split(".");for(i=0;i<words.length-1;i++)o=o[words[i]];o[words[words.length-1]]={__interface__:name}},class:function(o,fullName,_super,miniName){if(_super&&Laya.__extend(o,_super),fullName)if(Laya.__package(fullName,o),Laya.__classmap[fullName]=o,fullName.indexOf(".")>0){if(0==fullName.indexOf("laya.")){var paths=fullName.split(".");miniName=miniName||paths[paths.length-1],Laya[miniName]&&console.log("Warning!,this class["+miniName+"] already exist:",Laya[miniName]),Laya[miniName]=o}}else"Main"==fullName?window.Main=o:(Laya[fullName]&&console.log("Error!,this class["+fullName+"] already exist:",Laya[fullName]),Laya[fullName]=o);var un=Laya.un,p=o.prototype;un(p,"hasOwnProperty",Laya.__hasOwnProperty),un(p,"__class",o),un(p,"__super",_super),un(p,"__className",fullName),un(o,"__super",_super),un(o,"__className",fullName),un(o,"__isclass",!0),un(o,"super",function(o){this.__super.call(o)})},imps:function(dec,src){if(!src)return null;var d=dec.__imps||Laya.un(dec,"__imps",{});function __(name){var c,exs;if((c=Laya.__internals[name])&&(d[name]=!0,exs=c.extend))for(var i=0;i<exs.length;i++)__(exs[i].self)}for(var i in src)__(i)},superSet:function(clas,o,prop,value){var fun=clas.prototype["_$set_"+prop];fun&&fun.call(o,value)},superGet:function(clas,o,prop){var fun=clas.prototype["_$get_"+prop];return fun?fun.call(o):null},getset:function(isStatic,o,name,getfn,setfn){isStatic?(getfn&&(o["_$GET_"+name]=getfn),setfn&&(o["_$SET_"+name]=setfn)):(getfn&&Laya.un(o,"_$get_"+name,getfn),setfn&&Laya.un(o,"_$set_"+name,setfn)),getfn&&setfn?Object.defineProperty(o,name,{get:getfn,set:setfn,enumerable:!1,configurable:!0}):(getfn&&Object.defineProperty(o,name,{get:getfn,enumerable:!1,configurable:!0}),setfn&&Object.defineProperty(o,name,{set:setfn,enumerable:!1,configurable:!0}))},static:function(_class,def){for(var i=0,sz=def.length;i<sz;i+=2)if("length"==def[i])_class.length=def[i+1].call(_class);else{function tmp(){var name=def[i],getfn=def[i+1];Object.defineProperty(_class,name,{get:function(){return delete this[name],this[name]=getfn.call(this)},set:function(v){delete this[name],this[name]=v},enumerable:!0,configurable:!0})}tmp()}},un:function(obj,name,value){return value||(value=obj[name]),Laya.__propun.value=value,Object.defineProperty(obj,name,Laya.__propun),value},uns:function(obj,names){names.forEach(function(o){Laya.un(obj,o)})}};return window.console=window.console||{log:function(){}},window.trace=window.console.log,Error.prototype.throwError=function(){throw arguments},Object.defineProperty(Array.prototype,"fixed",{enumerable:!1}),Laya}(window,document);!function(window,document,Laya){Laya.un,Laya.uns,Laya.static,Laya.class,Laya.getset,Laya.__newvec}(window,document,Laya),function(window,document,Laya){Laya.un,Laya.uns;var __static=Laya.static,__class=Laya.class,__getset=Laya.getset;Laya.__newvec,Laya.interface("laya.ui.IBox"),Laya.interface("laya.ui.IItem"),Laya.interface("laya.ui.ISelect"),Laya.interface("laya.ui.IRender"),Laya.interface("laya.filters.IFilter"),Laya.interface("laya.resource.IDispose"),Laya.interface("laya.resource.IDestroy"),Laya.interface("laya.resource.ICreateResource"),Laya.interface("laya.resource.ISingletonElement"),__getset(1,Laya,"alertGlobalError",null,function(value){var erralert=0;Browser.window.onerror=value?function(msg,url,line,column,detail){erralert++<5&&detail&&alert("出错啦，请把此信息截图给研发商\n"+msg+"\n"+detail.stack)}:null}),Laya.init=function(width,height,__plugins){for(var plugins=[],i=2,sz=arguments.length;i<sz;i++)plugins.push(arguments[i]);if(!Laya._isinit){Laya._isinit=!0,ArrayBuffer.prototype.slice||(ArrayBuffer.prototype.slice=Laya._arrayBufferSlice),Browser.__init__(),Render.isConchApp||Context.__init__(),Laya.systemTimer=new Timer(!1),Laya.startTimer=new Timer(!1),Laya.physicsTimer=new Timer(!1),Laya.updateTimer=new Timer(!1),Laya.lateTimer=new Timer(!1),Laya.timer=new Timer(!1),Laya.loader=new LoaderManager,WeakObject.__init__();for(var isWebGLEnabled=!1,n=(i=0,plugins.length);i<n;i++)plugins[i]&&plugins[i].enable&&(plugins[i].enable(),"WebGL"==typeof plugins[i]&&(isWebGLEnabled=!0));return Render.isConchApp&&(isWebGLEnabled||laya.webgl.WebGL.enable(),RunDriver.enableNative()),CacheManger.beginCheck(),Laya._currentStage=Laya.stage=new Stage,Laya._getUrlPath(),Laya.render=new Render(0,0),Laya.stage.size(width,height),window.stage=Laya.stage,RenderSprite.__init__(),MouseManager.instance.__init__(Laya.stage,Render.canvas),Render.canvas}},Laya._getUrlPath=function(){var location=Browser.window.location,pathName=location.pathname;pathName=":"==pathName.charAt(2)?pathName.substring(1):pathName,URL.rootPath=URL.basePath=URL.getPath("file:"==location.protocol?pathName:location.protocol+"//"+location.host+location.pathname)},Laya._arrayBufferSlice=function(start,end){var arrU8List=new Uint8Array(this,start,end-start),newU8List=new Uint8Array(arrU8List.length);return newU8List.set(arrU8List),newU8List.buffer},Laya._runScript=function(script){return Browser.window[Laya._evcode](script)},Laya.enableDebugPanel=function(debugJsPath){if(void 0===debugJsPath&&(debugJsPath="libs/laya.debugtool.js"),Laya.DebugPanel)Laya.DebugPanel.enable();else{var script=Browser.createElement("script");script.onload=function(){Laya.DebugPanel.enable()},script.src=debugJsPath,Browser.document.body.appendChild(script)}},Laya.stage=null,Laya.systemTimer=null,Laya.startTimer=null,Laya.physicsTimer=null,Laya.updateTimer=null,Laya.lateTimer=null,Laya.timer=null,Laya.loader=null,Laya.version="2.0.0",Laya.render=null,Laya._currentStage=null,Laya._isinit=!1,Laya.isWXOpenDataContext=!1,Laya.isWXPosMsg=!1,__static(Laya,["_evcode",function(){return this._evcode="eval"}]);var LayaGLQuickRunner=function(){function LayaGLQuickRunner(){}return __class(LayaGLQuickRunner,"laya.renders.LayaGLQuickRunner"),LayaGLQuickRunner.__init__=function(){LayaGLQuickRunner.map[515]=LayaGLQuickRunner.alpha_transform_drawLayaGL,LayaGLQuickRunner.map[513]=LayaGLQuickRunner.alpha_drawLayaGL,LayaGLQuickRunner.map[514]=LayaGLQuickRunner.transform_drawLayaGL,LayaGLQuickRunner.map[8194]=LayaGLQuickRunner.transform_drawNodes,LayaGLQuickRunner.map[259]=LayaGLQuickRunner.alpha_transform_drawTexture,LayaGLQuickRunner.map[257]=LayaGLQuickRunner.alpha_drawTexture,LayaGLQuickRunner.map[258]=LayaGLQuickRunner.transform_drawTexture,LayaGLQuickRunner.map[8704]=LayaGLQuickRunner.drawLayaGL_drawNodes},LayaGLQuickRunner.transform_drawTexture=function(sprite,context,x,y){sprite._style;var tex=sprite.texture;context.saveTransform(LayaGLQuickRunner.curMat),context.transformByMatrix(sprite.transform,x,y),context.drawTexture(tex,-sprite.pivotX,-sprite.pivotY,sprite._width||tex.width,sprite._height||tex.height),context.restoreTransform(LayaGLQuickRunner.curMat)},LayaGLQuickRunner.alpha_drawTexture=function(sprite,context,x,y){var alpha,style=sprite._style,tex=sprite.texture;if((alpha=style.alpha)>.01||sprite._needRepaint()){var temp=context.globalAlpha;context.globalAlpha*=alpha,context.drawTexture(tex,x-style.pivotX+tex.offsetX,y-style.pivotY+tex.offsetY,sprite._width||tex.width,sprite._height||tex.height),context.globalAlpha=temp}},LayaGLQuickRunner.alpha_transform_drawTexture=function(sprite,context,x,y){var alpha,style=sprite._style,tex=sprite.texture;if((alpha=style.alpha)>.01||sprite._needRepaint()){var temp=context.globalAlpha;context.globalAlpha*=alpha,context.saveTransform(LayaGLQuickRunner.curMat),context.transformByMatrix(sprite.transform,x,y),context.drawTexture(tex,-style.pivotX+tex.offsetX,-style.pivotY+tex.offsetY,sprite._width||tex.width,sprite._height||tex.height),context.restoreTransform(LayaGLQuickRunner.curMat),context.globalAlpha=temp}},LayaGLQuickRunner.alpha_transform_drawLayaGL=function(sprite,context,x,y){var alpha,style=sprite._style;if((alpha=style.alpha)>.01||sprite._needRepaint()){var temp=context.globalAlpha;context.globalAlpha*=alpha,context.saveTransform(LayaGLQuickRunner.curMat),context.transformByMatrix(sprite.transform,x,y),sprite._graphics&&sprite._graphics._render(sprite,context,-style.pivotX,-style.pivotY),context.restoreTransform(LayaGLQuickRunner.curMat),context.globalAlpha=temp}},LayaGLQuickRunner.alpha_drawLayaGL=function(sprite,context,x,y){var alpha,style=sprite._style;if((alpha=style.alpha)>.01||sprite._needRepaint()){var temp=context.globalAlpha;context.globalAlpha*=alpha,sprite._graphics&&sprite._graphics._render(sprite,context,x-style.pivotX,y-style.pivotY),context.globalAlpha=temp}},LayaGLQuickRunner.transform_drawLayaGL=function(sprite,context,x,y){var style=sprite._style;context.saveTransform(LayaGLQuickRunner.curMat),context.transformByMatrix(sprite.transform,x,y),sprite._graphics&&sprite._graphics._render(sprite,context,-style.pivotX,-style.pivotY),context.restoreTransform(LayaGLQuickRunner.curMat)},LayaGLQuickRunner.transform_drawNodes=function(sprite,context,x,y){var textLastRender=sprite._getBit(256)&&context.drawCallOptimize(!0),style=sprite._style;context.saveTransform(LayaGLQuickRunner.curMat),context.transformByMatrix(sprite.transform,x,y),x=-style.pivotX,y=-style.pivotY;var ele,childs=sprite._children,n=childs.length;if(style.viewport){var rect=style.viewport,left=rect.x,top=rect.y,right=rect.right,bottom=rect.bottom,_x=NaN,_y=NaN;for(i=0;i<n;++i)(ele=childs[i])._visible&&(_x=ele._x)<right&&_x+ele.width>left&&(_y=ele._y)<bottom&&_y+ele.height>top&&ele.render(context,x,y)}else for(var i=0;i<n;++i)(ele=childs[i])._visible&&ele.render(context,x,y);context.restoreTransform(LayaGLQuickRunner.curMat),textLastRender&&context.drawCallOptimize(!1)},LayaGLQuickRunner.drawLayaGL_drawNodes=function(sprite,context,x,y){var textLastRender=sprite._getBit(256)&&context.drawCallOptimize(!0),style=sprite._style;x-=style.pivotX,y-=style.pivotY,sprite._graphics&&sprite._graphics._render(sprite,context,x,y);var ele,childs=sprite._children,n=childs.length;if(style.viewport){var rect=style.viewport,left=rect.x,top=rect.y,right=rect.right,bottom=rect.bottom,_x=NaN,_y=NaN;for(i=0;i<n;++i)(ele=childs[i])._visible&&(_x=ele._x)<right&&_x+ele.width>left&&(_y=ele._y)<bottom&&_y+ele.height>top&&ele.render(context,x,y)}else for(var i=0;i<n;++i)(ele=childs[i])._visible&&ele.render(context,x,y);textLastRender&&context.drawCallOptimize(!1)},LayaGLQuickRunner.map={},__static(LayaGLQuickRunner,["curMat",function(){return this.curMat=new Matrix}]),LayaGLQuickRunner}(),ColorUtils=function(){function ColorUtils(value){if(this.arrColor=[],null==value)return this.strColor="#00000000",this.numColor=0,void(this.arrColor=[0,0,0,0]);var i=0,len=0,color=0;if("string"==typeof value)if(value.indexOf("rgba(")>=0||value.indexOf("rgb(")>=0){var beginI,endI,tStr=value;for(beginI=tStr.indexOf("("),endI=tStr.indexOf(")"),tStr=tStr.substring(beginI+1,endI),this.arrColor=tStr.split(","),len=this.arrColor.length,i=0;i<len;i++)this.arrColor[i]=parseFloat(this.arrColor[i]),i<3&&(this.arrColor[i]=Math.round(this.arrColor[i]));color=4==this.arrColor.length?256*(256*(256*this.arrColor[0]+this.arrColor[1])+this.arrColor[2])+Math.round(255*this.arrColor[3]):256*(256*this.arrColor[0]+this.arrColor[1])+this.arrColor[2],this.strColor=value}else{if(this.strColor=value,"#"===value.charAt(0)&&(value=value.substr(1)),3===(len=value.length)||4===len){var temp="";for(i=0;i<len;i++)temp+=value[i]+value[i];value=temp}color=parseInt(value,16)}else color=value,this.strColor=Utils.toHexColor(color);this.strColor.indexOf("rgba")>=0||9===this.strColor.length?(this.arrColor=[((4278190080&color)>>>24)/255,((16711680&color)>>16)/255,((65280&color)>>8)/255,(255&color)/255],this.numColor=(4278190080&color)>>>24|(16711680&color)>>8|(65280&color)<<8|(255&color)<<24):(this.arrColor=[((16711680&color)>>16)/255,((65280&color)>>8)/255,(255&color)/255,1],this.numColor=4278190080|(16711680&color)>>16|65280&color|(255&color)<<16),this.arrColor.__id=++ColorUtils._COLODID}return __class(ColorUtils,"laya.utils.ColorUtils"),ColorUtils._initDefault=function(){for(var i in ColorUtils._DEFAULT={},ColorUtils._COLOR_MAP)ColorUtils._SAVE[i]=ColorUtils._DEFAULT[i]=new ColorUtils(ColorUtils._COLOR_MAP[i]);return ColorUtils._DEFAULT},ColorUtils._initSaveMap=function(){for(var i in ColorUtils._SAVE_SIZE=0,ColorUtils._SAVE={},ColorUtils._DEFAULT)ColorUtils._SAVE[i]=ColorUtils._DEFAULT[i]},ColorUtils.create=function(value){var key=value+"",color=ColorUtils._SAVE[key];return null!=color?color:(ColorUtils._SAVE_SIZE<1e3&&ColorUtils._initSaveMap(),ColorUtils._SAVE[key]=new ColorUtils(value))},ColorUtils._SAVE={},ColorUtils._SAVE_SIZE=0,ColorUtils._COLOR_MAP={purple:"#800080",orange:"#ffa500",white:"#FFFFFF",red:"#FF0000",green:"#00FF00",blue:"#0000FF",black:"#000000",yellow:"#FFFF00",gray:"#808080"},ColorUtils._DEFAULT=ColorUtils._initDefault(),ColorUtils._COLODID=1,ColorUtils}(),EventDispatcher=(function(){function Config(){}__class(Config,"Config"),Config.animationInterval=50,Config.isAntialias=!1,Config.isAlpha=!1,Config.premultipliedAlpha=!0,Config.isStencil=!0,Config.preserveDrawingBuffer=!1,Config.webGL2D_MeshAllocMaxMem=!0,Config.is2DPixelArtGame=!1,Config.useWebGL2=!1}(),function(){var EventHandler;function EventDispatcher(){this._events=null}__class(EventDispatcher,"laya.events.EventDispatcher");var __proto=EventDispatcher.prototype;return __proto.hasListener=function(type){return!(!this._events||!this._events[type])},__proto.event=function(type,data){if(!this._events||!this._events[type])return!1;var listeners=this._events[type];if(listeners.run)listeners.once&&delete this._events[type],null!=data?listeners.runWith(data):listeners.run();else{for(var i=0,n=listeners.length;i<n;i++){var listener=listeners[i];listener&&(null!=data?listener.runWith(data):listener.run()),listener&&!listener.once||(listeners.splice(i,1),i--,n--)}0===listeners.length&&this._events&&delete this._events[type]}return!0},__proto.on=function(type,caller,listener,args){return this._createListener(type,caller,listener,args,!1)},__proto.once=function(type,caller,listener,args){return this._createListener(type,caller,listener,args,!0)},__proto._createListener=function(type,caller,listener,args,once,offBefore){void 0===offBefore&&(offBefore=!0),offBefore&&this.off(type,caller,listener,once);var handler=EventHandler.create(caller||this,listener,args,once);this._events||(this._events={});var events=this._events;return events[type]?events[type].run?events[type]=[events[type],handler]:events[type].push(handler):events[type]=handler,this},__proto.off=function(type,caller,listener,onceOnly){if(void 0===onceOnly&&(onceOnly=!1),!this._events||!this._events[type])return this;var listeners=this._events[type];if(null!=listeners)if(listeners.run)caller&&listeners.caller!==caller||null!=listener&&listeners.method!==listener||onceOnly&&!listeners.once||(delete this._events[type],listeners.recover());else{for(var count=0,i=0,n=listeners.length;i<n;i++){var item=listeners[i];item?!item||caller&&item.caller!==caller||null!=listener&&item.method!==listener||onceOnly&&!item.once||(count++,listeners[i]=null,item.recover()):count++}count===n&&delete this._events[type]}return this},__proto.offAll=function(type){var events=this._events;if(!events)return this;if(type)this._recoverHandlers(events[type]),delete events[type];else{for(var name in events)this._recoverHandlers(events[name]);this._events=null}return this},__proto.offAllCaller=function(caller){if(caller&&this._events)for(var name in this._events)this.off(name,caller,null);return this},__proto._recoverHandlers=function(arr){if(arr)if(arr.run)arr.recover();else for(var i=arr.length-1;i>-1;i--)arr[i]&&(arr[i].recover(),arr[i]=null)},__proto.isMouseEvent=function(type){return EventDispatcher.MOUSE_EVENTS[type]||!1},EventDispatcher.MOUSE_EVENTS={rightmousedown:!0,rightmouseup:!0,rightclick:!0,mousedown:!0,mouseup:!0,mousemove:!0,mouseover:!0,mouseout:!0,click:!0,doubleclick:!0},EventDispatcher.__init$=function(){Object.defineProperty(laya.events.EventDispatcher.prototype,"_events",{enumerable:!1,writable:!0}),EventHandler=function(_super){function EventHandler(caller,method,args,once){EventHandler.__super.call(this,caller,method,args,once)}return __class(EventHandler,"",Handler),EventHandler.prototype.recover=function(){this._id>0&&(this._id=0,EventHandler._pool.push(this.clear()))},EventHandler.create=function(caller,method,args,once){return void 0===once&&(once=!0),EventHandler._pool.length?EventHandler._pool.pop().setTo(caller,method,args,once):new EventHandler(caller,method,args,once)},EventHandler._pool=[],EventHandler}()},EventDispatcher}()),Handler=function(){function Handler(caller,method,args,once){this.once=!1,this._id=0,void 0===once&&(once=!1),this.setTo(caller,method,args,once)}__class(Handler,"laya.utils.Handler");var __proto=Handler.prototype;return __proto.setTo=function(caller,method,args,once){return this._id=Handler._gid++,this.caller=caller,this.method=method,this.args=args,this.once=once,this},__proto.run=function(){if(null==this.method)return null;var id=this._id,result=this.method.apply(this.caller,this.args);return this._id===id&&this.once&&this.recover(),result},__proto.runWith=function(data){if(null==this.method)return null;var id=this._id;if(null==data)var result=this.method.apply(this.caller,this.args);else result=this.args||data.unshift?this.args?this.method.apply(this.caller,this.args.concat(data)):this.method.apply(this.caller,data):this.method.call(this.caller,data);return this._id===id&&this.once&&this.recover(),result},__proto.clear=function(){return this.caller=null,this.method=null,this.args=null,this},__proto.recover=function(){this._id>0&&(this._id=0,Handler._pool.push(this.clear()))},Handler.create=function(caller,method,args,once){return void 0===once&&(once=!0),Handler._pool.length?Handler._pool.pop().setTo(caller,method,args,once):new Handler(caller,method,args,once)},Handler._pool=[],Handler._gid=1,Handler}(),Filter=function(){function Filter(){this._action=null,this._glRender=null}__class(Filter,"laya.filters.Filter");var __proto=Filter.prototype;return Laya.imps(__proto,{"laya.filters.IFilter":!0}),__getset(0,__proto,"type",function(){return-1}),Filter.BLUR=16,Filter.COLOR=32,Filter.GLOW=8,Filter._filter=null,Filter._recycleScope=null,Filter}(),TouchManager=function(){function TouchManager(){this.preOvers=[],this.preDowns=[],this.preRightDowns=[],this.enable=!0,this._lastClickTime=0,this._event=new Event}__class(TouchManager,"laya.events.TouchManager");var __proto=TouchManager.prototype;return __proto._clearTempArrs=function(){TouchManager._oldArr.length=0,TouchManager._newArr.length=0,TouchManager._tEleArr.length=0},__proto.getTouchFromArr=function(touchID,arr){var len,tTouchO,i=0;for(len=arr.length,i=0;i<len;i++)if((tTouchO=arr[i]).id==touchID)return tTouchO;return null},__proto.removeTouchFromArr=function(touchID,arr){var i=0;for(i=arr.length-1;i>=0;i--)arr[i].id==touchID&&arr.splice(i,1)},__proto.createTouchO=function(ele,touchID){var rst;return(rst=Pool.getItem("TouchData")||{}).id=touchID,rst.tar=ele,rst},__proto.onMouseDown=function(ele,touchID,isLeft){var preO,tO,arrs,preDowns;void 0===isLeft&&(isLeft=!1),this.enable&&(preO=this.getTouchFromArr(touchID,this.preOvers),arrs=this.getEles(ele,null,TouchManager._tEleArr),preO?preO.tar=ele:(tO=this.createTouchO(ele,touchID),this.preOvers.push(tO)),Browser.onMobile&&this.sendEvents(arrs,"mouseover"),preDowns=isLeft?this.preDowns:this.preRightDowns,(preO=this.getTouchFromArr(touchID,preDowns))?preO.tar=ele:(tO=this.createTouchO(ele,touchID),preDowns.push(tO)),this.sendEvents(arrs,isLeft?"mousedown":"rightmousedown"),this._clearTempArrs())},__proto.sendEvents=function(eles,type){var len,_target,tE,i=0;for(len=eles.length,this._event._stoped=!1,_target=eles[0],i=0;i<len;i++){if((tE=eles[i]).destroyed)return;if(tE.event(type,this._event.setTo(type,tE,_target)),this._event._stoped)break}},__proto.getEles=function(start,end,rst){for(rst?rst.length=0:rst=[];start&&start!=end;)rst.push(start),start=start.parent;return rst},__proto.checkMouseOutAndOverOfMove=function(eleNew,elePre,touchID){if(void 0===touchID&&(touchID=0),elePre!=eleNew){var tar,arrs,i=0,len=0;if(elePre.contains(eleNew))arrs=this.getEles(eleNew,elePre,TouchManager._tEleArr),this.sendEvents(arrs,"mouseover");else if(eleNew.contains(elePre))arrs=this.getEles(elePre,eleNew,TouchManager._tEleArr),this.sendEvents(arrs,"mouseout");else{var oldArr,newArr;(arrs=TouchManager._tEleArr).length=0,oldArr=this.getEles(elePre,null,TouchManager._oldArr),newArr=this.getEles(eleNew,null,TouchManager._newArr),len=oldArr.length;var tIndex=0;for(i=0;i<len;i++){if(tar=oldArr[i],(tIndex=newArr.indexOf(tar))>=0){newArr.splice(tIndex,newArr.length-tIndex);break}arrs.push(tar)}arrs.length>0&&this.sendEvents(arrs,"mouseout"),newArr.length>0&&this.sendEvents(newArr,"mouseover")}}},__proto.onMouseMove=function(ele,touchID){var preO,arrs;this.enable&&((preO=this.getTouchFromArr(touchID,this.preOvers))?(this.checkMouseOutAndOverOfMove(ele,preO.tar),preO.tar=ele,arrs=this.getEles(ele,null,TouchManager._tEleArr)):(arrs=this.getEles(ele,null,TouchManager._tEleArr),this.sendEvents(arrs,"mouseover"),this.preOvers.push(this.createTouchO(ele,touchID))),this.sendEvents(arrs,"mousemove"),this._clearTempArrs())},__proto.getLastOvers=function(){return TouchManager._tEleArr.length=0,this.preOvers.length>0&&this.preOvers[0].tar?this.getEles(this.preOvers[0].tar,null,TouchManager._tEleArr):(TouchManager._tEleArr.push(Laya.stage),TouchManager._tEleArr)},__proto.stageMouseOut=function(){var lastOvers;lastOvers=this.getLastOvers(),this.preOvers.length=0,this.sendEvents(lastOvers,"mouseout")},__proto.onMouseUp=function(ele,touchID,isLeft){if(void 0===isLeft&&(isLeft=!1),this.enable){var preO,arrs,oldArr,tar,sendArr,preDowns,i=0,len=0,onMobile=Browser.onMobile;if(arrs=this.getEles(ele,null,TouchManager._tEleArr),this.sendEvents(arrs,isLeft?"mouseup":"rightmouseup"),preDowns=isLeft?this.preDowns:this.preRightDowns,preO=this.getTouchFromArr(touchID,preDowns)){var isDouble,now=Browser.now();if(isDouble=now-this._lastClickTime<300,this._lastClickTime=now,ele==preO.tar)sendArr=arrs;else for(oldArr=this.getEles(preO.tar,null,TouchManager._oldArr),(sendArr=TouchManager._newArr).length=0,len=oldArr.length,i=0;i<len;i++)tar=oldArr[i],arrs.indexOf(tar)>=0&&sendArr.push(tar);sendArr.length>0&&this.sendEvents(sendArr,isLeft?"click":"rightclick"),isLeft&&isDouble&&this.sendEvents(sendArr,"doubleclick"),this.removeTouchFromArr(touchID,preDowns),preO.tar=null,Pool.recover("TouchData",preO)}(preO=this.getTouchFromArr(touchID,this.preOvers))&&onMobile&&((sendArr=this.getEles(preO.tar,null,sendArr))&&sendArr.length>0&&this.sendEvents(sendArr,"mouseout"),this.removeTouchFromArr(touchID,this.preOvers),preO.tar=null,Pool.recover("TouchData",preO)),this._clearTempArrs()}},TouchManager._oldArr=[],TouchManager._newArr=[],TouchManager._tEleArr=[],__static(TouchManager,["I",function(){return this.I=new TouchManager}]),TouchManager}(),Component=function(){function Component(){this._id=Utils.getGID(),this._resetComp()}__class(Component,"laya.components.Component");var __proto=Component.prototype;return Laya.imps(__proto,{"laya.resource.ISingletonElement":!0,"laya.resource.IDestroy":!0}),__proto._isScript=function(){return!1},__proto._resetComp=function(){this._indexInList=-1,this._enabled=!0,this._awaked=!1,this.owner=null},__proto._getIndexInList=function(){return this._indexInList},__proto._setIndexInList=function(index){this._indexInList=index},__proto._onAdded=function(){},__proto._onAwake=function(){},__proto._onEnable=function(){},__proto._onDisable=function(){},__proto._onEnableInScene=function(){},__proto._onDisableInScene=function(){},__proto._onDestroy=function(){},__proto.onReset=function(){},__proto._parse=function(data){},__proto._cloneTo=function(dest){},__proto._setActive=function(value){value?(this._awaked||(this._awaked=!0,this._onAwake()),this._enabled&&this._onEnable()):this._enabled&&this._onDisable()},__proto._setActiveInScene=function(value){value?this._onEnableInScene():this._onDisableInScene()},__proto.destroy=function(){this.owner&&this.owner._destroyComponent(this)},__proto._destroy=function(){this.owner.activeInHierarchy&&this._enabled&&(this._setActive(!1),this._isScript()&&this.onDisable()),this.owner._scene&&this._setActiveInScene(!1),this._onDestroy(),this._destroyed=!0,this.onReset!==laya.components.Component.prototype.onReset?(this.onReset(),this._resetComp(),Pool.recoverByClass(this)):this._resetComp()},__getset(0,__proto,"id",function(){return this._id}),__getset(0,__proto,"enabled",function(){return this._enabled},function(value){this._enabled=value,this.owner&&(value?this.owner.activeInHierarchy&&this._onEnable():this.owner.activeInHierarchy&&this._onDisable())}),__getset(0,__proto,"isSingleton",function(){return!0}),__getset(0,__proto,"destroyed",function(){return this._destroyed}),Component}(),CallLater=function(){var LaterHandler;function CallLater(){this._pool=[],this._map=[],this._laters=[]}__class(CallLater,"laya.utils.CallLater");var __proto=CallLater.prototype;return __proto._update=function(){var laters=this._laters,len=laters.length;if(len>0){for(var i=0,n=len-1;i<=n;i++){var handler=laters[i];this._map[handler.key]=null,null!==handler.method&&(handler.run(),handler.clear()),this._pool.push(handler),i===n&&(n=laters.length-1)}laters.length=0}},__proto._getHandler=function(caller,method){var cid=caller?caller.$_GID||(caller.$_GID=Utils.getGID()):0,mid=method.$_TID||(method.$_TID=1e5*Timer._mid++);return this._map[cid+mid]},__proto.callLater=function(caller,method,args){if(null==this._getHandler(caller,method)){if(this._pool.length)var handler=this._pool.pop();else handler=new LaterHandler;handler.caller=caller,handler.method=method,handler.args=args;var cid=caller?caller.$_GID:0,mid=method.$_TID;handler.key=cid+mid,this._map[handler.key]=handler,this._laters.push(handler)}},__proto.runCallLater=function(caller,method){var handler=this._getHandler(caller,method);handler&&null!=handler.method&&(this._map[handler.key]=null,handler.run(),handler.clear())},CallLater.I=new CallLater,CallLater.__init$=function(){LaterHandler=function(){function LaterHandler(){this.key=0,this.caller=null,this.method=null,this.args=null}__class(LaterHandler,"");var __proto=LaterHandler.prototype;return __proto.clear=function(){this.caller=null,this.method=null,this.args=null},__proto.run=function(){var caller=this.caller;if(caller&&caller.destroyed)return this.clear();var method=this.method,args=this.args;null!=method&&(args?method.apply(caller,args):method.call(caller))},LaterHandler}()},CallLater}(),MiniLocalStorage=function(){function MiniLocalStorage(){}return __class(MiniLocalStorage,"laya.wx.mini.MiniLocalStorage"),MiniLocalStorage.__init__=function(){MiniLocalStorage.items=MiniLocalStorage},MiniLocalStorage.setItem=function(key,value){try{wx.setStorageSync(key,value)}catch(error){wx.setStorage({key:key,data:value})}},MiniLocalStorage.getItem=function(key){return wx.getStorageSync(key)},MiniLocalStorage.setJSON=function(key,value){MiniLocalStorage.setItem(key,value)},MiniLocalStorage.getJSON=function(key){return MiniLocalStorage.getItem(key)},MiniLocalStorage.removeItem=function(key){wx.removeStorageSync(key)},MiniLocalStorage.clear=function(){wx.clearStorageSync()},MiniLocalStorage.getStorageInfoSync=function(){try{var res=wx.getStorageInfoSync();return console.log(res.keys),console.log(res.currentSize),console.log(res.limitSize),res}catch(e){}return null},MiniLocalStorage.support=!0,MiniLocalStorage.items=null,MiniLocalStorage}(),DrawRectCmd=(function(){function HTMLChar(){this.reset()}__class(HTMLChar,"laya.utils.HTMLChar");var __proto=HTMLChar.prototype;__proto.setData=function(char,w,h,style){return this.char=char,this.charNum=char.charCodeAt(0),this.x=this.y=0,this.width=w,this.height=h,this.style=style,this.isWord=!HTMLChar._isWordRegExp.test(char),this},__proto.reset=function(){return this.x=this.y=this.width=this.height=0,this.isWord=!1,this.char=null,this.charNum=0,this.style=null,this},__proto.recover=function(){Pool.recover("HTMLChar",this.reset())},__proto._isChar=function(){return!0},__proto._getCSSStyle=function(){return this.style},HTMLChar.create=function(){return Pool.getItemByClass("HTMLChar",HTMLChar)},HTMLChar._isWordRegExp=new RegExp("[\\w.]","")}(),function(){function DrawRectCmd(){}__class(DrawRectCmd,"laya.display.cmd.DrawRectCmd");var __proto=DrawRectCmd.prototype;return __proto.recover=function(){this.fillColor=null,this.lineColor=null,Pool.recover("DrawRectCmd",this)},__proto.run=function(context,gx,gy){context.drawRect(this.x+gx,this.y+gy,this.width,this.height,this.fillColor,this.lineColor,this.lineWidth)},__getset(0,__proto,"cmdID",function(){return"DrawRect"}),DrawRectCmd.create=function(x,y,width,height,fillColor,lineColor,lineWidth){var cmd=Pool.getItemByClass("DrawRectCmd",DrawRectCmd);return cmd.x=x,cmd.y=y,cmd.width=width,cmd.height=height,cmd.fillColor=fillColor,cmd.lineColor=lineColor,cmd.lineWidth=lineWidth,cmd},DrawRectCmd.ID="DrawRect",DrawRectCmd}()),DrawCircleCmd=function(){function DrawCircleCmd(){}__class(DrawCircleCmd,"laya.display.cmd.DrawCircleCmd");var __proto=DrawCircleCmd.prototype;return __proto.recover=function(){this.fillColor=null,this.lineColor=null,Pool.recover("DrawCircleCmd",this)},__proto.run=function(context,gx,gy){context._drawCircle(this.x+gx,this.y+gy,this.radius,this.fillColor,this.lineColor,this.lineWidth,this.vid)},__getset(0,__proto,"cmdID",function(){return"DrawCircle"}),DrawCircleCmd.create=function(x,y,radius,fillColor,lineColor,lineWidth,vid){var cmd=Pool.getItemByClass("DrawCircleCmd",DrawCircleCmd);return cmd.x=x,cmd.y=y,cmd.radius=radius,cmd.fillColor=fillColor,cmd.lineColor=lineColor,cmd.lineWidth=lineWidth,cmd.vid=vid,cmd},DrawCircleCmd.ID="DrawCircle",DrawCircleCmd}(),Styles=function(){function Styles(){}return __class(Styles,"laya.ui.Styles"),Styles.labelColor="#000000",Styles.buttonStateNum=3,Styles.scrollBarMinNum=15,Styles.scrollBarDelayTime=500,__static(Styles,["defaultSizeGrid",function(){return this.defaultSizeGrid=[4,4,4,4,0]},"labelPadding",function(){return this.labelPadding=[2,2,2,2]},"inputLabelPadding",function(){return this.inputLabelPadding=[1,1,1,3]},"buttonLabelColors",function(){return this.buttonLabelColors=["#32556b","#32cc6b","#ff0000","#C0C0C0"]},"comboBoxItemColors",function(){return this.comboBoxItemColors=["#5e95b6","#ffffff","#000000","#8fa4b1","#ffffff"]}]),Styles}(),URL=function(){function URL(url){this._url=null,this._path=null,this._url=URL.formatURL(url),this._path=URL.getPath(url)}__class(URL,"laya.net.URL");var __proto=URL.prototype;return __getset(0,__proto,"path",function(){return this._path}),__getset(0,__proto,"url",function(){return this._url}),URL.formatURL=function(url){if(!url)return"null path";if(url.indexOf(":")>0)return url;if(null!=URL.customFormat&&(url=URL.customFormat(url)),url.indexOf(":")>0)return url;var char1=url.charAt(0);if("."===char1)return URL._formatRelativePath(URL.basePath+url);if("~"===char1)return URL.rootPath+url.substring(1);if("d"===char1){if(0===url.indexOf("data:image"))return url}else if("/"===char1)return url;return URL.basePath+url},URL._formatRelativePath=function(value){for(var parts=value.split("/"),i=0,len=parts.length;i<len;i++)".."==parts[i]&&(parts.splice(i-1,2),i-=2);return parts.join("/")},URL.getPath=function(url){var ofs=url.lastIndexOf("/");return ofs>0?url.substr(0,ofs+1):""},URL.getFileName=function(url){var ofs=url.lastIndexOf("/");return ofs>0?url.substr(ofs+1):url},URL.getAdptedFilePath=function(url){if(!URL.exportSceneToJson||!url)return url;var len,tArr,i=0;for(len=URL._adpteTypeList.length,i=0;i<len;i++)tArr=URL._adpteTypeList[i],url=url.replace(tArr[0],tArr[1]);return url},URL.version={},URL.exportSceneToJson=!1,URL.basePath="",URL.rootPath="",URL.customFormat=function(url){var newUrl=URL.version[url];return!Render.isConchApp&&newUrl&&(url+="?v="+newUrl),url},__static(URL,["_adpteTypeList",function(){return this._adpteTypeList=[[".scene3d",".json"],[".scene",".json"],[".taa",".json"],[".prefab",".json"]]}]),URL}(),Pool=function(){function Pool(){}return __class(Pool,"laya.utils.Pool"),Pool.getPoolBySign=function(sign){return Pool._poolDic[sign]||(Pool._poolDic[sign]=[])},Pool.clearBySign=function(sign){Pool._poolDic[sign]&&(Pool._poolDic[sign].length=0)},Pool.recover=function(sign,item){item.__InPool||(item.__InPool=!0,Pool.getPoolBySign(sign).push(item))},Pool.recoverByClass=function(instance){if(instance){var className=instance.__className||instance.constructor._$gid;className&&Pool.recover(className,instance)}},Pool._getClassSign=function(cla){var className=cla.__className||cla._$gid;return className||(cla._$gid=className=Utils.getGID()+""),className},Pool.createByClass=function(cls){return Pool.getItemByClass(Pool._getClassSign(cls),cls)},Pool.getItemByClass=function(sign,cls){if(!Pool._poolDic[sign])return new cls;var pool=Pool.getPoolBySign(sign);if(pool.length){var rst=pool.pop();rst.__InPool=!1}else rst=new cls;return rst},Pool.getItemByCreateFun=function(sign,createFun,caller){var pool=Pool.getPoolBySign(sign),rst=pool.length?pool.pop():createFun.call(caller);return rst.__InPool=!1,rst},Pool.getItem=function(sign){var pool=Pool.getPoolBySign(sign),rst=pool.length?pool.pop():null;return rst&&(rst.__InPool=!1),rst},Pool.POOLSIGN="__InPool",Pool._poolDic={},Pool}(),SpriteStyle=(function(){function PoolCache(){this.sign=null,this.maxCount=1e3}__class(PoolCache,"laya.utils.PoolCache");var __proto=PoolCache.prototype;__proto.getCacheList=function(){return Pool.getPoolBySign(this.sign)},__proto.tryDispose=function(force){var list;(list=Pool.getPoolBySign(this.sign)).length>this.maxCount&&list.splice(this.maxCount,list.length-this.maxCount)},PoolCache.addPoolCacheManager=function(sign,maxCount){var cache;void 0===maxCount&&(maxCount=100),(cache=new PoolCache).sign=sign,cache.maxCount=maxCount,CacheManger.regCacheByFunction(Utils.bind(cache.tryDispose,cache),Utils.bind(cache.getCacheList,cache))}}(),function(){function SpriteStyle(){this.reset()}__class(SpriteStyle,"laya.display.css.SpriteStyle");var __proto=SpriteStyle.prototype;return __proto.reset=function(){return this.scaleX=this.scaleY=1,this.skewX=this.skewY=0,this.pivotX=this.pivotY=this.rotation=0,this.alpha=1,this.scrollRect&&this.scrollRect.recover(),this.scrollRect=null,this.viewport&&this.viewport.recover(),this.viewport=null,this.hitArea=null,this.dragging=null,this.blendMode=null,this},__proto.recover=function(){this!==SpriteStyle.EMPTY&&Pool.recover("SpriteStyle",this.reset())},SpriteStyle.create=function(){return Pool.getItemByClass("SpriteStyle",SpriteStyle)},SpriteStyle.EMPTY=new SpriteStyle,SpriteStyle}()),MouseManager=function(){function MouseManager(){this.mouseX=0,this.mouseY=0,this.disableMouseEvent=!1,this.mouseDownTime=0,this.mouseMoveAccuracy=2,this._stage=null,this._captureSp=null,this._captureExlusiveMode=!1,this._hitCaputreSp=!1,this._target=null,this._lastMoveTimer=0,this._isLeftMouse=!1,this._touchIDs={},this._id=1,this._tTouchID=0,this._event=new Event,this._captureChain=[],this._matrix=new Matrix,this._point=new Point,this._rect=new Rectangle,this._prePoint=new Point,this._curTouchID=NaN}__class(MouseManager,"laya.events.MouseManager");var __proto=MouseManager.prototype;return __proto.__init__=function(stage,canvas){var _$this=this;this._stage=stage;var _this=this;canvas.oncontextmenu=function(e){if(MouseManager.enabled)return!1},canvas.addEventListener("mousedown",function(e){MouseManager.enabled&&(Browser.onIE||e.preventDefault(),_this.mouseDownTime=Browser.now(),_$this.runEvent(e))}),canvas.addEventListener("mouseup",function(e){MouseManager.enabled&&(e.preventDefault(),_this.mouseDownTime=-Browser.now(),_$this.runEvent(e))},!0),canvas.addEventListener("mousemove",function(e){if(MouseManager.enabled){e.preventDefault();var now=Browser.now();if(now-_this._lastMoveTimer<10)return;_this._lastMoveTimer=now,_$this.runEvent(e)}},!0),canvas.addEventListener("mouseout",function(e){MouseManager.enabled&&_$this.runEvent(e)}),canvas.addEventListener("mouseover",function(e){MouseManager.enabled&&_$this.runEvent(e)}),canvas.addEventListener("touchstart",function(e){MouseManager.enabled&&(MouseManager._isFirstTouch||e.preventDefault(),_this.mouseDownTime=Browser.now(),_$this.runEvent(e))}),canvas.addEventListener("touchend",function(e){MouseManager.enabled?(MouseManager._isFirstTouch||e.preventDefault(),MouseManager._isFirstTouch=!1,_this.mouseDownTime=-Browser.now(),_$this.runEvent(e)):_$this._curTouchID=NaN},!0),canvas.addEventListener("touchmove",function(e){MouseManager.enabled&&(e.preventDefault(),_$this.runEvent(e))},!0),canvas.addEventListener("touchcancel",function(e){MouseManager.enabled?(e.preventDefault(),_$this.runEvent(e)):_$this._curTouchID=NaN},!0),canvas.addEventListener("mousewheel",function(e){MouseManager.enabled&&_$this.runEvent(e)}),canvas.addEventListener("DOMMouseScroll",function(e){MouseManager.enabled&&_$this.runEvent(e)})},__proto.initEvent=function(e,nativeEvent){var evt;this._event._stoped=!1,this._event.nativeEvent=nativeEvent||e,this._target=null,this._point.setTo(e.pageX||e.clientX,e.pageY||e.clientY),this._stage._canvasTransform&&(this._stage._canvasTransform.invertTransformPoint(this._point),this.mouseX=this._point.x,this.mouseY=this._point.y),this._event.touchId=e.identifier||0,this._tTouchID=this._event.touchId,(evt=TouchManager.I._event)._stoped=!1,evt.nativeEvent=this._event.nativeEvent,evt.touchId=this._event.touchId},__proto.checkMouseWheel=function(e){this._event.delta=e.wheelDelta?.025*e.wheelDelta:-e.detail;for(var _lastOvers=TouchManager.I.getLastOvers(),i=0,n=_lastOvers.length;i<n;i++){var ele=_lastOvers[i];ele.event("mousewheel",this._event.setTo("mousewheel",ele,this._target))}},__proto.onMouseMove=function(ele){TouchManager.I.onMouseMove(ele,this._tTouchID)},__proto.onMouseDown=function(ele){Laya.stage.focus&&Laya.stage.focus.focus&&!Laya.stage.focus.contains(this._target)&&((Laya.stage.focus._tf||Laya.stage.focus).focus=!1),TouchManager.I.onMouseDown(ele,this._tTouchID,this._isLeftMouse)},__proto.onMouseUp=function(ele){TouchManager.I.onMouseUp(ele,this._tTouchID,this._isLeftMouse)},__proto.check=function(sp,mouseX,mouseY,callBack){this._point.setTo(mouseX,mouseY),sp.fromParentPoint(this._point),mouseX=this._point.x,mouseY=this._point.y;var scrollRect=sp._style.scrollRect;if(scrollRect&&(this._rect.setTo(scrollRect.x,scrollRect.y,scrollRect.width,scrollRect.height),!this._rect.contains(mouseX,mouseY)))return!1;if(!this.disableMouseEvent){if(sp.hitTestPrior&&!sp.mouseThrough&&!this.hitTest(sp,mouseX,mouseY))return!1;for(var i=sp._children.length-1;i>-1;i--){var child=sp._children[i];if(!child.destroyed&&child._mouseState>1&&child._visible&&this.check(child,mouseX,mouseY,callBack))return!0}for(i=sp._extUIChild.length-1;i>=0;i--){var c=sp._extUIChild[i];if(!c.destroyed&&c._mouseState>1&&c._visible&&this.check(c,mouseX,mouseY,callBack))return!0}}var isHit=!(!sp.hitTestPrior||sp.mouseThrough||this.disableMouseEvent)||this.hitTest(sp,mouseX,mouseY);return isHit?(this._target=sp,callBack.call(this,sp),this._target==this._hitCaputreSp&&(this._hitCaputreSp=!0)):callBack===this.onMouseUp&&sp===this._stage&&(this._target=this._stage,callBack.call(this,this._target)),isHit},__proto.hitTest=function(sp,mouseX,mouseY){var isHit=!1;sp.scrollRect&&(mouseX-=sp._style.scrollRect.x,mouseY-=sp._style.scrollRect.y);var hitArea=sp._style.hitArea;return hitArea&&hitArea._hit?hitArea.contains(mouseX,mouseY):((sp.width>0&&sp.height>0||sp.mouseThrough||hitArea)&&(isHit=sp.mouseThrough?sp.getGraphicBounds().contains(mouseX,mouseY):(hitArea||this._rect.setTo(0,0,sp.width,sp.height)).contains(mouseX,mouseY)),isHit)},__proto._checkAllBaseUI=function(mousex,mousey,callback){var ret=this.handleExclusiveCapture(this.mouseX,this.mouseY,callback);return!!ret||(ret=this.check(this._stage,this.mouseX,this.mouseY,callback),this.handleCapture(this.mouseX,this.mouseY,callback)||ret)},__proto.check3DUI=function(mousex,mousey,callback){for(var uis=this._stage._3dUI,i=0,ret=!1;i<uis.length;i++){var curui=uis[i];this._stage._curUIBase=curui,!curui.destroyed&&curui._mouseState>1&&curui._visible&&(ret=ret||this.check(curui,this.mouseX,this.mouseY,callback))}return this._stage._curUIBase=this._stage,ret},__proto.handleExclusiveCapture=function(mousex,mousey,callback){if(this._captureExlusiveMode&&this._captureSp&&this._captureChain.length>0){var cursp;this._point.setTo(mousex,mousey);for(var i=0;i<this._captureChain.length;i++)(cursp=this._captureChain[i]).fromParentPoint(this._point);return this._target=cursp,callback.call(this,cursp),!0}return!1},__proto.handleCapture=function(mousex,mousey,callback){if(!this._hitCaputreSp&&this._captureSp&&this._captureChain.length>0){var cursp;this._point.setTo(mousex,mousey);for(var i=0;i<this._captureChain.length;i++)(cursp=this._captureChain[i]).fromParentPoint(this._point);return this._target=cursp,callback.call(this,cursp),!0}return!1},__proto.runEvent=function(evt){var touch,i=0,n=0;switch("mousemove"!==evt.type&&(this._prePoint.x=this._prePoint.y=-1e6),evt.type){case"mousedown":this._touchIDs[0]=this._id++,MouseManager._isTouchRespond?MouseManager._isTouchRespond=!1:(this._isLeftMouse=0===evt.button,this.initEvent(evt),this._checkAllBaseUI(this.mouseX,this.mouseY,this.onMouseDown));break;case"mouseup":this._isLeftMouse=0===evt.button,this.initEvent(evt),this._checkAllBaseUI(this.mouseX,this.mouseY,this.onMouseUp);break;case"mousemove":Math.abs(this._prePoint.x-evt.clientX)+Math.abs(this._prePoint.y-evt.clientY)>=this.mouseMoveAccuracy&&(this._prePoint.x=evt.clientX,this._prePoint.y=evt.clientY,this.initEvent(evt),this._checkAllBaseUI(this.mouseX,this.mouseY,this.onMouseMove));break;case"touchstart":MouseManager._isTouchRespond=!0,this._isLeftMouse=!0;var touches=evt.changedTouches;for(i=0,n=touches.length;i<n;i++)touch=touches[i],(MouseManager.multiTouchEnabled||isNaN(this._curTouchID))&&(this._curTouchID=touch.identifier,this._id%200==0&&(this._touchIDs={}),this._touchIDs[touch.identifier]=this._id++,this.initEvent(touch,evt),this._checkAllBaseUI(this.mouseX,this.mouseY,this.onMouseDown));break;case"touchend":case"touchcancel":MouseManager._isTouchRespond=!0,this._isLeftMouse=!0;var touchends=evt.changedTouches;for(i=0,n=touchends.length;i<n;i++)touch=touchends[i],(MouseManager.multiTouchEnabled||touch.identifier==this._curTouchID)&&(this._curTouchID=NaN,this.initEvent(touch,evt),this._checkAllBaseUI(this.mouseX,this.mouseY,this.onMouseUp)||this.onMouseUp(null));break;case"touchmove":var touchemoves=evt.changedTouches;for(i=0,n=touchemoves.length;i<n;i++)touch=touchemoves[i],(MouseManager.multiTouchEnabled||touch.identifier==this._curTouchID)&&(this.initEvent(touch,evt),this._checkAllBaseUI(this.mouseX,this.mouseY,this.onMouseMove));break;case"wheel":case"mousewheel":case"DOMMouseScroll":this.checkMouseWheel(evt);break;case"mouseout":TouchManager.I.stageMouseOut();break;case"mouseover":this._stage.event("mouseover",this._event.setTo("mouseover",this._stage,this._stage))}},__proto.setCapture=function(sp,exclusive){void 0===exclusive&&(exclusive=!1),this._captureSp=sp,this._captureExlusiveMode=exclusive,this._captureChain.length=0,this._captureChain.push(sp);for(var cursp=sp;cursp!=Laya.stage&&cursp!=Laya.stage._curUIBase&&(cursp=cursp.parent);)this._captureChain.splice(0,0,cursp)},__proto.releaseCapture=function(){console.log("release capture"),this._captureSp=null},MouseManager.enabled=!0,MouseManager.multiTouchEnabled=!0,MouseManager._isTouchRespond=!1,MouseManager._isFirstTouch=!0,__static(MouseManager,["instance",function(){return this.instance=new MouseManager}]),MouseManager}(),TranslateCmd=function(){function TranslateCmd(){}__class(TranslateCmd,"laya.display.cmd.TranslateCmd");var __proto=TranslateCmd.prototype;return __proto.recover=function(){Pool.recover("TranslateCmd",this)},__proto.run=function(context,gx,gy){context.translate(this.tx,this.ty)},__getset(0,__proto,"cmdID",function(){return"Translate"}),TranslateCmd.create=function(tx,ty){var cmd=Pool.getItemByClass("TranslateCmd",TranslateCmd);return cmd.tx=tx,cmd.ty=ty,cmd},TranslateCmd.ID="Translate",TranslateCmd}(),DrawLineCmd=function(){function DrawLineCmd(){}__class(DrawLineCmd,"laya.display.cmd.DrawLineCmd");var __proto=DrawLineCmd.prototype;return __proto.recover=function(){Pool.recover("DrawLineCmd",this)},__proto.run=function(context,gx,gy){context._drawLine(gx,gy,this.fromX,this.fromY,this.toX,this.toY,this.lineColor,this.lineWidth,this.vid)},__getset(0,__proto,"cmdID",function(){return"DrawLine"}),DrawLineCmd.create=function(fromX,fromY,toX,toY,lineColor,lineWidth,vid){var cmd=Pool.getItemByClass("DrawLineCmd",DrawLineCmd);return cmd.fromX=fromX,cmd.fromY=fromY,cmd.toX=toX,cmd.toY=toY,cmd.lineColor=lineColor,cmd.lineWidth=lineWidth,cmd.vid=vid,cmd},DrawLineCmd.ID="DrawLine",DrawLineCmd}(),DrawTexturesCmd=function(){function DrawTexturesCmd(){}__class(DrawTexturesCmd,"laya.display.cmd.DrawTexturesCmd");var __proto=DrawTexturesCmd.prototype;return __proto.recover=function(){this.texture._removeReference(),this.texture=null,this.pos=null,Pool.recover("DrawTexturesCmd",this)},__proto.run=function(context,gx,gy){context.drawTextures(this.texture,this.pos,gx,gy)},__getset(0,__proto,"cmdID",function(){return"DrawTextures"}),DrawTexturesCmd.create=function(texture,pos){var cmd=Pool.getItemByClass("DrawTexturesCmd",DrawTexturesCmd);return cmd.texture=texture,texture._addReference(),cmd.pos=pos,cmd},DrawTexturesCmd.ID="DrawTextures",DrawTexturesCmd}(),ColorFilterAction=function(){function ColorFilterAction(){this.data=null}__class(ColorFilterAction,"laya.filters.ColorFilterAction");var __proto=ColorFilterAction.prototype;return __proto.apply=function(srcCanvas){var canvas=srcCanvas.canvas,ctx=canvas.context;if(0==canvas.width||0==canvas.height)return canvas;for(var nData,imgdata=ctx.getImageData(0,0,canvas.width,canvas.height),data=imgdata.data,i=0,n=data.length;i<n;i+=4)nData=this.getColor(data[i],data[i+1],data[i+2],data[i+3]),0!=data[i+3]&&(data[i]=nData[0],data[i+1]=nData[1],data[i+2]=nData[2],data[i+3]=nData[3]);return ctx.putImageData(imgdata,0,0),srcCanvas},__proto.getColor=function(red,green,blue,alpha){var rst=[];if(this.data._mat&&this.data._alpha){var mat=this.data._mat,tempAlpha=this.data._alpha;rst[0]=mat[0]*red+mat[1]*green+mat[2]*blue+mat[3]*alpha+tempAlpha[0],rst[1]=mat[4]*red+mat[5]*green+mat[6]*blue+mat[7]*alpha+tempAlpha[1],rst[2]=mat[8]*red+mat[9]*green+mat[10]*blue+mat[11]*alpha+tempAlpha[2],rst[3]=mat[12]*red+mat[13]*green+mat[14]*blue+mat[15]*alpha+tempAlpha[3]}return rst},ColorFilterAction}(),MiniAdpter=(function(){function System(){}__class(System,"laya.system.System"),System.changeDefinition=function(name,classObj){Laya[name]=classObj;var str=name+"=classObj";Laya._runScript(str)},System.__init__=function(){}}(),function(){function MiniAdpter(){}return __class(MiniAdpter,"laya.wx.mini.MiniAdpter"),MiniAdpter.getJson=function(data){return JSON.parse(data)},MiniAdpter.enable=function(){MiniAdpter.init(Laya.isWXPosMsg,Laya.isWXOpenDataContext)},MiniAdpter.init=function(isPosMsg,isSon){void 0===isPosMsg&&(isPosMsg=!1),void 0===isSon&&(isSon=!1),MiniAdpter._inited||(MiniAdpter._inited=!0,MiniAdpter.window=window,MiniAdpter.window.navigator.userAgent.indexOf("MiniGame")<0||(MiniAdpter.isZiYu=isSon,MiniAdpter.isPosMsgYu=isPosMsg,MiniAdpter.EnvConfig={},MiniAdpter.isZiYu||(MiniFileMgr.setNativeFileDir("/layaairGame"),MiniFileMgr.existDir(MiniFileMgr.fileNativeDir,Handler.create(MiniAdpter,MiniAdpter.onMkdirCallBack))),MiniAdpter.systemInfo=wx.getSystemInfoSync(),MiniAdpter.window.focus=function(){},Laya._getUrlPath=function(){},MiniAdpter.window.logtime=function(str){},MiniAdpter.window.alertTimeLog=function(str){},MiniAdpter.window.resetShareInfo=function(){},MiniAdpter.window.CanvasRenderingContext2D=function(){},MiniAdpter.window.CanvasRenderingContext2D.prototype=MiniAdpter.window.wx.createCanvas().getContext("2d").__proto__,MiniAdpter.window.document.body.appendChild=function(){},MiniAdpter.EnvConfig.pixelRatioInt=0,Browser._pixelRatio=MiniAdpter.pixelRatio(),MiniAdpter._preCreateElement=Browser.createElement,Browser.createElement=MiniAdpter.createElement,RunDriver.createShaderCondition=MiniAdpter.createShaderCondition,Utils.parseXMLFromString=MiniAdpter.parseXMLFromString,MiniAdpter.EnvConfig.load=Loader.prototype.load,Loader.prototype.load=MiniLoader.prototype.load,Loader.prototype._loadImage=MiniImage.prototype._loadImage,MiniLocalStorage.__init__(),MiniAdpter.window.wx.onMessage(MiniAdpter._onMessage)))},MiniAdpter._onMessage=function(data){switch(data.type){case"changeMatrix":Laya.stage.transform.identity(),Laya.stage._width=data.w,Laya.stage._height=data.h,Laya.stage._canvasTransform=new Matrix(data.a,data.b,data.c,data.d,data.tx,data.ty);break;case"display":Laya.stage.frameRate=data.rate||"fast";break;case"undisplay":Laya.stage.frameRate="sleep"}"opendatacontext"==data.isLoad?data.url&&(MiniFileMgr.ziyuFileData[data.url]=data.atlasdata,MiniFileMgr.ziyuFileTextureData[data.imgReadyUrl]=data.imgNativeUrl):"openJsondatacontext"==data.isLoad?data.url&&(MiniFileMgr.ziyuFileData[data.url]=data.atlasdata):"openJsondatacontextPic"==data.isLoad&&(MiniFileMgr.ziyuFileTextureData[data.imgReadyUrl]=data.imgNativeUrl)},MiniAdpter.getUrlEncode=function(url,type){return"arraybuffer"==type?"":"utf8"},MiniAdpter.downLoadFile=function(fileUrl,fileType,callBack,encoding){void 0===fileType&&(fileType=""),void 0===encoding&&(encoding="utf8"),MiniFileMgr.getFileInfo(fileUrl)?null!=callBack&&callBack.runWith([0]):MiniFileMgr.downLoadFile(fileUrl,fileType,callBack,encoding)},MiniAdpter.remove=function(fileUrl,callBack){MiniFileMgr.deleteFile("",fileUrl,callBack,"",0)},MiniAdpter.removeAll=function(){MiniFileMgr.deleteAll()},MiniAdpter.hasNativeFile=function(fileUrl){return MiniFileMgr.isLocalNativeFile(fileUrl)},MiniAdpter.getFileInfo=function(fileUrl){return MiniFileMgr.getFileInfo(fileUrl)},MiniAdpter.getFileList=function(){return MiniFileMgr.filesListObj},MiniAdpter.exitMiniProgram=function(){MiniAdpter.window.wx.exitMiniProgram()},MiniAdpter.onMkdirCallBack=function(errorCode,data){errorCode||(MiniFileMgr.filesListObj=JSON.parse(data.data))},MiniAdpter.pixelRatio=function(){if(!MiniAdpter.EnvConfig.pixelRatioInt)try{return MiniAdpter.EnvConfig.pixelRatioInt=MiniAdpter.systemInfo.pixelRatio,MiniAdpter.systemInfo.pixelRatio}catch(error){}return MiniAdpter.EnvConfig.pixelRatioInt},MiniAdpter.createElement=function(type){var _source;if("canvas"==type)return 1==MiniAdpter.idx?MiniAdpter.isZiYu?(_source=sharedCanvas).style={}:_source=window.canvas:_source=window.wx.createCanvas(),MiniAdpter.idx++,_source;if("textarea"==type||"input"==type)return MiniAdpter.onCreateInput(type);if("div"==type){var node=MiniAdpter._preCreateElement(type);return node.contains=function(value){return null},node.removeChild=function(value){},node}return MiniAdpter._preCreateElement(type)},MiniAdpter.onCreateInput=function(type){var node=MiniAdpter._preCreateElement(type);return node.style={},node.value=0,node.parentElement={},node.placeholder={},node.type={},node.setColor=function(value){},node.setType=function(value){},node.setFontFace=function(value){},node.addEventListener=function(value){},node.contains=function(value){return null},node.removeChild=function(value){},node},MiniAdpter.createShaderCondition=function(conditionScript){var _$this=this;return function(){return _$this[conditionScript.replace("this.","")]}},MiniAdpter.sendAtlasToOpenDataContext=function(url){if(!laya.wx.mini.MiniAdpter.isZiYu){var atlasJson=Loader.getRes(URL.formatURL(url));if(!atlasJson)throw"传递的url没有获取到对应的图集数据信息，请确保图集已经过！";if(atlasJson.meta.image.split(","),atlasJson.meta&&atlasJson.meta.image)for(var toloadPics=atlasJson.meta.image.split(","),split=url.indexOf("/")>=0?"/":"\\",idx=url.lastIndexOf(split),folderPath=idx>=0?url.substr(0,idx+1):"",i=0,len=toloadPics.length;i<len;i++)toloadPics[i]=folderPath+toloadPics[i];else toloadPics=[url.replace(".json",".png")];for(i=0;i<toloadPics.length;i++){var tempAtlasPngUrl=toloadPics[i];MiniAdpter.postInfoToContext(url,tempAtlasPngUrl,atlasJson)}}},MiniAdpter.postInfoToContext=function(url,atlaspngUrl,atlasJson){var postData={frames:atlasJson.frames,meta:atlasJson.meta},textureUrl=atlaspngUrl,fileObj=MiniFileMgr.getFileInfo(URL.formatURL(atlaspngUrl));if(fileObj)var fileMd5Name=fileObj.md5,fileNativeUrl=MiniFileMgr.getFileNativePath(fileMd5Name);else fileNativeUrl=textureUrl;if(!fileNativeUrl)throw"获取图集的磁盘url路径不存在！";wx.postMessage({url:url,atlasdata:postData,imgNativeUrl:fileNativeUrl,imgReadyUrl:textureUrl,isLoad:"opendatacontext"})},MiniAdpter.sendSinglePicToOpenDataContext=function(url){var tempTextureUrl=URL.formatURL(url),fileObj=MiniFileMgr.getFileInfo(tempTextureUrl);if(fileObj){var fileMd5Name=fileObj.md5,fileNativeUrl=MiniFileMgr.getFileNativePath(fileMd5Name);url=tempTextureUrl}else fileNativeUrl=url;if(!fileNativeUrl)throw"获取图集的磁盘url路径不存在！";wx.postMessage({url:url,imgNativeUrl:fileNativeUrl,imgReadyUrl:url,isLoad:"openJsondatacontextPic"})},MiniAdpter.sendJsonDataToDataContext=function(url){if(!laya.wx.mini.MiniAdpter.isZiYu){var atlasJson=Loader.getRes(url);if(!atlasJson)throw"传递的url没有获取到对应的图集数据信息，请确保图集已经过！";wx.postMessage({url:url,atlasdata:atlasJson,isLoad:"openJsondatacontext"})}},MiniAdpter.EnvConfig=null,MiniAdpter.window=null,MiniAdpter._preCreateElement=null,MiniAdpter._inited=!1,MiniAdpter.systemInfo=null,MiniAdpter.isZiYu=!1,MiniAdpter.isPosMsgYu=!1,MiniAdpter.autoCacheFile=!0,MiniAdpter.minClearSize=5242880,MiniAdpter.subNativeFiles=null,MiniAdpter.subNativeheads=[],MiniAdpter.subMaps=[],MiniAdpter.AutoCacheDownFile=!1,MiniAdpter.parseXMLFromString=function(value){var rst;value=value.replace(/>\s+</g,"><");try{rst=(new window.Parser.DOMParser).parseFromString(value,"text/xml")}catch(error){throw"需要引入xml解析库文件"}return rst},MiniAdpter.idx=1,__static(MiniAdpter,["nativefiles",function(){return this.nativefiles=["layaNativeDir","wxlocal"]}]),MiniAdpter}()),Event=function(){function Event(){}__class(Event,"laya.events.Event");var __proto=Event.prototype;return __proto.setTo=function(type,currentTarget,target){return this.type=type,this.currentTarget=currentTarget,this.target=target,this},__proto.stopPropagation=function(){this._stoped=!0},__getset(0,__proto,"stageY",function(){return Laya.stage.mouseY}),__getset(0,__proto,"charCode",function(){return this.nativeEvent.charCode}),__getset(0,__proto,"touches",function(){if(!this.nativeEvent)return null;var arr=this.nativeEvent.touches;if(arr)for(var stage=Laya.stage,i=0,n=arr.length;i<n;i++){var e=arr[i],point=Point.TEMP;point.setTo(e.clientX,e.clientY),stage._canvasTransform.invertTransformPoint(point),stage.transform.invertTransformPoint(point),e.stageX=point.x,e.stageY=point.y}return arr}),__getset(0,__proto,"keyLocation",function(){return this.nativeEvent.location||this.nativeEvent.keyLocation}),__getset(0,__proto,"ctrlKey",function(){return this.nativeEvent.ctrlKey}),__getset(0,__proto,"altKey",function(){return this.nativeEvent.altKey}),__getset(0,__proto,"shiftKey",function(){return this.nativeEvent.shiftKey}),__getset(0,__proto,"stageX",function(){return Laya.stage.mouseX}),Event.EMPTY=new Event,Event.MOUSE_DOWN="mousedown",Event.MOUSE_UP="mouseup",Event.CLICK="click",Event.RIGHT_MOUSE_DOWN="rightmousedown",Event.RIGHT_MOUSE_UP="rightmouseup",Event.RIGHT_CLICK="rightclick",Event.MOUSE_MOVE="mousemove",Event.MOUSE_OVER="mouseover",Event.MOUSE_OUT="mouseout",Event.MOUSE_WHEEL="mousewheel",Event.ROLL_OVER="mouseover",Event.ROLL_OUT="mouseout",Event.DOUBLE_CLICK="doubleclick",Event.CHANGE="change",Event.CHANGED="changed",Event.RESIZE="resize",Event.ADDED="added",Event.REMOVED="removed",Event.DISPLAY="display",Event.UNDISPLAY="undisplay",Event.ERROR="error",Event.COMPLETE="complete",Event.LOADED="loaded",Event.READY="ready",Event.PROGRESS="progress",Event.INPUT="input",Event.RENDER="render",Event.OPEN="open",Event.MESSAGE="message",Event.CLOSE="close",Event.KEY_DOWN="keydown",Event.KEY_PRESS="keypress",Event.KEY_UP="keyup",Event.FRAME="enterframe",Event.DRAG_START="dragstart",Event.DRAG_MOVE="dragmove",Event.DRAG_END="dragend",Event.ENTER="enter",Event.SELECT="select",Event.BLUR="blur",Event.FOCUS="focus",Event.VISIBILITY_CHANGE="visibilitychange",Event.FOCUS_CHANGE="focuschange",Event.PLAYED="played",Event.PAUSED="paused",Event.STOPPED="stopped",Event.START="start",Event.END="end",Event.COMPONENT_ADDED="componentadded",Event.COMPONENT_REMOVED="componentremoved",Event.RELEASED="released",Event.LINK="link",Event.LABEL="label",Event.FULL_SCREEN_CHANGE="fullscreenchange",Event.DEVICE_LOST="devicelost",Event.TRANSFORM_CHANGED="transformchanged",Event.ANIMATION_CHANGED="animationchanged",Event.TRAIL_FILTER_CHANGE="trailfilterchange",Event.TRIGGER_ENTER="triggerenter",Event.TRIGGER_STAY="triggerstay",Event.TRIGGER_EXIT="triggerexit",Event}(),RunDriver=function(){function RunDriver(){}return __class(RunDriver,"laya.utils.RunDriver"),RunDriver.getIncludeStr=function(name){return null},RunDriver.createShaderCondition=function(conditionScript){var fn="(function() {return "+conditionScript+";})";return Laya._runScript(fn)},RunDriver.fontMap=[],RunDriver.measureText=function(txt,font){var isChinese=RunDriver.hanzi.test(txt);if(isChinese&&RunDriver.fontMap[font])return RunDriver.fontMap[font];var ctx=Browser.context;ctx.font=font;var r=ctx.measureText(txt);return isChinese&&(RunDriver.fontMap[font]=r),r},RunDriver.drawToCanvas=function(sprite,_renderType,canvasWidth,canvasHeight,offsetX,offsetY){canvasWidth|=0,canvasHeight|=0,offsetX|=0,offsetY|=0;var canvas=new HTMLCanvas,ctx=canvas.getContext("2d");return canvas.size(canvasWidth,canvasHeight),RenderSprite.renders[_renderType]._fun(sprite,ctx,offsetX,offsetY),canvas},RunDriver.initRender=function(canvas,w,h){return Render._context=canvas.getContext("2d"),canvas.size(w,h),!0},RunDriver.createParticleTemplate2D=null,RunDriver.changeWebGLSize=function(w,h){},RunDriver.createRenderSprite=function(type,next){return new RenderSprite(type,next)},RunDriver.clear=function(value){Render.isConchApp||Render._context.clear()},RunDriver.getTexturePixels=function(value,x,y,width,height){return null},RunDriver.skinAniSprite=function(){return null},RunDriver.cancelLoadByUrl=function(url){},RunDriver.enableNative=null,__static(RunDriver,["hanzi",function(){return this.hanzi=new RegExp("^[一-龥]$")}]),RunDriver}(),Tween=function(){function Tween(){this.gid=0,this.repeat=1,this._count=0}__class(Tween,"laya.utils.Tween");var __proto=Tween.prototype;return __proto.to=function(target,props,duration,ease,complete,delay,coverBefore){return void 0===delay&&(delay=0),void 0===coverBefore&&(coverBefore=!1),this._create(target,props,duration,ease,complete,delay,coverBefore,!0,!1,!0)},__proto.from=function(target,props,duration,ease,complete,delay,coverBefore){return void 0===delay&&(delay=0),void 0===coverBefore&&(coverBefore=!1),this._create(target,props,duration,ease,complete,delay,coverBefore,!1,!1,!0)},__proto._create=function(target,props,duration,ease,complete,delay,coverBefore,isTo,usePool,runNow){if(!target)throw new Error("Tween:target is null");this._target=target,this._duration=duration,this._ease=ease||props.ease||Tween.easeNone,this._complete=complete||props.complete,this._delay=delay,this._props=[],this._usedTimer=0,this._startTimer=Browser.now(),this._usedPool=usePool,this._delayParam=null,this.update=props.update;var gid=target.$_GID||(target.$_GID=Utils.getGID());return Tween.tweenMap[gid]?(coverBefore&&Tween.clearTween(target),Tween.tweenMap[gid].push(this)):Tween.tweenMap[gid]=[this],runNow?delay<=0?this.firstStart(target,props,isTo):(this._delayParam=[target,props,isTo],Laya.timer.once(delay,this,this.firstStart,this._delayParam)):this._initProps(target,props,isTo),this},__proto.firstStart=function(target,props,isTo){this._delayParam=null,target.destroyed?this.clear():(this._initProps(target,props,isTo),this._beginLoop())},__proto._initProps=function(target,props,isTo){for(var p in props)if("number"==typeof target[p]){var start=isTo?target[p]:props[p],end=isTo?props[p]:target[p];this._props.push([p,start,end-start]),isTo||(target[p]=start)}},__proto._beginLoop=function(){Laya.timer.frameLoop(1,this,this._doEase)},__proto._doEase=function(){this._updateEase(Browser.now())},__proto._updateEase=function(time){var target=this._target;if(target){if(target.destroyed)return Tween.clearTween(target);var usedTimer=this._usedTimer=time-this._startTimer-this._delay;if(!(usedTimer<0)){if(usedTimer>=this._duration)return this.complete();for(var ratio=usedTimer>0?this._ease(usedTimer,0,1,this._duration):0,props=this._props,i=0,n=props.length;i<n;i++){var prop=props[i];target[prop[0]]=prop[1]+ratio*prop[2]}this.update&&this.update.run()}}},__proto.complete=function(){if(this._target){Laya.timer.runTimer(this,this.firstStart);for(var target=this._target,props=this._props,handler=this._complete,i=0,n=props.length;i<n;i++){var prop=props[i];target[prop[0]]=prop[1]+prop[2]}this.update&&this.update.run(),this._count++,0!=this.repeat&&this._count>=this.repeat?(this.clear(),handler&&handler.run()):this.restart()}},__proto.pause=function(){var dTime;Laya.timer.clear(this,this._beginLoop),Laya.timer.clear(this,this._doEase),Laya.timer.clear(this,this.firstStart),(dTime=Browser.now()-this._startTimer-this._delay)<0&&(this._usedTimer=dTime)},__proto.setStartTime=function(startTime){this._startTimer=startTime},__proto.clear=function(){this._target&&(this._remove(),this._clear())},__proto._clear=function(){this.pause(),Laya.timer.clear(this,this.firstStart),this._complete=null,this._target=null,this._ease=null,this._props=null,this._delayParam=null,this._usedPool&&(this.update=null,Pool.recover("tween",this))},__proto.recover=function(){this._usedPool=!0,this._clear()},__proto._remove=function(){var tweens=Tween.tweenMap[this._target.$_GID];if(tweens)for(var i=0,n=tweens.length;i<n;i++)if(tweens[i]===this){tweens.splice(i,1);break}},__proto.restart=function(){if(this.pause(),this._usedTimer=0,this._startTimer=Browser.now(),this._delayParam)Laya.timer.once(this._delay,this,this.firstStart,this._delayParam);else{for(var props=this._props,i=0,n=props.length;i<n;i++){var prop=props[i];this._target[prop[0]]=prop[1]}Laya.timer.once(this._delay,this,this._beginLoop)}},__proto.resume=function(){this._usedTimer>=this._duration||(this._startTimer=Browser.now()-this._usedTimer-this._delay,this._delayParam?this._usedTimer<0?Laya.timer.once(-this._usedTimer,this,this.firstStart,this._delayParam):this.firstStart.apply(this,this._delayParam):this._beginLoop())},__getset(0,__proto,"progress",null,function(v){var uTime=v*this._duration;this._startTimer=Browser.now()-this._delay-uTime}),Tween.to=function(target,props,duration,ease,complete,delay,coverBefore,autoRecover){return void 0===delay&&(delay=0),void 0===coverBefore&&(coverBefore=!1),void 0===autoRecover&&(autoRecover=!0),Pool.getItemByClass("tween",Tween)._create(target,props,duration,ease,complete,delay,coverBefore,!0,autoRecover,!0)},Tween.from=function(target,props,duration,ease,complete,delay,coverBefore,autoRecover){return void 0===delay&&(delay=0),void 0===coverBefore&&(coverBefore=!1),void 0===autoRecover&&(autoRecover=!0),Pool.getItemByClass("tween",Tween)._create(target,props,duration,ease,complete,delay,coverBefore,!1,autoRecover,!0)},Tween.clearAll=function(target){if(target&&target.$_GID){var tweens=Tween.tweenMap[target.$_GID];if(tweens){for(var i=0,n=tweens.length;i<n;i++)tweens[i]._clear();tweens.length=0}}},Tween.clear=function(tween){tween.clear()},Tween.clearTween=function(target){Tween.clearAll(target)},Tween.easeNone=function(t,b,c,d){return c*t/d+b},Tween.tweenMap=[],Tween}(),Browser=function(){function Browser(){}return __class(Browser,"laya.utils.Browser"),__getset(1,Browser,"pixelRatio",function(){if(Browser._pixelRatio<0)if(Browser.__init__(),Browser.userAgent.indexOf("Mozilla/6.0(Linux; Android 6.0; HUAWEI NXT-AL10 Build/HUAWEINXT-AL10)")>-1)Browser._pixelRatio=2;else{var ctx=Browser.context,backingStore=ctx.backingStorePixelRatio||ctx.webkitBackingStorePixelRatio||ctx.mozBackingStorePixelRatio||ctx.msBackingStorePixelRatio||ctx.oBackingStorePixelRatio||ctx.backingStorePixelRatio||1;Browser._pixelRatio=(Browser._window.devicePixelRatio||1)/backingStore,Browser._pixelRatio<1&&(Browser._pixelRatio=1)}return Browser._pixelRatio}),__getset(1,Browser,"height",function(){return Browser.__init__(),(Laya.stage&&Laya.stage.canvasRotation?Browser.clientWidth:Browser.clientHeight)*Browser.pixelRatio}),__getset(1,Browser,"clientWidth",function(){return Browser.__init__(),Browser._window.innerWidth||Browser._document.body.clientWidth}),__getset(1,Browser,"window",function(){return Browser._window||Browser.__init__()}),__getset(1,Browser,"clientHeight",function(){return Browser.__init__(),Browser._window.innerHeight||Browser._document.body.clientHeight||Browser._document.documentElement.clientHeight}),__getset(1,Browser,"width",function(){return Browser.__init__(),(Laya.stage&&Laya.stage.canvasRotation?Browser.clientHeight:Browser.clientWidth)*Browser.pixelRatio}),__getset(1,Browser,"container",function(){return Browser._container||(Browser.__init__(),Browser._container=Browser.createElement("div"),Browser._container.id="layaContainer",Browser._document.body.appendChild(Browser._container)),Browser._container},function(value){Browser._container=value}),__getset(1,Browser,"document",function(){return Browser.__init__(),Browser._document}),Browser.__init__=function(){if(Browser._window)return Browser._window;var win=Browser._window=window,doc=Browser._document=win.document,u=Browser.userAgent=win.navigator.userAgent,libs=win._layalibs;if(libs){libs.sort(function(a,b){return a.i>b.i});for(var j=0;j<libs.length;j++)libs[j].f(win,doc,Laya)}u.indexOf("MiniGame")>-1&&(Laya.MiniAdpter?Laya.MiniAdpter.enable():console.error("请先添加小游戏适配库,详细教程：https://ldc2.layabox.com/doc/?nav=zh-ts-5-0-0")),u.indexOf("SwanGame")>-1&&(Laya.BMiniAdapter?Laya.BMiniAdapter.enable():console.error("请先添加百度小游戏适配库,详细教程：https://ldc2.layabox.com/doc/?nav=zh-ts-5-0-0")),win.trace=console.log,win.requestAnimationFrame=win.requestAnimationFrame||win.webkitRequestAnimationFrame||win.mozRequestAnimationFrame||win.oRequestAnimationFrame||win.msRequestAnimationFrame||function(fun){return win.setTimeout(fun,1e3/60)};var bodyStyle=doc.body.style;bodyStyle.margin=0,bodyStyle.overflow="hidden",bodyStyle["-webkit-user-select"]="none",bodyStyle["-webkit-tap-highlight-color"]="rgba(200,200,200,0)";for(var metas=doc.getElementsByTagName("meta"),i=0,flag=!1,content="width=device-width,initial-scale=1.0,minimum-scale=1.0,maximum-scale=1.0,user-scalable=no";i<metas.length;){var meta=metas[i];if("viewport"==meta.name){meta.content=content,flag=!0;break}i++}flag||((meta=doc.createElement("meta")).name="viewport",meta.content=content,doc.getElementsByTagName("head")[0].appendChild(meta)),Browser.onMobile=u.indexOf("Mobile")>-1,Browser.onIOS=!!u.match(/\(i[^;]+;(U;)? CPU.+Mac OS X/),Browser.onIPhone=u.indexOf("iPhone")>-1,Browser.onMac=u.indexOf("Mac OS X")>-1,Browser.onIPad=u.indexOf("iPad")>-1,Browser.onAndroid=u.indexOf("Android")>-1||u.indexOf("Adr")>-1,Browser.onWP=u.indexOf("Windows Phone")>-1,Browser.onQQBrowser=u.indexOf("QQBrowser")>-1,Browser.onMQQBrowser=u.indexOf("MQQBrowser")>-1||u.indexOf("Mobile")>-1&&u.indexOf("QQ")>-1,Browser.onIE=!!win.ActiveXObject||"ActiveXObject"in win,Browser.onWeiXin=u.indexOf("MicroMessenger")>-1,Browser.onSafari=u.indexOf("Safari")>-1,Browser.onPC=!Browser.onMobile,Browser.onMiniGame=u.indexOf("MiniGame")>-1,Browser.onBDMiniGame=u.indexOf("SwanGame")>-1,Browser.onLimixiu=u.indexOf("limixiu")>-1,Render._mainCanvas=new HTMLCanvas(!0);var style=Render._mainCanvas.source.style;style.position="absolute",style.top=style.left="0px",style.background="#000000",Browser.canvas=new HTMLCanvas(!0),Browser.context=Browser.canvas.getContext("2d");var tmpCanv=new HTMLCanvas(!0),names=["webgl","experimental-webgl","webkit-3d","moz-webgl"],gl=null;for(i=0;i<names.length;i++){try{gl=tmpCanv.source.getContext(names[i])}catch(e){}if(gl){Browser._supportWebGL=!0;break}}return win},Browser.createElement=function(type){return Browser.__init__(),Browser._document.createElement(type)},Browser.getElementById=function(type){return Browser.__init__(),Browser._document.getElementById(type)},Browser.removeElement=function(ele){ele&&ele.parentNode&&ele.parentNode.removeChild(ele)},Browser.now=function(){return Date.now()},Browser.userAgent=null,Browser.onMobile=!1,Browser.onIOS=!1,Browser.onMac=!1,Browser.onIPhone=!1,Browser.onIPad=!1,Browser.onAndroid=!1,Browser.onWP=!1,Browser.onQQBrowser=!1,Browser.onMQQBrowser=!1,Browser.onSafari=!1,Browser.onIE=!1,Browser.onWeiXin=!1,Browser.onPC=!1,Browser.onMiniGame=!1,Browser.onBDMiniGame=!1,Browser.onLimixiu=!1,Browser.onFirefox=!1,Browser.onEdge=!1,Browser.supportWebAudio=!1,Browser.supportLocalStorage=!1,Browser.canvas=null,Browser.context=null,Browser._window=null,Browser._document=null,Browser._container=null,Browser._pixelRatio=-1,Browser._supportWebGL=!1,Browser}(),DrawPathCmd=function(){function DrawPathCmd(){}__class(DrawPathCmd,"laya.display.cmd.DrawPathCmd");var __proto=DrawPathCmd.prototype;return __proto.recover=function(){this.paths=null,this.brush=null,this.pen=null,Pool.recover("DrawPathCmd",this)},__proto.run=function(context,gx,gy){context._drawPath(this.x+gx,this.y+gy,this.paths,this.brush,this.pen)},__getset(0,__proto,"cmdID",function(){return"DrawPath"}),DrawPathCmd.create=function(x,y,paths,brush,pen){var cmd=Pool.getItemByClass("DrawPathCmd",DrawPathCmd);return cmd.x=x,cmd.y=y,cmd.paths=paths,cmd.brush=brush,cmd.pen=pen,cmd},DrawPathCmd.ID="DrawPath",DrawPathCmd}(),Timer=function(){var TimerHandler;function Timer(autoActive){this.scale=1,this.currFrame=0,this._delta=0,this._map=[],this._handlers=[],this._temp=[],this._count=0,this.currTimer=Browser.now(),this._lastTimer=Browser.now(),void 0===autoActive&&(autoActive=!0),autoActive&&Laya.systemTimer&&Laya.systemTimer.frameLoop(1,this,this._update)}__class(Timer,"laya.utils.Timer");var __proto=Timer.prototype;return __proto._update=function(){if(this.scale<=0)this._lastTimer=Browser.now();else{var frame=this.currFrame=this.currFrame+this.scale,now=Browser.now();this._delta=(now-this._lastTimer)*this.scale;var timer=this.currTimer=this.currTimer+this._delta;this._lastTimer=now;var handlers=this._handlers;this._count=0;for(var i=0,n=handlers.length;i<n;i++){var handler=handlers[i];if(null!==handler.method){var t=handler.userFrame?frame:timer;if(t>=handler.exeTime)if(handler.repeat)if(handler.jumpFrame)for(;t>=handler.exeTime;)handler.exeTime+=handler.delay,handler.run(!1);else handler.exeTime+=handler.delay,handler.run(!1),t>handler.exeTime&&(handler.exeTime+=Math.ceil((t-handler.exeTime)/handler.delay)*handler.delay);else handler.run(!0)}else this._count++}(this._count>30||frame%200==0)&&this._clearHandlers()}},__proto._clearHandlers=function(){for(var handlers=this._handlers,i=0,n=handlers.length;i<n;i++){var handler=handlers[i];null!==handler.method?this._temp.push(handler):this._recoverHandler(handler)}this._handlers=this._temp,handlers.length=0,this._temp=handlers},__proto._recoverHandler=function(handler){this._map[handler.key]==handler&&(this._map[handler.key]=null),handler.clear(),Timer._pool.push(handler)},__proto._create=function(useFrame,repeat,delay,caller,method,args,coverBefore){if(!delay)return method.apply(caller,args),null;if(coverBefore){var handler=this._getHandler(caller,method);if(handler)return handler.repeat=repeat,handler.userFrame=useFrame,handler.delay=delay,handler.caller=caller,handler.method=method,handler.args=args,handler.exeTime=delay+(useFrame?this.currFrame:this.currTimer+Browser.now()-this._lastTimer),handler}return(handler=Timer._pool.length>0?Timer._pool.pop():new TimerHandler).repeat=repeat,handler.userFrame=useFrame,handler.delay=delay,handler.caller=caller,handler.method=method,handler.args=args,handler.exeTime=delay+(useFrame?this.currFrame:this.currTimer+Browser.now()-this._lastTimer),this._indexHandler(handler),this._handlers.push(handler),handler},__proto._indexHandler=function(handler){var caller=handler.caller,method=handler.method,cid=caller?caller.$_GID||(caller.$_GID=Utils.getGID()):0,mid=method.$_TID||(method.$_TID=1e5*Timer._mid++);handler.key=cid+mid,this._map[handler.key]=handler},__proto.once=function(delay,caller,method,args,coverBefore){void 0===coverBefore&&(coverBefore=!0),this._create(!1,!1,delay,caller,method,args,coverBefore)},__proto.loop=function(delay,caller,method,args,coverBefore,jumpFrame){void 0===coverBefore&&(coverBefore=!0),void 0===jumpFrame&&(jumpFrame=!1);var handler=this._create(!1,!0,delay,caller,method,args,coverBefore);handler&&(handler.jumpFrame=jumpFrame)},__proto.frameOnce=function(delay,caller,method,args,coverBefore){void 0===coverBefore&&(coverBefore=!0),this._create(!0,!1,delay,caller,method,args,coverBefore)},__proto.frameLoop=function(delay,caller,method,args,coverBefore){void 0===coverBefore&&(coverBefore=!0),this._create(!0,!0,delay,caller,method,args,coverBefore)},__proto.toString=function(){return" handlers:"+this._handlers.length+" pool:"+Timer._pool.length},__proto.clear=function(caller,method){var handler=this._getHandler(caller,method);handler&&(this._map[handler.key]=null,handler.key=0,handler.clear())},__proto.clearAll=function(caller){if(caller)for(var i=0,n=this._handlers.length;i<n;i++){var handler=this._handlers[i];handler.caller===caller&&(this._map[handler.key]=null,handler.key=0,handler.clear())}},__proto._getHandler=function(caller,method){var cid=caller?caller.$_GID||(caller.$_GID=Utils.getGID()):0,mid=method.$_TID||(method.$_TID=1e5*Timer._mid++);return this._map[cid+mid]},__proto.callLater=function(caller,method,args){CallLater.I.callLater(caller,method,args)},__proto.runCallLater=function(caller,method){CallLater.I.runCallLater(caller,method)},__proto.runTimer=function(caller,method){var handler=this._getHandler(caller,method);handler&&null!=handler.method&&(this._map[handler.key]=null,handler.run(!0))},__proto.pause=function(){this.scale=0},__proto.resume=function(){this.scale=1},__getset(0,__proto,"delta",function(){return this._delta}),Timer._pool=[],Timer._mid=1,Timer.__init$=function(){TimerHandler=function(){function TimerHandler(){this.key=0,this.repeat=!1,this.delay=0,this.userFrame=!1,this.exeTime=0,this.caller=null,this.method=null,this.args=null,this.jumpFrame=!1}__class(TimerHandler,"");var __proto=TimerHandler.prototype;return __proto.clear=function(){this.caller=null,this.method=null,this.args=null},__proto.run=function(withClear){var caller=this.caller;if(caller&&caller.destroyed)return this.clear();var method=this.method,args=this.args;withClear&&this.clear(),null!=method&&(args?method.apply(caller,args):method.call(caller))},TimerHandler}()},Timer}(),FillBorderTextCmd=function(){function FillBorderTextCmd(){}__class(FillBorderTextCmd,"laya.display.cmd.FillBorderTextCmd");var __proto=FillBorderTextCmd.prototype;return __proto.recover=function(){Pool.recover("FillBorderTextCmd",this)},__proto.run=function(context,gx,gy){context.fillBorderText(this.text,this.x+gx,this.y+gy,this.font,this.fillColor,this.borderColor,this.lineWidth,this.textAlign)},__getset(0,__proto,"cmdID",function(){return"FillBorderText"}),FillBorderTextCmd.create=function(text,x,y,font,fillColor,borderColor,lineWidth,textAlign){var cmd=Pool.getItemByClass("FillBorderTextCmd",FillBorderTextCmd);return cmd.text=text,cmd.x=x,cmd.y=y,cmd.font=font,cmd.fillColor=fillColor,cmd.borderColor=borderColor,cmd.lineWidth=lineWidth,cmd.textAlign=textAlign,cmd},FillBorderTextCmd.ID="FillBorderText",FillBorderTextCmd}(),FontInfo=(function(){function DrawParticleCmd(){}__class(DrawParticleCmd,"laya.display.cmd.DrawParticleCmd");var __proto=DrawParticleCmd.prototype;__proto.recover=function(){this._templ=null,Pool.recover("DrawParticleCmd",this)},__proto.run=function(context,gx,gy){context.drawParticle(gx,gy,this._templ)},__getset(0,__proto,"cmdID",function(){return"DrawParticleCmd"}),DrawParticleCmd.create=function(_temp){var cmd=Pool.getItemByClass("DrawParticleCmd",DrawParticleCmd);return cmd._templ=_temp,cmd},DrawParticleCmd.ID="DrawParticleCmd"}(),function(){function FontInfo(font){this._font="14px Arial",this._family="Arial",this._size=14,this._italic=!1,this._bold=!1,this._id=FontInfo._gfontID++,this.setFont(font||this._font)}return __class(FontInfo,"laya.utils.FontInfo"),FontInfo.prototype.setFont=function(value){this._font=value;var _words=value.split(" "),l=_words.length;if(l<2)1==l&&_words[0].indexOf("px")>0&&(this._size=parseInt(_words[0]));else{for(var szpos=-1,i=0;i<l;i++)if(_words[i].indexOf("px")>0||_words[i].indexOf("pt")>0){szpos=i,this._size=parseInt(_words[i]),this._size<=0&&(console.error("font parse error:"+value),this._size=14);break}var fpos=szpos+1,familys=_words[fpos];for(fpos++;fpos<l;fpos++)familys+=" "+_words[fpos];this._family=familys.split(",")[0],this._italic=_words.indexOf("italic")>=0,this._bold=_words.indexOf("bold")>=0}},FontInfo.Parse=function(font){if(font===FontInfo._lastFont)return FontInfo._lastFontInfo;var r=FontInfo._cache[font];return r||(r=FontInfo._cache[font]=new FontInfo(font)),FontInfo._lastFont=font,FontInfo._lastFontInfo=r,r},FontInfo.EMPTY=new FontInfo(null),FontInfo._cache={},FontInfo._gfontID=0,FontInfo._lastFont="",FontInfo._lastFontInfo=null,FontInfo}()),DrawLinesCmd=(function(){function SpriteConst(){}__class(SpriteConst,"laya.display.SpriteConst"),SpriteConst.POSRENDERTYPE=0,SpriteConst.POSBUFFERBEGIN=1,SpriteConst.POSBUFFEREND=2,SpriteConst.POSFRAMECOUNT=3,SpriteConst.POSREPAINT=4,SpriteConst.POSVISIBLE_NATIVE=5,SpriteConst.POSX=6,SpriteConst.POSY=7,SpriteConst.POSPIVOTX=8,SpriteConst.POSPIVOTY=9,SpriteConst.POSSCALEX=10,SpriteConst.POSSCALEY=11,SpriteConst.POSSKEWX=12,SpriteConst.POSSKEWY=13,SpriteConst.POSROTATION=14,SpriteConst.POSTRANSFORM_FLAG=15,SpriteConst.POSMATRIX=16,SpriteConst.POSCOLOR=22,SpriteConst.POSGRAPICS=23,SpriteConst.POSSIM_TEXTURE_ID=24,SpriteConst.POSSIM_TEXTURE_DATA=25,SpriteConst.POSLAYAGL3D=26,SpriteConst.POSCUSTOM=27,SpriteConst.POSCLIP=28,SpriteConst.POSCLIP_NEG_POS=32,SpriteConst.POSCOLORFILTER_COLOR=34,SpriteConst.POSCOLORFILTER_ALPHA=50,SpriteConst.POSCALLBACK_OBJ_ID=54,SpriteConst.POSCUSTOM_CALLBACK_FUN_ID=55,SpriteConst.POSCANVAS_CALLBACK_FUN_ID=56,SpriteConst.POSCANVAS_CALLBACK_END_FUN_ID=57,SpriteConst.POSCANVAS_BEGIN_CMD_ID=58,SpriteConst.POSCANVAS_END_CMD_ID=59,SpriteConst.POSCANVAS_DRAW_TARGET_CMD_ID=60,SpriteConst.POSCANVAS_DRAW_TARGET_PARAM_ID=61,SpriteConst.POSLAYA3D_FUN_ID=62,SpriteConst.POSCACHE_CANVAS_SKIP_PAINT_FLAG=63,SpriteConst.POSFILTER_BEGIN_CMD_ID=64,SpriteConst.POSFILTER_CALLBACK_FUN_ID=65,SpriteConst.POSFILTER_END_CMD_ID=66,SpriteConst.POSFILTER_END_CALLBACK_FUN_ID=67,SpriteConst.POSGRAPHICS_CALLBACK_FUN_ID=68,SpriteConst.POSMASK_CALLBACK_FUN_ID=69,SpriteConst.POSMASK_CMD_ID=70,SpriteConst.POSBLEND_SRC=71,SpriteConst.POSBLEND_DEST=72,SpriteConst.POSSIM_RECT_FILL_CMD=73,SpriteConst.POSSIM_RECT_FILL_DATA=74,SpriteConst.POSSIM_RECT_STROKE_CMD=75,SpriteConst.POSSIM_RECT_STROKE_DATA=76,SpriteConst.POSSIZE=77,SpriteConst.ALPHA=1,SpriteConst.TRANSFORM=2,SpriteConst.BLEND=4,SpriteConst.CANVAS=8,SpriteConst.FILTERS=16,SpriteConst.MASK=32,SpriteConst.CLIP=64,SpriteConst.STYLE=128,SpriteConst.TEXTURE=256,SpriteConst.GRAPHICS=512,SpriteConst.LAYAGL3D=1024,SpriteConst.CUSTOM=2048,SpriteConst.ONECHILD=4096,SpriteConst.CHILDS=8192,SpriteConst.REPAINT_NONE=0,SpriteConst.REPAINT_NODE=1,SpriteConst.REPAINT_CACHE=2,SpriteConst.REPAINT_ALL=3}(),function(){function DrawLinesCmd(){}__class(DrawLinesCmd,"laya.display.cmd.DrawLinesCmd");var __proto=DrawLinesCmd.prototype;return __proto.recover=function(){this.points=null,this.lineColor=null,Pool.recover("DrawLinesCmd",this)},__proto.run=function(context,gx,gy){context._drawLines(this.x+gx,this.y+gy,this.points,this.lineColor,this.lineWidth,this.vid)},__getset(0,__proto,"cmdID",function(){return"DrawLines"}),DrawLinesCmd.create=function(x,y,points,lineColor,lineWidth,vid){var cmd=Pool.getItemByClass("DrawLinesCmd",DrawLinesCmd);return cmd.x=x,cmd.y=y,cmd.points=points,cmd.lineColor=lineColor,cmd.lineWidth=lineWidth,cmd.vid=vid,cmd},DrawLinesCmd.ID="DrawLines",DrawLinesCmd}()),BoundsStyle=function(){function BoundsStyle(){}__class(BoundsStyle,"laya.display.css.BoundsStyle");var __proto=BoundsStyle.prototype;return __proto.reset=function(){return this.bounds&&this.bounds.recover(),this.userBounds&&this.userBounds.recover(),this.bounds=null,this.userBounds=null,this.temBM=null,this},__proto.recover=function(){Pool.recover("BoundsStyle",this.reset())},BoundsStyle.create=function(){return Pool.getItemByClass("BoundsStyle",BoundsStyle)},BoundsStyle}(),DrawPieCmd=function(){function DrawPieCmd(){}__class(DrawPieCmd,"laya.display.cmd.DrawPieCmd");var __proto=DrawPieCmd.prototype;return __proto.recover=function(){this.fillColor=null,this.lineColor=null,Pool.recover("DrawPieCmd",this)},__proto.run=function(context,gx,gy){context._drawPie(this.x+gx,this.y+gy,this.radius,this._startAngle,this._endAngle,this.fillColor,this.lineColor,this.lineWidth,this.vid)},__getset(0,__proto,"startAngle",function(){return 180*this._startAngle/Math.PI},function(value){this._startAngle=value*Math.PI/180}),__getset(0,__proto,"cmdID",function(){return"DrawPie"}),__getset(0,__proto,"endAngle",function(){return 180*this._endAngle/Math.PI},function(value){this._endAngle=value*Math.PI/180}),DrawPieCmd.create=function(x,y,radius,startAngle,endAngle,fillColor,lineColor,lineWidth,vid){var cmd=Pool.getItemByClass("DrawPieCmd",DrawPieCmd);return cmd.x=x,cmd.y=y,cmd.radius=radius,cmd._startAngle=startAngle,cmd._endAngle=endAngle,cmd.fillColor=fillColor,cmd.lineColor=lineColor,cmd.lineWidth=lineWidth,cmd.vid=vid,cmd},DrawPieCmd.ID="DrawPie",DrawPieCmd}(),MiniFileMgr=function(){function MiniFileMgr(){}return __class(MiniFileMgr,"laya.wx.mini.MiniFileMgr"),MiniFileMgr.isLocalNativeFile=function(url){for(var i=0,sz=MiniAdpter.nativefiles.length;i<sz;i++)if(-1!=url.indexOf(MiniAdpter.nativefiles[i]))return!0;return!1},MiniFileMgr.getFileInfo=function(fileUrl){var fileNativePath=fileUrl,fileObj=MiniFileMgr.filesListObj[fileNativePath];return null==fileObj?null:fileObj},MiniFileMgr.read=function(filePath,encoding,callBack,readyUrl,isSaveFile,fileType){var fileUrl;void 0===encoding&&(encoding="ascill"),void 0===readyUrl&&(readyUrl=""),void 0===isSaveFile&&(isSaveFile=!1),void 0===fileType&&(fileType=""),fileUrl=""==readyUrl||-1==readyUrl.indexOf("http://")&&-1==readyUrl.indexOf("https://")?filePath:MiniFileMgr.getFileNativePath(filePath),fileUrl=URL.getAdptedFilePath(fileUrl),MiniFileMgr.fs.readFile({filePath:fileUrl,encoding:encoding,success:function(data){null!=callBack&&callBack.runWith([0,data])},fail:function(data){data&&""!=readyUrl?MiniFileMgr.downFiles(readyUrl,encoding,callBack,readyUrl,isSaveFile,fileType):null!=callBack&&callBack.runWith([1])}})},MiniFileMgr.downFiles=function(fileUrl,encoding,callBack,readyUrl,isSaveFile,fileType,isAutoClear){void 0===encoding&&(encoding="ascii"),void 0===readyUrl&&(readyUrl=""),void 0===isSaveFile&&(isSaveFile=!1),void 0===fileType&&(fileType=""),void 0===isAutoClear&&(isAutoClear=!0),MiniFileMgr.wxdown({url:fileUrl,success:function(data){200===data.statusCode?MiniFileMgr.readFile(data.tempFilePath,encoding,callBack,readyUrl,isSaveFile,fileType,isAutoClear):403===data.statusCode?null!=callBack&&callBack.runWith([0,fileUrl]):null!=callBack&&callBack.runWith([1,data])},fail:function(data){null!=callBack&&callBack.runWith([1,data])}}).onProgressUpdate(function(data){null!=callBack&&callBack.runWith([2,data.progress])})},MiniFileMgr.readFile=function(filePath,encoding,callBack,readyUrl,isSaveFile,fileType,isAutoClear){void 0===encoding&&(encoding="ascill"),void 0===readyUrl&&(readyUrl=""),void 0===isSaveFile&&(isSaveFile=!1),void 0===fileType&&(fileType=""),void 0===isAutoClear&&(isAutoClear=!0),filePath=URL.getAdptedFilePath(filePath),MiniFileMgr.fs.readFile({filePath:filePath,encoding:encoding,success:function(data){-1!=filePath.indexOf("http://")||-1!=filePath.indexOf("https://")?(MiniAdpter.autoCacheFile||isSaveFile)&&MiniFileMgr.copyFile(filePath,readyUrl,callBack,encoding,isAutoClear):null!=callBack&&callBack.runWith([0,data])},fail:function(data){data&&null!=callBack&&callBack.runWith([1,data])}})},MiniFileMgr.downOtherFiles=function(fileUrl,callBack,readyUrl,isSaveFile,isAutoClear){void 0===readyUrl&&(readyUrl=""),void 0===isSaveFile&&(isSaveFile=!1),void 0===isAutoClear&&(isAutoClear=!0),MiniFileMgr.wxdown({url:fileUrl,success:function(data){200===data.statusCode?(MiniAdpter.autoCacheFile||isSaveFile)&&-1==readyUrl.indexOf("qlogo.cn")&&-1==readyUrl.indexOf(".php")?MiniFileMgr.copyFile(data.tempFilePath,readyUrl,callBack,"",isAutoClear):null!=callBack&&callBack.runWith([0,data.tempFilePath]):null!=callBack&&callBack.runWith([1,data])},fail:function(data){null!=callBack&&callBack.runWith([1,data])}})},MiniFileMgr.downLoadFile=function(fileUrl,fileType,callBack,encoding){void 0===fileType&&(fileType=""),void 0===encoding&&(encoding="ascii"),window.navigator.userAgent.indexOf("MiniGame")<0?Laya.loader.load(fileUrl,callBack):"image"==fileType||"sound"==fileType?MiniFileMgr.downOtherFiles(fileUrl,callBack,fileUrl,!0,!1):MiniFileMgr.downFiles(fileUrl,encoding,callBack,fileUrl,!0,fileType,!1)},MiniFileMgr.copyFile=function(tempFilePath,readyUrl,callBack,encoding,isAutoClear){void 0===encoding&&(encoding=""),void 0===isAutoClear&&(isAutoClear=!0);var temp=tempFilePath.split("/"),tempFileName=temp[temp.length-1],fileObj=MiniFileMgr.getFileInfo(readyUrl),saveFilePath=MiniFileMgr.getFileNativePath(tempFileName),fileUseSize=MiniFileMgr.getCacheUseSize();fileObj?fileObj.readyUrl!=readyUrl?MiniFileMgr.fs.getFileInfo({filePath:tempFilePath,success:function(data){isAutoClear&&fileUseSize+4194304+data.size>=52428800&&(data.size>MiniAdpter.minClearSize&&(MiniAdpter.minClearSize=data.size),MiniFileMgr.onClearCacheRes()),MiniFileMgr.deleteFile(tempFileName,readyUrl,callBack,encoding,data.size)},fail:function(data){null!=callBack&&callBack.runWith([1,data])}}):null!=callBack&&callBack.runWith([0]):MiniFileMgr.fs.getFileInfo({filePath:tempFilePath,success:function(data){isAutoClear&&fileUseSize+4194304+data.size>=52428800&&(data.size>MiniAdpter.minClearSize&&(MiniAdpter.minClearSize=data.size),MiniFileMgr.onClearCacheRes()),MiniFileMgr.fs.copyFile({srcPath:tempFilePath,destPath:saveFilePath,success:function(data2){MiniFileMgr.onSaveFile(readyUrl,tempFileName,!0,encoding,callBack,data.size)},fail:function(data){null!=callBack&&callBack.runWith([1,data])}})},fail:function(data){null!=callBack&&callBack.runWith([1,data])}})},MiniFileMgr.onClearCacheRes=function(){var memSize=MiniAdpter.minClearSize,tempFileListArr=[];for(var key in MiniFileMgr.filesListObj)tempFileListArr.push(MiniFileMgr.filesListObj[key]);MiniFileMgr.sortOn(tempFileListArr,"times",16);for(var clearSize=0,i=1,sz=tempFileListArr.length;i<sz;i++){var fileObj=tempFileListArr[i];if(clearSize>=memSize)break;clearSize+=fileObj.size,MiniFileMgr.deleteFile("",fileObj.readyUrl)}},MiniFileMgr.sortOn=function(array,name,options){return void 0===options&&(options=0),16==options?array.sort(function(a,b){return a[name]-b[name]}):18==options?array.sort(function(a,b){return b[name]-a[name]}):array.sort(function(a,b){return a[name]-b[name]})},MiniFileMgr.getFileNativePath=function(fileName){return laya.wx.mini.MiniFileMgr.fileNativeDir+"/"+fileName},MiniFileMgr.deleteFile=function(tempFileName,readyUrl,callBack,encoding,fileSize){void 0===readyUrl&&(readyUrl=""),void 0===encoding&&(encoding=""),void 0===fileSize&&(fileSize=0);var fileObj=MiniFileMgr.getFileInfo(readyUrl),deleteFileUrl=MiniFileMgr.getFileNativePath(fileObj.md5);MiniFileMgr.fs.unlink({filePath:deleteFileUrl,success:function(data){var isAdd=""!=tempFileName;if(""!=tempFileName){var saveFilePath=MiniFileMgr.getFileNativePath(tempFileName);MiniFileMgr.fs.copyFile({srcPath:tempFileName,destPath:saveFilePath,success:function(data){MiniFileMgr.onSaveFile(readyUrl,tempFileName,isAdd,encoding,callBack,data.size)},fail:function(data){null!=callBack&&callBack.runWith([1,data])}})}else MiniFileMgr.onSaveFile(readyUrl,tempFileName,isAdd,encoding,callBack,fileSize)},fail:function(data){}})},MiniFileMgr.deleteAll=function(){var tempFileListArr=[];for(var key in MiniFileMgr.filesListObj)tempFileListArr.push(MiniFileMgr.filesListObj[key]);for(var i=1,sz=tempFileListArr.length;i<sz;i++){var fileObj=tempFileListArr[i];MiniFileMgr.deleteFile("",fileObj.readyUrl)}laya.wx.mini.MiniFileMgr.filesListObj&&laya.wx.mini.MiniFileMgr.filesListObj.fileUsedSize&&(laya.wx.mini.MiniFileMgr.filesListObj.fileUsedSize=0),laya.wx.mini.MiniFileMgr.writeFilesList("",JSON.stringify({}),!1)},MiniFileMgr.onSaveFile=function(readyUrl,md5Name,isAdd,encoding,callBack,fileSize){void 0===isAdd&&(isAdd=!0),void 0===encoding&&(encoding=""),void 0===fileSize&&(fileSize=0);var fileurlkey=readyUrl;if(null==MiniFileMgr.filesListObj.fileUsedSize&&(MiniFileMgr.filesListObj.fileUsedSize=0),isAdd)MiniFileMgr.getFileNativePath(md5Name),MiniFileMgr.filesListObj[fileurlkey]={md5:md5Name,readyUrl:readyUrl,size:fileSize,times:Browser.now(),encoding:encoding},MiniFileMgr.filesListObj.fileUsedSize=parseInt(MiniFileMgr.filesListObj.fileUsedSize)+fileSize,MiniFileMgr.writeFilesList(fileurlkey,JSON.stringify(MiniFileMgr.filesListObj),!0),null!=callBack&&callBack.runWith([0]);else if(MiniFileMgr.filesListObj[fileurlkey]){var deletefileSize=parseInt(MiniFileMgr.filesListObj[fileurlkey].size);MiniFileMgr.filesListObj.fileUsedSize=parseInt(MiniFileMgr.filesListObj.fileUsedSize)-deletefileSize,delete MiniFileMgr.filesListObj[fileurlkey],MiniFileMgr.writeFilesList(fileurlkey,JSON.stringify(MiniFileMgr.filesListObj),!1),null!=callBack&&callBack.runWith([0])}},MiniFileMgr.writeFilesList=function(fileurlkey,filesListStr,isAdd){var listFilesPath=MiniFileMgr.fileNativeDir+"/"+MiniFileMgr.fileListName;MiniFileMgr.fs.writeFile({filePath:listFilesPath,encoding:"utf8",data:filesListStr,success:function(data){},fail:function(data){}}),!MiniAdpter.isZiYu&&MiniAdpter.isPosMsgYu&&wx.postMessage({url:fileurlkey,data:MiniFileMgr.filesListObj[fileurlkey],isLoad:"filenative",isAdd:isAdd})},MiniFileMgr.getCacheUseSize=function(){return MiniFileMgr.filesListObj&&MiniFileMgr.filesListObj.fileUsedSize?MiniFileMgr.filesListObj.fileUsedSize:0},MiniFileMgr.existDir=function(dirPath,callBack){MiniFileMgr.fs.mkdir({dirPath:dirPath,success:function(data){null!=callBack&&callBack.runWith([0,{data:JSON.stringify({})}])},fail:function(data){-1!=data.errMsg.indexOf("file already exists")?MiniFileMgr.readSync(MiniFileMgr.fileListName,"utf8",callBack):null!=callBack&&callBack.runWith([1,data])}})},MiniFileMgr.readSync=function(filePath,encoding,callBack,readyUrl){void 0===encoding&&(encoding="ascill"),void 0===readyUrl&&(readyUrl="");var filesListStr,fileUrl=MiniFileMgr.getFileNativePath(filePath);try{filesListStr=MiniFileMgr.fs.readFileSync(fileUrl,encoding),null!=callBack&&callBack.runWith([0,{data:filesListStr}])}catch(error){null!=callBack&&callBack.runWith([1])}},MiniFileMgr.setNativeFileDir=function(value){MiniFileMgr.fileNativeDir=wx.env.USER_DATA_PATH+value},MiniFileMgr.filesListObj={},MiniFileMgr.fileNativeDir=null,MiniFileMgr.fileListName="layaairfiles.txt",MiniFileMgr.ziyuFileData={},MiniFileMgr.ziyuFileTextureData={},MiniFileMgr.loadPath="",MiniFileMgr.DESCENDING=2,MiniFileMgr.NUMERIC=16,__static(MiniFileMgr,["fs",function(){return this.fs=wx.getFileSystemManager()},"wxdown",function(){return this.wxdown=wx.downloadFile}]),MiniFileMgr}(),FillTextureCmd=function(){function FillTextureCmd(){}__class(FillTextureCmd,"laya.display.cmd.FillTextureCmd");var __proto=FillTextureCmd.prototype;return __proto.recover=function(){this.texture=null,this.offset=null,this.other=null,Pool.recover("FillTextureCmd",this)},__proto.run=function(context,gx,gy){context.fillTexture(this.texture,this.x+gx,this.y+gy,this.width,this.height,this.type,this.offset,this.other)},__getset(0,__proto,"cmdID",function(){return"FillTexture"}),FillTextureCmd.create=function(texture,x,y,width,height,type,offset,other){var cmd=Pool.getItemByClass("FillTextureCmd",FillTextureCmd);return cmd.texture=texture,cmd.x=x,cmd.y=y,cmd.width=width,cmd.height=height,cmd.type=type,cmd.offset=offset,cmd.other=other,cmd},FillTextureCmd.ID="FillTexture",FillTextureCmd}(),StrokeTextCmd=function(){function StrokeTextCmd(){}__class(StrokeTextCmd,"laya.display.cmd.StrokeTextCmd");var __proto=StrokeTextCmd.prototype;return __proto.recover=function(){Pool.recover("StrokeTextCmd",this)},__proto.run=function(context,gx,gy){context.strokeWord(this.text,this.x+gx,this.y+gy,this.font,this.color,this.lineWidth,this.textAlign)},__getset(0,__proto,"cmdID",function(){return"StrokeText"}),StrokeTextCmd.create=function(text,x,y,font,color,lineWidth,textAlign){var cmd=Pool.getItemByClass("StrokeTextCmd",StrokeTextCmd);return cmd.text=text,cmd.x=x,cmd.y=y,cmd.font=font,cmd.color=color,cmd.lineWidth=lineWidth,cmd.textAlign=textAlign,cmd},StrokeTextCmd.ID="StrokeText",StrokeTextCmd}(),Graphics=function(){function Graphics(){this._one=null,this._cmds=null,this.autoDestroy=!1,this._render=this._renderEmpty,this._createData()}__class(Graphics,"laya.display.Graphics");var __proto=Graphics.prototype;return __proto._createData=function(){},__proto._clearData=function(){},__proto._destroyData=function(){},__proto.destroy=function(){this.clear(!0),this._graphicBounds&&this._graphicBounds.destroy(),this._graphicBounds=null,this._vectorgraphArray=null,this._sp&&(this._sp._renderType=0,this._sp._setRenderType(0),this._sp=null),this._destroyData()},__proto.clear=function(recoverCmds){if(void 0===recoverCmds&&(recoverCmds=!0),recoverCmds){var tCmd=this._one;if(this._cmds){var i=0,len=this._cmds.length;for(i=0;i<len;i++)(tCmd=this._cmds[i]).recover();this._cmds.length=0}else tCmd&&tCmd.recover()}else this._cmds=null;if(this._one=null,this._render=this._renderEmpty,this._clearData(),this._sp&&(this._sp._renderType&=-513,this._sp._setRenderType(this._sp._renderType)),this._repaint(),this._vectorgraphArray){for(i=0,len=this._vectorgraphArray.length;i<len;i++)VectorGraphManager.getInstance().deleteShape(this._vectorgraphArray[i]);this._vectorgraphArray.length=0}},__proto._clearBoundsCache=function(){this._graphicBounds&&this._graphicBounds.reset()},__proto._initGraphicBounds=function(){this._graphicBounds||(this._graphicBounds=GraphicsBounds.create(),this._graphicBounds._graphics=this)},__proto._repaint=function(){this._clearBoundsCache(),this._sp&&this._sp.repaint()},__proto._isOnlyOne=function(){return!this._cmds||0===this._cmds.length},__proto.getBounds=function(realSize){return void 0===realSize&&(realSize=!1),this._initGraphicBounds(),this._graphicBounds.getBounds(realSize)},__proto.getBoundPoints=function(realSize){return void 0===realSize&&(realSize=!1),this._initGraphicBounds(),this._graphicBounds.getBoundPoints(realSize)},__proto.drawImage=function(texture,x,y,width,height){if(void 0===x&&(x=0),void 0===y&&(y=0),void 0===width&&(width=0),void 0===height&&(height=0),!texture)return null;if(width||(width=texture.sourceWidth),height||(height=texture.sourceHeight),texture.getIsReady()){var wRate=width/texture.sourceWidth,hRate=height/texture.sourceHeight;if(width=texture.width*wRate,height=texture.height*hRate,width<=0||height<=0)return null;x+=texture.offsetX*wRate,y+=texture.offsetY*hRate}this._sp&&(this._sp._renderType|=512,this._sp._setRenderType(this._sp._renderType));var args=DrawImageCmd.create.call(this,texture,x,y,width,height);return null==this._one?(this._one=args,this._render=this._renderOneImg):this._saveToCmd(null,args),this._repaint(),args},__proto.drawTexture=function(texture,x,y,width,height,matrix,alpha,color,blendMode){if(void 0===x&&(x=0),void 0===y&&(y=0),void 0===width&&(width=0),void 0===height&&(height=0),void 0===alpha&&(alpha=1),!texture||alpha<.01)return null;if(!texture.getIsReady())return null;if(width||(width=texture.sourceWidth),height||(height=texture.sourceHeight),texture.getIsReady()){var offset=!Render.isWebGL&&(Browser.onFirefox||Browser.onEdge||Browser.onIE||Browser.onSafari)?.5:0,wRate=width/texture.sourceWidth,hRate=height/texture.sourceHeight;if(width=texture.width*wRate,height=texture.height*hRate,width<=0||height<=0)return null;x+=texture.offsetX*wRate,y+=texture.offsetY*hRate,x-=offset,y-=offset,width+=2*offset,height+=2*offset}if(this._sp&&(this._sp._renderType|=512,this._sp._setRenderType(this._sp._renderType)),!Render.isConchApp&&!Render.isWebGL&&(blendMode||color)){var canvas=new HTMLCanvas;if(canvas.size(width,height),canvas.getContext("2d").drawTexture(texture,0,0,width,height),texture=new Texture(canvas),color){var filter=new ColorFilterAction,colorArr=ColorUtils.create(color).arrColor;filter.data=(new ColorFilter).color(255*colorArr[0],255*colorArr[1],255*colorArr[2]),filter.apply({canvas:canvas})}}var args=DrawTextureCmd.create.call(this,texture,x,y,width,height,matrix,alpha,color,blendMode);return this._repaint(),this._saveToCmd(null,args)},__proto.drawTextures=function(texture,pos){return texture?this._saveToCmd(Render._context._drawTextures,DrawTexturesCmd.create.call(this,texture,pos)):null},__proto.drawTriangles=function(texture,x,y,vertices,uvs,indices,matrix,alpha,color,blendMode){return void 0===alpha&&(alpha=1),this._saveToCmd(Render._context.drawTriangles,DrawTrianglesCmd.create.call(this,texture,x,y,vertices,uvs,indices,matrix,alpha,color,blendMode))},__proto.fillTexture=function(texture,x,y,width,height,type,offset){return void 0===width&&(width=0),void 0===height&&(height=0),void 0===type&&(type="repeat"),texture&&texture.getIsReady()?this._saveToCmd(Render._context._fillTexture,FillTextureCmd.create.call(this,texture,x,y,width,height,type,offset||Point.EMPTY,{})):null},__proto._saveToCmd=function(fun,args){return this._sp&&(this._sp._renderType|=512,this._sp._setRenderType(this._sp._renderType)),null==this._one?(this._one=args,this._render=this._renderOne):(this._render=this._renderAll,0===(this._cmds||(this._cmds=[])).length&&this._cmds.push(this._one),this._cmds.push(args)),this._repaint(),args},__proto.clipRect=function(x,y,width,height){return this._saveToCmd(Render._context._clipRect,ClipRectCmd.create.call(this,x,y,width,height))},__proto.fillText=function(text,x,y,font,color,textAlign){return this._saveToCmd(Render._context._fillText,FillTextCmd.create.call(this,text,x,y,font||Text.defaultFontStr(),color,textAlign))},__proto.fillBorderText=function(text,x,y,font,fillColor,borderColor,lineWidth,textAlign){return this._saveToCmd(Render._context._fillBorderText,FillBorderTextCmd.create.call(this,text,x,y,font||Text.defaultFontStr(),fillColor,borderColor,lineWidth,textAlign))},__proto.fillWords=function(words,x,y,font,color){return this._saveToCmd(Render._context._fillWords,FillWordsCmd.create.call(this,words,x,y,font||Text.defaultFontStr(),color))},__proto.fillBorderWords=function(words,x,y,font,fillColor,borderColor,lineWidth){return this._saveToCmd(Render._context._fillBorderWords,FillBorderWordsCmd.create.call(this,words,x,y,font||Text.defaultFontStr(),fillColor,borderColor,lineWidth))},__proto.strokeText=function(text,x,y,font,color,lineWidth,textAlign){return this._saveToCmd(Render._context._strokeText,StrokeTextCmd.create.call(this,text,x,y,font||Text.defaultFontStr(),color,lineWidth,textAlign))},__proto.alpha=function(alpha){return this._saveToCmd(Render._context._alpha,AlphaCmd.create.call(this,alpha))},__proto.transform=function(matrix,pivotX,pivotY){return void 0===pivotX&&(pivotX=0),void 0===pivotY&&(pivotY=0),this._saveToCmd(Render._context._transform,TransformCmd.create.call(this,matrix,pivotX,pivotY))},__proto.rotate=function(angle,pivotX,pivotY){return void 0===pivotX&&(pivotX=0),void 0===pivotY&&(pivotY=0),this._saveToCmd(Render._context._rotate,RotateCmd.create.call(this,angle,pivotX,pivotY))},__proto.scale=function(scaleX,scaleY,pivotX,pivotY){return void 0===pivotX&&(pivotX=0),void 0===pivotY&&(pivotY=0),this._saveToCmd(Render._context._scale,ScaleCmd.create.call(this,scaleX,scaleY,pivotX,pivotY))},__proto.translate=function(tx,ty){return this._saveToCmd(Render._context._translate,TranslateCmd.create.call(this,tx,ty))},__proto.save=function(){return this._saveToCmd(Render._context._save,SaveCmd.create.call(this))},__proto.restore=function(){return this._saveToCmd(Render._context._restore,RestoreCmd.create.call(this))},__proto.replaceText=function(text){this._repaint();var cmds=this._cmds;if(cmds){for(var i=cmds.length-1;i>-1;i--)if(this._isTextCmd(cmds[i]))return cmds[i].text=text,!0}else if(this._one&&this._isTextCmd(this._one))return this._one.text=text,!0;return!1},__proto._isTextCmd=function(cmd){var cmdID=cmd.cmdID;return"FillText"==cmdID||"StrokeText"==cmdID||"FillBorderText"==cmdID},__proto.replaceTextColor=function(color){this._repaint();var cmds=this._cmds;if(cmds)for(var i=cmds.length-1;i>-1;i--)this._isTextCmd(cmds[i])&&this._setTextCmdColor(cmds[i],color);else this._one&&this._isTextCmd(this._one)&&this._setTextCmdColor(this._one,color)},__proto._setTextCmdColor=function(cmdO,color){switch(cmdO.cmdID){case"FillText":case"StrokeText":cmdO.color=color;break;case"FillBorderText":case"FillBorderWords":case"FillBorderText":cmdO.fillColor=color}},__proto.loadImage=function(url,x,y,width,height,complete){void 0===x&&(x=0),void 0===y&&(y=0),void 0===width&&(width=0),void 0===height&&(height=0);var tex=Loader.getRes(url);tex?tex.getIsReady()?this.drawImage(tex,x,y,width,height):tex.once("ready",this,this.drawImage,[tex,x,y,width,height]):((tex=new Texture).load(url),Loader.cacheRes(url,tex),tex.once("ready",this,this.drawImage,[tex,x,y,width,height])),null!=complete&&(tex.getIsReady()?complete.call(this._sp):tex.on("ready",this._sp,complete))},__proto._renderEmpty=function(sprite,context,x,y){},__proto._renderAll=function(sprite,context,x,y){for(var cmds=this._cmds,i=0,n=cmds.length;i<n;i++)cmds[i].run(context,x,y)},__proto._renderOne=function(sprite,context,x,y){this._one.run(context,x,y)},__proto._renderOneImg=function(sprite,context,x,y){this._one.run(context,x,y)},__proto.drawLine=function(fromX,fromY,toX,toY,lineColor,lineWidth){void 0===lineWidth&&(lineWidth=1);var tId=0;Render.isWebGL&&(tId=VectorGraphManager.getInstance().getId(),null==this._vectorgraphArray&&(this._vectorgraphArray=[]),this._vectorgraphArray.push(tId));var offset=lineWidth<1||lineWidth%2==0?0:.5;return this._saveToCmd(Render._context._drawLine,DrawLineCmd.create.call(this,fromX+offset,fromY+offset,toX+offset,toY+offset,lineColor,lineWidth,tId))},__proto.drawLines=function(x,y,points,lineColor,lineWidth){void 0===lineWidth&&(lineWidth=1);var tId=0;if(!points||points.length<4)return null;Render.isWebGL&&(tId=VectorGraphManager.getInstance().getId(),null==this._vectorgraphArray&&(this._vectorgraphArray=[]),this._vectorgraphArray.push(tId));var offset=lineWidth<1||lineWidth%2==0?0:.5;return this._saveToCmd(Render._context._drawLines,DrawLinesCmd.create.call(this,x+offset,y+offset,points,lineColor,lineWidth,tId))},__proto.drawCurves=function(x,y,points,lineColor,lineWidth){return void 0===lineWidth&&(lineWidth=1),this._saveToCmd(Render._context._drawCurves,DrawCurvesCmd.create.call(this,x,y,points,lineColor,lineWidth))},__proto.drawRect=function(x,y,width,height,fillColor,lineColor,lineWidth){void 0===lineWidth&&(lineWidth=1);var offset=lineWidth>=1&&lineColor?lineWidth/2:0,lineOffset=lineColor?lineWidth:0;return this._saveToCmd(Render._context.drawRect,DrawRectCmd.create.call(this,x+offset,y+offset,width-lineOffset,height-lineOffset,fillColor,lineColor,lineWidth))},__proto.drawCircle=function(x,y,radius,fillColor,lineColor,lineWidth){void 0===lineWidth&&(lineWidth=1);var offset=lineWidth>=1&&lineColor?lineWidth/2:0,tId=0;return Render.isWebGL&&(tId=VectorGraphManager.getInstance().getId(),null==this._vectorgraphArray&&(this._vectorgraphArray=[]),this._vectorgraphArray.push(tId)),this._saveToCmd(Render._context._drawCircle,DrawCircleCmd.create.call(this,x,y,radius-offset,fillColor,lineColor,lineWidth,tId))},__proto.drawPie=function(x,y,radius,startAngle,endAngle,fillColor,lineColor,lineWidth){void 0===lineWidth&&(lineWidth=1);var offset=lineWidth>=1&&lineColor?lineWidth/2:0,lineOffset=lineColor?lineWidth:0,tId=0;return Render.isWebGL&&(tId=VectorGraphManager.getInstance().getId(),null==this._vectorgraphArray&&(this._vectorgraphArray=[]),this._vectorgraphArray.push(tId)),this._saveToCmd(Render._context._drawPie,DrawPieCmd.create.call(this,x+offset,y+offset,radius-lineOffset,Utils.toRadian(startAngle),Utils.toRadian(endAngle),fillColor,lineColor,lineWidth,tId))},__proto.drawPoly=function(x,y,points,fillColor,lineColor,lineWidth){void 0===lineWidth&&(lineWidth=1);var tId=0;if(Render.isWebGL){tId=VectorGraphManager.getInstance().getId(),null==this._vectorgraphArray&&(this._vectorgraphArray=[]),this._vectorgraphArray.push(tId);var tIsConvexPolygon=!1;tIsConvexPolygon=!(points.length>6)}var offset=lineWidth>=1&&lineColor?lineWidth%2==0?0:.5:0;return this._saveToCmd(Render._context._drawPoly,DrawPolyCmd.create.call(this,x+offset,y+offset,points,fillColor,lineColor,lineWidth,tIsConvexPolygon,tId))},__proto.drawPath=function(x,y,paths,brush,pen){return this._saveToCmd(Render._context._drawPath,DrawPathCmd.create.call(this,x,y,paths,brush,pen))},__getset(0,__proto,"cmds",function(){return this._cmds},function(value){this._sp&&(this._sp._renderType|=512,this._sp._setRenderType(this._sp._renderType)),this._cmds=value,this._render=this._renderAll,this._repaint()}),Graphics}(),RestoreCmd=function(){function RestoreCmd(){}__class(RestoreCmd,"laya.display.cmd.RestoreCmd");var __proto=RestoreCmd.prototype;return __proto.recover=function(){Pool.recover("RestoreCmd",this)},__proto.run=function(context,gx,gy){context.restore()},__getset(0,__proto,"cmdID",function(){return"Restore"}),RestoreCmd.create=function(){return Pool.getItemByClass("RestoreCmd",RestoreCmd)},RestoreCmd.ID="Restore",RestoreCmd}(),FillBorderWordsCmd=(function(){function ResourceVersion(){}__class(ResourceVersion,"laya.net.ResourceVersion"),ResourceVersion.enable=function(manifestFile,callback,type){void 0===type&&(type=2),laya.net.ResourceVersion.type=type,Laya.loader.load(manifestFile,Handler.create(null,ResourceVersion.onManifestLoaded,[callback]),null,"json")},ResourceVersion.onManifestLoaded=function(callback,data){ResourceVersion.manifest=data,URL.customFormat=ResourceVersion.addVersionPrefix,callback.run(),data||console.warn("资源版本清单文件不存在，不使用资源版本管理。忽略ERR_FILE_NOT_FOUND错误。")},ResourceVersion.addVersionPrefix=function(originURL){return originURL=URL.getAdptedFilePath(originURL),ResourceVersion.manifest&&ResourceVersion.manifest[originURL]?2==ResourceVersion.type?ResourceVersion.manifest[originURL]:ResourceVersion.manifest[originURL]+"/"+originURL:originURL},ResourceVersion.FOLDER_VERSION=1,ResourceVersion.FILENAME_VERSION=2,ResourceVersion.manifest=null,ResourceVersion.type=1}(),function(){function FillBorderWordsCmd(){}__class(FillBorderWordsCmd,"laya.display.cmd.FillBorderWordsCmd");var __proto=FillBorderWordsCmd.prototype;return __proto.recover=function(){this.words=null,Pool.recover("FillBorderWordsCmd",this)},__proto.run=function(context,gx,gy){context.fillBorderWords(this.words,this.x+gx,this.y+gy,this.font,this.fillColor,this.borderColor,this.lineWidth)},__getset(0,__proto,"cmdID",function(){return"FillBorderWords"}),FillBorderWordsCmd.create=function(words,x,y,font,fillColor,borderColor,lineWidth){var cmd=Pool.getItemByClass("FillBorderWordsCmd",FillBorderWordsCmd);return cmd.words=words,cmd.x=x,cmd.y=y,cmd.font=font,cmd.fillColor=fillColor,cmd.borderColor=borderColor,cmd.lineWidth=lineWidth,cmd},FillBorderWordsCmd.ID="FillBorderWords",FillBorderWordsCmd}()),ScaleCmd=function(){function ScaleCmd(){}__class(ScaleCmd,"laya.display.cmd.ScaleCmd");var __proto=ScaleCmd.prototype;return __proto.recover=function(){Pool.recover("ScaleCmd",this)},__proto.run=function(context,gx,gy){context._scale(this.scaleX,this.scaleY,this.pivotX+gx,this.pivotY+gy)},__getset(0,__proto,"cmdID",function(){return"Scale"}),ScaleCmd.create=function(scaleX,scaleY,pivotX,pivotY){var cmd=Pool.getItemByClass("ScaleCmd",ScaleCmd);return cmd.scaleX=scaleX,cmd.scaleY=scaleY,cmd.pivotX=pivotX,cmd.pivotY=pivotY,cmd},ScaleCmd.ID="Scale",ScaleCmd}(),AlphaCmd=function(){function AlphaCmd(){}__class(AlphaCmd,"laya.display.cmd.AlphaCmd");var __proto=AlphaCmd.prototype;return __proto.recover=function(){Pool.recover("AlphaCmd",this)},__proto.run=function(context,gx,gy){context.alpha(this.alpha)},__getset(0,__proto,"cmdID",function(){return"Alpha"}),AlphaCmd.create=function(alpha){var cmd=Pool.getItemByClass("AlphaCmd",AlphaCmd);return cmd.alpha=alpha,cmd},AlphaCmd.ID="Alpha",AlphaCmd}(),Prefab=function(){function Prefab(){this.json=null}return __class(Prefab,"laya.components.Prefab"),Prefab.prototype.create=function(){return this.json?SceneUtils.createByData(null,this.json):null},Prefab}(),WordText=function(){function WordText(){this.id=NaN,this.save=[],this.toUpperCase=null,this.changed=!1,this._text=null,this.width=-1,this.pageChars=[],this.startID=0,this.startIDStroke=0,this.lastGCCnt=0}__class(WordText,"laya.utils.WordText");var __proto=WordText.prototype;return __proto.setText=function(txt){this.changed=!0,this._text=txt,this.width=-1,this.pageChars=[]},__proto.toString=function(){return this._text},__proto.charCodeAt=function(i){return this._text?this._text.charCodeAt(i):NaN},__proto.charAt=function(i){return this._text?this._text.charAt(i):null},__proto.cleanCache=function(){this.pageChars=[],this.startID=0},__getset(0,__proto,"length",function(){return this._text?this._text.length:0}),WordText}(),GrahamScan=function(){function GrahamScan(){}return __class(GrahamScan,"laya.maths.GrahamScan"),GrahamScan.multiply=function(p1,p2,p0){return(p1.x-p0.x)*(p2.y-p0.y)-(p2.x-p0.x)*(p1.y-p0.y)},GrahamScan.dis=function(p1,p2){return(p1.x-p2.x)*(p1.x-p2.x)+(p1.y-p2.y)*(p1.y-p2.y)},GrahamScan._getPoints=function(count,tempUse,rst){for(void 0===tempUse&&(tempUse=!1),GrahamScan._mPointList||(GrahamScan._mPointList=[]);GrahamScan._mPointList.length<count;)GrahamScan._mPointList.push(new Point);return rst||(rst=[]),rst.length=0,tempUse?GrahamScan.getFrom(rst,GrahamScan._mPointList,count):GrahamScan.getFromR(rst,GrahamScan._mPointList,count),rst},GrahamScan.getFrom=function(rst,src,count){var i=0;for(i=0;i<count;i++)rst.push(src[i]);return rst},GrahamScan.getFromR=function(rst,src,count){var i=0;for(i=0;i<count;i++)rst.push(src.pop());return rst},GrahamScan.pListToPointList=function(pList,tempUse){void 0===tempUse&&(tempUse=!1);var i=0,len=pList.length/2,rst=GrahamScan._getPoints(len,tempUse,GrahamScan._tempPointList);for(i=0;i<len;i++)rst[i].setTo(pList[i+i],pList[i+i+1]);return rst},GrahamScan.pointListToPlist=function(pointList){var tPoint,i=0,len=pointList.length,rst=GrahamScan._temPList;for(rst.length=0,i=0;i<len;i++)tPoint=pointList[i],rst.push(tPoint.x,tPoint.y);return rst},GrahamScan.scanPList=function(pList){return Utils.copyArray(pList,GrahamScan.pointListToPlist(GrahamScan.scan(GrahamScan.pListToPointList(pList,!0))))},GrahamScan.scan=function(PointSet){var tmp,ch,key,i=0,j=0,k=0,n=PointSet.length,_tmpDic={};for((ch=GrahamScan._temArr).length=0,i=PointSet.length-1;i>=0;i--)key=(tmp=PointSet[i]).x+"_"+tmp.y,_tmpDic.hasOwnProperty(key)||(_tmpDic[key]=!0,ch.push(tmp));for(n=ch.length,Utils.copyArray(PointSet,ch),i=1;i<n;i++)(PointSet[i].y<PointSet[k].y||PointSet[i].y==PointSet[k].y&&PointSet[i].x<PointSet[k].x)&&(k=i);for(tmp=PointSet[0],PointSet[0]=PointSet[k],PointSet[k]=tmp,i=1;i<n-1;i++){for(k=i,j=i+1;j<n;j++)(GrahamScan.multiply(PointSet[j],PointSet[k],PointSet[0])>0||0==GrahamScan.multiply(PointSet[j],PointSet[k],PointSet[0])&&GrahamScan.dis(PointSet[0],PointSet[j])<GrahamScan.dis(PointSet[0],PointSet[k]))&&(k=j);tmp=PointSet[i],PointSet[i]=PointSet[k],PointSet[k]=tmp}if((ch=GrahamScan._temArr).length=0,PointSet.length<3)return Utils.copyArray(ch,PointSet);for(ch.push(PointSet[0],PointSet[1],PointSet[2]),i=3;i<n;i++){for(;ch.length>=2&&GrahamScan.multiply(PointSet[i],ch[ch.length-1],ch[ch.length-2])>=0;)ch.pop();PointSet[i]&&ch.push(PointSet[i])}return ch},GrahamScan._mPointList=null,GrahamScan._tempPointList=[],GrahamScan._temPList=[],GrahamScan._temArr=[],GrahamScan}(),DrawCurvesCmd=(function(){function Const(){}__class(Const,"laya.Const"),Const.NOT_ACTIVE=1,Const.ACTIVE_INHIERARCHY=2,Const.AWAKED=4,Const.NOT_READY=8,Const.DISPLAY=16,Const.HAS_ZORDER=32,Const.HAS_MOUSE=64,Const.DISPLAYED_INSTAGE=128,Const.DRAWCALL_OPTIMIZE=256}(),function(){function MathUtil(){}__class(MathUtil,"laya.maths.MathUtil"),MathUtil.subtractVector3=function(l,r,o){o[0]=l[0]-r[0],o[1]=l[1]-r[1],o[2]=l[2]-r[2]},MathUtil.lerp=function(left,right,amount){return left*(1-amount)+right*amount},MathUtil.scaleVector3=function(f,b,e){e[0]=f[0]*b,e[1]=f[1]*b,e[2]=f[2]*b},MathUtil.lerpVector3=function(l,r,t,o){var ax=l[0],ay=l[1],az=l[2];o[0]=ax+t*(r[0]-ax),o[1]=ay+t*(r[1]-ay),o[2]=az+t*(r[2]-az)},MathUtil.lerpVector4=function(l,r,t,o){var ax=l[0],ay=l[1],az=l[2],aw=l[3];o[0]=ax+t*(r[0]-ax),o[1]=ay+t*(r[1]-ay),o[2]=az+t*(r[2]-az),o[3]=aw+t*(r[3]-aw)},MathUtil.slerpQuaternionArray=function(a,Offset1,b,Offset2,t,out,Offset3){var omega,cosom,sinom,scale0,scale1,ax=a[Offset1+0],ay=a[Offset1+1],az=a[Offset1+2],aw=a[Offset1+3],bx=b[Offset2+0],by=b[Offset2+1],bz=b[Offset2+2],bw=b[Offset2+3];return(cosom=ax*bx+ay*by+az*bz+aw*bw)<0&&(cosom=-cosom,bx=-bx,by=-by,bz=-bz,bw=-bw),1-cosom>1e-6?(omega=Math.acos(cosom),sinom=Math.sin(omega),scale0=Math.sin((1-t)*omega)/sinom,scale1=Math.sin(t*omega)/sinom):(scale0=1-t,scale1=t),out[Offset3+0]=scale0*ax+scale1*bx,out[Offset3+1]=scale0*ay+scale1*by,out[Offset3+2]=scale0*az+scale1*bz,out[Offset3+3]=scale0*aw+scale1*bw,out},MathUtil.getRotation=function(x0,y0,x1,y1){return Math.atan2(y1-y0,x1-x0)/Math.PI*180},MathUtil.sortBigFirst=function(a,b){return a==b?0:b>a?1:-1},MathUtil.sortSmallFirst=function(a,b){return a==b?0:b>a?-1:1},MathUtil.sortNumBigFirst=function(a,b){return parseFloat(b)-parseFloat(a)},MathUtil.sortNumSmallFirst=function(a,b){return parseFloat(a)-parseFloat(b)},MathUtil.sortByKey=function(key,bigFirst,forceNum){var _sortFun;return void 0===bigFirst&&(bigFirst=!1),void 0===forceNum&&(forceNum=!0),_sortFun=bigFirst?forceNum?MathUtil.sortNumBigFirst:MathUtil.sortBigFirst:forceNum?MathUtil.sortNumSmallFirst:MathUtil.sortSmallFirst,function(a,b){return _sortFun(a[key],b[key])}}}(),function(){function DrawCurvesCmd(){}__class(DrawCurvesCmd,"laya.display.cmd.DrawCurvesCmd");var __proto=DrawCurvesCmd.prototype;return __proto.recover=function(){this.points=null,this.lineColor=null,Pool.recover("DrawCurvesCmd",this)},__proto.run=function(context,gx,gy){context.drawCurves(this.x+gx,this.y+gy,this.points,this.lineColor,this.lineWidth)},__getset(0,__proto,"cmdID",function(){return"DrawCurves"}),DrawCurvesCmd.create=function(x,y,points,lineColor,lineWidth){var cmd=Pool.getItemByClass("DrawCurvesCmd",DrawCurvesCmd);return cmd.x=x,cmd.y=y,cmd.points=points,cmd.lineColor=lineColor,cmd.lineWidth=lineWidth,cmd},DrawCurvesCmd.ID="DrawCurves",DrawCurvesCmd}()),SaveCmd=function(){function SaveCmd(){}__class(SaveCmd,"laya.display.cmd.SaveCmd");var __proto=SaveCmd.prototype;return __proto.recover=function(){Pool.recover("SaveCmd",this)},__proto.run=function(context,gx,gy){context.save()},__getset(0,__proto,"cmdID",function(){return"Save"}),SaveCmd.create=function(){return Pool.getItemByClass("SaveCmd",SaveCmd)},SaveCmd.ID="Save",SaveCmd}(),DrawImageCmd=function(){function DrawImageCmd(){}__class(DrawImageCmd,"laya.display.cmd.DrawImageCmd");var __proto=DrawImageCmd.prototype;return __proto.recover=function(){this.texture._removeReference(),this.texture=null,Pool.recover("DrawImageCmd",this)},__proto.run=function(context,gx,gy){context.drawTexture(this.texture,this.x+gx,this.y+gy,this.width,this.height)},__getset(0,__proto,"cmdID",function(){return"DrawImage"}),DrawImageCmd.create=function(texture,x,y,width,height){var cmd=Pool.getItemByClass("DrawImageCmd",DrawImageCmd);return cmd.texture=texture,texture._addReference(),cmd.x=x,cmd.y=y,cmd.width=width,cmd.height=height,cmd},DrawImageCmd.ID="DrawImage",DrawImageCmd}(),Matrix=function(){function Matrix(a,b,c,d,tx,ty,nums){if(this._bTransform=!1,void 0===a&&(a=1),void 0===b&&(b=0),void 0===c&&(c=0),void 0===d&&(d=1),void 0===tx&&(tx=0),void 0===ty&&(ty=0),void 0===nums&&(nums=0),null!=Matrix._createFun)return Matrix._createFun(a,b,c,d,tx,ty,nums);this.a=a,this.b=b,this.c=c,this.d=d,this.tx=tx,this.ty=ty,this._checkTransform()}__class(Matrix,"laya.maths.Matrix");var __proto=Matrix.prototype;return __proto.identity=function(){return this.a=this.d=1,this.b=this.tx=this.ty=this.c=0,this._bTransform=!1,this},__proto._checkTransform=function(){return this._bTransform=1!==this.a||0!==this.b||0!==this.c||1!==this.d},__proto.setTranslate=function(x,y){return this.tx=x,this.ty=y,this},__proto.translate=function(x,y){return this.tx+=x,this.ty+=y,this},__proto.scale=function(x,y){return this.a*=x,this.d*=y,this.c*=x,this.b*=y,this.tx*=x,this.ty*=y,this._bTransform=!0,this},__proto.rotate=function(angle){var cos=Math.cos(angle),sin=Math.sin(angle),a1=this.a,c1=this.c,tx1=this.tx;return this.a=a1*cos-this.b*sin,this.b=a1*sin+this.b*cos,this.c=c1*cos-this.d*sin,this.d=c1*sin+this.d*cos,this.tx=tx1*cos-this.ty*sin,this.ty=tx1*sin+this.ty*cos,this._bTransform=!0,this},__proto.skew=function(x,y){var tanX=Math.tan(x),tanY=Math.tan(y),a1=this.a,b1=this.b;return this.a+=tanY*this.c,this.b+=tanY*this.d,this.c+=tanX*a1,this.d+=tanX*b1,this},__proto.invertTransformPoint=function(out){var a1=this.a,b1=this.b,c1=this.c,d1=this.d,tx1=this.tx,n=a1*d1-b1*c1,a2=d1/n,b2=-b1/n,c2=-c1/n,d2=a1/n,tx2=(c1*this.ty-d1*tx1)/n,ty2=-(a1*this.ty-b1*tx1)/n;return out.setTo(a2*out.x+c2*out.y+tx2,b2*out.x+d2*out.y+ty2)},__proto.transformPoint=function(out){return out.setTo(this.a*out.x+this.c*out.y+this.tx,this.b*out.x+this.d*out.y+this.ty)},__proto.transformPointN=function(out){return out.setTo(this.a*out.x+this.c*out.y,this.b*out.x+this.d*out.y)},__proto.getScaleX=function(){return 0===this.b?this.a:Math.sqrt(this.a*this.a+this.b*this.b)},__proto.getScaleY=function(){return 0===this.c?this.d:Math.sqrt(this.c*this.c+this.d*this.d)},__proto.invert=function(){var a1=this.a,b1=this.b,c1=this.c,d1=this.d,tx1=this.tx,n=a1*d1-b1*c1;return this.a=d1/n,this.b=-b1/n,this.c=-c1/n,this.d=a1/n,this.tx=(c1*this.ty-d1*tx1)/n,this.ty=-(a1*this.ty-b1*tx1)/n,this},__proto.setTo=function(a,b,c,d,tx,ty){return this.a=a,this.b=b,this.c=c,this.d=d,this.tx=tx,this.ty=ty,this},__proto.concat=function(matrix){var a=this.a,c=this.c,tx=this.tx;return this.a=a*matrix.a+this.b*matrix.c,this.b=a*matrix.b+this.b*matrix.d,this.c=c*matrix.a+this.d*matrix.c,this.d=c*matrix.b+this.d*matrix.d,this.tx=tx*matrix.a+this.ty*matrix.c+matrix.tx,this.ty=tx*matrix.b+this.ty*matrix.d+matrix.ty,this},__proto.scaleEx=function(x,y){var ba=this.a,bb=this.b,bc=this.c,bd=this.d;0!==bb||0!==bc?(this.a=x*ba,this.b=x*bb,this.c=y*bc,this.d=y*bd):(this.a=x*ba,this.b=0*bd,this.c=0*ba,this.d=y*bd),this._bTransform=!0},__proto.rotateEx=function(angle){var cos=Math.cos(angle),sin=Math.sin(angle),ba=this.a,bb=this.b,bc=this.c,bd=this.d;0!==bb||0!==bc?(this.a=cos*ba+sin*bc,this.b=cos*bb+sin*bd,this.c=-sin*ba+cos*bc,this.d=-sin*bb+cos*bd):(this.a=cos*ba,this.b=sin*bd,this.c=-sin*ba,this.d=cos*bd),this._bTransform=!0},__proto.clone=function(){var dec=Matrix.create();return dec.a=this.a,dec.b=this.b,dec.c=this.c,dec.d=this.d,dec.tx=this.tx,dec.ty=this.ty,dec._bTransform=this._bTransform,dec},__proto.copyTo=function(dec){return dec.a=this.a,dec.b=this.b,dec.c=this.c,dec.d=this.d,dec.tx=this.tx,dec.ty=this.ty,dec._bTransform=this._bTransform,dec},__proto.toString=function(){return this.a+","+this.b+","+this.c+","+this.d+","+this.tx+","+this.ty},__proto.destroy=function(){this.recover()},__proto.recover=function(){Pool.recover("Matrix",this.identity())},Matrix.mul=function(m1,m2,out){var aa=m1.a,ab=m1.b,ac=m1.c,ad=m1.d,atx=m1.tx,aty=m1.ty,ba=m2.a,bb=m2.b,bc=m2.c,bd=m2.d,btx=m2.tx,bty=m2.ty;return 0!==bb||0!==bc?(out.a=aa*ba+ab*bc,out.b=aa*bb+ab*bd,out.c=ac*ba+ad*bc,out.d=ac*bb+ad*bd,out.tx=ba*atx+bc*aty+btx,out.ty=bb*atx+bd*aty+bty):(out.a=aa*ba,out.b=ab*bd,out.c=ac*ba,out.d=ad*bd,out.tx=ba*atx+btx,out.ty=bd*aty+bty),out},Matrix.mul16=function(m1,m2,out){var aa=m1.a,ab=m1.b,ac=m1.c,ad=m1.d,atx=m1.tx,aty=m1.ty,ba=m2.a,bb=m2.b,bc=m2.c,bd=m2.d,btx=m2.tx,bty=m2.ty;return 0!==bb||0!==bc?(out[0]=aa*ba+ab*bc,out[1]=aa*bb+ab*bd,out[4]=ac*ba+ad*bc,out[5]=ac*bb+ad*bd,out[12]=ba*atx+bc*aty+btx,out[13]=bb*atx+bd*aty+bty):(out[0]=aa*ba,out[1]=ab*bd,out[4]=ac*ba,out[5]=ad*bd,out[12]=ba*atx+btx,out[13]=bd*aty+bty),out},Matrix.create=function(){return Pool.getItemByClass("Matrix",Matrix)},Matrix.EMPTY=new Matrix,Matrix.TEMP=new Matrix,Matrix._createFun=null,Matrix}(),UIUtils=(function(){function Byte(data){this._xd_=!0,this._allocated_=8,this._pos_=0,this._length=0,data?(this._u8d_=new Uint8Array(data),this._d_=new DataView(this._u8d_.buffer),this._length=this._d_.byteLength):this._resizeBuffer(this._allocated_)}__class(Byte,"laya.utils.Byte");var __proto=Byte.prototype;__proto._resizeBuffer=function(len){try{var newByteView=new Uint8Array(len);null!=this._u8d_&&(this._u8d_.length<=len?newByteView.set(this._u8d_):newByteView.set(this._u8d_.subarray(0,len))),this._u8d_=newByteView,this._d_=new DataView(newByteView.buffer)}catch(err){throw"Invalid typed array length:"+len}},__proto.getString=function(){return this.readString()},__proto.readString=function(){return this._rUTF(this.getUint16())},__proto.getFloat32Array=function(start,len){return this.readFloat32Array(start,len)},__proto.readFloat32Array=function(start,len){var end=start+len;end=end>this._length?this._length:end;var v=new Float32Array(this._d_.buffer.slice(start,end));return this._pos_=end,v},__proto.getUint8Array=function(start,len){return this.readUint8Array(start,len)},__proto.readUint8Array=function(start,len){var end=start+len;end=end>this._length?this._length:end;var v=new Uint8Array(this._d_.buffer.slice(start,end));return this._pos_=end,v},__proto.getInt16Array=function(start,len){return this.readInt16Array(start,len)},__proto.readInt16Array=function(start,len){var end=start+len;end=end>this._length?this._length:end;var v=new Int16Array(this._d_.buffer.slice(start,end));return this._pos_=end,v},__proto.getFloat32=function(){return this.readFloat32()},__proto.readFloat32=function(){if(this._pos_+4>this._length)throw"getFloat32 error - Out of bounds";var v=this._d_.getFloat32(this._pos_,this._xd_);return this._pos_+=4,v},__proto.getFloat64=function(){return this.readFloat64()},__proto.readFloat64=function(){if(this._pos_+8>this._length)throw"getFloat64 error - Out of bounds";var v=this._d_.getFloat64(this._pos_,this._xd_);return this._pos_+=8,v},__proto.writeFloat32=function(value){this._ensureWrite(this._pos_+4),this._d_.setFloat32(this._pos_,value,this._xd_),this._pos_+=4},__proto.writeFloat64=function(value){this._ensureWrite(this._pos_+8),this._d_.setFloat64(this._pos_,value,this._xd_),this._pos_+=8},__proto.getInt32=function(){return this.readInt32()},__proto.readInt32=function(){if(this._pos_+4>this._length)throw"getInt32 error - Out of bounds";var float=this._d_.getInt32(this._pos_,this._xd_);return this._pos_+=4,float},__proto.getUint32=function(){return this.readUint32()},__proto.readUint32=function(){if(this._pos_+4>this._length)throw"getUint32 error - Out of bounds";var v=this._d_.getUint32(this._pos_,this._xd_);return this._pos_+=4,v},__proto.writeInt32=function(value){this._ensureWrite(this._pos_+4),this._d_.setInt32(this._pos_,value,this._xd_),this._pos_+=4},__proto.writeUint32=function(value){this._ensureWrite(this._pos_+4),this._d_.setUint32(this._pos_,value,this._xd_),this._pos_+=4},__proto.getInt16=function(){return this.readInt16()},__proto.readInt16=function(){if(this._pos_+2>this._length)throw"getInt16 error - Out of bounds";var us=this._d_.getInt16(this._pos_,this._xd_);return this._pos_+=2,us},__proto.getUint16=function(){return this.readUint16()},__proto.readUint16=function(){if(this._pos_+2>this._length)throw"getUint16 error - Out of bounds";var us=this._d_.getUint16(this._pos_,this._xd_);return this._pos_+=2,us},__proto.writeUint16=function(value){this._ensureWrite(this._pos_+2),this._d_.setUint16(this._pos_,value,this._xd_),this._pos_+=2},__proto.writeInt16=function(value){this._ensureWrite(this._pos_+2),this._d_.setInt16(this._pos_,value,this._xd_),this._pos_+=2},__proto.getUint8=function(){return this.readUint8()},__proto.readUint8=function(){if(this._pos_+1>this._length)throw"getUint8 error - Out of bounds";return this._u8d_[this._pos_++]},__proto.writeUint8=function(value){this._ensureWrite(this._pos_+1),this._d_.setUint8(this._pos_,value),this._pos_++},__proto._getUInt8=function(pos){return this._readUInt8(pos)},__proto._readUInt8=function(pos){return this._d_.getUint8(pos)},__proto._getUint16=function(pos){return this._readUint16(pos)},__proto._readUint16=function(pos){return this._d_.getUint16(pos,this._xd_)},__proto._getMatrix=function(){return this._readMatrix()},__proto._readMatrix=function(){return new Matrix(this.getFloat32(),this.getFloat32(),this.getFloat32(),this.getFloat32(),this.getFloat32(),this.getFloat32())},__proto._rUTF=function(len){for(var v="",max=this._pos_+len,c=0,f=String.fromCharCode,u=this._u8d_;this._pos_<max;)(c=u[this._pos_++])<128?0!=c&&(v+=f(c)):v+=f(c<224?(63&c)<<6|127&u[this._pos_++]:c<240?(31&c)<<12|(127&u[this._pos_++])<<6|127&u[this._pos_++]:(15&c)<<18|(127&u[this._pos_++])<<12|u[this._pos_++]<<6&127|127&u[this._pos_++]);return v},__proto.getCustomString=function(len){return this.readCustomString(len)},__proto.readCustomString=function(len){for(var v="",ulen=0,c=0,f=String.fromCharCode,u=this._u8d_;len>0;)if((c=u[this._pos_])<128)v+=f(c),this._pos_++,len--;else for(ulen=c-128,this._pos_++,len-=ulen;ulen>0;)c=u[this._pos_++],v+=f(u[this._pos_++]<<8|c),ulen--;return v},__proto.clear=function(){this._pos_=0,this.length=0},__proto.__getBuffer=function(){return this._d_.buffer},__proto.writeUTFBytes=function(value){for(var i=0,sz=(value+="").length;i<sz;i++){var c=value.charCodeAt(i);c<=127?this.writeByte(c):c<=2047?(this._ensureWrite(this._pos_+2),this._u8d_.set([192|c>>6,128|63&c],this._pos_),this._pos_+=2):c<=65535?(this._ensureWrite(this._pos_+3),this._u8d_.set([224|c>>12,128|c>>6&63,128|63&c],this._pos_),this._pos_+=3):(this._ensureWrite(this._pos_+4),this._u8d_.set([240|c>>18,128|c>>12&63,128|c>>6&63,128|63&c],this._pos_),this._pos_+=4)}},__proto.writeUTFString=function(value){var tPos=this.pos;this.writeUint16(1),this.writeUTFBytes(value);var dPos=this.pos-tPos-2;this._d_.setUint16(tPos,dPos,this._xd_)},__proto.readUTFString=function(){return this.readUTFBytes(this.getUint16())},__proto.getUTFString=function(){return this.readUTFString()},__proto.readUTFBytes=function(len){if(void 0===len&&(len=-1),0===len)return"";var lastBytes=this.bytesAvailable;if(len>lastBytes)throw"readUTFBytes error - Out of bounds";return len=len>0?len:lastBytes,this._rUTF(len)},__proto.getUTFBytes=function(len){return void 0===len&&(len=-1),this.readUTFBytes(len)},__proto.writeByte=function(value){this._ensureWrite(this._pos_+1),this._d_.setInt8(this._pos_,value),this._pos_+=1},__proto.readByte=function(){if(this._pos_+1>this._length)throw"readByte error - Out of bounds";return this._d_.getInt8(this._pos_++)},__proto.getByte=function(){return this.readByte()},__proto._ensureWrite=function(lengthToEnsure){this._length<lengthToEnsure&&(this._length=lengthToEnsure),this._allocated_<lengthToEnsure&&(this.length=lengthToEnsure)},__proto.writeArrayBuffer=function(arraybuffer,offset,length){if(void 0===offset&&(offset=0),void 0===length&&(length=0),offset<0||length<0)throw"writeArrayBuffer error - Out of bounds";0==length&&(length=arraybuffer.byteLength-offset),this._ensureWrite(this._pos_+length);var uint8array=new Uint8Array(arraybuffer);this._u8d_.set(uint8array.subarray(offset,offset+length),this._pos_),this._pos_+=length},__proto.readArrayBuffer=function(length){var rst;return rst=this._u8d_.buffer.slice(this._pos_,this._pos_+length),this._pos_=this._pos_+length,rst},__getset(0,__proto,"buffer",function(){var rstBuffer=this._d_.buffer;return rstBuffer.byteLength===this._length?rstBuffer:rstBuffer.slice(0,this._length)}),__getset(0,__proto,"endian",function(){return this._xd_?"littleEndian":"bigEndian"},function(value){this._xd_="littleEndian"===value}),__getset(0,__proto,"length",function(){return this._length},function(value){this._allocated_<value?this._resizeBuffer(this._allocated_=Math.floor(Math.max(value,2*this._allocated_))):this._allocated_>value&&this._resizeBuffer(this._allocated_=value),this._length=value}),__getset(0,__proto,"pos",function(){return this._pos_},function(value){this._pos_=value}),__getset(0,__proto,"bytesAvailable",function(){return this._length-this._pos_}),Byte.getSystemEndian=function(){if(!Byte._sysEndian){var buffer=new ArrayBuffer(2);new DataView(buffer).setInt16(0,256,!0),Byte._sysEndian=256===new Int16Array(buffer)[0]?"littleEndian":"bigEndian"}return Byte._sysEndian},Byte.BIG_ENDIAN="bigEndian",Byte.LITTLE_ENDIAN="littleEndian",Byte._sysEndian=null}(),function(){function UIUtils(){}return __class(UIUtils,"laya.ui.UIUtils"),UIUtils.fillArray=function(arr,str,type){var temp=arr.concat();if(str)for(var a=str.split(","),i=0,n=Math.min(temp.length,a.length);i<n;i++){var value=a[i];temp[i]="true"==value||"false"!=value&&value,null!=type&&(temp[i]=type(value))}return temp},UIUtils.toColor=function(color){return Utils.toHexColor(color)},UIUtils.gray=function(traget,isGray){void 0===isGray&&(isGray=!0),isGray?UIUtils.addFilter(traget,UIUtils.grayFilter):UIUtils.clearFilter(traget,ColorFilter)},UIUtils.addFilter=function(target,filter){var filters=target.filters||[];filters.push(filter),target.filters=filters},UIUtils.clearFilter=function(target,filterType){var filters=target.filters;if(null!=filters&&filters.length>0){for(var i=filters.length-1;i>-1;i--){var filter=filters[i];Laya.__typeof(filter,filterType)&&filters.splice(i,1)}target.filters=filters}},UIUtils._getReplaceStr=function(word){return UIUtils.escapeSequence[word]},UIUtils.adptString=function(str){return str.replace(/\\(\w)/g,UIUtils._getReplaceStr)},UIUtils.getBindFun=function(value){var fun=UIUtils._funMap.get(value);if(null==fun){var temp='"'+value+'"',str="(function(data){if(data==null)return;with(data){try{\nreturn "+(temp=temp.replace(/^"\${|}"$/g,"").replace(/\${/g,'"+').replace(/}/g,'+"'))+"\n}catch(e){}}})";fun=Laya._runScript(str),UIUtils._funMap.set(value,fun)}return fun},__static(UIUtils,["grayFilter",function(){return this.grayFilter=new ColorFilter([.3086,.6094,.082,0,0,.3086,.6094,.082,0,0,.3086,.6094,.082,0,0,0,0,0,1,0])},"escapeSequence",function(){return this.escapeSequence={"\\n":"\n","\\t":"\t"}},"_funMap",function(){return this._funMap=new WeakObject}]),UIUtils}()),CacheStyle=function(){function CacheStyle(){this.reset()}__class(CacheStyle,"laya.display.css.CacheStyle");var __proto=CacheStyle.prototype;return __proto.needBitmapCache=function(){return this.cacheForFilters||!!this.mask},__proto.needEnableCanvasRender=function(){return"none"!=this.userSetCache||this.cacheForFilters||!!this.mask},__proto.releaseContext=function(){this.canvas&&this.canvas.size&&(Pool.recover("CacheCanvas",this.canvas),this.canvas.size(0,0)),this.canvas=null},__proto.createContext=function(){if(!this.canvas){this.canvas=Pool.getItem("CacheCanvas")||new HTMLCanvas(!Render.isWebGL);var tx=this.canvas.context;tx||(tx=this.canvas.getContext("2d"))}},__proto.releaseFilterCache=function(){var fc=this.filterCache;fc&&(fc.destroy(),fc.recycle(),this.filterCache=null)},__proto.recover=function(){this!==CacheStyle.EMPTY&&Pool.recover("SpriteCache",this.reset())},__proto.reset=function(){return this.releaseContext(),this.releaseFilterCache(),this.cacheAs="none",this.enableCanvasRender=!1,this.userSetCache="none",this.cacheForFilters=!1,this.staticCache=!1,this.reCache=!0,this.mask=null,this.maskParent=null,this.filterCache=null,this.filters=null,this.hasGlowFilter=!1,this.cacheRect&&this.cacheRect.recover(),this.cacheRect=null,this},__proto._calculateCacheRect=function(sprite,tCacheType,x,y){var bWebGL=!1;(Render.isWebGL||Render.isConchApp)&&(bWebGL=!0);var tRec,_cacheStyle=sprite._cacheStyle;_cacheStyle.cacheRect||(_cacheStyle.cacheRect=Rectangle.create()),bWebGL&&"bitmap"!==tCacheType?_cacheStyle.cacheRect.setTo(-sprite._style.pivotX,-sprite._style.pivotY,1,1):(tRec=sprite.getSelfBounds(),Render.isConchApp?(tRec.width=tRec.x+tRec.width+32,tRec.height=tRec.x+tRec.height+32):(tRec.width=tRec.width+32,tRec.height=tRec.height+32),tRec.x=tRec.x-sprite.pivotX,tRec.y=tRec.y-sprite.pivotY,tRec.x=tRec.x-16,tRec.y=tRec.y-16,tRec.x=Math.floor(tRec.x+x)-x,tRec.y=Math.floor(tRec.y+y)-y,tRec.width=Math.floor(tRec.width),tRec.height=Math.floor(tRec.height),_cacheStyle.cacheRect.copyFrom(tRec)),tRec=_cacheStyle.cacheRect;var scaleX=bWebGL?1:Browser.pixelRatio*Laya.stage.clientScaleX,scaleY=bWebGL?1:Browser.pixelRatio*Laya.stage.clientScaleY;if(!bWebGL){var tar,chainScaleX=1,chainScaleY=1;for(tar=sprite;tar&&tar!=Laya.stage;)chainScaleX*=tar.scaleX,chainScaleY*=tar.scaleY,tar=tar.parent;chainScaleX>1&&(scaleX*=chainScaleX),chainScaleY>1&&(scaleY*=chainScaleY)}if(sprite._style.scrollRect){var scrollRect=sprite._style.scrollRect;tRec.x-=scrollRect.x,tRec.y-=scrollRect.y}return CacheStyle._scaleInfo.setTo(scaleX,scaleY),CacheStyle._scaleInfo},CacheStyle.create=function(){return Pool.getItemByClass("SpriteCache",CacheStyle)},CacheStyle.EMPTY=new CacheStyle,CacheStyle.CANVAS_EXTEND_EDGE=16,__static(CacheStyle,["_scaleInfo",function(){return this._scaleInfo=new Point}]),CacheStyle}(),Point=function(){function Point(x,y){void 0===x&&(x=0),void 0===y&&(y=0),this.x=x,this.y=y}__class(Point,"laya.maths.Point");var __proto=Point.prototype;return __proto.setTo=function(x,y){return this.x=x,this.y=y,this},__proto.reset=function(){return this.x=this.y=0,this},__proto.recover=function(){Pool.recover("Point",this.reset())},__proto.distance=function(x,y){return Math.sqrt((this.x-x)*(this.x-x)+(this.y-y)*(this.y-y))},__proto.toString=function(){return this.x+","+this.y},__proto.normalize=function(){var d=Math.sqrt(this.x*this.x+this.y*this.y);if(d>0){var id=1/d;this.x*=id,this.y*=id}},__proto.copy=function(point){return this.setTo(point.x,point.y)},Point.create=function(){return Pool.getItemByClass("Point",Point)},Point.TEMP=new Point,Point.EMPTY=new Point,Point}(),Context=function(){function Context(){}__class(Context,"laya.resource.Context");var __proto=Context.prototype;return __proto.drawCanvas=function(canvas,x,y,width,height){Stat.renderBatch++,this.drawImage(canvas._source,x,y,width,height)},__proto._drawRect=function(x,y,width,height,style){Stat.renderBatch++,style&&(this.fillStyle=style),this.fillRect(x,y,width,height)},__proto.drawText=function(text,x,y,font,color,textAlign){Stat.renderBatch++,arguments.length>3&&null!=font&&(this.font=font,this.fillStyle=color,this.textAlign=textAlign,this.textBaseline="top"),this.fillText(text,x,y)},__proto.fillBorderText=function(text,x,y,font,fillColor,borderColor,lineWidth,textAlign){Stat.renderBatch++,this.font=font,this.fillStyle=fillColor,this.textBaseline="top",this.strokeStyle=borderColor,this.lineWidth=lineWidth,this.textAlign=textAlign,this.strokeText(text,x,y),this.fillText(text,x,y)},__proto.fillWords=function(words,x,y,font,color){font&&(this.font=font),color&&(this.fillStyle=color),this.textBaseline="top",this.textAlign="left";for(var i=0,n=words.length;i<n;i++){var a=words[i];this.fillText(a.char,a.x+x,a.y+y)}},__proto.fillBorderWords=function(words,x,y,font,color,borderColor,lineWidth){font&&(this.font=font),color&&(this.fillStyle=color),this.textBaseline="top",this.lineWidth=lineWidth,this.textAlign="left",this.strokeStyle=borderColor;for(var i=0,n=words.length;i<n;i++){var a=words[i];this.strokeText(a.char,a.x+x,a.y+y),this.fillText(a.char,a.x+x,a.y+y)}},__proto.strokeWord=function(text,x,y,font,color,lineWidth,textAlign){Stat.renderBatch++,arguments.length>3&&null!=font&&(this.font=font,this.strokeStyle=color,this.lineWidth=lineWidth,this.textAlign=textAlign,this.textBaseline="top"),this.strokeText(text,x,y)},__proto.setTransformByMatrix=function(value){this.setTransform(value.a,value.b,value.c,value.d,value.tx,value.ty)},__proto.clipRect=function(x,y,width,height){Stat.renderBatch++,this.beginPath(),this.rect(x,y,width,height),this.clip()},__proto.drawTextureWithTransform=function(tex,tx,ty,width,height,m,gx,gy,alpha,blendMode,colorfilter){if(tex._getSource()){Stat.renderBatch++;var alphaChanged=1!==alpha;if(alphaChanged){var temp=this.globalAlpha;this.globalAlpha*=alpha}blendMode&&(this.globalCompositeOperation=blendMode);var uv=tex.uv,w=tex.bitmap._width,h=tex.bitmap._height;m?(this.save(),this.transform(m.a,m.b,m.c,m.d,m.tx+gx,m.ty+gy),this.drawImage(tex.bitmap._source,uv[0]*w,uv[1]*h,(uv[2]-uv[0])*w,(uv[5]-uv[3])*h,tx,ty,width,height),this.restore()):this.drawImage(tex.bitmap._source,uv[0]*w,uv[1]*h,(uv[2]-uv[0])*w,(uv[5]-uv[3])*h,gx+tx,gy+ty,width,height),alphaChanged&&(this.globalAlpha=temp),blendMode&&(this.globalCompositeOperation="source-over")}},__proto.drawTexture2=function(x,y,pivotX,pivotY,m,args2){var tex=args2[0];Stat.renderBatch++;var uv=tex.uv,w=tex.bitmap._width,h=tex.bitmap._height;m?(this.save(),this.transform(m.a,m.b,m.c,m.d,m.tx+x,m.ty+y),this.drawImage(tex.bitmap._source,uv[0]*w,uv[1]*h,(uv[2]-uv[0])*w,(uv[5]-uv[3])*h,args2[1]-pivotX,args2[2]-pivotY,args2[3],args2[4]),this.restore()):this.drawImage(tex.bitmap._source,uv[0]*w,uv[1]*h,(uv[2]-uv[0])*w,(uv[5]-uv[3])*h,args2[1]-pivotX+x,args2[2]-pivotY+y,args2[3],args2[4])},__proto.fillTexture=function(texture,x,y,width,height,type,offset,other){if(!other.pat){if(texture.uv!=Texture.DEF_UV){var canvas=new HTMLCanvas;canvas.getContext("2d"),canvas.size(texture.width,texture.height),canvas.context.drawTexture(texture,0,0,texture.width,texture.height),texture=new Texture(canvas)}other.pat=this.createPattern(texture.bitmap._source,type)}var oX=x,oY=y,sX=0,sY=0;offset&&(oX+=offset.x%texture.width,oY+=offset.y%texture.height,sX-=offset.x%texture.width,sY-=offset.y%texture.height),this.translate(oX,oY),this._drawRect(sX,sY,width,height,other.pat),this.translate(-oX,-oY)},__proto.flush=function(){return 0},__proto.destroy=function(){this.canvas.width=this.canvas.height=0},__proto.clear=function(){Render.isConchApp||this.clearRect(0,0,Render._mainCanvas.width,Render._mainCanvas.height)},__proto.drawTriangle=function(texture,vertices,uvs,index0,index1,index2,matrix,canvasPadding){var source=texture.bitmap,textureSource=source._getSource(),textureWidth=texture.width,textureHeight=texture.height,sourceWidth=source.width,sourceHeight=source.height,u0=uvs[index0]*sourceWidth,u1=uvs[index1]*sourceWidth,u2=uvs[index2]*sourceWidth,v0=uvs[index0+1]*sourceHeight,v1=uvs[index1+1]*sourceHeight,v2=uvs[index2+1]*sourceHeight,x0=vertices[index0],x1=vertices[index1],x2=vertices[index2],y0=vertices[index0+1],y1=vertices[index1+1],y2=vertices[index2+1];if(canvasPadding){var centerX=(x0+x1+x2)/3,centerY=(y0+y1+y2)/3,normX=x0-centerX,normY=y0-centerY,dist=Math.sqrt(normX*normX+normY*normY);x0=centerX+normX/dist*(dist+1),y0=centerY+normY/dist*(dist+1),normY=y1-centerY,x1=centerX+(normX=x1-centerX)/(dist=Math.sqrt(normX*normX+normY*normY))*(dist+1),y1=centerY+normY/dist*(dist+1),normY=y2-centerY,x2=centerX+(normX=x2-centerX)/(dist=Math.sqrt(normX*normX+normY*normY))*(dist+1),y2=centerY+normY/dist*(dist+1)}this.save(),matrix&&this.transform(matrix.a,matrix.b,matrix.c,matrix.d,matrix.tx,matrix.ty),this.beginPath(),this.moveTo(x0,y0),this.lineTo(x1,y1),this.lineTo(x2,y2),this.closePath(),this.clip();var dDelta=1/(u0*v1+v0*u2+u1*v2-v1*u2-v0*u1-u0*v2),deltaA=x0*v1+v0*x2+x1*v2-v1*x2-v0*x1-x0*v2,deltaB=u0*x1+x0*u2+u1*x2-x1*u2-x0*u1-u0*x2,deltaC=u0*v1*x2+v0*x1*u2+x0*u1*v2-x0*v1*u2-v0*u1*x2-u0*x1*v2,deltaD=y0*v1+v0*y2+y1*v2-v1*y2-v0*y1-y0*v2,deltaE=u0*y1+y0*u2+u1*y2-y1*u2-y0*u1-u0*y2,deltaF=u0*v1*y2+v0*y1*u2+y0*u1*v2-y0*v1*u2-v0*u1*y2-u0*y1*v2;this.transform(deltaA*dDelta,deltaD*dDelta,deltaB*dDelta,deltaE*dDelta,deltaC*dDelta,deltaF*dDelta),this.drawImage(textureSource,texture.uv[0]*sourceWidth,texture.uv[1]*sourceHeight,textureWidth,textureHeight,texture.uv[0]*sourceWidth,texture.uv[1]*sourceHeight,textureWidth,textureHeight),this.restore()},__proto.transformByMatrix=function(matrix,tx,ty){this.transform(matrix.a,matrix.b,matrix.c,matrix.d,matrix.tx+tx,matrix.ty+ty)},__proto.saveTransform=function(matrix){this.save()},__proto.restoreTransform=function(matrix){this.restore()},__proto.drawRect=function(x,y,width,height,fillColor,lineColor,lineWidth){null!=fillColor&&(this.fillStyle=fillColor,this.fillRect(x,y,width,height)),null!=lineColor&&(this.strokeStyle=lineColor,this.lineWidth=lineWidth,this.strokeRect(x,y,width,height))},__proto.drawTexture=function(tex,x,y,width,height){var source=tex._getSource();if(source){Stat.renderBatch++;var uv=tex.uv,w=tex.bitmap.width,h=tex.bitmap.height;this.drawImage(source,uv[0]*w,uv[1]*h,(uv[2]-uv[0])*w,(uv[5]-uv[3])*h,x,y,width,height)}},__proto.drawTextures=function(tex,pos,tx,ty){Stat.renderBatch+=pos.length/2;for(var w=tex.width,h=tex.height,i=0,sz=pos.length;i<sz;i+=2)this.drawTexture(tex,pos[i]+tx,pos[i+1]+ty,w,h)},__proto.drawTriangles=function(texture,x,y,vertices,uvs,indices,matrix,alpha,color,blendMode){var i=0,len=indices.length;for(this.translate(x,y),i=0;i<len;i+=3){var index0=2*indices[i],index1=2*indices[i+1],index2=2*indices[i+2];this.drawTriangle(texture,vertices,uvs,index0,index1,index2,matrix,!0)}this.translate(-x,-y)},__proto.alpha=function(value){this.globalAlpha*=value},__proto._transform=function(mat,pivotX,pivotY){this.translate(pivotX,pivotY),this.transform(mat.a,mat.b,mat.c,mat.d,mat.tx,mat.ty),this.translate(-pivotX,-pivotY)},__proto._rotate=function(angle,pivotX,pivotY){this.translate(pivotX,pivotY),this.rotate(angle),this.translate(-pivotX,-pivotY)},__proto._scale=function(scaleX,scaleY,pivotX,pivotY){this.translate(pivotX,pivotY),this.scale(scaleX,scaleY),this.translate(-pivotX,-pivotY)},__proto._drawLine=function(x,y,fromX,fromY,toX,toY,lineColor,lineWidth,vid){this.beginPath(),this.strokeStyle=lineColor,this.lineWidth=lineWidth,this.moveTo(x+fromX,y+fromY),this.lineTo(x+toX,y+toY),this.stroke()},__proto._drawLines=function(x,y,points,lineColor,lineWidth,vid){Render.isWebGL&&this.setPathId(vid),this.beginPath(),this.strokeStyle=lineColor,this.lineWidth=lineWidth;var i=2,n=points.length;if(Render.isWebGL)this.addPath(points.slice(),!1,!1,x,y);else for(this.moveTo(x+points[0],y+points[1]);i<n;)this.lineTo(x+points[i++],y+points[i++]);this.stroke()},__proto.drawCurves=function(x,y,points,lineColor,lineWidth){this.beginPath(),this.strokeStyle=lineColor,this.lineWidth=lineWidth,this.moveTo(x+points[0],y+points[1]);for(var i=2,n=points.length;i<n;)this.quadraticCurveTo(x+points[i++],y+points[i++],x+points[i++],y+points[i++]);this.stroke()},__proto._fillAndStroke=function(fillColor,strokeColor,lineWidth,isConvexPolygon){void 0===isConvexPolygon&&(isConvexPolygon=!1),null!=fillColor&&(this.fillStyle=fillColor,this.fill()),null!=strokeColor&&lineWidth>0&&(this.strokeStyle=strokeColor,this.lineWidth=lineWidth,this.stroke())},__proto._drawCircle=function(x,y,radius,fillColor,lineColor,lineWidth,vid){Stat.renderBatch++,Render.isWebGL?this.beginPath(!0):this.beginPath(),this.arc(x,y,radius,0,Context.PI2),this.closePath(),this._fillAndStroke(fillColor,lineColor,lineWidth)},__proto._drawPie=function(x,y,radius,startAngle,endAngle,fillColor,lineColor,lineWidth,vid){this.beginPath(),this.moveTo(x,y),this.arc(x,y,radius,startAngle,endAngle),this.closePath(),this._fillAndStroke(fillColor,lineColor,lineWidth)},__proto._drawPoly=function(x,y,points,fillColor,lineColor,lineWidth,isConvexPolygon,vid){var i=2,n=points.length;if(this.beginPath(),Render.isWebGL)this.setPathId(vid),this.addPath(points.slice(),!0,isConvexPolygon,x,y);else for(this.moveTo(x+points[0],y+points[1]);i<n;)this.lineTo(x+points[i++],y+points[i++]);this.closePath(),this._fillAndStroke(fillColor,lineColor,lineWidth,isConvexPolygon)},__proto._drawPath=function(x,y,paths,brush,pen){this.beginPath();for(var i=0,n=paths.length;i<n;i++){var path=paths[i];switch(path[0]){case"moveTo":this.moveTo(x+path[1],y+path[2]);break;case"lineTo":this.lineTo(x+path[1],y+path[2]);break;case"arcTo":this.arcTo(x+path[1],y+path[2],x+path[3],y+path[4],path[5]);break;case"closePath":this.closePath()}}null!=brush&&(this.fillStyle=brush.fillStyle,this.fill()),null!=pen&&(this.strokeStyle=pen.strokeStyle,this.lineWidth=pen.lineWidth||1,this.lineJoin=pen.lineJoin,this.lineCap=pen.lineCap,this.miterLimit=pen.miterLimit,this.stroke())},__proto.drawParticle=function(x,y,pt){},Context.__init__=function(to){var from=laya.resource.Context.prototype;(to=to||CanvasRenderingContext2D.prototype).init2d||(to.init2d=!0,["saveTransform","restoreTransform","transformByMatrix","drawTriangles","drawTriangle","drawTextures","fillWords","fillBorderWords","drawRect","strokeWord","drawText","fillTexture","setTransformByMatrix","clipRect","drawTexture","drawTexture2","drawTextureWithTransform","flush","clear","destroy","drawCanvas","fillBorderText","drawCurves","_drawRect","alpha","_transform","_rotate","_scale","_drawLine","_drawLines","_drawCircle","_fillAndStroke","_drawPie","_drawPoly","_drawPath","drawTextureWithTransform"].forEach(function(i){to[i]=from[i]}))},Context.ENUM_TEXTALIGN_DEFAULT=0,Context.ENUM_TEXTALIGN_CENTER=1,Context.ENUM_TEXTALIGN_RIGHT=2,Context.PI2=2*Math.PI,Context}(),VectorGraphManager=function(){function VectorGraphManager(){this.useDic={},this.shapeDic={},this.shapeLineDic={},this._id=0,this._checkKey=!1,this._freeIdArray=[],Render.isWebGL&&CacheManger.regCacheByFunction(Utils.bind(this.startDispose,this),Utils.bind(this.getCacheList,this))}__class(VectorGraphManager,"laya.utils.VectorGraphManager");var __proto=VectorGraphManager.prototype;return __proto.getId=function(){return this._id++},__proto.addShape=function(id,shape){this.shapeDic[id]=shape,this.useDic[id]||(this.useDic[id]=!0)},__proto.addLine=function(id,Line){this.shapeLineDic[id]=Line,this.shapeLineDic[id]||(this.shapeLineDic[id]=!0)},__proto.getShape=function(id){this._checkKey&&null!=this.useDic[id]&&(this.useDic[id]=!0)},__proto.deleteShape=function(id){this.shapeDic[id]&&(this.shapeDic[id]=null,delete this.shapeDic[id]),this.shapeLineDic[id]&&(this.shapeLineDic[id]=null,delete this.shapeLineDic[id]),null!=this.useDic[id]&&delete this.useDic[id]},__proto.getCacheList=function(){var str,list=[];for(str in this.shapeDic)list.push(this.shapeDic[str]);for(str in this.shapeLineDic)list.push(this.shapeLineDic[str]);return list},__proto.startDispose=function(key){var str;for(str in this.useDic)this.useDic[str]=!1;this._checkKey=!0},__proto.endDispose=function(){if(this._checkKey){var str;for(str in this.useDic)this.useDic[str]||this.deleteShape(str);this._checkKey=!1}},VectorGraphManager.getInstance=function(){return VectorGraphManager.instance=VectorGraphManager.instance||new VectorGraphManager},VectorGraphManager.instance=null,VectorGraphManager}(),SceneUtils=function(){var DataWatcher,InitTool;function SceneUtils(){}return __class(SceneUtils,"laya.utils.SceneUtils"),SceneUtils.getBindFun=function(value){var fun=SceneUtils._funMap.get(value);if(null==fun){var temp='"'+value+'"',str="(function(data){if(data==null)return;with(data){try{\nreturn "+(temp=temp.replace(/^"\${|}"$/g,"").replace(/\${/g,'"+').replace(/}/g,'+"'))+"\n}catch(e){}}})";fun=Laya._runScript(str),SceneUtils._funMap.set(value,fun)}return fun},SceneUtils.createByData=function(root,uiView){var tInitTool=InitTool.create();return(root=SceneUtils.createComp(uiView,root,root,null,tInitTool))._setBit(8,!0),root.hasOwnProperty("_idMap")&&(root._idMap=tInitTool._idMap),uiView.animations&&uiView.animations.length,"Scene"===root._$componentType&&root._width>0&&null==uiView.props.hitTestPrior&&!root.mouseThrough&&(root.hitTestPrior=!0),tInitTool.beginLoad(root),root},SceneUtils.createInitTool=function(){return InitTool.create()},SceneUtils.createComp=function(uiView,comp,view,dataMap,initTool){if("Scene3D"==uiView.type||"Sprite3D"==uiView.type){var outBatchSprits=[],scene3D=Laya.Utils3D._createSceneByJsonForMaker(uiView,outBatchSprits,initTool);return"Sprite3D"==uiView.type?Laya.StaticBatchManager.combine(scene3D,outBatchSprits):Laya.StaticBatchManager.combine(null,outBatchSprits),scene3D}if(!(comp=comp||SceneUtils.getCompInstance(uiView)))return uiView.props&&uiView.props.runtime?console.warn("runtime not found:"+uiView.props.runtime):console.warn("can not create:"+uiView.type),null;var child=uiView.child;if(child)for(var isList="List"==comp._$componentType,i=0,n=child.length;i<n;i++){var node=child[i];if(!comp.hasOwnProperty("itemRender")||"render"!=node.props.name&&"render"!==node.props.renderType)if("Graphic"==node.type)ClassUtils._addGraphicsToSprite(node,comp);else if(ClassUtils._isDrawType(node.type))ClassUtils._addGraphicToSprite(node,comp,!0);else{if(isList){var arr=[],tChild=SceneUtils.createComp(node,null,view,arr,initTool);arr.length&&(tChild._$bindData=arr)}else tChild=SceneUtils.createComp(node,null,view,dataMap,initTool);"Script"==node.type?tChild instanceof laya.components.Component?comp._addComponentInstance(tChild):"owner"in tChild?tChild.owner=comp:"target"in tChild&&(tChild.target=comp):"mask"==node.props.renderType||"mask"==node.props.name?comp.mask=tChild:tChild instanceof laya.display.Node&&comp.addChild(tChild)}else comp.itemRender=node}var props=uiView.props;for(var prop in props){var value=props[prop];"string"==typeof value&&(value.indexOf("@node:")>=0||value.indexOf("@Prefab:")>=0)?initTool&&initTool.addNodeRef(comp,prop,value):SceneUtils.setCompValue(comp,prop,value,view,dataMap)}return comp._afterInited&&comp._afterInited(),uiView.compId&&initTool&&initTool._idMap&&(initTool._idMap[uiView.compId]=comp),comp},SceneUtils.setCompValue=function(comp,prop,value,view,dataMap){if("string"==typeof value&&value.indexOf("${")>-1){if(SceneUtils._sheet||(SceneUtils._sheet=ClassUtils.getClass("laya.data.Table")),!SceneUtils._sheet)return void console.warn("Can not find class Sheet");if(dataMap)dataMap.push(comp,prop,value);else if(view){-1==value.indexOf("].")&&(value=value.replace(".","[0]."));var one,temp,watcher=new DataWatcher(comp,prop,value);watcher.exe(view);for(var str=value.replace(/\[.*?\]\./g,".");null!=(one=SceneUtils._parseWatchData.exec(str));){for(var key1=one[1];null!=(temp=SceneUtils._parseKeyWord.exec(key1));){var key2=temp[0],arr=view._watchMap[key2]||(view._watchMap[key2]=[]);arr.push(watcher),SceneUtils._sheet.I.notifer.on(key2,view,view.changeData,[key2])}(arr=view._watchMap[key1]||(view._watchMap[key1]=[])).push(watcher),SceneUtils._sheet.I.notifer.on(key1,view,view.changeData,[key1])}}}else"var"===prop&&view?view[value]=comp:comp[prop]="true"===value||"false"!==value&&value},SceneUtils.getCompInstance=function(json){if("UIView"==json.type&&json.props&&json.props.pageData)return SceneUtils.createByData(null,json.props.pageData);var runtime=json.props&&json.props.runtime||json.type,compClass=ClassUtils.getClass(runtime);if(!compClass)throw"Can not find class "+runtime;if("Script"===json.type&&compClass.prototype._doAwake){var comp=Pool.createByClass(compClass);return comp._destroyed=!1,comp}return json.props&&json.props.hasOwnProperty("renderType")&&"instance"==json.props.renderType?(compClass.instance||(compClass.instance=new compClass),compClass.instance):new compClass},SceneUtils._sheet=null,__static(SceneUtils,["_funMap",function(){return this._funMap=new WeakObject},"_parseWatchData",function(){return this._parseWatchData=/\${(.*?)}/g},"_parseKeyWord",function(){return this._parseKeyWord=/[a-zA-Z_][a-zA-Z0-9_]*(?:(?:\.[a-zA-Z_][a-zA-Z0-9_]*)+)/g}]),SceneUtils.__init$=function(){DataWatcher=function(){function DataWatcher(comp,prop,value){this.comp=null,this.prop=null,this.value=null,this.comp=comp,this.prop=prop,this.value=value}return __class(DataWatcher,""),DataWatcher.prototype.exe=function(view){var fun=SceneUtils.getBindFun(this.value);this.comp[this.prop]=fun.call(this,view)},DataWatcher}(),InitTool=function(){function InitTool(){this._nodeRefList=null,this._initList=null,this._loadList=null,this._idMap=null,this._scene=null}__class(InitTool,"");var __proto=InitTool.prototype;return __proto.reset=function(){this._nodeRefList=null,this._initList=null,this._idMap=null,this._loadList=null,this._scene=null},__proto.recover=function(){this.reset(),Pool.recover("InitTool",this)},__proto.addLoadRes=function(url,type){this._loadList||(this._loadList=[]),type?this._loadList.push({url:url,type:type}):this._loadList.push(url)},__proto.addNodeRef=function(node,prop,referStr){this._nodeRefList||(this._nodeRefList=[]),this._nodeRefList.push([node,prop,referStr]),referStr.indexOf("@Prefab:")>=0&&this.addLoadRes(referStr.replace("@Prefab:",""),"prefab")},__proto.setNodeRef=function(){if(this._nodeRefList)if(this._idMap){var len,tRefInfo,i=0;for(len=this._nodeRefList.length,i=0;i<len;i++)(tRefInfo=this._nodeRefList[i])[0][tRefInfo[1]]=this.getReferData(tRefInfo[2]);this._nodeRefList=null}else this._nodeRefList=null},__proto.getReferData=function(referStr){if(referStr.indexOf("@Prefab:")>=0)return Loader.getRes(referStr.replace("@Prefab:",""));if(referStr.indexOf("@arr:")>=0){var list,len,tStr,i=0;for(len=(list=(referStr=referStr.replace("@arr:","")).split(",")).length,i=0;i<len;i++)tStr=list[i],list[i]=tStr?this._idMap[tStr.replace("@node:","")]:null;return list}return this._idMap[referStr.replace("@node:","")]},__proto.addInitItem=function(item){this._initList||(this._initList=[]),this._initList.push(item)},__proto.doInits=function(){this._initList&&(this._initList=null)},__proto.finish=function(){this.setNodeRef(),this.doInits(),this._scene._setBit(8,!1),this._scene.parent&&this._scene.parent.activeInHierarchy&&this._scene.active&&this._scene._processActive(),this._scene.event("onViewCreated"),this.recover()},__proto.beginLoad=function(scene){this._scene=scene,!this._loadList||this._loadList.length<1?this.finish():Laya.loader.load(this._loadList,Handler.create(this,this.finish))},InitTool.create=function(){var tool=Pool.getItemByClass("InitTool",InitTool);return tool._idMap=[],tool},InitTool}()},SceneUtils}(),FillTextCmd=function(){function FillTextCmd(){this._textIsWorldText=!1,this._fontColor=4294967295,this._strokeColor=0,this._nTexAlign=0,this._fontObj=FillTextCmd._defFontObj}__class(FillTextCmd,"laya.display.cmd.FillTextCmd");var __proto=FillTextCmd.prototype;return __proto.recover=function(){Pool.recover("FillTextCmd",this)},__proto.run=function(context,gx,gy){Laya.stage.isGlobalRepaint()&&this._textIsWorldText&&this._text.cleanCache(),this._textIsWorldText&&context._fast_filltext?context._fast_filltext(this._text,this.x+gx,this.y+gy,this._fontObj,this._color,null,0,this._nTexAlign,0):context.drawText(this._text,this.x+gx,this.y+gy,this._font,this._color,this._textAlign)},__getset(0,__proto,"text",function(){return this._text},function(value){this._text=value,this._textIsWorldText=value instanceof laya.utils.WordText,this._textIsWorldText&&this._text.cleanCache()}),__getset(0,__proto,"cmdID",function(){return"FillText"}),__getset(0,__proto,"color",function(){return this._color},function(value){this._color=value,this._fontColor=ColorUtils.create(value).numColor,this._textIsWorldText&&this._text.cleanCache()}),__getset(0,__proto,"font",function(){return this._font},function(value){this._font=value,(Render.isWebGL||Render.isConchApp)&&(this._fontObj=FontInfo.Parse(value)),this._textIsWorldText&&this._text.cleanCache()}),__getset(0,__proto,"textAlign",function(){return this._textAlign},function(value){switch(this._textAlign=value,value){case"center":this._nTexAlign=Context.ENUM_TEXTALIGN_CENTER;break;case"right":this._nTexAlign=Context.ENUM_TEXTALIGN_RIGHT;break;default:this._nTexAlign=Context.ENUM_TEXTALIGN_DEFAULT}this._textIsWorldText&&this._text.cleanCache()}),FillTextCmd.create=function(text,x,y,font,color,textAlign){var cmd=Pool.getItemByClass("FillTextCmd",FillTextCmd);return cmd.text=text,cmd._textIsWorldText=text instanceof laya.utils.WordText,cmd.x=x,cmd.y=y,cmd.font=font,cmd.color=color,cmd.textAlign=textAlign,cmd},FillTextCmd.ID="FillText",__static(FillTextCmd,["_defFontObj",function(){return this._defFontObj=new FontInfo(null)}]),FillTextCmd}(),Ease=function(){function Ease(){}return __class(Ease,"laya.utils.Ease"),Ease.linearNone=function(t,b,c,d){return c*t/d+b},Ease.linearIn=function(t,b,c,d){return c*t/d+b},Ease.linearInOut=function(t,b,c,d){return c*t/d+b},Ease.linearOut=function(t,b,c,d){return c*t/d+b},Ease.bounceIn=function(t,b,c,d){return c-Ease.bounceOut(d-t,0,c,d)+b},Ease.bounceInOut=function(t,b,c,d){return t<.5*d?.5*Ease.bounceIn(2*t,0,c,d)+b:.5*Ease.bounceOut(2*t-d,0,c,d)+.5*c+b},Ease.bounceOut=function(t,b,c,d){return(t/=d)<1/2.75?c*(7.5625*t*t)+b:t<2/2.75?c*(7.5625*(t-=1.5/2.75)*t+.75)+b:t<2.5/2.75?c*(7.5625*(t-=2.25/2.75)*t+.9375)+b:c*(7.5625*(t-=2.625/2.75)*t+.984375)+b},Ease.backIn=function(t,b,c,d,s){return void 0===s&&(s=1.70158),c*(t/=d)*t*((s+1)*t-s)+b},Ease.backInOut=function(t,b,c,d,s){return void 0===s&&(s=1.70158),(t/=.5*d)<1?.5*c*(t*t*((1+(s*=1.525))*t-s))+b:c/2*((t-=2)*t*((1+(s*=1.525))*t+s)+2)+b},Ease.backOut=function(t,b,c,d,s){return void 0===s&&(s=1.70158),c*((t=t/d-1)*t*((s+1)*t+s)+1)+b},Ease.elasticIn=function(t,b,c,d,a,p){var s;return void 0===a&&(a=0),void 0===p&&(p=0),0==t?b:1==(t/=d)?b+c:(p||(p=.3*d),!a||c>0&&a<c||c<0&&a<-c?(a=c,s=p/4):s=p/Ease.PI2*Math.asin(c/a),-a*Math.pow(2,10*(t-=1))*Math.sin((t*d-s)*Ease.PI2/p)+b)},Ease.elasticInOut=function(t,b,c,d,a,p){var s;return void 0===a&&(a=0),void 0===p&&(p=0),0==t?b:2==(t/=.5*d)?b+c:(p||(p=d*(.3*1.5)),!a||c>0&&a<c||c<0&&a<-c?(a=c,s=p/4):s=p/Ease.PI2*Math.asin(c/a),t<1?a*Math.pow(2,10*(t-=1))*Math.sin((t*d-s)*Ease.PI2/p)*-.5+b:a*Math.pow(2,-10*(t-=1))*Math.sin((t*d-s)*Ease.PI2/p)*.5+c+b)},Ease.elasticOut=function(t,b,c,d,a,p){var s;return void 0===a&&(a=0),void 0===p&&(p=0),0==t?b:1==(t/=d)?b+c:(p||(p=.3*d),!a||c>0&&a<c||c<0&&a<-c?(a=c,s=p/4):s=p/Ease.PI2*Math.asin(c/a),a*Math.pow(2,-10*t)*Math.sin((t*d-s)*Ease.PI2/p)+c+b)},Ease.strongIn=function(t,b,c,d){return c*(t/=d)*t*t*t*t+b},Ease.strongInOut=function(t,b,c,d){return(t/=.5*d)<1?.5*c*t*t*t*t*t+b:.5*c*((t-=2)*t*t*t*t+2)+b},Ease.strongOut=function(t,b,c,d){return c*((t=t/d-1)*t*t*t*t+1)+b},Ease.sineInOut=function(t,b,c,d){return.5*-c*(Math.cos(Math.PI*t/d)-1)+b},Ease.sineIn=function(t,b,c,d){return-c*Math.cos(t/d*Ease.HALF_PI)+c+b},Ease.sineOut=function(t,b,c,d){return c*Math.sin(t/d*Ease.HALF_PI)+b},Ease.quintIn=function(t,b,c,d){return c*(t/=d)*t*t*t*t+b},Ease.quintInOut=function(t,b,c,d){return(t/=.5*d)<1?.5*c*t*t*t*t*t+b:.5*c*((t-=2)*t*t*t*t+2)+b},Ease.quintOut=function(t,b,c,d){return c*((t=t/d-1)*t*t*t*t+1)+b},Ease.quartIn=function(t,b,c,d){return c*(t/=d)*t*t*t+b},Ease.quartInOut=function(t,b,c,d){return(t/=.5*d)<1?.5*c*t*t*t*t+b:.5*-c*((t-=2)*t*t*t-2)+b},Ease.quartOut=function(t,b,c,d){return-c*((t=t/d-1)*t*t*t-1)+b},Ease.cubicIn=function(t,b,c,d){return c*(t/=d)*t*t+b},Ease.cubicInOut=function(t,b,c,d){return(t/=.5*d)<1?.5*c*t*t*t+b:.5*c*((t-=2)*t*t+2)+b},Ease.cubicOut=function(t,b,c,d){return c*((t=t/d-1)*t*t+1)+b},Ease.quadIn=function(t,b,c,d){return c*(t/=d)*t+b},Ease.quadInOut=function(t,b,c,d){return(t/=.5*d)<1?.5*c*t*t+b:.5*-c*(--t*(t-2)-1)+b},Ease.quadOut=function(t,b,c,d){return-c*(t/=d)*(t-2)+b},Ease.expoIn=function(t,b,c,d){return 0==t?b:c*Math.pow(2,10*(t/d-1))+b-.001*c},Ease.expoInOut=function(t,b,c,d){return 0==t?b:t==d?b+c:(t/=.5*d)<1?.5*c*Math.pow(2,10*(t-1))+b:.5*c*(2-Math.pow(2,-10*--t))+b},Ease.expoOut=function(t,b,c,d){return t==d?b+c:c*(1-Math.pow(2,-10*t/d))+b},Ease.circIn=function(t,b,c,d){return-c*(Math.sqrt(1-(t/=d)*t)-1)+b},Ease.circInOut=function(t,b,c,d){return(t/=.5*d)<1?.5*-c*(Math.sqrt(1-t*t)-1)+b:.5*c*(Math.sqrt(1-(t-=2)*t)+1)+b},Ease.circOut=function(t,b,c,d){return c*Math.sqrt(1-(t=t/d-1)*t)+b},Ease.HALF_PI=.5*Math.PI,Ease.PI2=2*Math.PI,Ease}(),HitArea=function(){function HitArea(){this._hit=null,this._unHit=null}__class(HitArea,"laya.utils.HitArea");var __proto=HitArea.prototype;return __proto.contains=function(x,y){return!!HitArea._isHitGraphic(x,y,this.hit)&&!HitArea._isHitGraphic(x,y,this.unHit)},__getset(0,__proto,"hit",function(){return this._hit||(this._hit=new Graphics),this._hit},function(value){this._hit=value}),__getset(0,__proto,"unHit",function(){return this._unHit||(this._unHit=new Graphics),this._unHit},function(value){this._unHit=value}),HitArea._isHitGraphic=function(x,y,graphic){if(!graphic)return!1;var cmds=graphic.cmds;if(!cmds&&graphic._one&&((cmds=HitArea._cmds).length=1,cmds[0]=graphic._one),!cmds)return!1;var len,cmd,i=0;for(len=cmds.length,i=0;i<len;i++)if(cmd=cmds[i]){switch(cmd.cmdID){case"Translate":x-=cmd.tx,y-=cmd.ty}if(HitArea._isHitCmd(x,y,cmd))return!0}return!1},HitArea._isHitCmd=function(x,y,cmd){if(!cmd)return!1;var rst=!1;switch(cmd.cmdID){case"DrawRect":HitArea._rect.setTo(cmd.x,cmd.y,cmd.width,cmd.height),rst=HitArea._rect.contains(x,y);break;case"DrawCircle":rst=(x-=cmd.x)*x+(y-=cmd.y)*y<cmd.radius*cmd.radius;break;case"DrawPoly":x-=cmd.x,y-=cmd.y,rst=HitArea._ptInPolygon(x,y,cmd.points)}return rst},HitArea._ptInPolygon=function(x,y,areaPoints){var p=HitArea._ptPoint;p.setTo(x,y);var len,nCross=0,p1x=NaN,p1y=NaN,p2x=NaN,p2y=NaN;len=areaPoints.length;for(var i=0;i<len;i+=2)p1x=areaPoints[i],p1y=areaPoints[i+1],p2x=areaPoints[(i+2)%len],p1y!=(p2y=areaPoints[(i+3)%len])&&(p.y<Math.min(p1y,p2y)||p.y>=Math.max(p1y,p2y)||(p.y-p1y)*(p2x-p1x)/(p2y-p1y)+p1x>p.x&&nCross++);return nCross%2==1},HitArea._cmds=[],__static(HitArea,["_rect",function(){return this._rect=new Rectangle},"_ptPoint",function(){return this._ptPoint=new Point}]),HitArea}(),AtlasInfoManager=function(){function AtlasInfoManager(){}return __class(AtlasInfoManager,"laya.net.AtlasInfoManager"),AtlasInfoManager.enable=function(infoFile,callback){Laya.loader.load(infoFile,Handler.create(null,AtlasInfoManager._onInfoLoaded,[callback]),null,"json")},AtlasInfoManager._onInfoLoaded=function(callback,data){var tKey,tPrefix,tArr,i=0,len=0;for(tKey in data)for(tPrefix=(tArr=data[tKey])[0],len=(tArr=tArr[1]).length,i=0;i<len;i++)AtlasInfoManager._fileLoadDic[tPrefix+tArr[i]]=tKey;callback&&callback.run()},AtlasInfoManager.getFileLoadPath=function(file){return AtlasInfoManager._fileLoadDic[file]||file},AtlasInfoManager._fileLoadDic={},AtlasInfoManager}(),DrawTextureCmd=function(){function DrawTextureCmd(){}__class(DrawTextureCmd,"laya.display.cmd.DrawTextureCmd");var __proto=DrawTextureCmd.prototype;return __proto.recover=function(){this.texture._removeReference(),this.texture=null,this.matrix=null,Pool.recover("DrawTextureCmd",this)},__proto.run=function(context,gx,gy){context.drawTextureWithTransform(this.texture,this.x,this.y,this.width,this.height,this.matrix,gx,gy,this.alpha,this.blendMode,this.colorFlt)},__getset(0,__proto,"cmdID",function(){return"DrawTexture"}),DrawTextureCmd.create=function(texture,x,y,width,height,matrix,alpha,color,blendMode){var cmd=Pool.getItemByClass("DrawTextureCmd",DrawTextureCmd);return cmd.texture=texture,texture._addReference(),cmd.x=x,cmd.y=y,cmd.width=width,cmd.height=height,cmd.matrix=matrix,cmd.alpha=alpha,cmd.color=color,cmd.blendMode=blendMode,color&&(cmd.colorFlt=new ColorFilter,cmd.colorFlt.setColor(color)),cmd},DrawTextureCmd.ID="DrawTexture",DrawTextureCmd}(),WeakObject=function(){function WeakObject(){this._obj=null,this._obj=WeakObject.supportWeakMap?new Browser.window.WeakMap:{},WeakObject.supportWeakMap||WeakObject._maps.push(this)}__class(WeakObject,"laya.utils.WeakObject");var __proto=WeakObject.prototype;return __proto.set=function(key,value){if(null!=key)if(WeakObject.supportWeakMap){var objKey=key;"string"!=typeof key&&"number"!=typeof key||(objKey=WeakObject._keys[key])||(objKey=WeakObject._keys[key]={k:key}),this._obj.set(objKey,value)}else"string"==typeof key||"number"==typeof key?this._obj[key]=value:(key.$_GID||(key.$_GID=Utils.getGID()),this._obj[key.$_GID]=value)},__proto.get=function(key){if(null==key)return null;if(WeakObject.supportWeakMap){var objKey="string"==typeof key||"number"==typeof key?WeakObject._keys[key]:key;return objKey?this._obj.get(objKey):null}return"string"==typeof key||"number"==typeof key?this._obj[key]:this._obj[key.$_GID]},__proto.del=function(key){if(null!=key)if(WeakObject.supportWeakMap){var objKey="string"==typeof key||"number"==typeof key?WeakObject._keys[key]:key;if(!objKey)return;this._obj.delete(objKey)}else"string"==typeof key||"number"==typeof key?delete this._obj[key]:delete this._obj[this._obj.$_GID]},__proto.has=function(key){if(null==key)return!1;if(WeakObject.supportWeakMap){var objKey="string"==typeof key||"number"==typeof key?WeakObject._keys[key]:key;return this._obj.has(objKey)}return"string"==typeof key||"number"==typeof key?null!=this._obj[key]:null!=this._obj[this._obj.$_GID]},WeakObject.__init__=function(){WeakObject.supportWeakMap=null!=Browser.window.WeakMap,WeakObject.supportWeakMap||Laya.systemTimer.loop(WeakObject.delInterval,null,WeakObject.clearCache)},WeakObject.clearCache=function(){for(var i=0,n=WeakObject._maps.length;i<n;i++)WeakObject._maps[i]._obj={}},WeakObject.supportWeakMap=!1,WeakObject.delInterval=6e5,WeakObject._keys={},WeakObject._maps=[],__static(WeakObject,["I",function(){return this.I=new WeakObject}]),WeakObject}(),UIConfig=function(){function UIConfig(){}return __class(UIConfig,"UIConfig"),UIConfig.touchScrollEnable=!0,UIConfig.mouseWheelEnable=!0,UIConfig.showButtons=!0,UIConfig.popupBgColor="#000000",UIConfig.popupBgAlpha=.5,UIConfig.closeDialogOnSide=!0,UIConfig}(),Utils=(function(){function Mouse(){}__class(Mouse,"laya.utils.Mouse"),__getset(1,Mouse,"cursor",function(){return Mouse._style.cursor},function(cursorStr){Mouse._style.cursor=cursorStr}),Mouse.hide=function(){"none"!=Mouse.cursor&&(Mouse._preCursor=Mouse.cursor,Mouse.cursor="none")},Mouse.show=function(){"none"==Mouse.cursor&&(Mouse._preCursor?Mouse.cursor=Mouse._preCursor:Mouse.cursor="auto")},Mouse._preCursor=null,__static(Mouse,["_style",function(){return this._style=Browser.document.body.style}])}(),function(){function Utils(){}return __class(Utils,"laya.utils.Utils"),Utils.toRadian=function(angle){return angle*Utils._pi2},Utils.toAngle=function(radian){return radian*Utils._pi},Utils.toHexColor=function(color){if(color<0||isNaN(color))return null;for(var str=color.toString(16);str.length<6;)str="0"+str;return"#"+str},Utils.getGID=function(){return Utils._gid++},Utils.concatArray=function(source,array){if(!array)return source;if(!source)return array;var i=0,len=array.length;for(i=0;i<len;i++)source.push(array[i]);return source},Utils.clearArray=function(array){return array?(array.length=0,array):array},Utils.copyArray=function(source,array){if(source||(source=[]),!array)return source;source.length=array.length;var i=0,len=array.length;for(i=0;i<len;i++)source[i]=array[i];return source},Utils.getGlobalRecByPoints=function(sprite,x0,y0,x1,y1){var newLTPoint,newRBPoint;newLTPoint=Point.create().setTo(x0,y0),newLTPoint=sprite.localToGlobal(newLTPoint),newRBPoint=Point.create().setTo(x1,y1),newRBPoint=sprite.localToGlobal(newRBPoint);var rst=Rectangle._getWrapRec([newLTPoint.x,newLTPoint.y,newRBPoint.x,newRBPoint.y]);return newLTPoint.recover(),newRBPoint.recover(),rst},Utils.getGlobalPosAndScale=function(sprite){return Utils.getGlobalRecByPoints(sprite,0,0,1,1)},Utils.bind=function(fun,scope){return fun.bind(scope)},Utils.measureText=function(txt,font){return RunDriver.measureText(txt,font)},Utils.updateOrder=function(array){if(!array||array.length<2)return!1;for(var c,i=1,j=0,len=array.length,key=NaN;i<len;){for(c=array[j=i],key=array[j]._zOrder;--j>-1&&array[j]._zOrder>key;)array[j+1]=array[j];array[j+1]=c,i++}return!0},Utils.transPointList=function(points,x,y){var i=0,len=points.length;for(i=0;i<len;i+=2)points[i]+=x,points[i+1]+=y},Utils.parseInt=function(str,radix){void 0===radix&&(radix=0);var result=Browser.window.parseInt(str,radix);return isNaN(result)?0:result},Utils.getFileExtension=function(path){Utils._extReg.lastIndex=path.lastIndexOf(".");var result=Utils._extReg.exec(path);return result&&result.length>1?result[1].toLowerCase():null},Utils.getTransformRelativeToWindow=function(coordinateSpace,x,y){var stage=Laya.stage,globalTransform=laya.utils.Utils.getGlobalPosAndScale(coordinateSpace),canvasMatrix=stage._canvasTransform.clone(),canvasLeft=canvasMatrix.tx,canvasTop=canvasMatrix.ty;canvasMatrix.rotate(-Math.PI/180*Laya.stage.canvasDegree),canvasMatrix.scale(Laya.stage.clientScaleX,Laya.stage.clientScaleY);var perpendicular=Laya.stage.canvasDegree%180!=0,tx=NaN,ty=NaN;perpendicular?(tx=y+globalTransform.y,ty=x+globalTransform.x,tx*=canvasMatrix.d,ty*=canvasMatrix.a,90==Laya.stage.canvasDegree?(tx=canvasLeft-tx,ty+=canvasTop):(tx+=canvasLeft,ty=canvasTop-ty)):(tx=x+globalTransform.x,ty=y+globalTransform.y,tx*=canvasMatrix.a,ty*=canvasMatrix.d,tx+=canvasLeft,ty+=canvasTop),ty+=Laya.stage._safariOffsetY;var domScaleX=NaN,domScaleY=NaN;return perpendicular?(domScaleX=canvasMatrix.d*globalTransform.height,domScaleY=canvasMatrix.a*globalTransform.width):(domScaleX=canvasMatrix.a*globalTransform.width,domScaleY=canvasMatrix.d*globalTransform.height),{x:tx,y:ty,scaleX:domScaleX,scaleY:domScaleY}},Utils.fitDOMElementInArea=function(dom,coordinateSpace,x,y,width,height){dom._fitLayaAirInitialized||(dom._fitLayaAirInitialized=!0,dom.style.transformOrigin=dom.style.webKittransformOrigin="left top",dom.style.position="absolute");var transform=Utils.getTransformRelativeToWindow(coordinateSpace,x,y);dom.style.transform=dom.style.webkitTransform="scale("+transform.scaleX+","+transform.scaleY+") rotate("+Laya.stage.canvasDegree+"deg)",dom.style.width=width+"px",dom.style.height=height+"px",dom.style.left=transform.x+"px",dom.style.top=transform.y+"px"},Utils.isOkTextureList=function(textureList){if(!textureList)return!1;var tTexture,i=0,len=textureList.length;for(i=0;i<len;i++)if(!(tTexture=textureList[i])||!tTexture._getSource())return!1;return!0},Utils.isOKCmdList=function(cmds){if(!cmds)return!1;var i=0,len=cmds.length;for(i=0;i<len;i++)cmds[i];return!0},Utils.getQueryString=function(name){if(Browser.onMiniGame)return null;var reg=new RegExp("(^|&)"+name+"=([^&]*)(&|$)"),r=window.location.search.substr(1).match(reg);return null!=r?unescape(r[2]):null},Utils._gid=1,Utils._pi=180/Math.PI,Utils._pi2=Math.PI/180,Utils._extReg=/\.(\w+)\??/g,Utils.parseXMLFromString=function(value){var rst;if(value=value.replace(/>\s+</g,"><"),(rst=(new DOMParser).parseFromString(value,"text/xml")).firstChild.textContent.indexOf("This page contains the following errors")>-1)throw new Error(rst.firstChild.firstChild.textContent);return rst},Utils}()),ClassUtils=function(){function ClassUtils(){}return __class(ClassUtils,"laya.utils.ClassUtils"),ClassUtils.regClass=function(className,classDef){ClassUtils._classMap[className]=classDef},ClassUtils.regShortClassName=function(classes){for(var i=0;i<classes.length;i++){var classDef=classes[i],className=classDef.name;ClassUtils._classMap[className]=classDef}},ClassUtils.getRegClass=function(className){return ClassUtils._classMap[className]},ClassUtils.getClass=function(className){var classObject=ClassUtils._classMap[className]||className;return"string"==typeof classObject?Laya.__classmap[classObject]||Laya[className]:classObject},ClassUtils.getInstance=function(className){var compClass=ClassUtils.getClass(className);return compClass?new compClass:(console.warn("[error] Undefined class:",className),null)},ClassUtils.createByJson=function(json,node,root,customHandler,instanceHandler){"string"==typeof json&&(json=JSON.parse(json));var props=json.props;if(!node&&!(node=instanceHandler?instanceHandler.runWith(json):ClassUtils.getInstance(props.runtime||json.type)))return null;var child=json.child;if(child)for(var i=0,n=child.length;i<n;i++){var data=child[i];if("render"!==data.props.name&&"render"!==data.props.renderType||!node._$set_itemRender)if("Graphic"==data.type)ClassUtils._addGraphicsToSprite(data,node);else if(ClassUtils._isDrawType(data.type))ClassUtils._addGraphicToSprite(data,node,!0);else{var tChild=ClassUtils.createByJson(data,null,root,customHandler,instanceHandler);"Script"===data.type?tChild.hasOwnProperty("owner")?tChild.owner=node:tChild.hasOwnProperty("target")&&(tChild.target=node):"mask"==data.props.renderType?node.mask=tChild:node.addChild(tChild)}else node.itemRender=data}if(props)for(var prop in props){var value=props[prop];"var"===prop&&root?root[value]=node:value instanceof Array&&"function"==typeof node[prop]?node[prop].apply(node,value):node[prop]=value}return customHandler&&json.customProps&&customHandler.runWith([node,json]),node.created&&node.created(),node},ClassUtils._addGraphicsToSprite=function(graphicO,sprite){var graphics=graphicO.child;if(graphics&&!(graphics.length<1)){var g=ClassUtils._getGraphicsFromSprite(graphicO,sprite),ox=0,oy=0;graphicO.props&&(ox=ClassUtils._getObjVar(graphicO.props,"x",0),oy=ClassUtils._getObjVar(graphicO.props,"y",0)),0!=ox&&0!=oy&&g.translate(ox,oy);var len,i=0;for(len=graphics.length,i=0;i<len;i++)ClassUtils._addGraphicToGraphics(graphics[i],g);0!=ox&&0!=oy&&g.translate(-ox,-oy)}},ClassUtils._addGraphicToSprite=function(graphicO,sprite,isChild){void 0===isChild&&(isChild=!1);var g=isChild?ClassUtils._getGraphicsFromSprite(graphicO,sprite):sprite.graphics;ClassUtils._addGraphicToGraphics(graphicO,g)},ClassUtils._getGraphicsFromSprite=function(dataO,sprite){if(!dataO||!dataO.props)return sprite.graphics;var propsName=dataO.props.renderType;if("hit"===propsName||"unHit"===propsName){var hitArea=sprite._style.hitArea||(sprite.hitArea=new HitArea);hitArea[propsName]||(hitArea[propsName]=new Graphics);var g=hitArea[propsName]}return g||(g=sprite.graphics),g},ClassUtils._getTransformData=function(propsO){var m;(propsO.hasOwnProperty("pivotX")||propsO.hasOwnProperty("pivotY"))&&(m=m||new Matrix).translate(-ClassUtils._getObjVar(propsO,"pivotX",0),-ClassUtils._getObjVar(propsO,"pivotY",0));var sx=ClassUtils._getObjVar(propsO,"scaleX",1),sy=ClassUtils._getObjVar(propsO,"scaleY",1),rotate=ClassUtils._getObjVar(propsO,"rotation",0);return ClassUtils._getObjVar(propsO,"skewX",0),ClassUtils._getObjVar(propsO,"skewY",0),1==sx&&1==sy&&0==rotate||((m=m||new Matrix).scale(sx,sy),m.rotate(.0174532922222222*rotate)),m},ClassUtils._addGraphicToGraphics=function(graphicO,graphic){var propsO,drawConfig;if((propsO=graphicO.props)&&(drawConfig=ClassUtils.DrawTypeDic[graphicO.type])){var g=graphic,params=ClassUtils._getParams(propsO,drawConfig[1],drawConfig[2],drawConfig[3]),m=ClassUtils._tM;(m||1!=ClassUtils._alpha)&&(g.save(),m&&g.transform(m),1!=ClassUtils._alpha&&g.alpha(ClassUtils._alpha)),g[drawConfig[0]].apply(g,params),(m||1!=ClassUtils._alpha)&&g.restore()}},ClassUtils._adptLineData=function(params){return params[2]=parseFloat(params[0])+parseFloat(params[2]),params[3]=parseFloat(params[1])+parseFloat(params[3]),params},ClassUtils._adptTextureData=function(params){return params[0]=Loader.getRes(params[0]),params},ClassUtils._adptLinesData=function(params){return params[2]=ClassUtils._getPointListByStr(params[2]),params},ClassUtils._isDrawType=function(type){return"Image"!==type&&ClassUtils.DrawTypeDic.hasOwnProperty(type)},ClassUtils._getParams=function(obj,params,xPos,adptFun){void 0===xPos&&(xPos=0);var rst=ClassUtils._temParam;rst.length=params.length;var len,m,i=0;for(len=params.length,i=0;i<len;i++)rst[i]=ClassUtils._getObjVar(obj,params[i][0],params[i][1]);return ClassUtils._alpha=ClassUtils._getObjVar(obj,"alpha",1),(m=ClassUtils._getTransformData(obj))?(xPos||(xPos=0),m.translate(rst[xPos],rst[xPos+1]),rst[xPos]=rst[xPos+1]=0,ClassUtils._tM=m):ClassUtils._tM=null,adptFun&&ClassUtils[adptFun]&&(rst=ClassUtils[adptFun](rst)),rst},ClassUtils._getPointListByStr=function(str){var len,pointArr=str.split(","),i=0;for(len=pointArr.length,i=0;i<len;i++)pointArr[i]=parseFloat(pointArr[i]);return pointArr},ClassUtils._getObjVar=function(obj,key,noValue){return obj.hasOwnProperty(key)?obj[key]:noValue},ClassUtils._temParam=[],ClassUtils._classMap={Sprite:Sprite,Scene:Scene,Text:Text,Animation:"laya.display.Animation",Skeleton:"laya.ani.bone.Skeleton",Particle2D:"laya.particle.Particle2D",div:"laya.html.dom.HTMLDivParser",p:"laya.html.dom.HTMLElement",img:"laya.html.dom.HTMLImageElement",span:"laya.html.dom.HTMLElement",br:"laya.html.dom.HTMLBrElement",style:"laya.html.dom.HTMLStyleElement",font:"laya.html.dom.HTMLElement",a:"laya.html.dom.HTMLElement","#text":"laya.html.dom.HTMLElement",link:"laya.html.dom.HTMLLinkElement"},ClassUtils._tM=null,ClassUtils._alpha=NaN,__static(ClassUtils,["DrawTypeDic",function(){return this.DrawTypeDic={Rect:["drawRect",[["x",0],["y",0],["width",0],["height",0],["fillColor",null],["lineColor",null],["lineWidth",1]]],Circle:["drawCircle",[["x",0],["y",0],["radius",0],["fillColor",null],["lineColor",null],["lineWidth",1]]],Pie:["drawPie",[["x",0],["y",0],["radius",0],["startAngle",0],["endAngle",0],["fillColor",null],["lineColor",null],["lineWidth",1]]],Image:["drawTexture",[["x",0],["y",0],["width",0],["height",0]]],Texture:["drawTexture",[["skin",null],["x",0],["y",0],["width",0],["height",0]],1,"_adptTextureData"],FillTexture:["fillTexture",[["skin",null],["x",0],["y",0],["width",0],["height",0],["repeat",null]],1,"_adptTextureData"],FillText:["fillText",[["text",""],["x",0],["y",0],["font",null],["color",null],["textAlign",null]],1],Line:["drawLine",[["x",0],["y",0],["toX",0],["toY",0],["lineColor",null],["lineWidth",0]],0,"_adptLineData"],Lines:["drawLines",[["x",0],["y",0],["points",""],["lineColor",null],["lineWidth",0]],0,"_adptLinesData"],Curves:["drawCurves",[["x",0],["y",0],["points",""],["lineColor",null],["lineWidth",0]],0,"_adptLinesData"],Poly:["drawPoly",[["x",0],["y",0],["points",""],["fillColor",null],["lineColor",null],["lineWidth",1]],0,"_adptLinesData"]}}]),ClassUtils}(),Bezier=function(){function Bezier(){this._controlPoints=[new Point,new Point,new Point],this._calFun=this.getPoint2}__class(Bezier,"laya.maths.Bezier");var __proto=Bezier.prototype;return __proto._switchPoint=function(x,y){var tPoint=this._controlPoints.shift();tPoint.setTo(x,y),this._controlPoints.push(tPoint)},__proto.getPoint2=function(t,rst){var p1=this._controlPoints[0],p2=this._controlPoints[1],p3=this._controlPoints[2],lineX=Math.pow(1-t,2)*p1.x+2*t*(1-t)*p2.x+Math.pow(t,2)*p3.x,lineY=Math.pow(1-t,2)*p1.y+2*t*(1-t)*p2.y+Math.pow(t,2)*p3.y;rst.push(lineX,lineY)},__proto.getPoint3=function(t,rst){var p1=this._controlPoints[0],p2=this._controlPoints[1],p3=this._controlPoints[2],p4=this._controlPoints[3],lineX=Math.pow(1-t,3)*p1.x+3*p2.x*t*(1-t)*(1-t)+3*p3.x*t*t*(1-t)+p4.x*Math.pow(t,3),lineY=Math.pow(1-t,3)*p1.y+3*p2.y*t*(1-t)*(1-t)+3*p3.y*t*t*(1-t)+p4.y*Math.pow(t,3);rst.push(lineX,lineY)},__proto.insertPoints=function(count,rst){var dLen,i=NaN;for(dLen=1/(count=count>0?count:5),i=0;i<=1;i+=dLen)this._calFun(i,rst)},__proto.getBezierPoints=function(pList,inSertCount,count){void 0===inSertCount&&(inSertCount=5),void 0===count&&(count=2);var len,i=0;if((len=pList.length)<2*(count+1))return[];var rst=[];switch(count){case 2:this._calFun=this.getPoint2;break;case 3:this._calFun=this.getPoint3;break;default:return[]}for(;this._controlPoints.length<=count;)this._controlPoints.push(Point.create());for(i=0;i<2*count;i+=2)this._switchPoint(pList[i],pList[i+1]);for(i=2*count;i<len;i+=2)this._switchPoint(pList[i],pList[i+1]),i/2%count==0&&this.insertPoints(inSertCount,rst);return rst},__static(Bezier,["I",function(){return this.I=new Bezier}]),Bezier}(),RotateCmd=(function(){function Config3D(){this._defaultPhysicsMemory=16,this._editerEnvironment=!1,this.isAntialias=!0,this.isAlpha=!1,this.premultipliedAlpha=!0,this.isStencil=!0}__class(Config3D,"Config3D");var __proto=Config3D.prototype;__getset(0,__proto,"defaultPhysicsMemory",function(){return this._defaultPhysicsMemory},function(value){if(value<16)throw"defaultPhysicsMemory must large than 16M";this._defaultPhysicsMemory=value}),__static(Config3D,["_defaultConfig",function(){return this._defaultConfig=new Config3D}])}(),function(){function RotateCmd(){}__class(RotateCmd,"laya.display.cmd.RotateCmd");var __proto=RotateCmd.prototype;return __proto.recover=function(){Pool.recover("RotateCmd",this)},__proto.run=function(context,gx,gy){context._rotate(this.angle,this.pivotX+gx,this.pivotY+gy)},__getset(0,__proto,"cmdID",function(){return"Rotate"}),RotateCmd.create=function(angle,pivotX,pivotY){var cmd=Pool.getItemByClass("RotateCmd",RotateCmd);return cmd.angle=angle,cmd.pivotX=pivotX,cmd.pivotY=pivotY,cmd},RotateCmd.ID="Rotate",RotateCmd}()),Rectangle=function(){function Rectangle(x,y,width,height){void 0===x&&(x=0),void 0===y&&(y=0),void 0===width&&(width=0),void 0===height&&(height=0),this.x=x,this.y=y,this.width=width,this.height=height}__class(Rectangle,"laya.maths.Rectangle");var __proto=Rectangle.prototype;return __proto.setTo=function(x,y,width,height){return this.x=x,this.y=y,this.width=width,this.height=height,this},__proto.reset=function(){return this.x=this.y=this.width=this.height=0,this},__proto.recover=function(){Pool.recover("Rectangle",this.reset())},__proto.copyFrom=function(source){return this.x=source.x,this.y=source.y,this.width=source.width,this.height=source.height,this},__proto.contains=function(x,y){return!(this.width<=0||this.height<=0)&&x>=this.x&&x<this.right&&y>=this.y&&y<this.bottom},__proto.intersects=function(rect){return!(rect.x>this.x+this.width||rect.x+rect.width<this.x||rect.y>this.y+this.height||rect.y+rect.height<this.y)},__proto.intersection=function(rect,out){return this.intersects(rect)?(out||(out=new Rectangle),out.x=Math.max(this.x,rect.x),out.y=Math.max(this.y,rect.y),out.width=Math.min(this.right,rect.right)-out.x,out.height=Math.min(this.bottom,rect.bottom)-out.y,out):null},__proto.union=function(source,out){return out||(out=new Rectangle),this.clone(out),source.width<=0||source.height<=0?out:(out.addPoint(source.x,source.y),out.addPoint(source.right,source.bottom),this)},__proto.clone=function(out){return out||(out=new Rectangle),out.x=this.x,out.y=this.y,out.width=this.width,out.height=this.height,out},__proto.toString=function(){return this.x+","+this.y+","+this.width+","+this.height},__proto.equals=function(rect){return!(!rect||rect.x!==this.x||rect.y!==this.y||rect.width!==this.width||rect.height!==this.height)},__proto.addPoint=function(x,y){return this.x>x&&(this.width+=this.x-x,this.x=x),this.y>y&&(this.height+=this.y-y,this.y=y),this.width<x-this.x&&(this.width=x-this.x),this.height<y-this.y&&(this.height=y-this.y),this},__proto._getBoundPoints=function(){var rst=Rectangle._temB;return rst.length=0,0==this.width||0==this.height?rst:(rst.push(this.x,this.y,this.x+this.width,this.y,this.x,this.y+this.height,this.x+this.width,this.y+this.height),rst)},__proto.isEmpty=function(){return this.width<=0||this.height<=0},__getset(0,__proto,"right",function(){return this.x+this.width}),__getset(0,__proto,"bottom",function(){return this.y+this.height}),Rectangle.create=function(){return Pool.getItemByClass("Rectangle",Rectangle)},Rectangle._getBoundPointS=function(x,y,width,height){var rst=Rectangle._temA;return rst.length=0,0==width||0==height?rst:(rst.push(x,y,x+width,y,x,y+height,x+width,y+height),rst)},Rectangle._getWrapRec=function(pointList,rst){if(!pointList||pointList.length<1)return rst?rst.setTo(0,0,0,0):Rectangle.TEMP.setTo(0,0,0,0);rst=rst||laya.maths.Rectangle.create();var i,minX,maxX,minY,maxY,len=pointList.length,tPoint=Point.TEMP;for(maxX=maxY=-(minX=minY=99999),i=0;i<len;i+=2)tPoint.x=pointList[i],tPoint.y=pointList[i+1],minX=minX<tPoint.x?minX:tPoint.x,minY=minY<tPoint.y?minY:tPoint.y,maxX=maxX>tPoint.x?maxX:tPoint.x,maxY=maxY>tPoint.y?maxY:tPoint.y;return rst.setTo(minX,minY,maxX-minX,maxY-minY)},Rectangle.EMPTY=new Rectangle,Rectangle.TEMP=new Rectangle,Rectangle._temB=[],Rectangle._temA=[],Rectangle}(),GraphicsBounds=function(){function GraphicsBounds(){this._cacheBoundsType=!1}__class(GraphicsBounds,"laya.display.GraphicsBounds");var __proto=GraphicsBounds.prototype;return __proto.destroy=function(){this._graphics=null,this._cacheBoundsType=!1,this._temp&&(this._temp.length=0),this._rstBoundPoints&&(this._rstBoundPoints.length=0),this._bounds&&this._bounds.recover(),this._bounds=null,Pool.recover("GraphicsBounds",this)},__proto.reset=function(){this._temp&&(this._temp.length=0)},__proto.getBounds=function(realSize){return void 0===realSize&&(realSize=!1),(!this._bounds||!this._temp||this._temp.length<1||realSize!=this._cacheBoundsType)&&(this._bounds=Rectangle._getWrapRec(this.getBoundPoints(realSize),this._bounds)),this._cacheBoundsType=realSize,this._bounds},__proto.getBoundPoints=function(realSize){return void 0===realSize&&(realSize=!1),(!this._temp||this._temp.length<1||realSize!=this._cacheBoundsType)&&(this._temp=this._getCmdPoints(realSize)),this._cacheBoundsType=realSize,this._rstBoundPoints=Utils.copyArray(this._rstBoundPoints,this._temp)},__proto._getCmdPoints=function(realSize){void 0===realSize&&(realSize=!1),Render._context;var rst,cmds=this._graphics.cmds;if((rst=this._temp||(this._temp=[])).length=0,cmds||null==this._graphics._one||(GraphicsBounds._tempCmds.length=0,GraphicsBounds._tempCmds.push(this._graphics._one),cmds=GraphicsBounds._tempCmds),!cmds)return rst;var matrixs=GraphicsBounds._tempMatrixArrays;matrixs.length=0;var tMatrix=GraphicsBounds._initMatrix;tMatrix.identity();for(var cmd,tex,tempMatrix=GraphicsBounds._tempMatrix,i=0,n=cmds.length;i<n;i++)switch((cmd=cmds[i]).cmdID){case"Alpha":matrixs.push(tMatrix),tMatrix=tMatrix.clone();break;case"Restore":tMatrix=matrixs.pop();break;case"Scale":tempMatrix.identity(),tempMatrix.translate(-cmd.pivotX,-cmd.pivotY),tempMatrix.scale(cmd.scaleX,cmd.scaleY),tempMatrix.translate(cmd.pivotX,cmd.pivotY),this._switchMatrix(tMatrix,tempMatrix);break;case"Rotate":tempMatrix.identity(),tempMatrix.translate(-cmd.pivotX,-cmd.pivotY),tempMatrix.rotate(cmd.angle),tempMatrix.translate(cmd.pivotX,cmd.pivotY),this._switchMatrix(tMatrix,tempMatrix);break;case"Translate":tempMatrix.identity(),tempMatrix.translate(cmd.tx,cmd.ty),this._switchMatrix(tMatrix,tempMatrix);break;case"Transform":tempMatrix.identity(),tempMatrix.translate(-cmd.pivotX,-cmd.pivotY),tempMatrix.concat(cmd.matrix),tempMatrix.translate(cmd.pivotX,cmd.pivotY),this._switchMatrix(tMatrix,tempMatrix);break;case"DrawImage":case"FillTexture":GraphicsBounds._addPointArrToRst(rst,Rectangle._getBoundPointS(cmd.x,cmd.y,cmd.width,cmd.height),tMatrix);break;case"DrawTexture":tMatrix.copyTo(tempMatrix),cmd.matrix&&tempMatrix.concat(cmd.matrix),GraphicsBounds._addPointArrToRst(rst,Rectangle._getBoundPointS(cmd.x,cmd.y,cmd.width,cmd.height),tempMatrix);break;case"DrawImage":if(tex=cmd.texture,realSize)cmd.width&&cmd.height?GraphicsBounds._addPointArrToRst(rst,Rectangle._getBoundPointS(cmd.x,cmd.y,cmd.width,cmd.height),tMatrix):GraphicsBounds._addPointArrToRst(rst,Rectangle._getBoundPointS(cmd.x,cmd.y,tex.width,tex.height),tMatrix);else{var wRate=(cmd.width||tex.sourceWidth)/tex.width,hRate=(cmd.height||tex.sourceHeight)/tex.height,oWidth=wRate*tex.sourceWidth,oHeight=hRate*tex.sourceHeight,offX=tex.offsetX>0?tex.offsetX:0,offY=tex.offsetY>0?tex.offsetY:0;offX*=wRate,offY*=hRate,GraphicsBounds._addPointArrToRst(rst,Rectangle._getBoundPointS(cmd.x-offX,cmd.y-offY,oWidth,oHeight),tMatrix)}break;case"FillTexture":cmd.width&&cmd.height?GraphicsBounds._addPointArrToRst(rst,Rectangle._getBoundPointS(cmd.x,cmd.y,cmd.width,cmd.height),tMatrix):(tex=cmd.texture,GraphicsBounds._addPointArrToRst(rst,Rectangle._getBoundPointS(cmd.x,cmd.y,tex.width,tex.height),tMatrix));break;case"DrawTexture":var drawMatrix;cmd.matrix?(tMatrix.copyTo(tempMatrix),tempMatrix.concat(cmd.matrix),drawMatrix=tempMatrix):drawMatrix=tMatrix,realSize?cmd.width&&cmd.height?GraphicsBounds._addPointArrToRst(rst,Rectangle._getBoundPointS(cmd.x,cmd.y,cmd.width,cmd.height),drawMatrix):(tex=cmd.texture,GraphicsBounds._addPointArrToRst(rst,Rectangle._getBoundPointS(cmd.x,cmd.y,tex.width,tex.height),drawMatrix)):(tex=cmd.texture,wRate=(cmd.width||tex.sourceWidth)/tex.width,hRate=(cmd.height||tex.sourceHeight)/tex.height,oWidth=wRate*tex.sourceWidth,oHeight=hRate*tex.sourceHeight,offX=tex.offsetX>0?tex.offsetX:0,offY=tex.offsetY>0?tex.offsetY:0,offX*=wRate,offY*=hRate,GraphicsBounds._addPointArrToRst(rst,Rectangle._getBoundPointS(cmd.x-offX,cmd.y-offY,oWidth,oHeight),drawMatrix));break;case"DrawRect":GraphicsBounds._addPointArrToRst(rst,Rectangle._getBoundPointS(cmd.x,cmd.y,cmd.width,cmd.height),tMatrix);break;case"DrawCircle":GraphicsBounds._addPointArrToRst(rst,Rectangle._getBoundPointS(cmd.x-cmd.radius,cmd.y-cmd.radius,cmd.radius+cmd.radius,cmd.radius+cmd.radius),tMatrix);break;case"DrawLine":var lineWidth;GraphicsBounds._tempPoints.length=0,lineWidth=.5*cmd.lineWidth,cmd.fromX==cmd.toX?GraphicsBounds._tempPoints.push(cmd.fromX+lineWidth,cmd.fromY,cmd.toX+lineWidth,cmd.toY,cmd.fromX-lineWidth,cmd.fromY,cmd.toX-lineWidth,cmd.toY):cmd.fromY==cmd.toY?GraphicsBounds._tempPoints.push(cmd.fromX,cmd.fromY+lineWidth,cmd.toX,cmd.toY+lineWidth,cmd.fromX,cmd.fromY-lineWidth,cmd.toX,cmd.toY-lineWidth):GraphicsBounds._tempPoints.push(cmd.fromX,cmd.fromY,cmd.toX,cmd.toY),GraphicsBounds._addPointArrToRst(rst,GraphicsBounds._tempPoints,tMatrix);break;case"DrawCurves":GraphicsBounds._addPointArrToRst(rst,Bezier.I.getBezierPoints(cmd.points),tMatrix,cmd.x,cmd.y);break;case"DrawLines":case"DrawPoly":GraphicsBounds._addPointArrToRst(rst,cmd.points,tMatrix,cmd.x,cmd.y);break;case"DrawPath":GraphicsBounds._addPointArrToRst(rst,this._getPathPoints(cmd.paths),tMatrix,cmd.x,cmd.y);break;case"DrawPie":GraphicsBounds._addPointArrToRst(rst,this._getPiePoints(cmd.x,cmd.y,cmd.radius,cmd.startAngle,cmd.endAngle),tMatrix)}return rst.length>200?rst=Utils.copyArray(rst,Rectangle._getWrapRec(rst)._getBoundPoints()):rst.length>8&&(rst=GrahamScan.scanPList(rst)),rst},__proto._switchMatrix=function(tMatix,tempMatrix){tempMatrix.concat(tMatix),tempMatrix.copyTo(tMatix)},__proto._getPiePoints=function(x,y,radius,startAngle,endAngle){var rst=GraphicsBounds._tempPoints;GraphicsBounds._tempPoints.length=0,rst.push(x,y);var dP=Math.PI/10,i=NaN;for(i=startAngle;i<endAngle;i+=dP)rst.push(x+radius*Math.cos(i),y+radius*Math.sin(i));return endAngle!=i&&rst.push(x+radius*Math.cos(endAngle),y+radius*Math.sin(endAngle)),rst},__proto._getPathPoints=function(paths){var len,tCMD,i=0,rst=GraphicsBounds._tempPoints;for(rst.length=0,len=paths.length,i=0;i<len;i++)(tCMD=paths[i]).length>1&&(rst.push(tCMD[1],tCMD[2]),tCMD.length>3&&rst.push(tCMD[3],tCMD[4]));return rst},GraphicsBounds.create=function(){return Pool.getItemByClass("GraphicsBounds",GraphicsBounds)},GraphicsBounds._addPointArrToRst=function(rst,points,matrix,dx,dy){void 0===dx&&(dx=0),void 0===dy&&(dy=0);var len,i=0;for(len=points.length,i=0;i<len;i+=2)GraphicsBounds._addPointToRst(rst,points[i]+dx,points[i+1]+dy,matrix)},GraphicsBounds._addPointToRst=function(rst,x,y,matrix){var _tempPoint=Point.TEMP;_tempPoint.setTo(x||0,y||0),matrix.transformPoint(_tempPoint),rst.push(_tempPoint.x,_tempPoint.y)},GraphicsBounds._tempPoints=[],GraphicsBounds._tempMatrixArrays=[],GraphicsBounds._tempCmds=[],__static(GraphicsBounds,["_tempMatrix",function(){return this._tempMatrix=new Matrix},"_initMatrix",function(){return this._initMatrix=new Matrix}]),GraphicsBounds}(),CacheManger=function(){function CacheManger(){}return __class(CacheManger,"laya.utils.CacheManger"),CacheManger.regCacheByFunction=function(disposeFunction,getCacheListFunction){var cache;CacheManger.unRegCacheByFunction(disposeFunction,getCacheListFunction),cache={tryDispose:disposeFunction,getCacheList:getCacheListFunction},CacheManger._cacheList.push(cache)},CacheManger.unRegCacheByFunction=function(disposeFunction,getCacheListFunction){var len,i=0;for(len=CacheManger._cacheList.length,i=0;i<len;i++)if(CacheManger._cacheList[i].tryDispose==disposeFunction&&CacheManger._cacheList[i].getCacheList==getCacheListFunction)return void CacheManger._cacheList.splice(i,1)},CacheManger.forceDispose=function(){var i=0,len=CacheManger._cacheList.length;for(i=0;i<len;i++)CacheManger._cacheList[i].tryDispose(!0)},CacheManger.beginCheck=function(waitTime){void 0===waitTime&&(waitTime=15e3),Laya.systemTimer.loop(waitTime,null,CacheManger._checkLoop)},CacheManger.stopCheck=function(){Laya.systemTimer.clear(null,CacheManger._checkLoop)},CacheManger._checkLoop=function(){var cacheList=CacheManger._cacheList;if(!(cacheList.length<1)){var len,tTime=Browser.now(),count=0;for(len=count=cacheList.length;count>0&&(CacheManger._index++,CacheManger._index=CacheManger._index%len,cacheList[CacheManger._index].tryDispose(!1),!(Browser.now()-tTime>CacheManger.loopTimeLimit));)count--}},CacheManger.loopTimeLimit=2,CacheManger._cacheList=[],CacheManger._index=0,CacheManger}(),MiniImage=function(){function MiniImage(){}return __class(MiniImage,"laya.wx.mini.MiniImage"),MiniImage.prototype._loadImage=function(url){if(MiniAdpter.isZiYu)MiniImage.onCreateImage(URL.formatURL(url),this,!0);else{var isTransformUrl=!1;if(MiniFileMgr.isLocalNativeFile(url)){if(-1!=url.indexOf("http://")||-1!=url.indexOf("https://"))if(""!=MiniFileMgr.loadPath)url=url.split(MiniFileMgr.loadPath)[1];else{var tempStr=""!=URL.rootPath?URL.rootPath:URL.basePath,tempUrl=url;""!=tempStr&&(url=url.split(tempStr)[1]),url||(url=tempUrl)}if(MiniAdpter.subNativeFiles&&0==MiniAdpter.subNativeheads.length)for(var key in MiniAdpter.subNativeFiles){var tempArr=MiniAdpter.subNativeFiles[key];MiniAdpter.subNativeheads=MiniAdpter.subNativeheads.concat(tempArr);for(var aa=0;aa<tempArr.length;aa++)MiniAdpter.subMaps[tempArr[aa]]=key+"/"+tempArr[aa]}if(MiniAdpter.subNativeFiles&&-1!=url.indexOf("/")){var curfileHead=url.split("/")[0]+"/";if(curfileHead&&-1!=MiniAdpter.subNativeheads.indexOf(curfileHead)){var newfileHead=MiniAdpter.subMaps[curfileHead];url=url.replace(curfileHead,newfileHead)}}}else isTransformUrl=!0,url=URL.formatURL(url);MiniFileMgr.getFileInfo(url)?MiniImage.onCreateImage(url,this,!isTransformUrl):-1!=url.indexOf("http://")||-1!=url.indexOf("https://")?MiniAdpter.isZiYu?MiniImage.onCreateImage(url,this,!0):MiniFileMgr.downOtherFiles(url,new Handler(MiniImage,MiniImage.onDownImgCallBack,[url,this]),url):MiniImage.onCreateImage(url,this,!0)}},MiniImage.onDownImgCallBack=function(sourceUrl,thisLoader,errorCode,tempFilePath){void 0===tempFilePath&&(tempFilePath=""),errorCode?thisLoader.onError(null):MiniImage.onCreateImage(sourceUrl,thisLoader,!1,tempFilePath)},MiniImage.onCreateImage=function(sourceUrl,thisLoader,isLocal,tempFilePath){var fileNativeUrl,image;if(void 0===isLocal&&(isLocal=!1),void 0===tempFilePath&&(tempFilePath=""),MiniAdpter.autoCacheFile)if(isLocal)if(MiniAdpter.isZiYu){var tempUrl=URL.formatURL(sourceUrl);fileNativeUrl=MiniFileMgr.ziyuFileTextureData[tempUrl]?MiniFileMgr.ziyuFileTextureData[tempUrl]:sourceUrl}else fileNativeUrl=sourceUrl;else if(""!=tempFilePath)fileNativeUrl=tempFilePath;else{var fileMd5Name=MiniFileMgr.getFileInfo(sourceUrl).md5;fileNativeUrl=MiniFileMgr.getFileNativePath(fileMd5Name)}else fileNativeUrl=isLocal?sourceUrl:tempFilePath;function clear(){var img=thisLoader._imgCache[fileNativeUrl];img&&(img.onload=null,img.onerror=null,delete thisLoader._imgCache[fileNativeUrl])}null==thisLoader._imgCache&&(thisLoader._imgCache={});var onerror=function(){clear(),thisLoader.event("error","Load image failed")};if("nativeimage"==thisLoader._type){var onload=function(){clear(),thisLoader._url=URL.formatURL(thisLoader._url),thisLoader.onLoaded(image)};(image=new Browser.window.Image).crossOrigin="",image.onload=onload,image.onerror=onerror,image.src=fileNativeUrl,thisLoader._imgCache[fileNativeUrl]=image}else{var imageSource=new Browser.window.Image;onload=function(){thisLoader._url=URL.formatURL(thisLoader._url),(image=HTMLImage.create(imageSource.width,imageSource.height)).loadImageSource(imageSource,!0),image._setCreateURL(fileNativeUrl),clear(),thisLoader.onLoaded(image)},imageSource.crossOrigin="",imageSource.onload=onload,imageSource.onerror=onerror,imageSource.src=fileNativeUrl,thisLoader._imgCache[fileNativeUrl]=imageSource}},MiniImage}(),RenderSprite=function(){function RenderSprite(type,next){if(LayaGLQuickRunner.map[type])return this._fun=LayaGLQuickRunner.map[type],void(this._next=RenderSprite.NORENDER);switch(this._next=next||RenderSprite.NORENDER,type){case 0:return void(this._fun=this._no);case 1:return void(this._fun=this._alpha);case 2:return void(this._fun=this._transform);case 4:return void(this._fun=this._blend);case 8:return void(this._fun=this._canvas);case 32:return void(this._fun=this._mask);case 64:return void(this._fun=this._clip);case 128:return void(this._fun=this._style);case 512:return void(this._fun=this._graphics);case 8192:return void(this._fun=this._children);case 2048:return void(this._fun=this._custom);case 256:return void(this._fun=this._texture);case 16:return void(this._fun=Filter._filter);case 69905:return void(this._fun=RenderSprite._initRenderFun)}this.onCreate(type)}__class(RenderSprite,"laya.renders.RenderSprite");var __proto=RenderSprite.prototype;return __proto.onCreate=function(type){},__proto._style=function(sprite,context,x,y){var style=sprite._style;null!=style.render&&style.render(sprite,context,x,y);var next=this._next;next._fun.call(next,sprite,context,x,y)},__proto._no=function(sprite,context,x,y){},__proto._custom=function(sprite,context,x,y){sprite.customRender(context,x,y),this._next._fun.call(this._next,sprite,context,x-sprite.pivotX,y-sprite.pivotY)},__proto._clip=function(sprite,context,x,y){var next=this._next;if(next!=RenderSprite.NORENDER){var r=sprite._style.scrollRect;context.save(),context.clipRect(x,y,r.width,r.height),next._fun.call(next,sprite,context,x-r.x,y-r.y),context.restore()}},__proto._blend=function(sprite,context,x,y){var style=sprite._style;style.blendMode&&(context.globalCompositeOperation=style.blendMode);var next=this._next;next._fun.call(next,sprite,context,x,y),context.globalCompositeOperation="source-over"},__proto._mask=function(sprite,context,x,y){var next=this._next;next._fun.call(next,sprite,context,x,y);var mask=sprite.mask;mask&&(context.globalCompositeOperation="destination-in",(mask.numChildren>0||!mask.graphics._isOnlyOne())&&(mask.cacheAs="bitmap"),mask.render(context,x-sprite._style.pivotX,y-sprite._style.pivotY)),context.globalCompositeOperation="source-over"},__proto._texture=function(sprite,context,x,y){var tex=sprite.texture;tex._getSource()&&context.drawTexture(tex,x-sprite.pivotX+tex.offsetX,y-sprite.pivotY+tex.offsetY,sprite._width||tex.width,sprite._height||tex.height);var next=this._next;next._fun.call(next,sprite,context,x,y)},__proto._graphics=function(sprite,context,x,y){sprite._graphics&&sprite._graphics._render(sprite,context,x-sprite.pivotX,y-sprite.pivotY);var next=this._next;next._fun.call(next,sprite,context,x,y)},__proto._image=function(sprite,context,x,y){var style=sprite._style;context.drawTexture2(x,y,style.pivotX,style.pivotY,sprite.transform,sprite._graphics._one)},__proto._image2=function(sprite,context,x,y){var style=sprite._style;context.drawTexture2(x,y,style.pivotX,style.pivotY,sprite.transform,sprite._graphics._one)},__proto._alpha=function(sprite,context,x,y){var alpha;if((alpha=sprite._style.alpha)>.01||sprite._needRepaint()){var temp=context.globalAlpha;context.globalAlpha*=alpha;var next=this._next;next._fun.call(next,sprite,context,x,y),context.globalAlpha=temp}},__proto._transform=function(sprite,context,x,y){var transform=sprite.transform,_next=this._next;sprite._style,transform&&_next!=RenderSprite.NORENDER?(context.save(),context.transform(transform.a,transform.b,transform.c,transform.d,transform.tx+x,transform.ty+y),_next._fun.call(_next,sprite,context,0,0),context.restore()):_next._fun.call(_next,sprite,context,x,y)},__proto._children=function(sprite,context,x,y){var ele,style=sprite._style,childs=sprite._children,n=childs.length;x-=sprite.pivotX,y-=sprite.pivotY;var textLastRender=sprite._getBit(256)&&context.drawCallOptimize(!0);if(style.viewport){var rect=style.viewport,left=rect.x,top=rect.y,right=rect.right,bottom=rect.bottom,_x=NaN,_y=NaN;for(i=0;i<n;++i)(ele=childs[i])._visible&&(_x=ele._x)<right&&_x+ele.width>left&&(_y=ele._y)<bottom&&_y+ele.height>top&&ele.render(context,x,y)}else for(var i=0;i<n;++i)(ele=childs[i])._visible&&ele.render(context,x,y);textLastRender&&context.drawCallOptimize(!1)},__proto._canvas=function(sprite,context,x,y){var _cacheStyle=sprite._cacheStyle,_next=this._next;if(_cacheStyle.enableCanvasRender){"bitmap"===_cacheStyle.cacheAs?Stat.canvasBitmap++:Stat.canvasNormal++;var cacheNeedRebuild=!1,textNeedRestore=!1;if(Render.isWebGL&&_cacheStyle.canvas){var canv=_cacheStyle.canvas,charRIs=(canv.context,canv.touches);if(charRIs)for(var ci=0;ci<charRIs.length;ci++)if(charRIs[ci].deleted){textNeedRestore=!0;break}cacheNeedRebuild=canv.isCacheValid&&!canv.isCacheValid()}if(sprite._needRepaint()||!_cacheStyle.canvas||textNeedRestore||cacheNeedRebuild||Laya.stage.isGlobalRepaint())if(Render.isWebGL&&"normal"===_cacheStyle.cacheAs){if(context._targets)return void _next._fun.call(_next,sprite,context,x,y);this._canvas_webgl_normal_repaint(sprite,context)}else this._canvas_repaint(sprite,context,x,y);var tRec=_cacheStyle.cacheRect;context.drawCanvas(_cacheStyle.canvas,x+tRec.x,y+tRec.y,tRec.width,tRec.height)}else _next._fun.call(_next,sprite,context,x,y)},__proto._canvas_repaint=function(sprite,context,x,y){var tx,left,top,tRec,w,h,scaleX,scaleY,scaleInfo,_cacheStyle=sprite._cacheStyle,_next=this._next,canvas=_cacheStyle.canvas,tCacheType=_cacheStyle.cacheAs;if(scaleX=(scaleInfo=_cacheStyle._calculateCacheRect(sprite,tCacheType,x,y)).x,scaleY=scaleInfo.y,w=(tRec=_cacheStyle.cacheRect).width*scaleX,h=tRec.height*scaleY,left=tRec.x,top=tRec.y,Render.isWebGL&&"bitmap"===tCacheType&&(w>2048||h>2048))return console.warn("cache bitmap size larger than 2048,cache ignored"),_cacheStyle.releaseContext(),void _next._fun.call(_next,sprite,context,x,y);if(canvas||(_cacheStyle.createContext(),canvas=_cacheStyle.canvas),(tx=canvas.context).sprite=sprite,(canvas.width!=w||canvas.height!=h)&&canvas.size(w,h),"bitmap"===tCacheType?tx.asBitmap=!0:"normal"===tCacheType&&(tx.asBitmap=!1),tx.clear(),1!=scaleX||1!=scaleY){var ctx=tx;ctx.save(),ctx.scale(scaleX,scaleY),_next._fun.call(_next,sprite,tx,-left,-top),ctx.restore(),sprite._applyFilters()}else ctx=tx,_next._fun.call(_next,sprite,tx,-left,-top),sprite._applyFilters();_cacheStyle.staticCache&&(_cacheStyle.reCache=!1),Stat.canvasReCache++},__proto._canvas_webgl_normal_repaint=function(sprite,context){var _cacheStyle=sprite._cacheStyle,_next=this._next,canvas=_cacheStyle.canvas,tCacheType=_cacheStyle.cacheAs;_cacheStyle._calculateCacheRect(sprite,tCacheType,0,0),canvas||(canvas=_cacheStyle.canvas=new Laya.WebGLCacheAsNormalCanvas(context,sprite));var tx=canvas.context;canvas.startRec(),_next._fun.call(_next,sprite,tx,sprite.pivotX,sprite.pivotY),sprite._applyFilters(),Stat.canvasReCache++,canvas.endRec()},RenderSprite.__init__=function(){LayaGLQuickRunner.__init__();var len,initRender,i=0;for(initRender=RunDriver.createRenderSprite(69905,null),len=RenderSprite.renders.length=16384,i=0;i<len;i++)RenderSprite.renders[i]=initRender;RenderSprite.renders[0]=RunDriver.createRenderSprite(0,null)},RenderSprite._initRenderFun=function(sprite,context,x,y){var type=sprite._renderType;(RenderSprite.renders[type]=RenderSprite._getTypeRender(type))._fun(sprite,context,x,y)},RenderSprite._getTypeRender=function(type){if(LayaGLQuickRunner.map[type])return RunDriver.createRenderSprite(type,null);for(var rst=null,tType=8192;tType>0;)tType&type&&(rst=RunDriver.createRenderSprite(tType,rst)),tType>>=1;return rst},RenderSprite.INIT=69905,RenderSprite.renders=[],RenderSprite.NORENDER=new RenderSprite(0,null),RenderSprite}(),FillWordsCmd=function(){function FillWordsCmd(){}__class(FillWordsCmd,"laya.display.cmd.FillWordsCmd");var __proto=FillWordsCmd.prototype;return __proto.recover=function(){this.words=null,Pool.recover("FillWordsCmd",this)},__proto.run=function(context,gx,gy){context.fillWords(this.words,this.x+gx,this.y+gy,this.font,this.color)},__getset(0,__proto,"cmdID",function(){return"FillWords"}),FillWordsCmd.create=function(words,x,y,font,color){var cmd=Pool.getItemByClass("FillWordsCmd",FillWordsCmd);return cmd.words=words,cmd.x=x,cmd.y=y,cmd.font=font,cmd.color=color,cmd},FillWordsCmd.ID="FillWords",FillWordsCmd}(),TransformCmd=function(){function TransformCmd(){}__class(TransformCmd,"laya.display.cmd.TransformCmd");var __proto=TransformCmd.prototype;return __proto.recover=function(){this.matrix=null,Pool.recover("TransformCmd",this)},__proto.run=function(context,gx,gy){context._transform(this.matrix,this.pivotX+gx,this.pivotY+gy)},__getset(0,__proto,"cmdID",function(){return"Transform"}),TransformCmd.create=function(matrix,pivotX,pivotY){var cmd=Pool.getItemByClass("TransformCmd",TransformCmd);return cmd.matrix=matrix,cmd.pivotX=pivotX,cmd.pivotY=pivotY,cmd},TransformCmd.ID="Transform",TransformCmd}(),Render=(function(){function DrawCanvasCmd(){this._graphicsCmdEncoder=null,this._index=0,this._paramData=null,this.texture=null,this.x=NaN,this.y=NaN,this.width=NaN,this.height=NaN}__class(DrawCanvasCmd,"laya.display.cmd.DrawCanvasCmd");var __proto=DrawCanvasCmd.prototype;__proto.recover=function(){this._graphicsCmdEncoder=null,Pool.recover("DrawCanvasCmd",this)},__getset(0,__proto,"cmdID",function(){return"DrawCanvasCmd"}),DrawCanvasCmd.create=function(texture,x,y,width,height){return null},DrawCanvasCmd.ID="DrawCanvasCmd",DrawCanvasCmd._DRAW_IMAGE_CMD_ENCODER_=null,DrawCanvasCmd._PARAM_TEXTURE_POS_=2,DrawCanvasCmd._PARAM_VB_POS_=5}(),function(){function Render(width,height){this._timeId=0,Render._mainCanvas.source.id="layaCanvas",Render._mainCanvas.source.width=width,Render._mainCanvas.source.height=height,laya.renders.Render.isConchApp?Browser.document.body.appendChild(Render._mainCanvas.source):Browser.container.appendChild(Render._mainCanvas.source),RunDriver.initRender(Render._mainCanvas,width,height),Browser.window.requestAnimationFrame(function loop(stamp){Laya.stage._loop(),Browser.window.requestAnimationFrame(loop)}),Laya.stage.on("visibilitychange",this,this._onVisibilitychange)}__class(Render,"laya.renders.Render");var __proto=Render.prototype;return __proto._onVisibilitychange=function(){Laya.stage.isVisibility?0!=this._timeId&&Browser.window.clearInterval(this._timeId):this._timeId=Browser.window.setInterval(this._enterFrame,1e3)},__proto._enterFrame=function(e){Laya.stage._loop()},__getset(1,Render,"context",function(){return Render._context}),__getset(1,Render,"canvas",function(){return Render._mainCanvas.source}),Render._context=null,Render._mainCanvas=null,Render.isWebGL=!1,Render.is3DMode=!1,__static(Render,["isConchApp",function(){return this.isConchApp=null!=window.conch}]),Render}()),Stat=function(){function Stat(){}return __class(Stat,"laya.utils.Stat"),__getset(1,Stat,"onclick",null,function(fn){Stat._sp&&Stat._sp.on("click",Stat._sp,fn),Stat._canvas&&(Stat._canvas.source.onclick=fn,Stat._canvas.source.style.pointerEvents="")}),Stat.show=function(x,y){void 0===x&&(x=0),void 0===y&&(y=0),Browser.onMiniGame||Browser.onLimixiu||(Stat._useCanvas=!0),Stat._show=!0,Stat._fpsData.length=60,Render.isConchApp?Stat._view[0]={title:"FPS",value:"_fpsStr",color:"yellow",units:"int"}:Stat._view[0]={title:"FPS(Canvas)",value:"_fpsStr",color:"yellow",units:"int"},Stat._view[1]={title:"Sprite",value:"_spriteStr",color:"white",units:"int"},Stat._view[2]={title:"RenderBatch",value:"renderBatch",color:"white",units:"int"},Stat._view[3]={title:"CPUMemory",value:"cpuMemory",color:"yellow",units:"M"},Stat._view[4]={title:"GPUMemory",value:"gpuMemory",color:"yellow",units:"M"},Render.isWebGL&&(Stat._view[5]={title:"Shader",value:"shaderCall",color:"white",units:"int"},Render.is3DMode?(Stat._view[0].title="FPS(3D)",Stat._view[6]={title:"TriFaces",value:"trianglesFaces",color:"white",units:"int"}):(Stat._view[0].title="FPS(WebGL)",Stat._view[6]={title:"Canvas",value:"_canvasStr",color:"white",units:"int"})),Stat._useCanvas?Stat.createUIPre(x,y):Stat.createUI(x,y),Stat.enable()},Stat.createUIPre=function(x,y){var pixel=Browser.pixelRatio;Stat._width=130*pixel,Stat._vx=75*pixel,Stat._height=pixel*(12*Stat._view.length+3*pixel)+4,Stat._fontSize=12*pixel;for(var i=0;i<Stat._view.length;i++)Stat._view[i].x=4,Stat._view[i].y=i*Stat._fontSize+2*pixel;Render.isConchApp?(Stat._sp=new Sprite,Stat._titleSp=new Sprite,Stat._bgSp=new Sprite,Stat._bgSp.graphics.drawRect(x,y,Stat._width,Stat._height,"#969696"),Stat._bgSp.alpha=.8,Stat._sp.zOrder=1e5,Stat._titleSp.zOrder=1e5,Stat._bgSp.zOrder=1e5,Stat._bgSp.addChild(Stat._sp),Stat._bgSp.addChild(Stat._titleSp),Laya.stage.addChild(Stat._bgSp)):(Stat._canvas||(Stat._canvas=new HTMLCanvas(!0),Stat._canvas.size(Stat._width,Stat._height),Stat._ctx=Stat._canvas.getContext("2d"),Stat._ctx.textBaseline="top",Stat._ctx.font=Stat._fontSize+"px Arial",Stat._canvas.source.style.cssText="pointer-events:none;background:rgba(150,150,150,0.8);z-index:100000;position: absolute;direction:ltr;left:"+x+"px;top:"+y+"px;width:"+Stat._width/pixel+"px;height:"+Stat._height/pixel+"px;"),Browser.container.appendChild(Stat._canvas.source)),Stat._first=!0,Stat.loop(),Stat._first=!1},Stat.createUI=function(x,y){var stat=Stat._sp,pixel=Browser.pixelRatio;stat||(stat=new Sprite,Stat._leftText=new Text,Stat._leftText.pos(5,5),Stat._leftText.color="#ffffff",stat.addChild(Stat._leftText),Stat._txt=new Text,Stat._txt.pos(80*pixel,5),Stat._txt.color="#ffffff",stat.addChild(Stat._txt),Stat._sp=stat),stat.pos(x,y);for(var text="",i=0;i<Stat._view.length;i++)text+=Stat._view[i].title+"\n";Stat._leftText.text=text;var width=138*pixel,height=pixel*(12*Stat._view.length+3*pixel)+4;Stat._txt.fontSize=Stat._fontSize*pixel,Stat._leftText.fontSize=Stat._fontSize*pixel,stat.size(width,height),stat.graphics.clear(),stat.graphics.alpha(.5),stat.graphics.drawRect(0,0,width,height,"#999999"),stat.graphics.alpha(2),Stat.loop()},Stat.enable=function(){Laya.systemTimer.frameLoop(1,Stat,Stat.loop)},Stat.hide=function(){Stat._show=!1,Laya.systemTimer.clear(Stat,Stat.loop),Stat._canvas&&Browser.removeElement(Stat._canvas.source)},Stat.clear=function(){Stat.trianglesFaces=Stat.renderBatch=Stat.shaderCall=Stat.spriteCount=Stat.spriteRenderUseCacheCount=Stat.treeNodeCollision=Stat.treeSpriteCollision=Stat.canvasNormal=Stat.canvasBitmap=Stat.canvasReCache=0},Stat.loop=function(){Stat._count++;var timer=Browser.now();if(!(timer-Stat._timer<1e3)){var count=Stat._count;if(Stat.FPS=Math.round(1e3*count/(timer-Stat._timer)),Stat._show){Stat.trianglesFaces=Math.round(Stat.trianglesFaces/count),Stat._useCanvas?(Stat.renderBatch=Math.round(Stat.renderBatch/count),Stat.shaderCall=Math.round(Stat.shaderCall/count),Stat.spriteCount=Math.round(Stat.spriteCount/count)-1):(Stat.renderBatch=Math.round(Stat.renderBatch/count)-1,Stat.shaderCall=Math.round(Stat.shaderCall/count),Stat.spriteCount=Math.round(Stat.spriteCount/count)-4),Stat.spriteRenderUseCacheCount=Math.round(Stat.spriteRenderUseCacheCount/count),Stat.canvasNormal=Math.round(Stat.canvasNormal/count),Stat.canvasBitmap=Math.round(Stat.canvasBitmap/count),Stat.canvasReCache=Math.ceil(Stat.canvasReCache/count),Stat.treeNodeCollision=Math.round(Stat.treeNodeCollision/count),Stat.treeSpriteCollision=Math.round(Stat.treeSpriteCollision/count);var delay=Stat.FPS>0?Math.floor(1e3/Stat.FPS).toString():" ";Stat._fpsStr=Stat.FPS+(Stat.renderSlow?" slow":"")+" "+delay,Stat._spriteStr=Stat.spriteCount+(Stat.spriteRenderUseCacheCount?"/"+Stat.spriteRenderUseCacheCount:""),Stat._canvasStr=Stat.canvasReCache+"/"+Stat.canvasNormal+"/"+Stat.canvasBitmap,Stat.cpuMemory=Resource.cpuMemory,Stat.gpuMemory=Resource.gpuMemory,Stat._useCanvas?Stat.renderInfoPre():Stat.renderInfo(),Stat.clear()}Stat._count=0,Stat._timer=timer}},Stat.renderInfoPre=function(){var one,value,i=0;if(Render.isConchApp)for(Stat._sp.graphics.clear(),i=0;i<Stat._view.length;i++)one=Stat._view[i],Stat._first&&Stat._titleSp.graphics.fillText(one.title,one.x,one.y,Stat._fontSize+"px Arial","#ffffff","left"),value=Stat[one.value],"M"==one.units&&(value=Math.floor(value/1048576*100)/100+" M"),Stat._sp.graphics.fillText(value+"",one.x+Stat._vx,one.y,Stat._fontSize+"px Arial",one.color,"left");else if(Stat._canvas){var ctx=Stat._ctx;for(ctx.clearRect(Stat._first?0:Stat._vx,0,Stat._width,Stat._height),i=0;i<Stat._view.length;i++)one=Stat._view[i],Stat._first&&(ctx.fillStyle="white",ctx.fillText(one.title,one.x,one.y)),ctx.fillStyle=one.color,value=Stat[one.value],"M"==one.units&&(value=Math.floor(value/1048576*100)/100+" M"),ctx.fillText(value+"",one.x+Stat._vx,one.y)}},Stat.renderInfo=function(){for(var text="",i=0;i<Stat._view.length;i++){var one=Stat._view[i],value=Stat[one.value];"M"==one.units&&(value=Math.floor(value/1048576*100)/100+" M"),"K"==one.units&&(value=Math.floor(value/1024*100)/100+" K"),text+=value+"\n"}Stat._txt.text=text},Stat.FPS=0,Stat.loopCount=0,Stat.shaderCall=0,Stat.renderBatch=0,Stat.trianglesFaces=0,Stat.spriteCount=0,Stat.spriteRenderUseCacheCount=0,Stat.treeNodeCollision=0,Stat.treeSpriteCollision=0,Stat.canvasNormal=0,Stat.canvasBitmap=0,Stat.canvasReCache=0,Stat.renderSlow=!1,Stat.gpuMemory=0,Stat.cpuMemory=0,Stat._fpsStr=null,Stat._canvasStr=null,Stat._spriteStr=null,Stat._fpsData=[],Stat._timer=0,Stat._count=0,Stat._view=[],Stat._fontSize=12,Stat._txt=null,Stat._leftText=null,Stat._sp=null,Stat._titleSp=null,Stat._bgSp=null,Stat._show=!1,Stat._useCanvas=!1,Stat._canvas=null,Stat._ctx=null,Stat._first=!1,Stat._vx=NaN,Stat._width=0,Stat._height=100,Stat}(),ClipRectCmd=function(){function ClipRectCmd(){}__class(ClipRectCmd,"laya.display.cmd.ClipRectCmd");var __proto=ClipRectCmd.prototype;return __proto.recover=function(){Pool.recover("ClipRectCmd",this)},__proto.run=function(context,gx,gy){context.clipRect(this.x+gx,this.y+gy,this.width,this.height)},__getset(0,__proto,"cmdID",function(){return"ClipRect"}),ClipRectCmd.create=function(x,y,width,height){var cmd=Pool.getItemByClass("ClipRectCmd",ClipRectCmd);return cmd.x=x,cmd.y=y,cmd.width=width,cmd.height=height,cmd},ClipRectCmd.ID="ClipRect",ClipRectCmd}(),DrawPolyCmd=function(){function DrawPolyCmd(){}__class(DrawPolyCmd,"laya.display.cmd.DrawPolyCmd");var __proto=DrawPolyCmd.prototype;return __proto.recover=function(){this.points=null,this.fillColor=null,this.lineColor=null,Pool.recover("DrawPolyCmd",this)},__proto.run=function(context,gx,gy){context._drawPoly(this.x+gx,this.y+gy,this.points,this.fillColor,this.lineColor,this.lineWidth,this.isConvexPolygon,this.vid)},__getset(0,__proto,"cmdID",function(){return"DrawPoly"}),DrawPolyCmd.create=function(x,y,points,fillColor,lineColor,lineWidth,isConvexPolygon,vid){var cmd=Pool.getItemByClass("DrawPolyCmd",DrawPolyCmd);return cmd.x=x,cmd.y=y,cmd.points=points,cmd.fillColor=fillColor,cmd.lineColor=lineColor,cmd.lineWidth=lineWidth,cmd.isConvexPolygon=isConvexPolygon,cmd.vid=vid,cmd},DrawPolyCmd.ID="DrawPoly",DrawPolyCmd}(),Dragging=function(){function Dragging(){this.ratio=.92,this.maxOffset=60,this._dragging=!1,this._clickOnly=!0}__class(Dragging,"laya.utils.Dragging");var __proto=Dragging.prototype;return __proto.start=function(target,area,hasInertia,elasticDistance,elasticBackTime,data,disableMouseEvent,ratio){void 0===ratio&&(ratio=.92),this.clearTimer(),this.target=target,this.area=area,this.hasInertia=hasInertia,this.elasticDistance=area?elasticDistance:0,this.elasticBackTime=elasticBackTime,this.data=data,this._disableMouseEvent=disableMouseEvent,this.ratio=ratio,this._parent=target.parent,this._clickOnly=!0,this._dragging=!0,this._elasticRateX=this._elasticRateY=1,this._lastX=this._parent.mouseX,this._lastY=this._parent.mouseY,Laya.stage.on("mouseup",this,this.onStageMouseUp),Laya.stage.on("mouseout",this,this.onStageMouseUp),Laya.systemTimer.frameLoop(1,this,this.loop)},__proto.clearTimer=function(){Laya.systemTimer.clear(this,this.loop),Laya.systemTimer.clear(this,this.tweenMove),this._tween&&(this._tween.recover(),this._tween=null)},__proto.stop=function(){this._dragging&&(MouseManager.instance.disableMouseEvent=!1,Laya.stage.off("mouseup",this,this.onStageMouseUp),Laya.stage.off("mouseout",this,this.onStageMouseUp),this._dragging=!1,this.target&&this.area&&this.backToArea(),this.clear())},__proto.loop=function(){var point=this._parent.getMousePoint(),mouseX=point.x,mouseY=point.y,offsetX=mouseX-this._lastX,offsetY=mouseY-this._lastY;if(this._clickOnly){if(!(Math.abs(offsetX*Laya.stage._canvasTransform.getScaleX())>1||Math.abs(offsetY*Laya.stage._canvasTransform.getScaleY())>1))return;this._clickOnly=!1,this._offsets||(this._offsets=[]),this._offsets.length=0,this.target.event("dragstart",this.data),MouseManager.instance.disableMouseEvent=this._disableMouseEvent}else this._offsets.push(offsetX,offsetY);0===offsetX&&0===offsetY||(this._lastX=mouseX,this._lastY=mouseY,this.target.x+=offsetX*this._elasticRateX,this.target.y+=offsetY*this._elasticRateY,this.area&&this.checkArea(),this.target.event("dragmove",this.data))},__proto.checkArea=function(){if(this.elasticDistance<=0)this.backToArea();else{if(this.target._x<this.area.x)var offsetX=this.area.x-this.target._x;else offsetX=this.target._x>this.area.x+this.area.width?this.target._x-this.area.x-this.area.width:0;if(this._elasticRateX=Math.max(0,1-offsetX/this.elasticDistance),this.target._y<this.area.y)var offsetY=this.area.y-this.target.y;else offsetY=this.target._y>this.area.y+this.area.height?this.target._y-this.area.y-this.area.height:0;this._elasticRateY=Math.max(0,1-offsetY/this.elasticDistance)}},__proto.backToArea=function(){this.target.x=Math.min(Math.max(this.target._x,this.area.x),this.area.x+this.area.width),this.target.y=Math.min(Math.max(this.target._y,this.area.y),this.area.y+this.area.height)},__proto.onStageMouseUp=function(e){if(MouseManager.instance.disableMouseEvent=!1,Laya.stage.off("mouseup",this,this.onStageMouseUp),Laya.stage.off("mouseout",this,this.onStageMouseUp),Laya.systemTimer.clear(this,this.loop),!this._clickOnly&&this.target)if(this.hasInertia){this._offsets.length<1&&this._offsets.push(this._parent.mouseX-this._lastX,this._parent.mouseY-this._lastY),this._offsetX=this._offsetY=0;for(var len=this._offsets.length,n=Math.min(len,6),m=this._offsets.length-n,i=len-1;i>m;i--)this._offsetY+=this._offsets[i--],this._offsetX+=this._offsets[i];this._offsetX=this._offsetX/n*2,this._offsetY=this._offsetY/n*2,Math.abs(this._offsetX)>this.maxOffset&&(this._offsetX=this._offsetX>0?this.maxOffset:-this.maxOffset),Math.abs(this._offsetY)>this.maxOffset&&(this._offsetY=this._offsetY>0?this.maxOffset:-this.maxOffset),Laya.systemTimer.frameLoop(1,this,this.tweenMove)}else this.elasticDistance>0?this.checkElastic():this.clear()},__proto.checkElastic=function(){var tx=NaN,ty=NaN;if(this.target.x<this.area.x?tx=this.area.x:this.target._x>this.area.x+this.area.width&&(tx=this.area.x+this.area.width),this.target.y<this.area.y?ty=this.area.y:this.target._y>this.area.y+this.area.height&&(ty=this.area.y+this.area.height),isNaN(tx)&&isNaN(ty))this.clear();else{var obj={};isNaN(tx)||(obj.x=tx),isNaN(ty)||(obj.y=ty),this._tween=Tween.to(this.target,obj,this.elasticBackTime,Ease.sineOut,Handler.create(this,this.clear),0,!1,!1)}},__proto.tweenMove=function(){this._offsetX*=this.ratio*this._elasticRateX,this._offsetY*=this.ratio*this._elasticRateY,this.target.x+=this._offsetX,this.target.y+=this._offsetY,this.area&&this.checkArea(),this.target.event("dragmove",this.data),(Math.abs(this._offsetX)<1&&Math.abs(this._offsetY)<1||this._elasticRateX<.5||this._elasticRateY<.5)&&(Laya.systemTimer.clear(this,this.tweenMove),this.elasticDistance>0?this.checkElastic():this.clear())},__proto.clear=function(){if(this.target){this.clearTimer();var sp=this.target;this.target=null,this._parent=null,sp.event("dragend",this.data)}},Dragging}(),DrawTrianglesCmd=function(){function DrawTrianglesCmd(){}__class(DrawTrianglesCmd,"laya.display.cmd.DrawTrianglesCmd");var __proto=DrawTrianglesCmd.prototype;return __proto.recover=function(){this.texture=null,this.vertices=null,this.uvs=null,this.indices=null,this.matrix=null,Pool.recover("DrawTrianglesCmd",this)},__proto.run=function(context,gx,gy){context.drawTriangles(this.texture,this.x+gx,this.y+gy,this.vertices,this.uvs,this.indices,this.matrix,this.alpha,this.color,this.blendMode)},__getset(0,__proto,"cmdID",function(){return"DrawTriangles"}),DrawTrianglesCmd.create=function(texture,x,y,vertices,uvs,indices,matrix,alpha,color,blendMode){var cmd=Pool.getItemByClass("DrawTrianglesCmd",DrawTrianglesCmd);if(cmd.texture=texture,cmd.x=x,cmd.y=y,cmd.vertices=vertices,cmd.uvs=uvs,cmd.indices=indices,cmd.matrix=matrix,cmd.alpha=alpha,color){cmd.color=new ColorFilter;var c=ColorUtils.create(color).arrColor;cmd.color.color(255*c[0],255*c[1],255*c[2],255*c[3])}return cmd.blendMode=blendMode,cmd},DrawTrianglesCmd.ID="DrawTriangles",DrawTrianglesCmd}(),ColorFilter=function(_super){function ColorFilter(mat){ColorFilter.__super.call(this),mat||(mat=this._copyMatrix(ColorFilter.IDENTITY_MATRIX)),this._mat=new Float32Array(16),this._alpha=new Float32Array(4),this.setByMatrix(mat),this._action=new ColorFilterAction,this._action.data=this}__class(ColorFilter,"laya.filters.ColorFilter",Filter);var __proto=ColorFilter.prototype;return Laya.imps(__proto,{"laya.filters.IFilter":!0}),__proto.gray=function(){return this.setByMatrix(ColorFilter.GRAY_MATRIX)},__proto.color=function(red,green,blue,alpha){return void 0===red&&(red=0),void 0===green&&(green=0),void 0===blue&&(blue=0),void 0===alpha&&(alpha=1),this.setByMatrix([1,0,0,0,red,0,1,0,0,green,0,0,1,0,blue,0,0,0,1,alpha])},__proto.setColor=function(color){var arr=ColorUtils.create(color).arrColor,mt=[0,0,0,0,256*arr[0],0,0,0,0,256*arr[1],0,0,0,0,256*arr[2],0,0,0,1,0];return this.setByMatrix(mt)},__proto.setByMatrix=function(matrix){this._matrix!=matrix&&this._copyMatrix(matrix);for(var j=0,z=0,i=0;i<20;i++)i%5!=4?this._mat[j++]=matrix[i]:this._alpha[z++]=matrix[i];return this},__proto.adjustColor=function(brightness,contrast,saturation,hue){return this.adjustHue(hue),this.adjustContrast(contrast),this.adjustBrightness(brightness),this.adjustSaturation(saturation),this},__proto.adjustBrightness=function(brightness){return 0==(brightness=this._clampValue(brightness,100))||isNaN(brightness)?this:this._multiplyMatrix([1,0,0,0,brightness,0,1,0,0,brightness,0,0,1,0,brightness,0,0,0,1,0,0,0,0,0,1])},__proto.adjustContrast=function(contrast){if(0==(contrast=this._clampValue(contrast,100))||isNaN(contrast))return this;var x=NaN,x1=(x=contrast<0?127+contrast/100*127:127*(x=0==(x=contrast%1)?ColorFilter.DELTA_INDEX[contrast]:ColorFilter.DELTA_INDEX[contrast<<0]*(1-x)+ColorFilter.DELTA_INDEX[1+(contrast<<0)]*x)+127)/127,x2=.5*(127-x);return this._multiplyMatrix([x1,0,0,0,x2,0,x1,0,0,x2,0,0,x1,0,x2,0,0,0,1,0,0,0,0,0,1])},__proto.adjustSaturation=function(saturation){if(0==(saturation=this._clampValue(saturation,100))||isNaN(saturation))return this;var x=1+(saturation>0?3*saturation/100:saturation/100),dx=1-x,r=.3086*dx,g=.6094*dx,b=.082*dx;return this._multiplyMatrix([r+x,g,b,0,0,r,g+x,b,0,0,r,g,b+x,0,0,0,0,0,1,0,0,0,0,0,1])},__proto.adjustHue=function(hue){if(0==(hue=this._clampValue(hue,180)/180*Math.PI)||isNaN(hue))return this;var cos=Math.cos(hue),sin=Math.sin(hue),r=.213,g=.715,b=.072;return this._multiplyMatrix([r+cos*(1-r)+sin*-r,g+cos*-g+sin*-g,b+cos*-b+sin*(1-b),0,0,r+cos*-r+.143*sin,g+cos*(1-g)+.14*sin,b+cos*-b+-.283*sin,0,0,r+cos*-r+-.787*sin,g+cos*-g+sin*g,b+cos*(1-b)+sin*b,0,0,0,0,0,1,0,0,0,0,0,1])},__proto.reset=function(){return this.setByMatrix(this._copyMatrix(ColorFilter.IDENTITY_MATRIX))},__proto._multiplyMatrix=function(matrix){var col=[];this._matrix=this._fixMatrix(this._matrix);for(var i=0;i<5;i++){for(var j=0;j<5;j++)col[j]=this._matrix[j+5*i];for(j=0;j<5;j++){for(var val=0,k=0;k<5;k++)val+=matrix[j+5*k]*col[k];this._matrix[j+5*i]=val}}return this.setByMatrix(this._matrix)},__proto._clampValue=function(val,limit){return Math.min(limit,Math.max(-limit,val))},__proto._fixMatrix=function(matrix){return null==matrix?ColorFilter.IDENTITY_MATRIX:(matrix.length<25?matrix=matrix.slice(0,matrix.length).concat(ColorFilter.IDENTITY_MATRIX.slice(matrix.length,25)):matrix.length>25&&(matrix=matrix.slice(0,25)),matrix)},__proto._copyMatrix=function(matrix){this._matrix||(this._matrix=[]);for(var i=0;i<25;i++)this._matrix[i]=matrix[i];return this._matrix},__getset(0,__proto,"type",function(){return 32}),ColorFilter.LENGTH=25,__static(ColorFilter,["DELTA_INDEX",function(){return this.DELTA_INDEX=[0,.01,.02,.04,.05,.06,.07,.08,.1,.11,.12,.14,.15,.16,.17,.18,.2,.21,.22,.24,.25,.27,.28,.3,.32,.34,.36,.38,.4,.42,.44,.46,.48,.5,.53,.56,.59,.62,.65,.68,.71,.74,.77,.8,.83,.86,.89,.92,.95,.98,1,1.06,1.12,1.18,1.24,1.3,1.36,1.42,1.48,1.54,1.6,1.66,1.72,1.78,1.84,1.9,1.96,2,2.12,2.25,2.37,2.5,2.62,2.75,2.87,3,3.2,3.4,3.6,3.8,4,4.3,4.7,4.9,5,5.5,6,6.5,6.8,7,7.3,7.5,7.8,8,8.4,8.7,9,9.4,9.6,9.8,10]},"GRAY_MATRIX",function(){return this.GRAY_MATRIX=[.3086,.6094,.082,0,0,.3086,.6094,.082,0,0,.3086,.6094,.082,0,0,0,0,0,1,0]},"IDENTITY_MATRIX",function(){return this.IDENTITY_MATRIX=[1,0,0,0,0,0,1,0,0,0,0,0,1,0,0,0,0,0,1,0,0,0,0,0,1]}]),ColorFilter}(),Widget=function(_super){function Widget(){Widget.__super.call(this),this._top=NaN,this._bottom=NaN,this._left=NaN,this._right=NaN,this._centerX=NaN,this._centerY=NaN}__class(Widget,"laya.ui.Widget",Component);var __proto=Widget.prototype;return __proto.onReset=function(){this._top=this._bottom=this._left=this._right=this._centerX=this._centerY=NaN},__proto._onEnable=function(){this.owner.parent?this._onAdded():this.owner.once("added",this,this._onAdded)},__proto._onDisable=function(){this.owner.off("added",this,this._onAdded),this.owner.parent&&this.owner.parent.off("resize",this,this._onParentResize)},__proto._onAdded=function(){this.owner.parent&&this.owner.parent.on("resize",this,this._onParentResize),this.resetLayoutX(),this.resetLayoutY()},__proto._onParentResize=function(){(this.resetLayoutX()||this.resetLayoutY())&&this.owner.event("resize")},__proto.resetLayoutX=function(){var owner=this.owner;if(!owner)return!1;var parent=owner.parent;if(parent)if(isNaN(this.centerX)){if(isNaN(this.left))isNaN(this.right)||(owner.x=Math.round(parent.width-owner.displayWidth-this.right+owner.pivotX*owner.scaleX));else if(owner.x=Math.round(this.left+owner.pivotX*owner.scaleX),!isNaN(this.right)){var temp=(parent._width-this.left-this.right)/(owner.scaleX||.01);if(temp!=owner.width)return owner.width=temp,!0}}else owner.x=Math.round(.5*(parent.width-owner.displayWidth)+this.centerX+owner.pivotX*owner.scaleX);return!1},__proto.resetLayoutY=function(){var owner=this.owner;if(!owner)return!1;var parent=owner.parent;if(parent)if(isNaN(this.centerY)){if(isNaN(this.top))isNaN(this.bottom)||(owner.y=Math.round(parent.height-owner.displayHeight-this.bottom+owner.pivotY*owner.scaleY));else if(owner.y=Math.round(this.top+owner.pivotY*owner.scaleY),!isNaN(this.bottom)){var temp=(parent._height-this.top-this.bottom)/(owner.scaleY||.01);if(temp!=owner.height)return owner.height=temp,!0}}else owner.y=Math.round(.5*(parent.height-owner.displayHeight)+this.centerY+owner.pivotY*owner.scaleY);return!1},__proto.resetLayout=function(){this.owner&&(this.resetLayoutX(),this.resetLayoutY())},__getset(0,__proto,"centerX",function(){return this._centerX},function(value){this._centerX!=value&&(this._centerX=value,this.resetLayoutX())}),__getset(0,__proto,"top",function(){return this._top},function(value){this._top!=value&&(this._top=value,this.resetLayoutY())}),__getset(0,__proto,"bottom",function(){return this._bottom},function(value){this._bottom!=value&&(this._bottom=value,this.resetLayoutY())}),__getset(0,__proto,"left",function(){return this._left},function(value){this._left!=value&&(this._left=value,this.resetLayoutX())}),__getset(0,__proto,"right",function(){return this._right},function(value){this._right!=value&&(this._right=value,this.resetLayoutX())}),__getset(0,__proto,"centerY",function(){return this._centerY},function(value){this._centerY!=value&&(this._centerY=value,this.resetLayoutY())}),__static(Widget,["EMPTY",function(){return this.EMPTY=new Widget}]),Widget}(),Node=function(_super){function Node(){this._bits=0,this._parent=null,this.name="",this.destroyed=!1,this._conchData=null,this._components=null,this._activeChangeScripts=null,this._scene=null,Node.__super.call(this),this._children=Node.ARRAY_EMPTY,this._extUIChild=Node.ARRAY_EMPTY,this.createGLBuffer()}__class(Node,"laya.display.Node",EventDispatcher);var __proto=Node.prototype;return __proto.createGLBuffer=function(){},__proto._setBit=function(type,value){16===type&&this._getBit(type)!=value&&this._updateDisplayedInstage(),value?this._bits|=type:this._bits&=~type},__proto._getBit=function(type){return 0!=(this._bits&type)},__proto._setUpNoticeChain=function(){this._getBit(16)&&this._setBitUp(16)},__proto._setBitUp=function(type){var ele=this;for(ele._setBit(type,!0),ele=ele._parent;ele;){if(ele._getBit(type))return;ele._setBit(type,!0),ele=ele._parent}},__proto.on=function(type,caller,listener,args){return"display"!==type&&"undisplay"!==type||this._getBit(16)||this._setBitUp(16),this._createListener(type,caller,listener,args,!1)},__proto.once=function(type,caller,listener,args){return"display"!==type&&"undisplay"!==type||this._getBit(16)||this._setBitUp(16),this._createListener(type,caller,listener,args,!0)},__proto.destroy=function(destroyChild){void 0===destroyChild&&(destroyChild=!0),this.destroyed=!0,this._destroyAllComponent(),this._parent&&this._parent.removeChild(this),this._children&&(destroyChild?this.destroyChildren():this.removeChildren()),this.onDestroy(),this._children=null,this.offAll()},__proto.onDestroy=function(){},__proto.destroyChildren=function(){if(this._children)for(var i=0,n=this._children.length;i<n;i++)this._children[0].destroy(!0)},__proto.addChild=function(node){if(!node||this.destroyed||node===this)return node;if(node._zOrder&&this._setBit(32,!0),node._parent===this){var index=this.getChildIndex(node);index!==this._children.length-1&&(this._children.splice(index,1),this._children.push(node),this._childChanged())}else node._parent&&node._parent.removeChild(node),this._children===Node.ARRAY_EMPTY&&(this._children=[]),this._children.push(node),node._setParent(this),this._childChanged();return node},__proto.addInputChild=function(node){if(this._extUIChild==Node.ARRAY_EMPTY)this._extUIChild=[node];else{if(this._extUIChild.indexOf(node)>=0)return null;this._extUIChild.push(node)}return null},__proto.removeInputChild=function(node){var idx=this._extUIChild.indexOf(node);idx>=0&&this._extUIChild.splice(idx,1)},__proto.addChildren=function(__args){for(var args=arguments,i=0,n=args.length;i<n;)this.addChild(args[i++])},__proto.addChildAt=function(node,index){if(!node||this.destroyed||node===this)return node;if(node._zOrder&&this._setBit(32,!0),index>=0&&index<=this._children.length){if(node._parent===this){var oldIndex=this.getChildIndex(node);this._children.splice(oldIndex,1),this._children.splice(index,0,node),this._childChanged()}else node._parent&&node._parent.removeChild(node),this._children===Node.ARRAY_EMPTY&&(this._children=[]),this._children.splice(index,0,node),node._setParent(this);return node}throw new Error("appendChildAt:The index is out of bounds")},__proto.getChildIndex=function(node){return this._children.indexOf(node)},__proto.getChildByName=function(name){var nodes=this._children;if(nodes)for(var i=0,n=nodes.length;i<n;i++){var node=nodes[i];if(node.name===name)return node}return null},__proto.getChildAt=function(index){return this._children[index]||null},__proto.setChildIndex=function(node,index){var childs=this._children;if(index<0||index>=childs.length)throw new Error("setChildIndex:The index is out of bounds.");var oldIndex=this.getChildIndex(node);if(oldIndex<0)throw new Error("setChildIndex:node is must child of this object.");return childs.splice(oldIndex,1),childs.splice(index,0,node),this._childChanged(),node},__proto._childChanged=function(child){},__proto.removeChild=function(node){if(!this._children)return node;var index=this._children.indexOf(node);return this.removeChildAt(index)},__proto.removeSelf=function(){return this._parent&&this._parent.removeChild(this),this},__proto.removeChildByName=function(name){var node=this.getChildByName(name);return node&&this.removeChild(node),node},__proto.removeChildAt=function(index){var node=this.getChildAt(index);return node&&(this._children.splice(index,1),node._setParent(null)),node},__proto.removeChildren=function(beginIndex,endIndex){if(void 0===beginIndex&&(beginIndex=0),void 0===endIndex&&(endIndex=2147483647),this._children&&this._children.length>0){var childs=this._children;if(0===beginIndex&&endIndex>=childs.length-1){var arr=childs;this._children=Node.ARRAY_EMPTY}else arr=childs.splice(beginIndex,endIndex-beginIndex);for(var i=0,n=arr.length;i<n;i++)arr[i]._setParent(null)}return this},__proto.replaceChild=function(newNode,oldNode){var index=this._children.indexOf(oldNode);return index>-1?(this._children.splice(index,1,newNode),oldNode._setParent(null),newNode._setParent(this),newNode):null},__proto._setParent=function(value){this._parent!==value&&(value?(this._parent=value,this._onAdded(),this.event("added"),this._getBit(16)&&(this._setUpNoticeChain(),value.displayedInStage&&this._displayChild(this,!0)),value._childChanged(this)):(this._onRemoved(),this.event("removed"),this._parent._childChanged(),this._getBit(16)&&this._displayChild(this,!1),this._parent=value))},__proto._updateDisplayedInstage=function(){var ele;ele=this;for(var stage=Laya.stage,displayedInStage=!1;ele;){if(ele._getBit(16)){displayedInStage=ele._getBit(128);break}if(ele===stage||ele._getBit(128)){displayedInStage=!0;break}ele=ele._parent}this._setBit(128,displayedInStage)},__proto._setDisplay=function(value){this._getBit(128)!==value&&(this._setBit(128,value),value?this.event("display"):this.event("undisplay"))},__proto._displayChild=function(node,display){var childs=node._children;if(childs)for(var i=0,n=childs.length;i<n;i++){var child=childs[i];child._getBit(16)&&(child._children.length>0?this._displayChild(child,display):child._setDisplay(display))}node._setDisplay(display)},__proto.contains=function(node){if(node===this)return!0;for(;node;){if(node._parent===this)return!0;node=node._parent}return!1},__proto.timerLoop=function(delay,caller,method,args,coverBefore,jumpFrame){void 0===coverBefore&&(coverBefore=!0),void 0===jumpFrame&&(jumpFrame=!1),(this.scene?this.scene.timer:Laya.timer).loop(delay,caller,method,args,coverBefore,jumpFrame)},__proto.timerOnce=function(delay,caller,method,args,coverBefore){void 0===coverBefore&&(coverBefore=!0),(this.scene?this.scene.timer:Laya.timer)._create(!1,!1,delay,caller,method,args,coverBefore)},__proto.frameLoop=function(delay,caller,method,args,coverBefore){void 0===coverBefore&&(coverBefore=!0),(this.scene?this.scene.timer:Laya.timer)._create(!0,!0,delay,caller,method,args,coverBefore)},__proto.frameOnce=function(delay,caller,method,args,coverBefore){void 0===coverBefore&&(coverBefore=!0),(this.scene?this.scene.timer:Laya.timer)._create(!0,!1,delay,caller,method,args,coverBefore)},__proto.clearTimer=function(caller,method){(this.scene?this.scene.timer:Laya.timer).clear(caller,method)},__proto.callLater=function(method,args){(this.scene?this.scene.timer:Laya.timer).callLater(this,method,args)},__proto.runCallLater=function(method){(this.scene?this.scene.timer:Laya.timer).runCallLater(this,method)},__proto._onActive=function(){},__proto._onInActive=function(){},__proto._onActiveInScene=function(){},__proto._onInActiveInScene=function(){},__proto._parse=function(data){},__proto._setBelongScene=function(scene){if(!this._scene){if(this._scene=scene,this._components)for(var i=0,n=this._components.length;i<n;i++)this._components[i]._setActiveInScene(!0);for(this._onActiveInScene(),i=0,n=this._children.length;i<n;i++)this._children[i]._setBelongScene(scene)}},__proto._setUnBelongScene=function(){if(this._scene!==this){if(this._onInActiveInScene(),this._components)for(var i=0,n=this._components.length;i<n;i++)this._components[i]._setActiveInScene(!1);for(this._scene=null,i=0,n=this._children.length;i<n;i++)this._children[i]._setUnBelongScene()}},__proto.onAwake=function(){},__proto.onEnable=function(){},__proto._processActive=function(){this._activeChangeScripts||(this._activeChangeScripts=[]),this._activeHierarchy(this._activeChangeScripts),this._activeScripts()},__proto._activeHierarchy=function(activeChangeScripts){if(this._setBit(2,!0),this._components)for(var i=0,n=this._components.length;i<n;i++){var comp=this._components[i];comp._setActive(!0),comp._isScript()&&activeChangeScripts.push(comp)}for(this._onActive(),i=0,n=this._children.length;i<n;i++){var child=this._children[i];!child._getBit(1)&&child._activeHierarchy(activeChangeScripts)}this._getBit(4)||(this._setBit(4,!0),this.onAwake()),this.onEnable()},__proto._activeScripts=function(){for(var i=0,n=this._activeChangeScripts.length;i<n;i++)this._activeChangeScripts[i].onEnable();this._activeChangeScripts.length=0},__proto._processInActive=function(){this._activeChangeScripts||(this._activeChangeScripts=[]),this._inActiveHierarchy(this._activeChangeScripts),this._inActiveScripts()},__proto._inActiveHierarchy=function(activeChangeScripts){if(this._onInActive(),this._components)for(var i=0,n=this._components.length;i<n;i++){var comp=this._components[i];comp._setActive(!1),comp._isScript()&&activeChangeScripts.push(comp)}for(this._setBit(2,!1),i=0,n=this._children.length;i<n;i++){var child=this._children[i];child&&!child._getBit(1)&&child._inActiveHierarchy(activeChangeScripts)}this.onDisable()},__proto._inActiveScripts=function(){for(var i=0,n=this._activeChangeScripts.length;i<n;i++)this._activeChangeScripts[i].onDisable();this._activeChangeScripts.length=0},__proto.onDisable=function(){},__proto._onAdded=function(){if(this._activeChangeScripts&&0!==this._activeChangeScripts.length)throw"Node: can't set the main inActive node active in hierarchy,if the operate is in main inActive node or it's children script's onDisable Event.";var parentScene=this._parent.scene;parentScene&&this._setBelongScene(parentScene),this._parent.activeInHierarchy&&this.active&&this._processActive()},__proto._onRemoved=function(){if(this._activeChangeScripts&&0!==this._activeChangeScripts.length)throw"Node: can't set the main active node inActive in hierarchy,if the operate is in main active node or it's children script's onEnable Event.";this._parent.activeInHierarchy&&this.active&&this._processInActive(),this._parent.scene&&this._setUnBelongScene()},__proto._addComponentInstance=function(comp){this._components=this._components||[],this._components.push(comp),comp.owner=this,comp._onAdded(),this.activeInHierarchy&&(comp._setActive(!0),comp._isScript()&&comp.onEnable()),this._scene&&comp._setActiveInScene(!0)},__proto._destroyComponent=function(comp){if(this._components)for(var i=0,n=this._components.length;i<n;i++){var item=this._components[i];if(item===comp){item._destroy(),this._components.splice(i,1);break}}},__proto._destroyAllComponent=function(){if(this._components){for(var i=0,n=this._components.length;i<n;i++)this._components[i]._destroy();this._components.length=0}},__proto._cloneTo=function(destObject){var destNode=destObject;if(this._components)for(var i=0,n=this._components.length;i<n;i++){var destComponent=destNode.addComponent(this._components[i].constructor);this._components[i]._cloneTo(destComponent)}},__proto.addComponentIntance=function(comp){if(comp.owner)throw"Node:the component has belong to other node.";if(comp.isSingleton&&this.getComponent(comp.constructor))throw"Node:the component is singleton,can't add the second one.";return this._addComponentInstance(comp),comp},__proto.addComponent=function(type){var comp=Pool.createByClass(type);if(comp._destroyed=!1,comp.isSingleton&&this.getComponent(type))throw"无法实例"+type+"组件，"+type+"组件已存在！";return this._addComponentInstance(comp),comp},__proto.getComponent=function(clas){if(this._components)for(var i=0,n=this._components.length;i<n;i++){var comp=this._components[i];if(Laya.__typeof(comp,clas))return comp}return null},__proto.getComponents=function(clas){var arr;if(this._components)for(var i=0,n=this._components.length;i<n;i++){var comp=this._components[i];Laya.__typeof(comp,clas)&&(arr=arr||[]).push(comp)}return arr},__getset(0,__proto,"numChildren",function(){return this._children.length}),__getset(0,__proto,"parent",function(){return this._parent}),__getset(0,__proto,"activeInHierarchy",function(){return this._getBit(2)}),__getset(0,__proto,"active",function(){return!this._getBit(8)&&!this._getBit(1)},function(value){if(value=!!value,!this._getBit(1)!==value){if(this._activeChangeScripts&&0!==this._activeChangeScripts.length)throw value?"Node: can't set the main inActive node active in hierarchy,if the operate is in main inActive node or it's children script's onDisable Event.":"Node: can't set the main active node inActive in hierarchy,if the operate is in main active node or it's children script's onEnable Event.";this._setBit(1,!value),this._parent&&this._parent.activeInHierarchy&&(value?this._processActive():this._processInActive())}}),__getset(0,__proto,"displayedInStage",function(){return this._getBit(16)?this._getBit(128):(this._setBitUp(16),this._getBit(128))}),__getset(0,__proto,"scene",function(){return this._scene}),__getset(0,__proto,"timer",function(){return this.scene?this.scene.timer:Laya.timer}),Node.ARRAY_EMPTY=[],Node}(),LoaderManager=function(_super){var ResInfo;function LoaderManager(){this.retryNum=1,this.retryDelay=0,this.maxLoader=5,this._loaders=[],this._loaderCount=0,this._resInfos=[],this._infoPool=[],this._maxPriority=5,this._failRes={},this._statInfo={count:1,loaded:1},LoaderManager.__super.call(this);for(var i=0;i<this._maxPriority;i++)this._resInfos[i]=[]}__class(LoaderManager,"laya.net.LoaderManager",EventDispatcher);var __proto=LoaderManager.prototype;return __proto.getProgress=function(){return this._statInfo.loaded/this._statInfo.count},__proto.resetProgress=function(){this._statInfo.count=this._statInfo.loaded=1},__proto.create=function(url,complete,progress,type,constructParams,propertyParams,priority,cache){void 0===priority&&(priority=1),void 0===cache&&(cache=!0),this._create(url,!0,complete,progress,type,constructParams,propertyParams,priority,cache)},__proto._create=function(url,mainResou,complete,progress,type,constructParams,propertyParams,priority,cache){if(void 0===priority&&(priority=1),void 0===cache&&(cache=!0),url instanceof Array){var items=url,itemCount=items.length,loadedCount=0;if(progress)var progress2=Handler.create(progress.caller,progress.method,progress.args,!1);for(var i=0;i<itemCount;i++){var item=items[i];"string"==typeof item&&(item=items[i]={url:item}),item.progress=0}for(i=0;i<itemCount;i++){item=items[i];var progressHandler=progress?Handler.create(null,onProgress,[item],!1):null,completeHandler=progress||complete?Handler.create(null,onComplete,[item]):null;this._createOne(item.url,mainResou,completeHandler,progressHandler,item.type||type,item.constructParams||constructParams,item.propertyParams||propertyParams,item.priority||priority,cache)}function onComplete(item,content){loadedCount++,item.progress=1,loadedCount===itemCount&&complete&&complete.run()}function onProgress(item,value){item.progress=value;for(var num=0,j=0;j<itemCount;j++)num+=items[j].progress;var v=num/itemCount;progress2.runWith(v)}}else this._createOne(url,mainResou,complete,progress,type,constructParams,propertyParams,priority,cache)},__proto._createOne=function(url,mainResou,complete,progress,type,constructParams,propertyParams,priority,cache){void 0===priority&&(priority=1),void 0===cache&&(cache=!0);var item=this.getRes(url);if(item)!mainResou&&item instanceof laya.resource.Resource&&item._addReference(),progress&&progress.runWith(1),complete&&complete.runWith(item);else{var extension=Utils.getFileExtension(url);if(type||(type=LoaderManager.createMap[extension]?LoaderManager.createMap[extension][0]:null),!type)return void this.load(url,complete,progress,type,priority,cache);if(!Loader.parserMap[type])return void this.load(url,complete,progress,type,priority,cache);this._createLoad(url,Handler.create(null,function(createRes){createRes&&(!mainResou&&createRes instanceof laya.resource.Resource&&createRes._addReference(),createRes._setCreateURL(url)),complete&&complete.runWith(createRes),Laya.loader.event(url)}),progress,type,constructParams,propertyParams,priority,cache,!0)}},__proto.load=function(url,complete,progress,type,priority,cache,group,ignoreCache,useWorkerLoader){var _$this=this;if(void 0===priority&&(priority=1),void 0===cache&&(cache=!0),void 0===ignoreCache&&(ignoreCache=!1),void 0===useWorkerLoader&&(useWorkerLoader=!1),url instanceof Array)return this._loadAssets(url,complete,progress,type,priority,cache,group);var content=Loader.getRes(url);if(ignoreCache||null==content){var original;original=url,(url=AtlasInfoManager.getFileLoadPath(url))!=original&&"nativeimage"!==type?type="atlas":original=null;var info=LoaderManager._resMap[url];info?(complete&&(original?complete&&info._createListener("complete",this,this._resInfoLoaded,[original,complete],!1,!1):complete&&info._createListener("complete",complete.caller,complete.method,complete.args,!1,!1)),progress&&info._createListener("progress",progress.caller,progress.method,progress.args,!1,!1)):((info=this._infoPool.length?this._infoPool.pop():new ResInfo).url=url,info.type=type,info.cache=cache,info.group=group,info.ignoreCache=ignoreCache,info.useWorkerLoader=useWorkerLoader,info.originalUrl=original,complete&&info.on("complete",complete.caller,complete.method,complete.args),progress&&info.on("progress",progress.caller,progress.method,progress.args),LoaderManager._resMap[url]=info,priority=priority<this._maxPriority?priority:this._maxPriority-1,this._resInfos[priority].push(info),this._statInfo.count++,this.event("progress",this.getProgress()),this._next())}else Laya.systemTimer.frameOnce(1,null,function(){progress&&progress.runWith(1),complete&&complete.runWith(content),_$this._loaderCount||_$this.event("complete")});return this},__proto._resInfoLoaded=function(original,complete){complete.runWith(Loader.getRes(original))},__proto._createLoad=function(url,complete,progress,type,constructParams,propertyParams,priority,cache,ignoreCache){var _$this=this;if(void 0===priority&&(priority=1),void 0===cache&&(cache=!0),void 0===ignoreCache&&(ignoreCache=!1),url instanceof Array)return this._loadAssets(url,complete,progress,type,priority,cache);var content=Loader.getRes(url);if(null!=content)Laya.systemTimer.frameOnce(1,null,function(){progress&&progress.runWith(1),complete&&complete.runWith(content),_$this._loaderCount||_$this.event("complete")});else{var info=LoaderManager._resMap[url];info?(complete&&info._createListener("complete",complete.caller,complete.method,complete.args,!1,!1),progress&&info._createListener("progress",progress.caller,progress.method,progress.args,!1,!1)):((info=this._infoPool.length?this._infoPool.pop():new ResInfo).url=url,info.type=type,info.cache=!1,info.ignoreCache=ignoreCache,info.originalUrl=null,info.createCache=cache,info.createConstructParams=constructParams,info.createPropertyParams=propertyParams,complete&&info.on("complete",complete.caller,complete.method,complete.args),progress&&info.on("progress",progress.caller,progress.method,progress.args),LoaderManager._resMap[url]=info,priority=priority<this._maxPriority?priority:this._maxPriority-1,this._resInfos[priority].push(info),this._statInfo.count++,this.event("progress",this.getProgress()),this._next())}return this},__proto._next=function(){if(!(this._loaderCount>=this.maxLoader)){for(var i=0;i<this._maxPriority;i++)for(var infos=this._resInfos[i];infos.length>0;){var info=infos.shift();if(info)return this._doLoad(info)}this._loaderCount||this.event("complete")}},__proto._doLoad=function(resInfo){this._loaderCount++;var loader=this._loaders.length?this._loaders.pop():new Loader;loader.on("complete",null,onLoaded),loader.on("progress",null,function(num){resInfo.event("progress",num)}),loader.on("error",null,function(msg){onLoaded(null)});var _me=this;function onLoaded(data){loader.offAll(),loader._data=null,loader._customParse=!1,_me._loaders.push(loader),_me._endLoad(resInfo,data instanceof Array?[data]:data),_me._loaderCount--,_me._next()}loader._constructParams=resInfo.createConstructParams,loader._propertyParams=resInfo.createPropertyParams,loader._createCache=resInfo.createCache,loader.load(resInfo.url,resInfo.type,resInfo.cache,resInfo.group,resInfo.ignoreCache,resInfo.useWorkerLoader)},__proto._endLoad=function(resInfo,content){var url=resInfo.url;if(null==content){var errorCount=this._failRes[url]||0;if(errorCount<this.retryNum)return console.warn("[warn]Retry to load:",url),this._failRes[url]=errorCount+1,void Laya.systemTimer.once(this.retryDelay,this,this._addReTry,[resInfo],!1);Loader.clearRes(url),console.warn("[error]Failed to load:",url),this.event("error",url)}this._failRes[url]&&(this._failRes[url]=0),delete LoaderManager._resMap[url],resInfo.originalUrl&&(content=Loader.getRes(resInfo.originalUrl)),resInfo.event("complete",content),resInfo.offAll(),this._infoPool.push(resInfo),this._statInfo.loaded++,this.event("progress",this.getProgress())},__proto._addReTry=function(resInfo){this._resInfos[this._maxPriority-1].push(resInfo),this._next()},__proto.clearRes=function(url){Loader.clearRes(url)},__proto.clearTextureRes=function(url){Loader.clearTextureRes(url)},__proto.getRes=function(url){return Loader.getRes(url)},__proto.cacheRes=function(url,data){Loader.cacheRes(url,data)},__proto.setGroup=function(url,group){Loader.setGroup(url,group)},__proto.clearResByGroup=function(group){Loader.clearResByGroup(group)},__proto.clearUnLoaded=function(){for(var i=0;i<this._maxPriority;i++){for(var infos=this._resInfos[i],j=infos.length-1;j>-1;j--){var info=infos[j];info&&(info.offAll(),this._infoPool.push(info))}infos.length=0}this._loaderCount=0,LoaderManager._resMap={}},__proto.cancelLoadByUrls=function(urls){if(urls)for(var i=0,n=urls.length;i<n;i++)this.cancelLoadByUrl(urls[i])},__proto.cancelLoadByUrl=function(url){for(var i=0;i<this._maxPriority;i++)for(var infos=this._resInfos[i],j=infos.length-1;j>-1;j--){var info=infos[j];info&&info.url===url&&(infos[j]=null,info.offAll(),this._infoPool.push(info))}LoaderManager._resMap[url]&&delete LoaderManager._resMap[url]},__proto._loadAssets=function(arr,complete,progress,type,priority,cache,group){void 0===priority&&(priority=1),void 0===cache&&(cache=!0);for(var itemCount=arr.length,loadedCount=0,totalSize=0,items=[],success=!0,i=0;i<itemCount;i++){var item=arr[i];"string"==typeof item&&(item={url:item,type:type,size:1,priority:priority}),item.size||(item.size=1),item.progress=0,totalSize+=item.size,items.push(item);var progressHandler=progress?Handler.create(null,loadProgress,[item],!1):null,completeHandler=complete||progress?Handler.create(null,loadComplete,[item]):null;this.load(item.url,completeHandler,progressHandler,item.type,item.priority||1,cache,item.group||group,!1,item.useWorkerLoader)}function loadComplete(item,content){loadedCount++,item.progress=1,content||(success=!1),loadedCount===itemCount&&complete&&complete.runWith(success)}function loadProgress(item,value){if(null!=progress){item.progress=value;for(var num=0,j=0;j<items.length;j++){var item1=items[j];num+=item1.size*item1.progress}var v=num/totalSize;progress.runWith(v)}}return this},__proto.decodeBitmaps=function(urls){var ctx,i=0,len=urls.length;for(ctx=Render._context,i=0;i<len;i++){var atlas,tex;(atlas=Loader.getAtlas(urls[i]))?this._decodeTexture(atlas[0],ctx):(tex=this.getRes(urls[i]))&&tex instanceof laya.resource.Texture&&this._decodeTexture(tex,ctx)}},__proto._decodeTexture=function(tex,ctx){var bitmap=tex.bitmap;if(tex&&bitmap){var tImg=bitmap.source||bitmap.image;tImg&&Laya.__typeof(tImg,Browser.window.HTMLImageElement)&&(ctx.drawImage(tImg,0,0,1,1),ctx.getImageData(0,0,1,1))}},LoaderManager.cacheRes=function(url,data){Loader.cacheRes(url,data)},LoaderManager._resMap={},__static(LoaderManager,["createMap",function(){return this.createMap={atlas:[null,"atlas"]}}]),LoaderManager.__init$=function(){ResInfo=function(_super){function ResInfo(){this.url=null,this.type=null,this.cache=!1,this.group=null,this.ignoreCache=!1,this.useWorkerLoader=!1,this.originalUrl=null,this.createCache=!1,this.createConstructParams=null,this.createPropertyParams=null,ResInfo.__super.call(this)}return __class(ResInfo,"",EventDispatcher),ResInfo}()},LoaderManager}(),Resource=function(_super){function Resource(){this._cpuMemory=0,this._gpuMemory=0,Resource.__super.call(this),this._id=++Resource._uniqueIDCounter,this._destroyed=!1,this._referenceCount=0,Resource._idResourcesMap[this.id]=this,this.lock=!1}__class(Resource,"laya.resource.Resource",EventDispatcher);var __proto=Resource.prototype;return Laya.imps(__proto,{"laya.resource.ICreateResource":!0,"laya.resource.IDestroy":!0}),__proto._setCPUMemory=function(value){var offsetValue=value-this._cpuMemory;this._cpuMemory=value,Resource._addCPUMemory(offsetValue)},__proto._setGPUMemory=function(value){var offsetValue=value-this._gpuMemory;this._gpuMemory=value,Resource._addGPUMemory(offsetValue)},__proto._setCreateURL=function(url){var resList;this._url!==url&&(this._url&&((resList=Resource._urlResourcesMap[this._url]).splice(resList.indexOf(this),1),0===resList.length&&delete Resource._urlResourcesMap[this._url]),url&&((resList=Resource._urlResourcesMap[url])||(Resource._urlResourcesMap[url]=resList=[]),resList.push(this)),this._url=url)},__proto._addReference=function(count){void 0===count&&(count=1),this._referenceCount+=count},__proto._removeReference=function(count){void 0===count&&(count=1),this._referenceCount-=count},__proto._clearReference=function(){this._referenceCount=0},__proto._recoverResource=function(){},__proto._disposeResource=function(){},__proto._activeResource=function(){},__proto.destroy=function(){var resList;this._destroyed||(this._destroyed=!0,this.lock=!1,this._disposeResource(),delete Resource._idResourcesMap[this.id],this._url&&((resList=Resource._urlResourcesMap[this._url])&&(resList.splice(resList.indexOf(this),1),0===resList.length&&delete Resource._urlResourcesMap[this._url]),Loader.getRes(this._url)==this&&delete Loader.loadedMap[this._url]))},__getset(0,__proto,"id",function(){return this._id}),__getset(0,__proto,"gpuMemory",function(){return this._gpuMemory}),__getset(0,__proto,"url",function(){return this._url}),__getset(0,__proto,"cpuMemory",function(){return this._cpuMemory}),__getset(0,__proto,"destroyed",function(){return this._destroyed}),__getset(0,__proto,"referenceCount",function(){return this._referenceCount}),__getset(1,Resource,"cpuMemory",function(){return this._cpuMemory},laya.events.EventDispatcher._$SET_cpuMemory),__getset(1,Resource,"gpuMemory",function(){return this._gpuMemory},laya.events.EventDispatcher._$SET_gpuMemory),Resource._addCPUMemory=function(size){this._cpuMemory+=size},Resource._addGPUMemory=function(size){this._gpuMemory+=size},Resource._addMemory=function(cpuSize,gpuSize){this._cpuMemory+=cpuSize,this._gpuMemory+=gpuSize},Resource.getResourceByID=function(id){return Resource._idResourcesMap[id]},Resource.getResourceByURL=function(url,index){return void 0===index&&(index=0),Resource._urlResourcesMap[url][index]},Resource.destroyUnusedResources=function(){for(var k in Resource._idResourcesMap){var res=Resource._idResourcesMap[k];res.lock||0!==res._referenceCount||res.destroy()}},Resource._uniqueIDCounter=0,Resource._idResourcesMap={},Resource._urlResourcesMap={},Resource._cpuMemory=0,Resource._gpuMemory=0,Resource}(),SceneLoader=function(_super){function SceneLoader(){this.totalCount=0,this._completeHandler=null,this._toLoadList=null,this._isLoading=!1,this._curUrl=null,SceneLoader.__super.call(this),this._completeHandler=new Handler(this,this.onOneLoadComplete),this.reset()}__class(SceneLoader,"laya.net.SceneLoader",EventDispatcher);var __proto=SceneLoader.prototype;return __proto.reset=function(){this._toLoadList=[],this._isLoading=!1,this.totalCount=0},__proto.load=function(url,is3D,ifCheck){if(void 0===is3D&&(is3D=!1),void 0===ifCheck&&(ifCheck=!0),url instanceof Array){var len,i=0;for(len=url.length,i=0;i<len;i++)this._addToLoadList(url[i],is3D)}else this._addToLoadList(url,is3D);ifCheck&&this._checkNext()},__proto._addToLoadList=function(url,is3D){void 0===is3D&&(is3D=!1),this._toLoadList.indexOf(url)>=0||Loader.getRes(url)||(is3D?this._toLoadList.push({url:url}):this._toLoadList.push(url),this.totalCount++)},__proto._checkNext=function(){if(!this._isLoading){if(0==this._toLoadList.length)return void this.event("complete");var tItem;"string"==typeof(tItem=this._toLoadList.pop())?this.loadOne(tItem):this.loadOne(tItem.url,!0)}},__proto.loadOne=function(url,is3D){void 0===is3D&&(is3D=!1),this._curUrl=url;var type=Utils.getFileExtension(this._curUrl);is3D?Laya.loader.create(url,this._completeHandler):SceneLoader.LoadableExtensions[type]?Laya.loader.load(url,this._completeHandler,null,SceneLoader.LoadableExtensions[type]):url!=AtlasInfoManager.getFileLoadPath(url)||SceneLoader.No3dLoadTypes[type]||!LoaderManager.createMap[type]?Laya.loader.load(url,this._completeHandler):Laya.loader.create(url,this._completeHandler)},__proto.onOneLoadComplete=function(){this._isLoading=!1,Loader.getRes(this._curUrl)||console.log("Fail to load:",this._curUrl);var dataO,type=Utils.getFileExtension(this._curUrl);SceneLoader.LoadableExtensions[type]&&((dataO=Loader.getRes(this._curUrl))&&dataO instanceof laya.components.Prefab&&(dataO=dataO.json),dataO&&(dataO.loadList&&this.load(dataO.loadList,!1,!1),dataO.loadList3D&&this.load(dataO.loadList3D,!0,!1))),"sk"==type&&this.load(this._curUrl.replace(".sk",".png"),!1,!1),this.event("progress",this.getProgress()),this._checkNext()},__proto.getProgress=function(){return this.loadedCount/this.totalCount},__getset(0,__proto,"loadedCount",function(){return this.totalCount-this.leftCount}),__getset(0,__proto,"leftCount",function(){return this._isLoading?this._toLoadList.length+1:this._toLoadList.length}),__static(SceneLoader,["LoadableExtensions",function(){return this.LoadableExtensions={scene:"json",scene3d:"json",ani:"json",ui:"json",prefab:"prefab"}},"No3dLoadTypes",function(){return this.No3dLoadTypes={png:!0,jpg:!0,txt:!0}}]),SceneLoader}(),Loader=function(_super){function Loader(){this._data=null,this._url=null,this._type=null,this._cache=!1,this._http=null,this._useWorkerLoader=!1,this._customParse=!1,this._constructParams=null,this._propertyParams=null,this._createCache=!1,Loader.__super.call(this)}__class(Loader,"laya.net.Loader",EventDispatcher);var __proto=Loader.prototype;return __proto.load=function(url,type,cache,group,ignoreCache,useWorkerLoader){if(void 0===cache&&(cache=!0),void 0===ignoreCache&&(ignoreCache=!1),void 0===useWorkerLoader&&(useWorkerLoader=!1),url){if(Loader.setGroup(url,"666"),this._url=url,0===url.indexOf("data:image")?type="image":url=URL.formatURL(url),this._type=type||(type=Loader.getTypeFromUrl(this._url)),this._cache=cache,this._useWorkerLoader=useWorkerLoader,this._data=null,!ignoreCache&&Loader.loadedMap[url])return this._data=Loader.loadedMap[url],this.event("progress",1),void this.event("complete",this._data);if(group&&Loader.setGroup(url,group),null!=Loader.parserMap[type])return this._customParse=!0,void(Loader.parserMap[type]instanceof laya.utils.Handler?Loader.parserMap[type].runWith(this):Loader.parserMap[type].call(null,this));if("image"===type||"htmlimage"===type||"nativeimage"===type)return this._loadImage(url);var contentType;switch(type){case"atlas":case"prefab":case"plf":contentType="json";break;case"font":contentType="xml";break;default:contentType=type}Loader.preLoadedMap[url]?this.onLoaded(Loader.preLoadedMap[url]):(this._http||(this._http=new HttpRequest,this._http.on("progress",this,this.onProgress),this._http.on("error",this,this.onError),this._http.on("complete",this,this.onLoaded)),this._http.send(url,null,"get",contentType))}else this.onLoaded(null)},__proto._loadImage=function(url){url=URL.formatURL(url);var image,_this=this;function clear(){var img=image;img&&(img.onload=null,img.onerror=null,delete Loader._imgCache[url])}var onerror=function(){clear(),_this.event("error","Load image failed")};if("nativeimage"===this._type){var onload=function(){clear(),_this.onLoaded(image)};(image=new Browser.window.Image).crossOrigin="",image.onload=onload,image.onerror=onerror,image.src=url,Loader._imgCache[url]=image}else{var imageSource=new Browser.window.Image;onload=function(){(image=HTMLImage.create(imageSource.width,imageSource.height)).loadImageSource(imageSource,!0),image._setCreateURL(url),clear(),_this.onLoaded(image)},imageSource.crossOrigin="",imageSource.onload=onload,imageSource.onerror=onerror,imageSource.src=url,image=imageSource,Loader._imgCache[url]=imageSource}},__proto.onProgress=function(value){"atlas"===this._type?this.event("progress",.3*value):this.event("progress",value)},__proto.onError=function(message){this.event("error",message)},__proto.onLoaded=function(data){var type=this._type;if("plf"==type)this.parsePLFData(data),this.complete(data);else if("image"===type){var tex=new Texture(data);tex.url=this._url,this.complete(tex)}else if("sound"===type||"htmlimage"===type||"nativeimage"===type)this.complete(data);else if("atlas"===type){if(!data.url&&!data._setContext){if(!this._data){if(this._data=data,data.meta&&data.meta.image)for(var toloadPics=data.meta.image.split(","),split=this._url.indexOf("/")>=0?"/":"\\",idx=this._url.lastIndexOf(split),folderPath=idx>=0?this._url.substr(0,idx+1):"",i=0,len=toloadPics.length;i<len;i++)toloadPics[i]=folderPath+toloadPics[i];else toloadPics=[this._url.replace(".json",".png")];toloadPics.reverse(),data.toLoads=toloadPics,data.pics=[]}return this.event("progress",.3+1/toloadPics.length*.6),this._loadImage(toloadPics.pop())}if(this._data.pics.push(data),this._data.toLoads.length>0)return this.event("progress",.3+1/this._data.toLoads.length*.6),this._loadImage(this._data.toLoads.pop());var frames=this._data.frames,cleanUrl=this._url.split("?")[0],directory=this._data.meta&&this._data.meta.prefix?this._data.meta.prefix:cleanUrl.substring(0,cleanUrl.lastIndexOf("."))+"/",pics=this._data.pics,atlasURL=URL.formatURL(this._url),map=Loader.atlasMap[atlasURL]||(Loader.atlasMap[atlasURL]=[]);map.dir=directory;var scaleRate=1;if(this._data.meta&&this._data.meta.scale&&1!=this._data.meta.scale)for(var name in scaleRate=parseFloat(this._data.meta.scale),frames){var tTexture,obj=frames[name],tPic=pics[obj.frame.idx?obj.frame.idx:0],url=URL.formatURL(directory+name);tPic.scaleRate=scaleRate,tTexture=Texture._create(tPic,obj.frame.x,obj.frame.y,obj.frame.w,obj.frame.h,obj.spriteSourceSize.x,obj.spriteSourceSize.y,obj.sourceSize.w,obj.sourceSize.h,laya.net.Loader.getRes(url)),Loader.cacheRes(url,tTexture),tTexture.url=url,map.push(url)}else for(name in frames)tPic=pics[(obj=frames[name]).frame.idx?obj.frame.idx:0],url=URL.formatURL(directory+name),tTexture=Texture._create(tPic,obj.frame.x,obj.frame.y,obj.frame.w,obj.frame.h,obj.spriteSourceSize.x,obj.spriteSourceSize.y,obj.sourceSize.w,obj.sourceSize.h,laya.net.Loader.getRes(url)),Loader.cacheRes(url,tTexture),tTexture.url=url,map.push(url);delete this._data.pics,this.complete(this._data)}else if("font"===type){if(!data._source)return this._data=data,this.event("progress",.5),this._loadImage(this._url.replace(".fnt",".png"))}else if("prefab"===type){var prefab=new Prefab;prefab.json=data,this.complete(prefab)}else this.complete(data)},__proto.parsePLFData=function(plfData){var type,filePath,fileDic;for(type in plfData)switch(fileDic=plfData[type],type){case"json":case"text":for(filePath in fileDic)Loader.preLoadedMap[URL.formatURL(filePath)]=fileDic[filePath];break;default:for(filePath in fileDic)Loader.preLoadedMap[URL.formatURL(filePath)]=fileDic[filePath]}},__proto.complete=function(data){this._data=data,this._customParse?this.event("loaded",data instanceof Array?[data]:data):(Loader._loaders.push(this),Loader._isWorking||Loader.checkNext())},__proto.endLoad=function(content){content&&(this._data=content),this._cache&&Loader.cacheRes(this._url,this._data),this.event("progress",1),this.event("complete",this.data instanceof Array?[this.data]:this.data)},__getset(0,__proto,"url",function(){return this._url}),__getset(0,__proto,"data",function(){return this._data}),__getset(0,__proto,"cache",function(){return this._cache}),__getset(0,__proto,"type",function(){return this._type}),Loader.getTypeFromUrl=function(url){var type=Utils.getFileExtension(url);return type?Loader.typeMap[type]:(console.warn("Not recognize the resources suffix",url),"text")},Loader.checkNext=function(){Loader._isWorking=!0;for(var startTimer=Browser.now();Loader._startIndex<Loader._loaders.length;)if(Browser.now(),Loader._loaders[Loader._startIndex].endLoad(),Loader._startIndex++,Browser.now()-startTimer>Loader.maxTimeOut)return console.warn("loader callback cost a long time:"+(Browser.now()-startTimer)+" url="+Loader._loaders[Loader._startIndex-1].url),void Laya.systemTimer.frameOnce(1,null,Loader.checkNext);Loader._loaders.length=0,Loader._startIndex=0,Loader._isWorking=!1},Loader.clearRes=function(url){url=URL.formatURL(url);var arr=Loader.getAtlas(url);if(arr){for(var i=0,n=arr.length;i<n;i++){var resUrl=arr[i],tex=Loader.getRes(resUrl);delete Loader.loadedMap[resUrl],tex&&tex.destroy()}arr.length=0,delete Loader.atlasMap[url],delete Loader.loadedMap[url]}else{var res=Loader.loadedMap[url];res&&(delete Loader.loadedMap[url],res instanceof laya.resource.Texture&&res.bitmap&&res.destroy())}},Loader.clearTextureRes=function(url){url=URL.formatURL(url);var arr=laya.net.Loader.getAtlas(url),res=arr&&arr.length>0?laya.net.Loader.getRes(arr[0]):laya.net.Loader.getRes(url);res instanceof laya.resource.Texture&&res.disposeBitmap()},Loader.getRes=function(url){return Loader.loadedMap[URL.formatURL(url)]},Loader.getAtlas=function(url){return Loader.atlasMap[URL.formatURL(url)]},Loader.cacheRes=function(url,data){url=URL.formatURL(url),null!=Loader.loadedMap[url]?console.warn("Resources already exist,is repeated loading:",url):Loader.loadedMap[url]=data},Loader.setGroup=function(url,group){Loader.groupMap[group]||(Loader.groupMap[group]=[]),Loader.groupMap[group].push(url)},Loader.clearResByGroup=function(group){if(Loader.groupMap[group]){var arr=Loader.groupMap[group],i=0,len=arr.length;for(i=0;i<len;i++)Loader.clearRes(arr[i]);arr.length=0}},Loader.TEXT="text",Loader.JSON="json",Loader.PREFAB="prefab",Loader.XML="xml",Loader.BUFFER="arraybuffer",Loader.IMAGE="image",Loader.SOUND="sound",Loader.ATLAS="atlas",Loader.FONT="font",Loader.TTF="ttf",Loader.PLF="plf",Loader.HIERARCHY="HIERARCHY",Loader.MESH="MESH",Loader.MATERIAL="MATERIAL",Loader.TEXTURE2D="TEXTURE2D",Loader.TEXTURECUBE="TEXTURECUBE",Loader.ANIMATIONCLIP="ANIMATIONCLIP",Loader.AVATAR="AVATAR",Loader.TERRAINHEIGHTDATA="TERRAINHEIGHTDATA",Loader.TERRAINRES="TERRAIN",Loader.typeMap={ttf:"ttf",png:"image",jpg:"image",jpeg:"image",txt:"text",json:"json",prefab:"prefab",xml:"xml",als:"atlas",atlas:"atlas",mp3:"sound",ogg:"sound",wav:"sound",part:"json",fnt:"font",pkm:"pkm",plf:"plf",scene:"json",ani:"json",sk:"arraybuffer"},Loader.parserMap={},Loader.maxTimeOut=100,Loader.groupMap={},Loader.loadedMap={},Loader.atlasMap={},Loader.preLoadedMap={},Loader._imgCache={},Loader._loaders=[],Loader._isWorking=!1,Loader._startIndex=0,Loader}(),MiniLoader=function(_super){function MiniLoader(){MiniLoader.__super.call(this)}return __class(MiniLoader,"laya.wx.mini.MiniLoader",EventDispatcher),MiniLoader.prototype.load=function(url,type,cache,group,ignoreCache){if(void 0===cache&&(cache=!0),void 0===ignoreCache&&(ignoreCache=!1),this._url=url,0===(url=URL.customFormat(url)).indexOf("data:image")?this._type=type="image":this._type=type||(type=Loader.getTypeFromUrl(this._url)),this._cache=cache,this._data=null,!ignoreCache&&Loader.loadedMap[URL.formatURL(url)])return this._data=Loader.loadedMap[URL.formatURL(url)],this.event("progress",1),void this.event("complete",this._data);if(null!=Loader.parserMap[type])return this._customParse=!0,void(Loader.parserMap[type]instanceof laya.utils.Handler?Loader.parserMap[type].runWith(this):Loader.parserMap[type].call(null,this));var encoding=MiniAdpter.getUrlEncode(url,type),urlType=Utils.getFileExtension(url);if(-1!=MiniLoader._fileTypeArr.indexOf(urlType))MiniAdpter.EnvConfig.load.call(this,url,type,cache,group,ignoreCache);else{if(MiniAdpter.isZiYu&&!MiniFileMgr.ziyuFileData[url]&&(url=URL.formatURL(url)),MiniAdpter.isZiYu&&MiniFileMgr.ziyuFileData[url]){var tempData=MiniFileMgr.ziyuFileData[url];return void this.onLoaded(tempData)}if(MiniFileMgr.getFileInfo(url)){var fileObj=MiniFileMgr.getFileInfo(url);fileObj.encoding=null==fileObj.encoding?"utf8":fileObj.encoding,MiniFileMgr.readFile(url,fileObj.encoding,new Handler(MiniLoader,MiniLoader.onReadNativeCallBack,[encoding,url,type,cache,group,ignoreCache,this]),url)}else{if(MiniFileMgr.isLocalNativeFile(url)){if(MiniAdpter.subNativeFiles&&0==MiniAdpter.subNativeheads.length)for(var key in MiniAdpter.subNativeFiles){var tempArr=MiniAdpter.subNativeFiles[key];MiniAdpter.subNativeheads=MiniAdpter.subNativeheads.concat(tempArr);for(var aa=0;aa<tempArr.length;aa++)MiniAdpter.subMaps[tempArr[aa]]=key+"/"+tempArr[aa]}if(MiniAdpter.subNativeFiles&&-1!=url.indexOf("/")){var curfileHead=url.split("/")[0]+"/";if(curfileHead&&-1!=MiniAdpter.subNativeheads.indexOf(curfileHead)){var newfileHead=MiniAdpter.subMaps[curfileHead];url=url.replace(curfileHead,newfileHead)}}var tempStr=""!=URL.rootPath?URL.rootPath:URL.basePath,tempUrl=url;return""!=tempStr&&(url=url.split(tempStr)[1]),url||(url=tempUrl),void MiniFileMgr.read(url,encoding,new Handler(MiniLoader,MiniLoader.onReadNativeCallBack,[encoding,url,type,cache,group,ignoreCache,this]))}-1!=(url=URL.formatURL(url)).indexOf("http://")||-1!=url.indexOf("https://")&&!MiniAdpter.AutoCacheDownFile?MiniAdpter.EnvConfig.load.call(this,url,type,cache,group,ignoreCache):MiniFileMgr.readFile(url,encoding,new Handler(MiniLoader,MiniLoader.onReadNativeCallBack,[encoding,url,type,cache,group,ignoreCache,this]),url)}}},MiniLoader.onReadNativeCallBack=function(encoding,url,type,cache,group,ignoreCache,thisLoader,errorCode,data){var tempData;void 0===cache&&(cache=!0),void 0===ignoreCache&&(ignoreCache=!1),void 0===errorCode&&(errorCode=0),errorCode?1==errorCode&&MiniAdpter.EnvConfig.load.call(thisLoader,url,type,cache,group,ignoreCache):(tempData="json"==type||"atlas"==type||"prefab"==type?MiniAdpter.getJson(data.data):"xml"==type?Utils.parseXMLFromString(data.data):data.data,!MiniAdpter.isZiYu&&MiniAdpter.isPosMsgYu&&"arraybuffer"!=type&&wx.postMessage({url:url,data:tempData,isLoad:"filedata"}),thisLoader.onLoaded(tempData))},__static(MiniLoader,["_fileTypeArr",function(){return this._fileTypeArr=["png","jpg","bmp","jpeg","gif"]}]),MiniLoader}(),Texture=(function(_super){function UIEvent(){UIEvent.__super.call(this)}__class(UIEvent,"laya.ui.UIEvent",Event),UIEvent.SHOW_TIP="showtip",UIEvent.HIDE_TIP="hidetip"}(),function(_super){function Texture(bitmap,uv,sourceWidth,sourceHeight){this.uvrect=[0,0,1,1],this._w=0,this._h=0,this._destroyed=!1,this._referenceCount=0,this.offsetX=0,this.offsetY=0,this.sourceWidth=0,this.sourceHeight=0,this.scaleRate=1,Texture.__super.call(this),void 0===sourceWidth&&(sourceWidth=0),void 0===sourceHeight&&(sourceHeight=0),this.setTo(bitmap,uv,sourceWidth,sourceHeight)}__class(Texture,"laya.resource.Texture",EventDispatcher);var __proto=Texture.prototype;return __proto._addReference=function(){this._bitmap&&this._bitmap._addReference(),this._referenceCount++},__proto._removeReference=function(){this._bitmap&&this._bitmap._removeReference(),this._referenceCount--},__proto._getSource=function(){return this._destroyed||!this._bitmap?null:(this.recoverBitmap(),this._bitmap.destroyed?null:this.bitmap._getSource())},__proto._onLoaded=function(complete,context){if(context)if(context==this);else if(context instanceof laya.resource.Texture){var tex=context;Texture._create(context,0,0,tex.width,tex.height,0,0,tex.sourceWidth,tex.sourceHeight,this)}else this.bitmap=context,this.sourceWidth=this._w=context.width,this.sourceHeight=this._h=context.height;complete&&complete.run(),this.event("ready",this)},__proto.getIsReady=function(){return!this._destroyed&&!!this._bitmap},__proto.setTo=function(bitmap,uv,sourceWidth,sourceHeight){void 0===sourceWidth&&(sourceWidth=0),void 0===sourceHeight&&(sourceHeight=0),this.bitmap=bitmap,this.sourceWidth=sourceWidth,this.sourceHeight=sourceHeight,bitmap&&(this._w=bitmap.width,this._h=bitmap.height,this.sourceWidth=this.sourceWidth||this._w,this.sourceHeight=this.sourceHeight||this._h),this.uv=uv||Texture.DEF_UV},__proto.load=function(url,complete){this._destroyed||Laya.loader.load(url,Handler.create(this,this._onLoaded,[complete]),null,"htmlimage",1,!1,null,!0)},__proto.getPixels=function(x,y,width,height){if(Render.isWebGL)return RunDriver.getTexturePixels(this,x,y,width,height);if(Render.isConchApp)return this._nativeObj.getImageData(x,y,width,height);var texw=this.width,texh=this.height;return x+width>texw&&(width-=x+width-texw),y+height>texh&&(height-=y+height-texh),width<=0||height<=0?null:(Browser.canvas.size(width,height),Browser.canvas.clear(),Browser.context.drawImage(this.bitmap._source,x,y,width,height,0,0,width,height),Browser.context.getImageData(0,0,width,height).data)},__proto.recoverBitmap=function(){var url=this._bitmap.url;this._destroyed||this._bitmap&&!this._bitmap.destroyed||!url||this.load(url)},__proto.disposeBitmap=function(){!this._destroyed&&this._bitmap&&this._bitmap.destroy()},__proto.destroy=function(){this._destroyed||(this._destroyed=!0,this.bitmap&&(this.bitmap._removeReference(this._referenceCount),this.bitmap=null),this.url&&this===Laya.loader.getRes(this.url)&&Laya.loader.clearRes(this.url))},__getset(0,__proto,"height",function(){return this._h?this._h:this.bitmap?this.uv&&this.uv!==Texture.DEF_UV?(this.uv[5]-this.uv[1])*this.bitmap.height:this.bitmap.height:0},function(value){this._h=value,this.sourceHeight||(this.sourceHeight=value)}),__getset(0,__proto,"uv",function(){return this._uv},function(value){this.uvrect[0]=Math.min(value[0],value[2],value[4],value[6]),this.uvrect[1]=Math.min(value[1],value[3],value[5],value[7]),this.uvrect[2]=Math.max(value[0],value[2],value[4],value[6])-this.uvrect[0],this.uvrect[3]=Math.max(value[1],value[3],value[5],value[7])-this.uvrect[1],this._uv=value}),__getset(0,__proto,"width",function(){return this._w?this._w:this.bitmap?this.uv&&this.uv!==Texture.DEF_UV?(this.uv[2]-this.uv[0])*this.bitmap.width:this.bitmap.width:0},function(value){this._w=value,this.sourceWidth||(this.sourceWidth=value)}),__getset(0,__proto,"bitmap",function(){return this._bitmap},function(value){this._bitmap&&this._bitmap._removeReference(this._referenceCount),this._bitmap=value,value&&value._addReference(this._referenceCount)}),__getset(0,__proto,"destroyed",function(){return this._destroyed}),Texture.moveUV=function(offsetX,offsetY,uv){for(var i=0;i<8;i+=2)uv[i]+=offsetX,uv[i+1]+=offsetY;return uv},Texture.create=function(source,x,y,width,height,offsetX,offsetY,sourceWidth,sourceHeight){return void 0===offsetX&&(offsetX=0),void 0===offsetY&&(offsetY=0),void 0===sourceWidth&&(sourceWidth=0),void 0===sourceHeight&&(sourceHeight=0),Texture._create(source,x,y,width,height,offsetX,offsetY,sourceWidth,sourceHeight)},Texture._create=function(source,x,y,width,height,offsetX,offsetY,sourceWidth,sourceHeight,outTexture){void 0===offsetX&&(offsetX=0),void 0===offsetY&&(offsetY=0),void 0===sourceWidth&&(sourceWidth=0),void 0===sourceHeight&&(sourceHeight=0);var tex,btex=source instanceof laya.resource.Texture,uv=btex?source.uv:Texture.DEF_UV,bitmap=btex?source.bitmap:source;bitmap.width&&x+width>bitmap.width&&(width=bitmap.width-x),bitmap.height&&y+height>bitmap.height&&(height=bitmap.height-y),outTexture?(tex=outTexture).setTo(bitmap,null,sourceWidth||width,sourceHeight||height):tex=new Texture(bitmap,null,sourceWidth||width,sourceHeight||height),tex.width=width,tex.height=height,tex.offsetX=offsetX,tex.offsetY=offsetY;var dwidth=1/bitmap.width,dheight=1/bitmap.height;x*=dwidth,y*=dheight,width*=dwidth,height*=dheight;var u1=tex.uv[0],v1=tex.uv[1],u2=tex.uv[4],v2=tex.uv[5],inAltasUVWidth=u2-u1,inAltasUVHeight=v2-v1,oriUV=Texture.moveUV(uv[0],uv[1],[x,y,x+width,y,x+width,y+height,x,y+height]);tex.uv=[u1+oriUV[0]*inAltasUVWidth,v1+oriUV[1]*inAltasUVHeight,u2-(1-oriUV[2])*inAltasUVWidth,v1+oriUV[3]*inAltasUVHeight,u2-(1-oriUV[4])*inAltasUVWidth,v2-(1-oriUV[5])*inAltasUVHeight,u1+oriUV[6]*inAltasUVWidth,v2-(1-oriUV[7])*inAltasUVHeight];var bitmapScale=bitmap.scaleRate;return bitmapScale&&1!=bitmapScale?(tex.sourceWidth/=bitmapScale,tex.sourceHeight/=bitmapScale,tex.width/=bitmapScale,tex.height/=bitmapScale,tex.scaleRate=bitmapScale):tex.scaleRate=1,tex},Texture.createFromTexture=function(texture,x,y,width,height){var texScaleRate=texture.scaleRate;1!=texScaleRate&&(x*=texScaleRate,y*=texScaleRate,width*=texScaleRate,height*=texScaleRate);var rect=Rectangle.TEMP.setTo(x-texture.offsetX,y-texture.offsetY,width,height),result=rect.intersection(Texture._rect1.setTo(0,0,texture.width,texture.height),Texture._rect2);return result?Texture.create(texture,result.x,result.y,result.width,result.height,result.x-rect.x,result.y-rect.y,width,height):null},Texture.DEF_UV=[0,0,1,0,1,1,0,1],Texture.NO_UV=[0,0,0,0,0,0,0,0],Texture.INV_UV=[0,1,1,1,1,0,0,0],Texture._rect1=new Rectangle,Texture._rect2=new Rectangle,Texture}()),TextStyle=function(_super){function TextStyle(){this.italic=!1,TextStyle.__super.call(this)}__class(TextStyle,"laya.display.css.TextStyle",_super);var __proto=TextStyle.prototype;return __proto.reset=function(){return _super.prototype.reset.call(this),this.italic=!1,this.align="left",this.wordWrap=!1,this.leading=0,this.padding=[0,0,0,0],this.bgColor=null,this.borderColor=null,this.asPassword=!1,this.stroke=0,this.strokeColor="#000000",this.bold=!1,this.underline=!1,this.underlineColor=null,this},__proto.recover=function(){this!==TextStyle.EMPTY&&Pool.recover("TextStyle",this.reset())},__proto.render=function(sprite,context,x,y){(this.bgColor||this.borderColor)&&context.drawRect(x,y,sprite.width,sprite.height,this.bgColor,this.borderColor,1)},TextStyle.create=function(){return Pool.getItemByClass("TextStyle",TextStyle)},TextStyle.EMPTY=new TextStyle,TextStyle}(SpriteStyle),TimeLine=(function(_super){function Script(){Script.__super.call(this)}__class(Script,"laya.components.Script",Component);var __proto=Script.prototype;__proto._onAwake=function(){this.onAwake(),this.onStart!==laya.components.Script.prototype.onStart&&Laya.startTimer.callLater(this,this.onStart)},__proto._onEnable=function(){var proto=laya.components.Script.prototype;this.onTriggerEnter!==proto.onTriggerEnter&&this.owner.on("triggerenter",this,this.onTriggerEnter),this.onTriggerStay!==proto.onTriggerStay&&this.owner.on("triggerstay",this,this.onTriggerStay),this.onTriggerExit!==proto.onTriggerExit&&this.owner.on("triggerexit",this,this.onTriggerExit),this.onMouseDown!==proto.onMouseDown&&this.owner.on("mousedown",this,this.onMouseDown),this.onMouseUp!==proto.onMouseUp&&this.owner.on("mouseup",this,this.onMouseUp),this.onClick!==proto.onClick&&this.owner.on("click",this,this.onClick),this.onStageMouseDown!==proto.onStageMouseDown&&Laya.stage.on("mousedown",this,this.onStageMouseDown),this.onStageMouseUp!==proto.onStageMouseUp&&Laya.stage.on("mouseup",this,this.onStageMouseUp),this.onStageClick!==proto.onStageClick&&Laya.stage.on("click",this,this.onStageClick),this.onStageMouseMove!==proto.onStageMouseMove&&Laya.stage.on("mousemove",this,this.onStageMouseMove),this.onDoubleClick!==proto.onDoubleClick&&this.owner.on("doubleclick",this,this.onDoubleClick),this.onRightClick!==proto.onRightClick&&this.owner.on("rightclick",this,this.onRightClick),this.onMouseMove!==proto.onMouseMove&&this.owner.on("mousemove",this,this.onMouseMove),this.onMouseOver!==proto.onMouseOver&&this.owner.on("mouseover",this,this.onMouseOver),this.onMouseOut!==proto.onMouseOut&&this.owner.on("mouseout",this,this.onMouseOut),this.onKeyDown!==proto.onKeyDown&&Laya.stage.on("keydown",this,this.onKeyDown),this.onKeyPress!==proto.onKeyPress&&Laya.stage.on("keypress",this,this.onKeyPress),this.onKeyUp!==proto.onKeyUp&&Laya.stage.on("keyup",this,this.onKeyUp),this.onUpdate!==proto.onUpdate&&Laya.updateTimer.frameLoop(1,this,this.onUpdate),this.onLateUpdate!==proto.onLateUpdate&&Laya.lateTimer.frameLoop(1,this,this.onLateUpdate),this.onPreRender!==proto.onPreRender&&Laya.lateTimer.frameLoop(1,this,this.onPreRender)},__proto._onDisable=function(){this.owner.offAllCaller(this),Laya.stage.offAllCaller(this),Laya.startTimer.clearAll(this),Laya.updateTimer.clearAll(this),Laya.lateTimer.clearAll(this)},__proto._isScript=function(){return!0},__proto._onDestroy=function(){this.onDestroy()},__proto.onAwake=function(){},__proto.onEnable=function(){},__proto.onStart=function(){},__proto.onTriggerEnter=function(other,self,contact){},__proto.onTriggerStay=function(other,self,contact){},__proto.onTriggerExit=function(other,self,contact){},__proto.onMouseDown=function(e){},__proto.onMouseUp=function(e){},__proto.onClick=function(e){},__proto.onStageMouseDown=function(e){},__proto.onStageMouseUp=function(e){},__proto.onStageClick=function(e){},__proto.onStageMouseMove=function(e){},__proto.onDoubleClick=function(e){},__proto.onRightClick=function(e){},__proto.onMouseMove=function(e){},__proto.onMouseOver=function(e){},__proto.onMouseOut=function(e){},__proto.onKeyDown=function(e){},__proto.onKeyPress=function(e){},__proto.onKeyUp=function(e){},__proto.onUpdate=function(){},__proto.onLateUpdate=function(){},__proto.onPreRender=function(){},__proto.onPostRender=function(){},__proto.onDisable=function(){},__proto.onDestroy=function(){},__getset(0,__proto,"isSingleton",function(){return!1})}(),function(_super){var tweenData;function TimeLine(){this._labelDic=null,this._tweenDic={},this._tweenDataList=[],this._endTweenDataList=null,this._currTime=0,this._lastTime=0,this._startTime=0,this._index=0,this._gidIndex=0,this._firstTweenDic={},this._startTimeSort=!1,this._endTimeSort=!1,this._loopKey=!1,this.scale=1,this._frameRate=60,this._frameIndex=0,this._total=0,TimeLine.__super.call(this)}__class(TimeLine,"laya.utils.TimeLine",EventDispatcher);var __proto=TimeLine.prototype;return __proto.to=function(target,props,duration,ease,offset){return void 0===offset&&(offset=0),this._create(target,props,duration,ease,offset,!0)},__proto.from=function(target,props,duration,ease,offset){return void 0===offset&&(offset=0),this._create(target,props,duration,ease,offset,!1)},__proto._create=function(target,props,duration,ease,offset,isTo){var tTweenData=Pool.getItemByClass("tweenData",tweenData);return tTweenData.isTo=isTo,tTweenData.type=0,tTweenData.target=target,tTweenData.duration=duration,tTweenData.data=props,tTweenData.startTime=this._startTime+offset,tTweenData.endTime=tTweenData.startTime+tTweenData.duration,tTweenData.ease=ease,this._startTime=Math.max(tTweenData.endTime,this._startTime),this._tweenDataList.push(tTweenData),this._startTimeSort=!0,this._endTimeSort=!0,this},__proto.addLabel=function(label,offset){var tTweenData=Pool.getItemByClass("tweenData",tweenData);return tTweenData.type=1,tTweenData.data=label,tTweenData.endTime=tTweenData.startTime=this._startTime+offset,this._labelDic||(this._labelDic={}),this._labelDic[label]=tTweenData,this._tweenDataList.push(tTweenData),this},__proto.removeLabel=function(label){if(this._labelDic&&this._labelDic[label]){var tTweenData=this._labelDic[label];if(tTweenData){var tIndex=this._tweenDataList.indexOf(tTweenData);tIndex>-1&&this._tweenDataList.splice(tIndex,1)}delete this._labelDic[label]}},__proto.gotoTime=function(time){if(null!=this._tweenDataList&&0!=this._tweenDataList.length){var tTween,tObject,tTweenDataCopyList,tTweenData;for(var p in this._firstTweenDic)if(tObject=this._firstTweenDic[p])for(var tDataP in tObject)tObject.diyTarget.hasOwnProperty(tDataP)&&(tObject.diyTarget[tDataP]=tObject[tDataP]);for(p in this._tweenDic)(tTween=this._tweenDic[p]).clear(),delete this._tweenDic[p];this._index=0,this._gidIndex=0,this._currTime=time,this._lastTime=Browser.now(),null==this._endTweenDataList||this._endTimeSort?(this._endTimeSort=!1,this._endTweenDataList=tTweenDataCopyList=this._tweenDataList.concat(),tTweenDataCopyList.sort(function(paraA,paraB){return paraA.endTime>paraB.endTime?1:paraA.endTime<paraB.endTime?-1:0})):tTweenDataCopyList=this._endTweenDataList;for(var i=0,n=tTweenDataCopyList.length;i<n;i++)if(0==(tTweenData=tTweenDataCopyList[i]).type){if(!(time>=tTweenData.endTime))break;this._index=Math.max(this._index,i+1);var props=tTweenData.data;if(tTweenData.isTo)for(var tP in props)tTweenData.target[tP]=props[tP]}for(i=0,n=this._tweenDataList.length;i<n;i++)0==(tTweenData=this._tweenDataList[i]).type&&time>=tTweenData.startTime&&time<tTweenData.endTime&&(this._index=Math.max(this._index,i+1),this._gidIndex++,(tTween=Pool.getItemByClass("tween",Tween))._create(tTweenData.target,tTweenData.data,tTweenData.duration,tTweenData.ease,Handler.create(this,this._animComplete,[this._gidIndex]),0,!1,tTweenData.isTo,!0,!1),tTween.setStartTime(this._currTime-(time-tTweenData.startTime)),tTween._updateEase(this._currTime),tTween.gid=this._gidIndex,this._tweenDic[this._gidIndex]=tTween)}},__proto.gotoLabel=function(Label){if(null!=this._labelDic){var tLabelData=this._labelDic[Label];tLabelData&&this.gotoTime(tLabelData.startTime)}},__proto.pause=function(){Laya.timer.clear(this,this._update)},__proto.resume=function(){this.play(this._currTime,this._loopKey)},__proto.play=function(timeOrLabel,loop){if(void 0===timeOrLabel&&(timeOrLabel=0),void 0===loop&&(loop=!1),this._tweenDataList){if(this._startTimeSort){this._startTimeSort=!1,this._tweenDataList.sort(function(paraA,paraB){return paraA.startTime>paraB.startTime?1:paraA.startTime<paraB.startTime?-1:0});for(var i=0,n=this._tweenDataList.length;i<n;i++){var tTweenData=this._tweenDataList[i];if(null!=tTweenData&&0==tTweenData.type){var tTarget=tTweenData.target,gid=tTarget.$_GID||(tTarget.$_GID=Utils.getGID()),tSrcData=null;for(var p in null==this._firstTweenDic[gid]?((tSrcData={}).diyTarget=tTarget,this._firstTweenDic[gid]=tSrcData):tSrcData=this._firstTweenDic[gid],tTweenData.data)null==tSrcData[p]&&(tSrcData[p]=tTarget[p])}}}"string"==typeof timeOrLabel?this.gotoLabel(timeOrLabel):this.gotoTime(timeOrLabel),this._loopKey=loop,this._lastTime=Browser.now(),Laya.timer.frameLoop(1,this,this._update)}},__proto._update=function(){if(this._currTime>=this._startTime){if(!this._loopKey){for(var p in this._tweenDic)(tTween=this._tweenDic[p]).complete();return this._complete(),void this.pause()}if(this._complete(),!this._tweenDataList)return;this.gotoTime(0)}var tTween,tNow=Browser.now(),tFrameTime=tNow-this._lastTime,tCurrTime=this._currTime+=tFrameTime*this.scale;for(p in this._lastTime=tNow,this._tweenDic)(tTween=this._tweenDic[p])._updateEase(tCurrTime);if(0!=this._tweenDataList.length&&this._index<this._tweenDataList.length){var tTweenData=this._tweenDataList[this._index];tCurrTime>=tTweenData.startTime&&(this._index++,0==tTweenData.type?(this._gidIndex++,(tTween=Pool.getItemByClass("tween",Tween))._create(tTweenData.target,tTweenData.data,tTweenData.duration,tTweenData.ease,Handler.create(this,this._animComplete,[this._gidIndex]),0,!1,tTweenData.isTo,!0,!1),tTween.setStartTime(tCurrTime),tTween.gid=this._gidIndex,this._tweenDic[this._gidIndex]=tTween,tTween._updateEase(tCurrTime)):this.event("label",tTweenData.data))}},__proto._animComplete=function(index){this._tweenDic[index]&&delete this._tweenDic[index]},__proto._complete=function(){this.event("complete")},__proto.reset=function(){var p;if(this._labelDic)for(p in this._labelDic)delete this._labelDic[p];for(p in this._tweenDic)this._tweenDic[p].clear(),delete this._tweenDic[p];for(p in this._firstTweenDic)delete this._firstTweenDic[p];if(this._endTweenDataList=null,this._tweenDataList&&this._tweenDataList.length){var len,i=0;for(len=this._tweenDataList.length,i=0;i<len;i++)this._tweenDataList[i]&&this._tweenDataList[i].destroy()}this._tweenDataList.length=0,this._currTime=0,this._lastTime=0,this._startTime=0,this._index=0,this._gidIndex=0,this.scale=1,Laya.timer.clear(this,this._update)},__proto.destroy=function(){this.reset(),this._labelDic=null,this._tweenDic=null,this._tweenDataList=null,this._firstTweenDic=null},__getset(0,__proto,"index",function(){return this._frameIndex},function(value){this._frameIndex=value,this.gotoTime(this._frameIndex/this._frameRate*1e3)}),__getset(0,__proto,"total",function(){return this._total=Math.floor(this._startTime/1e3*this._frameRate),this._total}),TimeLine.to=function(target,props,duration,ease,offset){return void 0===offset&&(offset=0),(new TimeLine).to(target,props,duration,ease,offset)},TimeLine.from=function(target,props,duration,ease,offset){return void 0===offset&&(offset=0),(new TimeLine).from(target,props,duration,ease,offset)},TimeLine.__init$=function(){tweenData=function(){function tweenData(){this.type=0,this.isTo=!0,this.startTime=NaN,this.endTime=NaN,this.target=null,this.duration=NaN,this.ease=null,this.data=null}return __class(tweenData,""),tweenData.prototype.destroy=function(){this.target=null,this.ease=null,this.data=null,this.isTo=!0,this.type=0,Pool.recover("tweenData",this)},tweenData}()},TimeLine}()),HttpRequest=function(_super){function HttpRequest(){this._responseType=null,this._data=null,this._url=null,HttpRequest.__super.call(this),this._http=new Browser.window.XMLHttpRequest}__class(HttpRequest,"laya.net.HttpRequest",EventDispatcher);var __proto=HttpRequest.prototype;return __proto.send=function(url,data,method,responseType,headers){void 0===method&&(method="get"),void 0===responseType&&(responseType="text"),this._responseType=responseType,this._data=null,this._url=url;var _this=this,http=this._http;if(url=URL.getAdptedFilePath(url),http.open(method,url,!0),headers)for(var i=0;i<headers.length;i++)http.setRequestHeader(headers[i++],headers[i]);else Render.isConchApp||(data&&"string"!=typeof data?http.setRequestHeader("Content-Type","application/json"):http.setRequestHeader("Content-Type","application/x-www-form-urlencoded"));http.responseType="arraybuffer"!==responseType?"text":"arraybuffer",http.onerror=function(e){_this._onError(e)},http.onabort=function(e){_this._onAbort(e)},http.onprogress=function(e){_this._onProgress(e)},http.onload=function(e){_this._onLoad(e)},http.send(data)},__proto._onProgress=function(e){e&&e.lengthComputable&&this.event("progress",e.loaded/e.total)},__proto._onAbort=function(e){this.error("Request was aborted by user")},__proto._onError=function(e){this.error("Request failed Status:"+this._http.status+" text:"+this._http.statusText)},__proto._onLoad=function(e){var http=this._http,status=void 0!==http.status?http.status:200;200===status||204===status||0===status?this.complete():this.error("["+http.status+"]"+http.statusText+":"+http.responseURL)},__proto.error=function(message){this.clear(),console.warn(this.url,message),this.event("error",message)},__proto.complete=function(){this.clear();var flag=!0;try{"json"===this._responseType?this._data=JSON.parse(this._http.responseText):"xml"===this._responseType?this._data=Utils.parseXMLFromString(this._http.responseText):this._data=this._http.response||this._http.responseText}catch(e){flag=!1,this.error(e.message)}flag&&this.event("complete",this._data instanceof Array?[this._data]:this._data)},__proto.clear=function(){var http=this._http;http.onerror=http.onabort=http.onprogress=http.onload=null},__getset(0,__proto,"url",function(){return this._url}),__getset(0,__proto,"http",function(){return this._http}),__getset(0,__proto,"data",function(){return this._data}),HttpRequest}(),AutoBitmap=function(_super){function AutoBitmap(){this.autoCacheCmd=!0,this._width=0,this._height=0,this._source=null,this._sizeGrid=null,this._isChanged=!1,this._offset=null,AutoBitmap.__super.call(this)}__class(AutoBitmap,"laya.ui.AutoBitmap",_super);var __proto=AutoBitmap.prototype;return __proto.destroy=function(){_super.prototype.destroy.call(this),this._source=null,this._sizeGrid=null,this._offset=null},__proto._setChanged=function(){this._isChanged||(this._isChanged=!0,Laya.timer.callLater(this,this.changeSource))},__proto.changeSource=function(){this._isChanged=!1;var source=this._source;if(source&&source.bitmap){var width=this.width,height=this.height,sizeGrid=this._sizeGrid,sw=source.sourceWidth,sh=source.sourceHeight;if(!sizeGrid||sw===width&&sh===height)this.clear(),this.drawTexture(source,this._offset?this._offset[0]:0,this._offset?this._offset[1]:0,width,height);else{this.clear();var top=sizeGrid[0],right=sizeGrid[1],bottom=sizeGrid[2],left=sizeGrid[3],repeat=sizeGrid[4],needClip=!1;if(width==sw&&(left=right=0),height==sh&&(top=bottom=0),left+right>width){var clipWidth=width;needClip=!0,width=left+right,this.save(),this.clipRect(0,0,clipWidth,height)}left&&top&&this.drawImage(AutoBitmap.getTexture(source,0,0,left,top),0,0,left,top),right&&top&&this.drawImage(AutoBitmap.getTexture(source,sw-right,0,right,top),width-right,0,right,top),left&&bottom&&this.drawImage(AutoBitmap.getTexture(source,0,sh-bottom,left,bottom),0,height-bottom,left,bottom),right&&bottom&&this.drawImage(AutoBitmap.getTexture(source,sw-right,sh-bottom,right,bottom),width-right,height-bottom,right,bottom),top&&this.drawBitmap(repeat,AutoBitmap.getTexture(source,left,0,sw-left-right,top),left,0,width-left-right,top),bottom&&this.drawBitmap(repeat,AutoBitmap.getTexture(source,left,sh-bottom,sw-left-right,bottom),left,height-bottom,width-left-right,bottom),left&&this.drawBitmap(repeat,AutoBitmap.getTexture(source,0,top,left,sh-top-bottom),0,top,left,height-top-bottom),right&&this.drawBitmap(repeat,AutoBitmap.getTexture(source,sw-right,top,right,sh-top-bottom),width-right,top,right,height-top-bottom),this.drawBitmap(repeat,AutoBitmap.getTexture(source,left,top,sw-left-right,sh-top-bottom),left,top,width-left-right,height-top-bottom),needClip&&this.restore()}this._repaint()}},__proto.drawBitmap=function(repeat,tex,x,y,width,height){void 0===width&&(width=0),void 0===height&&(height=0),width<.1||height<.1||(!repeat||tex.width==width&&tex.height==height?this.drawImage(tex,x,y,width,height):this.fillTexture(tex,x,y,width,height))},__getset(0,__proto,"sizeGrid",function(){return this._sizeGrid},function(value){this._sizeGrid=value,this._setChanged()}),__getset(0,__proto,"width",function(){return this._width?this._width:this._source?this._source.sourceWidth:0},function(value){this._width!=value&&(this._width=value,this._setChanged())}),__getset(0,__proto,"height",function(){return this._height?this._height:this._source?this._source.sourceHeight:0},function(value){this._height!=value&&(this._height=value,this._setChanged())}),__getset(0,__proto,"source",function(){return this._source},function(value){value?(this._source=value,this._setChanged()):(this._source=null,this.clear())}),AutoBitmap.getTexture=function(tex,x,y,width,height){var texture;return width<=0&&(width=1),height<=0&&(height=1),tex.$_GID||(tex.$_GID=Utils.getGID()),texture&&texture._getSource()||(texture=Texture.createFromTexture(tex,x,y,width,height)),texture},AutoBitmap}(Graphics),Sprite=function(_super){function Sprite(){this._x=0,this._y=0,this._width=0,this._height=0,this._visible=!0,this._mouseState=0,this._zOrder=0,this._renderType=0,this._transform=null,this._tfChanged=!1,this._texture=null,this._boundStyle=null,this._graphics=null,this.mouseThrough=!1,this.autoSize=!1,this.hitTestPrior=!1,Sprite.__super.call(this),this._repaint=0,this._style=SpriteStyle.EMPTY,this._cacheStyle=CacheStyle.EMPTY}__class(Sprite,"laya.display.Sprite",_super);var __proto=Sprite.prototype;return __proto.destroy=function(destroyChild){void 0===destroyChild&&(destroyChild=!0),_super.prototype.destroy.call(this,destroyChild),this._style&&this._style.recover(),this._cacheStyle&&this._cacheStyle.recover(),this._boundStyle&&this._boundStyle.recover(),this._style=null,this._cacheStyle=null,this._boundStyle=null,this._transform=null,this._graphics&&this._graphics.autoDestroy&&this._graphics.destroy(),this._graphics=null,this.texture=null},__proto.updateZOrder=function(){Utils.updateOrder(this._children)&&this.repaint()},__proto._getBoundsStyle=function(){return this._boundStyle||(this._boundStyle=BoundsStyle.create()),this._boundStyle},__proto._setCustomRender=function(){},__proto._setCacheAs=function(value){},__proto._checkCanvasEnable=function(){var tEnable=this._cacheStyle.needEnableCanvasRender();this._getCacheStyle().enableCanvasRender=tEnable,tEnable?(this._cacheStyle.needBitmapCache()?this._cacheStyle.cacheAs="bitmap":this._cacheStyle.cacheAs=this._cacheStyle.userSetCache,this._cacheStyle.reCache=!0,this._renderType|=8):(this._cacheStyle.cacheAs="none",this._cacheStyle.releaseContext(),this._renderType&=-9),this._setCacheAs(this._cacheStyle.cacheAs),this._setRenderType(this._renderType)},__proto.reCache=function(){this._cacheStyle.reCache=!0,this._repaint|=2},__proto.getRepaint=function(){return this._repaint},__proto._setX=function(value){this._x=value},__proto._setY=function(value){this._y=value},__proto._setWidth=function(texture,value){},__proto._setHeight=function(texture,value){},__proto.setSelfBounds=function(bound){this._getBoundsStyle().userBounds=bound},__proto.getBounds=function(){return this._getBoundsStyle().bounds=Rectangle._getWrapRec(this._boundPointsToParent())},__proto.getSelfBounds=function(){return this._boundStyle&&this._boundStyle.userBounds?this._boundStyle.userBounds:this._graphics||0!==this._children.length||this._texture?this._getBoundsStyle().bounds=Rectangle._getWrapRec(this._getBoundPointsM(!1)):Rectangle.TEMP.setTo(0,0,0,0)},__proto._boundPointsToParent=function(ifRotate){void 0===ifRotate&&(ifRotate=!1);var pX=0,pY=0;this._style&&(pX=this.pivotX,pY=this.pivotY,ifRotate=ifRotate||0!==this._style.rotation,this._style.scrollRect&&(pX+=this._style.scrollRect.x,pY+=this._style.scrollRect.y));var pList=this._getBoundPointsM(ifRotate);if(!pList||pList.length<1)return pList;if(8!=pList.length&&(pList=ifRotate?GrahamScan.scanPList(pList):Rectangle._getWrapRec(pList,Rectangle.TEMP)._getBoundPoints()),!this.transform)return Utils.transPointList(pList,this._x-pX,this._y-pY),pList;var tPoint=Point.TEMP,i=0,len=pList.length;for(i=0;i<len;i+=2)tPoint.x=pList[i],tPoint.y=pList[i+1],this.toParentPoint(tPoint),pList[i]=tPoint.x,pList[i+1]=tPoint.y;return pList},__proto.getGraphicBounds=function(realSize){return void 0===realSize&&(realSize=!1),this._graphics?this._graphics.getBounds(realSize):Rectangle.TEMP.setTo(0,0,0,0)},__proto._getBoundPointsM=function(ifRotate){if(void 0===ifRotate&&(ifRotate=!1),this._boundStyle&&this._boundStyle.userBounds)return this._boundStyle.userBounds._getBoundPoints();if(this._boundStyle||this._getBoundsStyle(),this._boundStyle.temBM||(this._boundStyle.temBM=[]),this._style.scrollRect){var rst=Utils.clearArray(this._boundStyle.temBM),rec=Rectangle.TEMP;return rec.copyFrom(this._style.scrollRect),Utils.concatArray(rst,rec._getBoundPoints()),rst}var pList,child,cList,__childs;this._graphics?pList=this._graphics.getBoundPoints():(pList=Utils.clearArray(this._boundStyle.temBM),this._texture&&((rec=Rectangle.TEMP).setTo(0,0,this._texture.width,this._texture.height),Utils.concatArray(pList,rec._getBoundPoints())));for(var i=0,n=(__childs=this._children).length;i<n;i++)(child=__childs[i])instanceof laya.display.Sprite&&!0===child._visible&&(cList=child._boundPointsToParent(ifRotate))&&(pList=pList?Utils.concatArray(pList,cList):cList);return pList},__proto._getCacheStyle=function(){return this._cacheStyle===CacheStyle.EMPTY&&(this._cacheStyle=CacheStyle.create()),this._cacheStyle},__proto.getStyle=function(){return this._style===SpriteStyle.EMPTY&&(this._style=SpriteStyle.create()),this._style},__proto.setStyle=function(value){this._style=value},__proto._setScaleX=function(value){this._style.scaleX=value},__proto._setScaleY=function(value){this._style.scaleY=value},__proto._setRotation=function(value){this._style.rotation=value},__proto._setSkewX=function(value){this._style.skewX=value},__proto._setSkewY=function(value){this._style.skewY=value},__proto._createTransform=function(){return Matrix.create()},__proto._adjustTransform=function(){this._tfChanged=!1;var style=this._style,sx=style.scaleX,sy=style.scaleY,m=this._transform||(this._transform=this._createTransform());if(style.rotation||1!==sx||1!==sy||0!==style.skewX||0!==style.skewY){m._bTransform=!0;var skx=.0174532922222222*(style.rotation-style.skewX),sky=.0174532922222222*(style.rotation+style.skewY),cx=Math.cos(sky),ssx=Math.sin(sky),cy=Math.sin(skx),ssy=Math.cos(skx);m.a=sx*cx,m.b=sx*ssx,m.c=-sy*cy,m.d=sy*ssy,m.tx=m.ty=0}else m.identity(),this._renderType&=-3,this._setRenderType(this._renderType);return m},__proto._setTransform=function(value){},__proto._setPivotX=function(value){this.getStyle().pivotX=value},__proto._getPivotX=function(){return this._style.pivotX},__proto._setPivotY=function(value){this.getStyle().pivotY=value},__proto._getPivotY=function(){return this._style.pivotY},__proto._setAlpha=function(value){this._style.alpha!==value&&(this.getStyle().alpha=value,1!==value?this._renderType|=1:this._renderType&=-2,this._setRenderType(this._renderType),this.parentRepaint())},__proto._getAlpha=function(){return this._style.alpha},__proto._setBlendMode=function(value){},__proto._setGraphics=function(value){},__proto._setGraphicsCallBack=function(){},__proto._setScrollRect=function(value){},__proto.pos=function(x,y,speedMode){if(void 0===speedMode&&(speedMode=!1),this._x!==x||this._y!==y){if(this.destroyed)return this;if(speedMode){this._setX(x),this._setY(y),this.parentRepaint(2);var p=this._cacheStyle.maskParent;p&&p.repaint(2)}else this.x=x,this.y=y}return this},__proto.pivot=function(x,y){return this.pivotX=x,this.pivotY=y,this},__proto.size=function(width,height){return this.width=width,this.height=height,this},__proto.scale=function(scaleX,scaleY,speedMode){void 0===speedMode&&(speedMode=!1);var style=this.getStyle();if(style.scaleX!=scaleX||style.scaleY!=scaleY){if(this.destroyed)return this;speedMode?(this._setScaleX(scaleX),this._setScaleY(scaleY),this._setTranformChange()):(this.scaleX=scaleX,this.scaleY=scaleY)}return this},__proto.skew=function(skewX,skewY){return this.skewX=skewX,this.skewY=skewY,this},__proto.render=function(ctx,x,y){Stat.spriteCount++,RenderSprite.renders[this._renderType]._fun(this,ctx,x+this._x,y+this._y),this._repaint=0},__proto.drawToCanvas=function(canvasWidth,canvasHeight,offsetX,offsetY){return RunDriver.drawToCanvas(this,this._renderType,canvasWidth,canvasHeight,offsetX,offsetY)},__proto.customRender=function(context,x,y){this._repaint=3},__proto._applyFilters=function(){var _filters;if(!Render.isWebGL&&(_filters=this._cacheStyle.filters)&&!(_filters.length<1))for(var i=0,n=_filters.length;i<n;i++)_filters[i]._action&&_filters[i]._action.apply(this._cacheStyle)},__proto._setColorFilter=function(value){},__proto._isHaveGlowFilter=function(){var len,i=0;if(this.filters)for(i=0;i<this.filters.length;i++)if(8==this.filters[i].type)return!0;for(i=0,len=this._children.length;i<len;i++)if(this._children[i]._isHaveGlowFilter())return!0;return!1},__proto.localToGlobal=function(point,createNewPoint,globalNode){void 0===createNewPoint&&(createNewPoint=!1),!0===createNewPoint&&(point=new Point(point.x,point.y));var ele=this;for(globalNode=globalNode||Laya.stage;ele&&!ele.destroyed&&ele!=globalNode;)point=ele.toParentPoint(point),ele=ele.parent;return point},__proto.globalToLocal=function(point,createNewPoint,globalNode){void 0===createNewPoint&&(createNewPoint=!1),createNewPoint&&(point=new Point(point.x,point.y));var ele=this,list=[];for(globalNode=globalNode||Laya.stage;ele&&!ele.destroyed&&ele!=globalNode;)list.push(ele),ele=ele.parent;for(var i=list.length-1;i>=0;)point=(ele=list[i]).fromParentPoint(point),i--;return point},__proto.toParentPoint=function(point){if(!point)return point;point.x-=this.pivotX,point.y-=this.pivotY,this.transform&&this._transform.transformPoint(point),point.x+=this._x,point.y+=this._y;var scroll=this._style.scrollRect;return scroll&&(point.x-=scroll.x,point.y-=scroll.y),point},__proto.fromParentPoint=function(point){if(!point)return point;point.x-=this._x,point.y-=this._y;var scroll=this._style.scrollRect;return scroll&&(point.x+=scroll.x,point.y+=scroll.y),this.transform&&this._transform.invertTransformPoint(point),point.x+=this.pivotX,point.y+=this.pivotY,point},__proto.fromStagePoint=function(point){return point},__proto.on=function(type,caller,listener,args){return 1!==this._mouseState&&this.isMouseEvent(type)?(this.mouseEnabled=!0,this._setBit(64,!0),this._parent&&this._$2__onDisplay(),this._createListener(type,caller,listener,args,!1)):_super.prototype.on.call(this,type,caller,listener,args)},__proto.once=function(type,caller,listener,args){return 1!==this._mouseState&&this.isMouseEvent(type)?(this.mouseEnabled=!0,this._setBit(64,!0),this._parent&&this._$2__onDisplay(),this._createListener(type,caller,listener,args,!0)):_super.prototype.once.call(this,type,caller,listener,args)},__proto._$2__onDisplay=function(){if(1!==this._mouseState){var ele=this;for(ele=ele.parent;ele&&1!==ele._mouseState&&!ele._getBit(64);)ele.mouseEnabled=!0,ele._setBit(64,!0),ele=ele.parent}},__proto._setParent=function(value){_super.prototype._setParent.call(this,value),value&&this._getBit(64)&&this._$2__onDisplay()},__proto.loadImage=function(url,complete){var _$this=this;if(null==url)this.texture=null,loaded();else{var tex=Loader.getRes(url);tex||((tex=new Texture).load(url),Loader.cacheRes(url,tex)),this.texture=tex,tex.getIsReady()?loaded():tex.once("ready",null,loaded)}function loaded(){_$this.repaint(3),complete&&complete.run()}return this},__proto.repaint=function(type){void 0===type&&(type=2),this._repaint&type||(this._repaint|=type,this.parentRepaint(type)),this._cacheStyle&&this._cacheStyle.maskParent&&this._cacheStyle.maskParent.repaint(type)},__proto._needRepaint=function(){return 2&this._repaint&&this._cacheStyle.enableCanvasRender&&this._cacheStyle.reCache},__proto._childChanged=function(child){this._children.length?this._renderType|=8192:this._renderType&=-8193,this._setRenderType(this._renderType),child&&this._getBit(32)&&Laya.systemTimer.callLater(this,this.updateZOrder),this.repaint(3)},__proto.parentRepaint=function(type){void 0===type&&(type=2);var p=this._parent;!p||p._repaint&type||(p._repaint|=type,p.parentRepaint(type))},__proto._setMask=function(value){},__proto.startDrag=function(area,hasInertia,elasticDistance,elasticBackTime,data,disableMouseEvent,ratio){void 0===hasInertia&&(hasInertia=!1),void 0===elasticDistance&&(elasticDistance=0),void 0===elasticBackTime&&(elasticBackTime=300),void 0===disableMouseEvent&&(disableMouseEvent=!1),void 0===ratio&&(ratio=.92),this._style.dragging||(this.getStyle().dragging=new Dragging),this._style.dragging.start(this,area,hasInertia,elasticDistance,elasticBackTime,data,disableMouseEvent,ratio)},__proto.stopDrag=function(){this._style.dragging&&this._style.dragging.stop()},__proto._setDisplay=function(value){value||this._cacheStyle&&(this._cacheStyle.releaseContext(),this._cacheStyle.releaseFilterCache(),this._cacheStyle.hasGlowFilter&&(this._cacheStyle.hasGlowFilter=!1)),_super.prototype._setDisplay.call(this,value)},__proto.hitTestPoint=function(x,y){var point=this.globalToLocal(Point.TEMP.setTo(x,y));return x=point.x,y=point.y,(this._style.hitArea?this._style.hitArea:this._width>0&&this._height>0?Rectangle.TEMP.setTo(0,0,this._width,this._height):this.getSelfBounds()).contains(x,y)},__proto.getMousePoint=function(){return this.globalToLocal(Point.TEMP.setTo(Laya.stage.mouseX,Laya.stage.mouseY))},__proto._setTexture=function(value){},__proto._setRenderType=function(type){},__proto._setTranformChange=function(){this._tfChanged=!0,this._renderType|=2,this.parentRepaint(2)},__proto._setBgStyleColor=function(x,y,width,height,fillColor){},__proto._setBorderStyleColor=function(x,y,width,height,fillColor,borderWidth){},__proto.captureMouseEvent=function(exclusive){MouseManager.instance.setCapture(this,exclusive)},__proto.releaseMouseEvent=function(){MouseManager.instance.releaseCapture()},__getset(0,__proto,"customRenderEnable",null,function(b){b&&(this._renderType|=2048,this._setRenderType(this._renderType),this._setCustomRender())}),__getset(0,__proto,"cacheAs",function(){return this._cacheStyle.cacheAs},function(value){value!==this._cacheStyle.userSetCache&&(Render.isConchApp&&"bitmap"!=value||this.mask&&"normal"===value||(this._setCacheAs(value),this._getCacheStyle().userSetCache=value,this._checkCanvasEnable(),this.repaint()))}),__getset(0,__proto,"globalScaleY",function(){for(var scale=1,ele=this;ele&&ele!==Laya.stage;)scale*=ele.scaleY,ele=ele.parent;return scale}),__getset(0,__proto,"hitArea",function(){return this._style.hitArea},function(value){this.getStyle().hitArea=value}),__getset(0,__proto,"staticCache",function(){return this._cacheStyle.staticCache},function(value){this._getCacheStyle().staticCache=value,value||this.reCache()}),__getset(0,__proto,"displayWidth",function(){return this.width*this.scaleX}),__getset(0,__proto,"zOrder",function(){return this._zOrder},function(value){this._zOrder!=value&&(this._zOrder=value,this._parent&&(value&&this._parent._setBit(32,!0),Laya.systemTimer.callLater(this._parent,this.updateZOrder)))}),__getset(0,__proto,"rotation",function(){return this._style.rotation},function(value){this.getStyle().rotation!==value&&(this._setRotation(value),this._setTranformChange())}),__getset(0,__proto,"width",function(){return this.autoSize?this.texture?this.texture.width:this._graphics||0!==this._children.length?this.getSelfBounds().width:0:this._width||(this.texture?this.texture.width:0)},function(value){this._width!==value&&(this._width=value,this._setWidth(this.texture,value),this._setTranformChange())}),__getset(0,__proto,"x",function(){return this._x},function(value){if(!this.destroyed&&this._x!==value){this._setX(value),this.parentRepaint(2);var p=this._cacheStyle.maskParent;p&&p.repaint(2)}}),__getset(0,__proto,"drawCallOptimize",function(){return this._getBit(256)},function(value){this._setBit(256,value)}),__getset(0,__proto,"texture",function(){return this._texture},function(value){"string"==typeof value?this.loadImage(value):this._texture!=value&&(this._texture&&this._texture._removeReference(),this._texture=value,value&&value._addReference(),this._setTexture(value),this._setWidth(this._texture,this.width),this._setHeight(this._texture,this.height),value?this._renderType|=256:this._renderType&=-257,this._setRenderType(this._renderType),this.repaint())}),__getset(0,__proto,"globalRotation",function(){for(var angle=0,ele=this;ele&&ele!==Laya.stage;)angle+=ele.rotation,ele=ele.parent;return angle}),__getset(0,__proto,"y",function(){return this._y},function(value){if(!this.destroyed&&this._y!==value){this._setY(value),this.parentRepaint(2);var p=this._cacheStyle.maskParent;p&&p.repaint(2)}}),__getset(0,__proto,"displayHeight",function(){return this.height*this.scaleY}),__getset(0,__proto,"height",function(){return this.autoSize?this.texture?this.texture.height:this._graphics||0!==this._children.length?this.getSelfBounds().height:0:this._height||(this.texture?this.texture.height:0)},function(value){this._height!==value&&(this._height=value,this._setHeight(this.texture,value),this._setTranformChange())}),__getset(0,__proto,"blendMode",function(){return this._style.blendMode},function(value){this._setBlendMode(value),this.getStyle().blendMode=value,value&&"source-over"!=value?this._renderType|=4:this._renderType&=-5,this._setRenderType(this._renderType),this.parentRepaint()}),__getset(0,__proto,"scaleX",function(){return this._style.scaleX},function(value){this.getStyle().scaleX!==value&&(this._setScaleX(value),this._setTranformChange())}),__getset(0,__proto,"scaleY",function(){return this._style.scaleY},function(value){this.getStyle().scaleY!==value&&(this._setScaleY(value),this._setTranformChange())}),__getset(0,__proto,"stage",function(){return Laya.stage}),__getset(0,__proto,"skewX",function(){return this._style.skewX},function(value){this.getStyle().skewX!==value&&(this._setSkewX(value),this._setTranformChange())}),__getset(0,__proto,"scrollRect",function(){return this._style.scrollRect},function(value){this.getStyle().scrollRect=value,this._setScrollRect(value),this.repaint(),value?this._renderType|=64:this._renderType&=-65,this._setRenderType(this._renderType)}),__getset(0,__proto,"skewY",function(){return this._style.skewY},function(value){this.getStyle().skewY!==value&&(this._setSkewY(value),this._setTranformChange())}),__getset(0,__proto,"transform",function(){return this._tfChanged?this._adjustTransform():this._transform},function(value){this._tfChanged=!1;var m=this._transform||(this._transform=this._createTransform());value.copyTo(m),this._setTransform(m),value&&(this._x=value.tx,this._y=value.ty,value.tx=value.ty=0),value?this._renderType|=2:this._renderType&=-3,this._setRenderType(this._renderType),this.parentRepaint()}),__getset(0,__proto,"pivotX",function(){return this._getPivotX()},function(value){this._setPivotX(value),this.repaint()}),__getset(0,__proto,"pivotY",function(){return this._getPivotY()},function(value){this._setPivotY(value),this.repaint()}),__getset(0,__proto,"alpha",function(){return this._getAlpha()},function(value){value=value<0?0:value>1?1:value,this._setAlpha(value)}),__getset(0,__proto,"visible",function(){return this._visible},function(value){this._visible!==value&&(this._visible=value,this.parentRepaint(3))}),__getset(0,__proto,"graphics",function(){return this._graphics||(this.graphics=new Graphics,this._graphics.autoDestroy=!0),this._graphics},function(value){this._graphics&&(this._graphics._sp=null),this._graphics=value,value?(this._setGraphics(value),this._renderType|=512,value._sp=this):this._renderType&=-513,this._setRenderType(this._renderType),this.repaint()}),__getset(0,__proto,"filters",function(){return this._cacheStyle.filters},function(value){value&&0===value.length&&(value=null),this._cacheStyle.filters!=value&&(this._getCacheStyle().filters=value?value.slice():null,(Render.isWebGL||Render.isConchApp)&&(value&&value.length?(this._setColorFilter(value[0]),this._renderType|=16):(this._setColorFilter(null),this._renderType&=-17),this._setRenderType(this._renderType)),value&&value.length>0?(this._getBit(16)||this._setBitUp(16),(Render.isWebGL||Render.isConchApp)&&1==value.length&&value[0]instanceof laya.filters.ColorFilter||(this._getCacheStyle().cacheForFilters=!0,this._checkCanvasEnable())):this._cacheStyle.cacheForFilters&&(this._cacheStyle.cacheForFilters=!1,this._checkCanvasEnable()),this._getCacheStyle().hasGlowFilter=this._isHaveGlowFilter(),this.repaint())}),__getset(0,__proto,"mask",function(){return this._cacheStyle.mask},function(value){value&&this.mask&&this.mask._cacheStyle.maskParent||(this._getCacheStyle().mask=value,this._setMask(value),this._checkCanvasEnable(),value?value._getCacheStyle().maskParent=this:this.mask&&(this.mask._getCacheStyle().maskParent=null),this._renderType|=32,this._setRenderType(this._renderType),this.parentRepaint(3))}),__getset(0,__proto,"mouseEnabled",function(){return this._mouseState>1},function(value){this._mouseState=value?2:1}),__getset(0,__proto,"globalScaleX",function(){for(var scale=1,ele=this;ele&&ele!==Laya.stage;)scale*=ele.scaleX,ele=ele.parent;return scale}),__getset(0,__proto,"mouseX",function(){return this.getMousePoint().x}),__getset(0,__proto,"mouseY",function(){return this.getMousePoint().y}),__getset(0,__proto,"viewport",function(){return this._style.viewport},function(value){var recArr;"string"==typeof value&&(recArr=value.split(",")).length>3&&(value=new Rectangle(parseFloat(recArr[0]),parseFloat(recArr[1]),parseFloat(recArr[2]),parseFloat(recArr[3]))),this.getStyle().viewport=value}),Sprite.fromImage=function(url){return(new Sprite).loadImage(url)},Sprite}(Node),Bitmap=function(_super){function Bitmap(){Bitmap.__super.call(this),this._width=-1,this._height=-1}__class(Bitmap,"laya.resource.Bitmap",Resource);var __proto=Bitmap.prototype;return __proto._getSource=function(){throw"Bitmap: must override it."},__getset(0,__proto,"width",function(){return this._width}),__getset(0,__proto,"height",function(){return this._height}),Bitmap}(),Scene=function(_super){function Scene(){this.autoDestroyAtClosed=!1,this.url=null,this._timer=null,this._viewCreated=!1,this._idMap=null,this._$componentType="Scene",Scene.__super.call(this),this._setBit(8,!0),Scene.unDestroyedScenes.push(this),this._scene=this,this.createChildren()}__class(Scene,"laya.display.Scene",_super);var __proto=Scene.prototype;return __proto.createChildren=function(){},__proto.loadScene=function(path){var url=path.indexOf(".")>-1?path:path+".scene",view=Laya.loader.getRes(url);if(view)this.createView(view);else{Laya.loader.resetProgress();var loader=new SceneLoader;loader.on("complete",this,this._onSceneLoaded,[url]),loader.load(url)}},__proto._onSceneLoaded=function(url){this.createView(Loader.getRes(url))},__proto.createView=function(view){view&&!this._viewCreated&&(this._viewCreated=!0,SceneUtils.createByData(this,view))},__proto.getNodeByID=function(id){return this._idMap?this._idMap[id]:null},__proto.open=function(closeOther,param){void 0===closeOther&&(closeOther=!0),closeOther&&Scene.closeAll(),Scene.root.addChild(this.scene),this.onOpened(param)},__proto.onOpened=function(param){},__proto.close=function(type){this.autoDestroyAtClosed?this.destroy():this.removeSelf(),this.onClosed(type)},__proto.onClosed=function(type){},__proto.destroy=function(destroyChild){void 0===destroyChild&&(destroyChild=!0),this._idMap=null,_super.prototype.destroy.call(this,destroyChild);for(var list=laya.display.Scene.unDestroyedScenes,i=list.length-1;i>-1;i--)if(list[i]===this)return void list.splice(i,1)},__proto._sizeChanged=function(){this.event("resize")},__getset(0,__proto,"scaleX",_super.prototype._$get_scaleX,function(value){Laya.superGet(Sprite,this,"scaleX")!=value&&(Laya.superSet(Sprite,this,"scaleX",value),this.event("resize"))}),__getset(0,__proto,"scaleY",_super.prototype._$get_scaleY,function(value){Laya.superGet(Sprite,this,"scaleY")!=value&&(Laya.superSet(Sprite,this,"scaleY",value),this.event("resize"))}),__getset(0,__proto,"width",function(){if(this._width)return this._width;for(var max=0,i=this.numChildren-1;i>-1;i--){var comp=this.getChildAt(i);comp._visible&&(max=Math.max(comp._x+comp.width*comp.scaleX,max))}return max},function(value){Laya.superGet(Sprite,this,"width")!=value&&(Laya.superSet(Sprite,this,"width",value),this.callLater(this._sizeChanged))}),__getset(0,__proto,"timer",function(){return this._timer||Laya.timer},function(value){this._timer=value}),__getset(0,__proto,"height",function(){if(this._height)return this._height;for(var max=0,i=this.numChildren-1;i>-1;i--){var comp=this.getChildAt(i);comp._visible&&(max=Math.max(comp._y+comp.height*comp.scaleY,max))}return max},function(value){Laya.superGet(Sprite,this,"height")!=value&&(Laya.superSet(Sprite,this,"height",value),this.callLater(this._sizeChanged))}),__getset(1,Scene,"root",function(){if(!Scene._root){function resize(){Scene._root.size(Laya.stage.width,Laya.stage.height),Scene._root.event("resize")}Scene._root=Laya.stage.addChild(new Sprite),Scene._root.name="root",Laya.stage.on("resize",null,resize),resize()}return Scene._root},laya.display.Sprite._$SET_root),Scene.load=function(url,complete,progress){Laya.loader.resetProgress();var loader=new SceneLoader;function onProgress(value){Scene._loadPage&&Scene._loadPage.event("progress",value),progress&&progress.runWith(value)}loader.on("progress",null,onProgress),loader.once("complete",null,function(){loader.off("progress",null,onProgress);var obj=Loader.getRes(url);if(!obj)throw"Can not find scene:"+url;if(!obj.props)throw"Scene data is error:"+url;var runtime=obj.props.runtime?obj.props.runtime:obj.type,clas=ClassUtils.getClass(runtime);if("instance"==obj.props.renderType)var scene=clas.instance||(clas.instance=new clas);else scene=new clas;if(!(scene&&scene instanceof laya.display.Node))throw"Can not find scene:"+runtime;scene.url=url,scene._getBit(8)?(scene.on("onViewCreated",null,function(){complete&&complete.runWith(scene)}),scene.createView(obj)):complete&&complete.runWith(scene),Scene.hideLoadingPage()}),loader.load(url)},Scene.open=function(url,closeOther,param,complete,progress){if(void 0===closeOther&&(closeOther=!0),param instanceof laya.utils.Handler){var temp=complete;complete=param,param=temp}Scene.showLoadingPage(),Scene.load(url,Handler.create(null,this._onSceneLoaded,[closeOther,complete,param]),progress)},Scene._onSceneLoaded=function(closeOther,complete,param,scene){scene.open(closeOther,param),complete&&complete.runWith(scene)},Scene.close=function(url,name){void 0===name&&(name="");for(var flag=!1,list=laya.display.Scene.unDestroyedScenes,i=0,n=list.length;i<n;i++){var scene=list[i];scene&&scene.parent&&scene.url===url&&scene.name==name&&(scene.close(),flag=!0)}return flag},Scene.closeAll=function(){for(var root=laya.display.Scene.root,i=0,n=root.numChildren;i<n;i++){var scene=root.getChildAt(0);scene instanceof laya.display.Scene?scene.close():scene.removeSelf()}},Scene.destroy=function(url,name){void 0===name&&(name="");for(var flag=!1,list=laya.display.Scene.unDestroyedScenes,i=0,n=list.length;i<n;i++){var scene=list[i];scene.url===url&&scene.name==name&&(scene.destroy(),flag=!0)}return flag},Scene.gc=function(){Resource.destroyUnusedResources()},Scene.setLoadingPage=function(loadPage){Scene._loadPage!=loadPage&&(Scene._loadPage=loadPage)},Scene.showLoadingPage=function(param,delay){void 0===delay&&(delay=500),Scene._loadPage&&(Laya.systemTimer.clear(null,Scene._showLoading),Laya.systemTimer.clear(null,Scene._hideLoading),Laya.systemTimer.once(delay,null,Scene._showLoading,[param],!1))},Scene._showLoading=function(param){Laya.stage.addChild(Scene._loadPage),Scene._loadPage.onOpened(param)},Scene._hideLoading=function(){Scene._loadPage.close()},Scene.hideLoadingPage=function(delay){void 0===delay&&(delay=500),Scene._loadPage&&(Laya.systemTimer.clear(null,Scene._showLoading),Laya.systemTimer.clear(null,Scene._hideLoading),Laya.systemTimer.once(delay,null,Scene._hideLoading))},Scene.unDestroyedScenes=[],Scene._root=null,Scene._loadPage=null,Scene}(Sprite),Text=function(_super){function Text(){this._clipPoint=null,this._text=null,this._isChanged=!1,this._textWidth=0,this._textHeight=0,this._lines=[],this._lineWidths=[],this._startX=0,this._startY=0,this._words=null,this._charSize={},this._valign="top",this._color="#000000",Text.__super.call(this),this._fontSize=Text.defaultFontSize,this._font=Text.defaultFont,this.overflow="visible",this._style=TextStyle.EMPTY}__class(Text,"laya.display.Text",_super);var __proto=Text.prototype;return __proto.getStyle=function(){return this._style===TextStyle.EMPTY&&(this._style=TextStyle.create()),this._style},__proto._getTextStyle=function(){return this._style===TextStyle.EMPTY&&(this._style=TextStyle.create()),this._style},__proto.destroy=function(destroyChild){void 0===destroyChild&&(destroyChild=!0),_super.prototype.destroy.call(this,destroyChild),this._clipPoint=null,this._lines=null,this._lineWidths=null,this._words=null,this._charSize=null},__proto._getBoundPointsM=function(ifRotate){void 0===ifRotate&&(ifRotate=!1);var rec=Rectangle.TEMP;return rec.setTo(0,0,this.width,this.height),rec._getBoundPoints()},__proto.getGraphicBounds=function(realSize){void 0===realSize&&(realSize=!1);var rec=Rectangle.TEMP;return rec.setTo(0,0,this.width,this.height),rec},__proto._getCSSStyle=function(){return this._style},__proto.lang=function(text,arg1,arg2,arg3,arg4,arg5,arg6,arg7,arg8,arg9,arg10){if(text=Text.langPacks&&Text.langPacks[text]?Text.langPacks[text]:text,arguments.length<2)this._text=text;else{for(var i=0,n=arguments.length;i<n;i++)text=text.replace("{"+i+"}",arguments[i+1]);this._text=text}},__proto._getContextFont=function(){return(this.italic?"italic ":"")+(this.bold?"bold ":"")+this.fontSize+"px "+(Browser.onIPhone&&laya.display.Text.fontFamilyMap[this.font]||this.font)},__proto._isPassWordMode=function(){var password=this._style.asPassword;return"prompt"in this&&this.prompt==this._text&&(password=!1),password},__proto._getPassWordTxt=function(txt){var word;word="";for(var j=txt.length;j>0;j--)word+="●";return word},__proto._renderText=function(){var padding=this.padding,visibleLineCount=this._lines.length;"visible"!=this.overflow&&(visibleLineCount=Math.min(visibleLineCount,Math.floor((this.height-padding[0]-padding[2])/(this.leading+this._charSize.height))+1));var beginLine=this.scrollY/(this._charSize.height+this.leading)|0,graphics=this.graphics;graphics.clear(!0);var ctxFont=this._getContextFont();Browser.context.font=ctxFont;var startX=padding[3],textAlgin="left",lines=this._lines,lineHeight=this.leading+this._charSize.height,startY=padding[0];if(this._width>0&&this._textWidth<=this._width&&("right"==this.align?(textAlgin="right",startX=this._width-padding[1]):"center"==this.align&&(textAlgin="center",startX=.5*this._width+padding[3]-padding[1])),this._height>0){var tempVAlign=this._textHeight>this._height?"top":this.valign;"middle"===tempVAlign?startY=.5*(this._height-visibleLineCount*lineHeight)+padding[0]-padding[2]:"bottom"===tempVAlign&&(startY=this._height-visibleLineCount*lineHeight-padding[2])}var style=this._style;this._clipPoint&&(graphics.save(),graphics.clipRect(padding[3],padding[0],this._width?this._width-padding[3]-padding[1]:this._textWidth,this._height?this._height-padding[0]-padding[2]:this._textHeight),this.repaint());var password=style.asPassword;"prompt"in this&&this.prompt==this._text&&(password=!1);for(var x=0,y=0,end=Math.min(this._lines.length,visibleLineCount+beginLine)||1,i=beginLine;i<end;i++){var _word,word=lines[i];if(password){var len=word.length;word="";for(var j=len;j>0;j--)word+="●"}null==word&&(word=""),x=startX-(this._clipPoint?this._clipPoint.x:0),y=startY+lineHeight*i-(this._clipPoint?this._clipPoint.y:0),this.underline&&this._drawUnderline(textAlgin,x,y,i),Render.isWebGL?(this._words||(this._words=[]),(_word=this._words.length>i-beginLine?this._words[i-beginLine]:new WordText).setText(word)):_word=word,style.stroke?graphics.fillBorderText(_word,x,y,ctxFont,this.color,style.strokeColor,style.stroke,textAlgin):graphics.fillText(_word,x,y,ctxFont,this.color,textAlgin)}this._clipPoint&&graphics.restore(),this._startX=startX,this._startY=startY},__proto._drawUnderline=function(align,x,y,lineIndex){var lineWidth=this._lineWidths[lineIndex];switch(align){case"center":x-=lineWidth/2;break;case"right":x-=lineWidth}y+=this._charSize.height,this._graphics.drawLine(x,y,x+lineWidth,y,this.underlineColor||this.color,1)},__proto.typeset=function(){if(this._isChanged=!1,!this._text)return this._clipPoint=null,this._textWidth=this._textHeight=0,void this.graphics.clear(!0);Render.isConchApp?window.conchTextCanvas.font=this._getContextFont():Browser.context.font=this._getContextFont(),this._lines.length=0,this._lineWidths.length=0,this._isPassWordMode()?this._parseLines(this._getPassWordTxt(this._text)):this._parseLines(this._text),this._evalTextSize(),this._checkEnabledViewportOrNot()?this._clipPoint||(this._clipPoint=new Point(0,0)):this._clipPoint=null,this._renderText()},__proto._evalTextSize=function(){var nw,nh;nw=Math.max.apply(this,this._lineWidths),nh=this._lines.length*(this._charSize.height+this.leading)+this.padding[0]+this.padding[2],nw==this._textWidth&&nh==this._textHeight||(this._textWidth=nw,this._textHeight=nh)},__proto._checkEnabledViewportOrNot=function(){return"scroll"==this.overflow&&(this._width>0&&this._textWidth>this._width||this._height>0&&this._textHeight>this._height)},__proto.changeText=function(text){this._text!==text&&(this.lang(text+""),this._graphics&&this._graphics.replaceText(this._text)||this.typeset())},__proto._parseLines=function(text){var needWordWrapOrTruncate=this.wordWrap||"hidden"==this.overflow;if(needWordWrapOrTruncate)var wordWrapWidth=this._getWordWrapWidth();var measureResult;measureResult=Render.isConchApp?window.conchTextCanvas.measureText(this._testWord):Browser.context.measureText(Text._testWord),this._charSize.width=measureResult.width,this._charSize.height=measureResult.height||this.fontSize;for(var lines=text.replace(/\r\n/g,"\n").split("\n"),i=0,n=lines.length;i<n;i++){var line=lines[i];needWordWrapOrTruncate?this._parseLine(line,wordWrapWidth):(this._lineWidths.push(this._getTextWidth(line)),this._lines.push(line))}},__proto._parseLine=function(line,wordWrapWidth){Browser.context;var execResult,lines=this._lines,maybeIndex=0,charsWidth=NaN,wordWidth=NaN,startIndex=0;if((charsWidth=this._getTextWidth(line))<=wordWrapWidth)return lines.push(line),void this._lineWidths.push(charsWidth);charsWidth=this._charSize.width,0==(maybeIndex=Math.floor(wordWrapWidth/charsWidth))&&(maybeIndex=1),wordWidth=charsWidth=this._getTextWidth(line.substring(0,maybeIndex));for(var j=maybeIndex,m=line.length;j<m;j++)if((wordWidth+=charsWidth=this._getTextWidth(line.charAt(j)))>wordWrapWidth)if(this.wordWrap){var newLine=line.substring(startIndex,j);if(newLine.charCodeAt(newLine.length-1)<255&&(execResult=/(?:\w|-)+$/.exec(newLine))&&(j=execResult.index+startIndex,0==execResult.index?j+=newLine.length:newLine=line.substring(startIndex,j)),lines.push(newLine),this._lineWidths.push(wordWidth-charsWidth),startIndex=j,!(j+maybeIndex<m)){lines.push(line.substring(startIndex,m)),this._lineWidths.push(this._getTextWidth(lines[lines.length-1])),startIndex=-1;break}j+=maybeIndex,wordWidth=charsWidth=this._getTextWidth(line.substring(startIndex,j)),j--}else if("hidden"==this.overflow)return lines.push(line.substring(0,j)),void this._lineWidths.push(this._getTextWidth(lines[lines.length-1]));this.wordWrap&&-1!=startIndex&&(lines.push(line.substring(startIndex,m)),this._lineWidths.push(this._getTextWidth(lines[lines.length-1])))},__proto._getTextWidth=function(text){return Render.isConchApp?window.conchTextCanvas.measureText(text).width:Browser.context.measureText(text).width},__proto._getWordWrapWidth=function(){var p=this.padding,w=NaN;return(w=this._width)<=0&&(w=this.wordWrap?100:Browser.width),w<=0&&(w=100),w-p[3]-p[1]},__proto.getCharPoint=function(charIndex,out){this._isChanged&&Laya.systemTimer.runCallLater(this,this.typeset);for(var len=0,lines=this._lines,startIndex=0,i=0,n=lines.length;i<n;i++){if(charIndex<(len+=lines[i].length)){var line=i;break}startIndex=len}var ctxFont=(this.italic?"italic ":"")+(this.bold?"bold ":"")+this.fontSize+"px "+this.font;Browser.context.font=ctxFont;var width=this._getTextWidth(this._text.substring(startIndex,charIndex));return(out||new Point).setTo(this._startX+width-(this._clipPoint?this._clipPoint.x:0),this._startY+line*(this._charSize.height+this.leading)-(this._clipPoint?this._clipPoint.y:0))},__getset(0,__proto,"width",function(){return this._width?this._width:this.textWidth+this.padding[1]+this.padding[3]},function(value){value!=this._width&&(Laya.superSet(Sprite,this,"width",value),this.isChanged=!0,this.borderColor&&this._setBorderStyleColor(0,0,this.width,this.height,this.borderColor,1))}),__getset(0,__proto,"textWidth",function(){return this._isChanged&&Laya.systemTimer.runCallLater(this,this.typeset),this._textWidth}),__getset(0,__proto,"height",function(){return this._height?this._height:this.textHeight},function(value){value!=this._height&&(Laya.superSet(Sprite,this,"height",value),this.isChanged=!0,this.borderColor&&this._setBorderStyleColor(0,0,this.width,this.height,this.borderColor,1))}),__getset(0,__proto,"textHeight",function(){return this._isChanged&&Laya.systemTimer.runCallLater(this,this.typeset),this._textHeight}),__getset(0,__proto,"padding",function(){return this._style.padding},function(value){if("string"==typeof value){var arr,len,i=0;for(len=(arr=value.split(",")).length;arr.length<4;)arr.push(0);for(i=0;i<len;i++)arr[i]=parseFloat(arr[i])||0;value=arr}this._getTextStyle().padding=value,this.isChanged=!0}),__getset(0,__proto,"bold",function(){return this._style.bold},function(value){this._getTextStyle().bold=value,this.isChanged=!0}),__getset(0,__proto,"text",function(){return this._text||""},function(value){this._text!==value&&(this.lang(value+""),this.isChanged=!0,this.event("change"),this.borderColor&&this._setBorderStyleColor(0,0,this.width,this.height,this.borderColor,1))}),__getset(0,__proto,"color",function(){return this._color},function(value){this._color!=value&&(this._color=value,!this._isChanged&&this._graphics?this._graphics.replaceTextColor(this.color):this.isChanged=!0)}),__getset(0,__proto,"font",function(){return this._font},function(value){this._font=value,this.isChanged=!0}),__getset(0,__proto,"fontSize",function(){return this._fontSize},function(value){this._fontSize!=value&&(this._fontSize=value,this.isChanged=!0)}),__getset(0,__proto,"italic",function(){return this._style.italic},function(value){this._getTextStyle().italic=value,this.isChanged=!0}),__getset(0,__proto,"align",function(){return this._style.align},function(value){this._getTextStyle().align=value,this.isChanged=!0}),__getset(0,__proto,"valign",function(){return this._valign},function(value){this._valign=value,this.isChanged=!0}),__getset(0,__proto,"wordWrap",function(){return this._style.wordWrap},function(value){this._getTextStyle().wordWrap=value,this.isChanged=!0}),__getset(0,__proto,"leading",function(){return this._style.leading},function(value){this._getTextStyle().leading=value,this.isChanged=!0}),__getset(0,__proto,"bgColor",function(){return this._style.bgColor},function(value){this._getTextStyle().bgColor=value,this._renderType|=128,this._setBgStyleColor(0,0,this.width,this.height,value),this._setRenderType(this._renderType),this.isChanged=!0}),__getset(0,__proto,"borderColor",function(){return this._style.borderColor},function(value){this._getTextStyle().borderColor=value,this._renderType|=128,this._setBorderStyleColor(0,0,this.width,this.height,value,1),this._setRenderType(this._renderType),this.isChanged=!0}),__getset(0,__proto,"stroke",function(){return this._style.stroke},function(value){this._getTextStyle().stroke=value,this.isChanged=!0}),__getset(0,__proto,"strokeColor",function(){return this._style.strokeColor},function(value){this._getTextStyle().strokeColor=value,this.isChanged=!0}),__getset(0,__proto,"isChanged",null,function(value){this._isChanged!==value&&(this._isChanged=value,value&&Laya.systemTimer.callLater(this,this.typeset))}),__getset(0,__proto,"scrollX",function(){return this._clipPoint?this._clipPoint.x:0},function(value){if(!("scroll"!=this.overflow||this.textWidth<this._width)&&this._clipPoint){value=value<this.padding[3]?this.padding[3]:value;var maxScrollX=this._textWidth-this._width;value=value>maxScrollX?maxScrollX:value,this._clipPoint.x=value,this._renderText()}}),__getset(0,__proto,"scrollY",function(){return this._clipPoint?this._clipPoint.y:0},function(value){if(!("scroll"!=this.overflow||this.textHeight<this._height)&&this._clipPoint){value=value<this.padding[0]?this.padding[0]:value;var maxScrollY=this._textHeight-this._height;value=value>maxScrollY?maxScrollY:value,this._clipPoint.y=value,this._renderText()}}),__getset(0,__proto,"maxScrollX",function(){return this.textWidth<this._width?0:this._textWidth-this._width}),__getset(0,__proto,"maxScrollY",function(){return this.textHeight<this._height?0:this._textHeight-this._height}),__getset(0,__proto,"lines",function(){return this._isChanged&&this.typeset(),this._lines}),__getset(0,__proto,"underlineColor",function(){return this._style.underlineColor},function(value){this._getTextStyle().underlineColor=value,this._isChanged||this._renderText()}),__getset(0,__proto,"underline",function(){return this._style.underline},function(value){this._getTextStyle().underline=value}),Text.defaultFontStr=function(){return Text.defaultFontSize+"px "+Text.defaultFont},Text.unregisterBitmapFont=function(name,destroy){void 0===destroy&&(destroy=!0),Text._bitmapFonts&&Text._bitmapFonts[name]&&delete Text._bitmapFonts[name]},Text.VISIBLE="visible",Text.SCROLL="scroll",Text.HIDDEN="hidden",Text.defaultFontSize=12,Text.defaultFont="Arial",Text.langPacks=null,Text.isComplexText=!1,Text._testWord="游",Text._bitmapFonts=null,Text.CharacterCache=!0,Text.RightToLeft=!1,__static(Text,["fontFamilyMap",function(){return this.fontFamilyMap={"报隶":"报隶-简","黑体":"黑体-简","楷体":"楷体-简","兰亭黑":"兰亭黑-简","隶变":"隶变-简","凌慧体":"凌慧体-简","翩翩体":"翩翩体-简","苹方":"苹方-简","手札体":"手札体-简","宋体":"宋体-简","娃娃体":"娃娃体-简","魏碑":"魏碑-简","行楷":"行楷-简","雅痞":"雅痞-简","圆体":"圆体-简"}}]),Text}(Sprite),UIComponent=function(_super){function UIComponent(){this._dataSource=null,this._toolTip=null,this._tag=null,this._disabled=!1,this._gray=!1,UIComponent.__super.call(this),this._anchorX=NaN,this._anchorY=NaN,this._widget=Widget.EMPTY,this.preinitialize(),this.createChildren(),this.initialize()}__class(UIComponent,"laya.ui.UIComponent",_super);var __proto=UIComponent.prototype;return __proto.destroy=function(destroyChild){void 0===destroyChild&&(destroyChild=!0),_super.prototype.destroy.call(this,destroyChild),this._dataSource=null,this._tag=null,this._toolTip=null},__proto.preinitialize=function(){},__proto.createChildren=function(){},__proto.initialize=function(){},__proto.measureWidth=function(){var max=0;this.commitMeasure();for(var i=this.numChildren-1;i>-1;i--){var comp=this.getChildAt(i);comp._visible&&(max=Math.max(comp._x+comp.width*comp.scaleX,max))}return max},__proto.commitMeasure=function(){},__proto.measureHeight=function(){var max=0;this.commitMeasure();for(var i=this.numChildren-1;i>-1;i--){var comp=this.getChildAt(i);comp._visible&&(max=Math.max(comp._y+comp.height*comp.scaleY,max))}return max},__proto._sizeChanged=function(){isNaN(this._anchorX)||(this.pivotX=this.anchorX*this.width),isNaN(this._anchorY)||(this.pivotY=this.anchorY*this.height),this.event("resize"),this._widget!==Widget.EMPTY&&this._widget.resetLayout()},__proto.onMouseOver=function(e){Laya.stage.event("showtip",this._toolTip)},__proto.onMouseOut=function(e){Laya.stage.event("hidetip",this._toolTip)},__proto._getWidget=function(){return this._widget===Widget.EMPTY&&(this._widget=this.addComponent(Widget)),this._widget},__proto.onCompResize=function(){this._sizeChanged()},__proto._childChanged=function(child){this.callLater(this._sizeChanged),_super.prototype._childChanged.call(this,child)},__getset(0,__proto,"centerY",function(){return this._widget.centerY},function(value){value!=this._widget.centerY&&(this._getWidget().centerY=value)}),__getset(0,__proto,"width",function(){return this._width?this._width:this.measureWidth()},function(value){Laya.superGet(Sprite,this,"width")!=value&&(Laya.superSet(Sprite,this,"width",value),this.callLater(this._sizeChanged))}),__getset(0,__proto,"bottom",function(){return this._widget.bottom},function(value){value!=this._widget.bottom&&(this._getWidget().bottom=value)}),__getset(0,__proto,"height",function(){return this._height?this._height:this.measureHeight()},function(value){Laya.superGet(Sprite,this,"height")!=value&&(Laya.superSet(Sprite,this,"height",value),this.callLater(this._sizeChanged))}),__getset(0,__proto,"left",function(){return this._widget.left},function(value){value!=this._widget.left&&(this._getWidget().left=value)}),__getset(0,__proto,"dataSource",function(){return this._dataSource},function(value){for(var prop in this._dataSource=value,this._dataSource)this.hasOwnProperty(prop)&&"function"!=typeof this[prop]&&(this[prop]=this._dataSource[prop])}),__getset(0,__proto,"centerX",function(){return this._widget.centerX},function(value){value!=this._widget.centerX&&(this._getWidget().centerX=value)}),__getset(0,__proto,"top",function(){return this._widget.top},function(value){value!=this._widget.top&&(this._getWidget().top=value)}),__getset(0,__proto,"right",function(){return this._widget.right},function(value){value!=this._widget.right&&(this._getWidget().right=value)}),__getset(0,__proto,"tag",function(){return this._tag},function(value){this._tag=value}),__getset(0,__proto,"toolTip",function(){return this._toolTip},function(value){this._toolTip!=value&&(this._toolTip=value,null!=value?(this.on("mouseover",this,this.onMouseOver),this.on("mouseout",this,this.onMouseOut)):(this.off("mouseover",this,this.onMouseOver),this.off("mouseout",this,this.onMouseOut)))}),__getset(0,__proto,"gray",function(){return this._gray},function(value){value!==this._gray&&(this._gray=value,UIUtils.gray(this,value))}),__getset(0,__proto,"disabled",function(){return this._disabled},function(value){value!==this._disabled&&(this.gray=this._disabled=value,this.mouseEnabled=!value)}),__getset(0,__proto,"scaleX",_super.prototype._$get_scaleX,function(value){Laya.superGet(Sprite,this,"scaleX")!=value&&(Laya.superSet(Sprite,this,"scaleX",value),this.event("resize"))}),__getset(0,__proto,"scaleY",_super.prototype._$get_scaleY,function(value){Laya.superGet(Sprite,this,"scaleY")!=value&&(Laya.superSet(Sprite,this,"scaleY",value),this.event("resize"))}),__getset(0,__proto,"anchorX",function(){return this._anchorX},function(value){this._anchorX!=value&&(this._anchorX=value,this.callLater(this._sizeChanged))}),__getset(0,__proto,"anchorY",function(){return this._anchorY},function(value){this._anchorY!=value&&(this._anchorY=value,this.callLater(this._sizeChanged))}),UIComponent}(Sprite),Stage=function(_super){function Stage(){this.focus=null,this._frameRate="fast",this.designWidth=0,this.designHeight=0,this.canvasRotation=!1,this.canvasDegree=0,this.renderingEnabled=!0,this.screenAdaptationEnabled=!0,this._screenMode="none",this._scaleMode="noscale",this._alignV="top",this._alignH="left",this._bgColor="black",this._mouseMoveTime=0,this._renderCount=0,this._safariOffsetY=0,this._frameStartTime=0,this._isFocused=!1,this._isVisibility=!1,this._wgColor=[0,0,0,1],this._scene3Ds=[],this._globalRepaintSet=!1,this._globalRepaintGet=!1,this._curUIBase=null,Stage.__super.call(this),this.offset=new Point,this._canvasTransform=new Matrix,this._previousOrientation=Browser.window.orientation,this._3dUI=[];var _$this=this;this.transform=Matrix.create(),this.mouseEnabled=!0,this.hitTestPrior=!0,this.autoSize=!1,this._setBit(128,!0),this._setBit(2,!0),this._isFocused=!0,this._isVisibility=!0;var window=Browser.window,_me=this;window.addEventListener("focus",function(){_$this._isFocused=!0,_me.event("focus"),_me.event("focuschange")}),window.addEventListener("blur",function(){_$this._isFocused=!1,_me.event("blur"),_me.event("focuschange")});var state="visibilityState",visibilityChange="visibilitychange",document=window.document;void 0!==document.hidden?(visibilityChange="visibilitychange",state="visibilityState"):void 0!==document.mozHidden?(visibilityChange="mozvisibilitychange",state="mozVisibilityState"):void 0!==document.msHidden?(visibilityChange="msvisibilitychange",state="msVisibilityState"):void 0!==document.webkitHidden&&(visibilityChange="webkitvisibilitychange",state="webkitVisibilityState"),window.document.addEventListener(visibilityChange,function(){"hidden"==Browser.document[state]?_$this._isVisibility=!1:_$this._isVisibility=!0,_$this.renderingEnabled=_$this._isVisibility,_me.event("visibilitychange")}),window.addEventListener("resize",function(){var orientation=Browser.window.orientation;_$this._previousOrientation=orientation,_me._isInputting()||(Browser.onSafari&&(_me._safariOffsetY=(Browser.window.__innerHeight||Browser.document.body.clientHeight||Browser.document.documentElement.clientHeight)-Browser.window.innerHeight),_me._resetCanvas())}),window.addEventListener("orientationchange",function(e){_me._resetCanvas()}),this.on("mousemove",this,this._onmouseMove),Browser.onMobile&&this.on("mousedown",this,this._onmouseMove)}__class(Stage,"laya.display.Stage",_super);var __proto=Stage.prototype;return __proto._isInputting=function(){return Browser.onMobile},__proto._changeCanvasSize=function(){this.setScreenSize(Browser.clientWidth*Browser.pixelRatio,Browser.clientHeight*Browser.pixelRatio)},__proto._resetCanvas=function(){this.screenAdaptationEnabled&&this._changeCanvasSize()},__proto.setScreenSize=function(screenWidth,screenHeight){var rotation=!1;if("none"!==this._screenMode&&(rotation=(screenWidth/screenHeight<1?"vertical":"horizontal")!==this._screenMode)){var temp=screenHeight;screenHeight=screenWidth,screenWidth=temp}this.canvasRotation=rotation;var canvas=Render._mainCanvas,canvasStyle=canvas.source.style,mat=this._canvasTransform.identity(),scaleMode=this._scaleMode,scaleX=screenWidth/this.designWidth,scaleY=screenHeight/this.designHeight,canvasWidth=this.designWidth,canvasHeight=this.designHeight,realWidth=screenWidth,realHeight=screenHeight,pixelRatio=Browser.pixelRatio;switch(this._width=this.designWidth,this._height=this.designHeight,scaleMode){case"noscale":scaleX=scaleY=1,realWidth=this.designWidth,realHeight=this.designHeight;break;case"showall":scaleX=scaleY=Math.min(scaleX,scaleY),canvasWidth=realWidth=Math.round(this.designWidth*scaleX),canvasHeight=realHeight=Math.round(this.designHeight*scaleY);break;case"noborder":scaleX=scaleY=Math.max(scaleX,scaleY),realWidth=Math.round(this.designWidth*scaleX),realHeight=Math.round(this.designHeight*scaleY);break;case"full":scaleX=scaleY=1,this._width=canvasWidth=screenWidth,this._height=canvasHeight=screenHeight;break;case"fixedwidth":scaleY=scaleX,this._height=canvasHeight=Math.round(screenHeight/scaleX);break;case"fixedheight":scaleX=scaleY,this._width=canvasWidth=Math.round(screenWidth/scaleY);break;case"fixedauto":screenWidth/screenHeight<this.designWidth/this.designHeight?(scaleY=scaleX,this._height=canvasHeight=Math.round(screenHeight/scaleX)):(scaleX=scaleY,this._width=canvasWidth=Math.round(screenWidth/scaleY))}scaleX*=this.scaleX,scaleY*=this.scaleY,1===scaleX&&1===scaleY?this.transform.identity():(this.transform.a=this._formatData(scaleX/(realWidth/canvasWidth)),this.transform.d=this._formatData(scaleY/(realHeight/canvasHeight))),Render.isConchApp&&(this._conchData._float32Data[10]=this._formatData(scaleX/(realWidth/canvasWidth)),this._conchData._float32Data[11]=this._formatData(scaleY/(realHeight/canvasHeight)),this._conchData._float32Data[15]=1),canvas.size(canvasWidth,canvasHeight),RunDriver.changeWebGLSize(canvasWidth,canvasHeight),mat.scale(realWidth/canvasWidth/pixelRatio,realHeight/canvasHeight/pixelRatio),"left"===this._alignH?this.offset.x=0:"right"===this._alignH?this.offset.x=screenWidth-realWidth:this.offset.x=.5*(screenWidth-realWidth)/pixelRatio,"top"===this._alignV?this.offset.y=0:"bottom"===this._alignV?this.offset.y=screenHeight-realHeight:this.offset.y=.5*(screenHeight-realHeight)/pixelRatio,this.offset.x=Math.round(this.offset.x),this.offset.y=Math.round(this.offset.y),mat.translate(this.offset.x,this.offset.y),this._safariOffsetY&&mat.translate(0,this._safariOffsetY),this.canvasDegree=0,rotation&&("horizontal"===this._screenMode?(mat.rotate(Math.PI/2),mat.translate(screenHeight/pixelRatio,0),this.canvasDegree=90):(mat.rotate(-Math.PI/2),mat.translate(0,screenWidth/pixelRatio),this.canvasDegree=-90)),mat.a=this._formatData(mat.a),mat.d=this._formatData(mat.d),mat.tx=this._formatData(mat.tx),mat.ty=this._formatData(mat.ty),this.transform=this.transform,canvasStyle.transformOrigin=canvasStyle.webkitTransformOrigin=canvasStyle.msTransformOrigin=canvasStyle.mozTransformOrigin=canvasStyle.oTransformOrigin="0px 0px 0px",canvasStyle.transform=canvasStyle.webkitTransform=canvasStyle.msTransform=canvasStyle.mozTransform=canvasStyle.oTransform="matrix("+mat.toString()+")",this._safariOffsetY&&mat.translate(0,-this._safariOffsetY),mat.translate(parseInt(canvasStyle.left)||0,parseInt(canvasStyle.top)||0),this.visible=!0,this._repaint|=2,this.event("resize")},__proto._formatData=function(value){return Math.abs(value)<1e-6?0:Math.abs(1-value)<.001?value>0?1:-1:value},__proto.getMousePoint=function(){return Point.TEMP.setTo(this.mouseX,this.mouseY)},__proto.repaint=function(type){void 0===type&&(type=2),this._repaint|=type},__proto.repaintForNative=function(type){void 0===type&&(type=2),this._conchData._int32Data[4]|=type},__proto.parentRepaint=function(type){void 0===type&&(type=2)},__proto._loop=function(){return this._globalRepaintGet=this._globalRepaintSet,this._globalRepaintSet=!1,this.render(Render._context,0,0),!0},__proto.getFrameTm=function(){return this._frameStartTime},__proto._onmouseMove=function(e){this._mouseMoveTime=Browser.now()},__proto.getTimeFromFrameStart=function(){return Browser.now()-this._frameStartTime},__proto.render=function(context,x,y){if(Stage._dbgSprite.graphics.clear(),"sleep"===this._frameRate){var now=Browser.now();if(!(now-this._frameStartTime>=1e3))return;this._frameStartTime=now}else{if(!this._visible)return this._renderCount++,void(this._renderCount%5==0&&(CallLater.I._update(),Stat.loopCount++,this._updateTimers()));this._frameStartTime=Browser.now()}this._renderCount++;var isFastMode="slow"!==("mouse"===this._frameRate?this._frameStartTime-this._mouseMoveTime<2e3?"fast":"slow":this._frameRate),isDoubleLoop=this._renderCount%2==0;if(Stat.renderSlow=!isFastMode,(isFastMode||isDoubleLoop)&&(CallLater.I._update(),Stat.loopCount++,!Render.isConchApp&&Render.isWebGL&&this.renderingEnabled)){for(var i=0,n=this._scene3Ds.length;i<n;i++)this._scene3Ds[i]._update();context.clear(),_super.prototype.render.call(this,context,x,y),Stat._show&&Stat._sp&&Stat._sp.render(context,x,y)}Stage._dbgSprite.render(context,0,0),!isFastMode&&isDoubleLoop||(this.renderingEnabled&&(Render.isWebGL?(RunDriver.clear(this._bgColor),context.flush(),VectorGraphManager.instance&&VectorGraphManager.getInstance().endDispose()):(RunDriver.clear(this._bgColor),_super.prototype.render.call(this,context,x,y),Stat._show&&Stat._sp&&Stat._sp.render(context,x,y),Render.isConchApp&&context.gl.commit())),this._updateTimers())},__proto._updateTimers=function(){Laya.systemTimer._update(),Laya.startTimer._update(),Laya.physicsTimer._update(),Laya.updateTimer._update(),Laya.lateTimer._update(),Laya.timer._update()},__proto.renderToNative=function(context,x,y){this._renderCount++,Stat.loopCount++,this._visible?(CallLater.I._update(),this._updateTimers(),CallLater.I._update(),this.renderingEnabled&&(RunDriver.clear(this._bgColor),_super.prototype.render.call(this,context,x,y),Stat._show&&Stat._sp&&Stat._sp.render(context,x,y),context.gl.commit())):this._renderCount%5==0&&(CallLater.I._update(),Stat.loopCount++,this._updateTimers(),CallLater.I._update())},__proto._requestFullscreen=function(){var element=Browser.document.documentElement;element.requestFullscreen?element.requestFullscreen():element.mozRequestFullScreen?element.mozRequestFullScreen():element.webkitRequestFullscreen?element.webkitRequestFullscreen():element.msRequestFullscreen&&element.msRequestFullscreen()},__proto._fullScreenChanged=function(){Laya.stage.event("fullscreenchange")},__proto.exitFullscreen=function(){var document=Browser.document;document.exitFullscreen?document.exitFullscreen():document.mozCancelFullScreen?document.mozCancelFullScreen():document.webkitExitFullscreen&&document.webkitExitFullscreen()},__proto.isGlobalRepaint=function(){return this._globalRepaintGet},__proto.setGlobalRepaint=function(){this._globalRepaintSet=!0},__proto.add3DUI=function(uibase){var uiroot=uibase.rootView;this._3dUI.indexOf(uiroot)>=0||this._3dUI.push(uiroot)},__proto.remove3DUI=function(uibase){var uiroot=uibase.rootView,p=this._3dUI.indexOf(uiroot);return p>=0&&(this._3dUI.splice(p,1),!0)},__getset(0,__proto,"clientScaleY",function(){return this._transform?this._transform.getScaleY():1}),__getset(0,__proto,"width",_super.prototype._$get_width,function(value){this.designWidth=value,Laya.superSet(Sprite,this,"width",value),Laya.systemTimer.callLater(this,this._changeCanvasSize)}),__getset(0,__proto,"isFocused",function(){return this._isFocused}),__getset(0,__proto,"alignH",function(){return this._alignH},function(value){this._alignH=value,Laya.systemTimer.callLater(this,this._changeCanvasSize)}),__getset(0,__proto,"height",_super.prototype._$get_height,function(value){this.designHeight=value,Laya.superSet(Sprite,this,"height",value),Laya.systemTimer.callLater(this,this._changeCanvasSize)}),__getset(0,__proto,"transform",function(){return this._tfChanged&&this._adjustTransform(),this._transform=this._transform||this._createTransform()},_super.prototype._$set_transform),__getset(0,__proto,"isVisibility",function(){return this._isVisibility}),__getset(0,__proto,"scaleMode",function(){return this._scaleMode},function(value){this._scaleMode=value,Laya.systemTimer.callLater(this,this._changeCanvasSize)}),__getset(0,__proto,"alignV",function(){return this._alignV},function(value){this._alignV=value,Laya.systemTimer.callLater(this,this._changeCanvasSize)}),__getset(0,__proto,"bgColor",function(){return this._bgColor},function(value){this._bgColor=value,Render.isWebGL&&(this._wgColor=value?ColorUtils.create(value).arrColor:null),Browser.onLimixiu?this._wgColor=ColorUtils.create(value).arrColor:Render.canvas.style.background=value||"none",Render.isConchApp&&(this._renderType|=128,this._setBgStyleColor(0,0,this.width,this.height,value),this._setRenderType(this._renderType))}),__getset(0,__proto,"mouseX",function(){return Math.round(MouseManager.instance.mouseX/this.clientScaleX)}),__getset(0,__proto,"mouseY",function(){return Math.round(MouseManager.instance.mouseY/this.clientScaleY)}),__getset(0,__proto,"clientScaleX",function(){return this._transform?this._transform.getScaleX():1}),__getset(0,__proto,"screenMode",function(){return this._screenMode},function(value){this._screenMode=value}),__getset(0,__proto,"visible",_super.prototype._$get_visible,function(value){this.visible!==value&&(Laya.superSet(Sprite,this,"visible",value),Render._mainCanvas.source.style.visibility=value?"visible":"hidden")}),__getset(0,__proto,"fullScreenEnabled",null,function(value){var document=Browser.document,canvas=Render.canvas;value?(canvas.addEventListener("mousedown",this._requestFullscreen),canvas.addEventListener("touchstart",this._requestFullscreen),document.addEventListener("fullscreenchange",this._fullScreenChanged),document.addEventListener("mozfullscreenchange",this._fullScreenChanged),document.addEventListener("webkitfullscreenchange",this._fullScreenChanged),document.addEventListener("msfullscreenchange",this._fullScreenChanged)):(canvas.removeEventListener("mousedown",this._requestFullscreen),canvas.removeEventListener("touchstart",this._requestFullscreen),document.removeEventListener("fullscreenchange",this._fullScreenChanged),document.removeEventListener("mozfullscreenchange",this._fullScreenChanged),document.removeEventListener("webkitfullscreenchange",this._fullScreenChanged),document.removeEventListener("msfullscreenchange",this._fullScreenChanged))}),__getset(0,__proto,"frameRate",function(){return Render.isConchApp?this._frameRateNative:this._frameRate},function(value){if(Render.isConchApp){switch(value){case"fast":window.conch.config.setLimitFPS(60);break;case"mouse":window.conch.config.setMouseFrame(2e3);break;case"slow":window.conch.config.setSlowFrame(!0);break;case"sleep":window.conch.config.setLimitFPS(1)}this._frameRateNative=value}else this._frameRate=value}),Stage.SCALE_NOSCALE="noscale",Stage.SCALE_EXACTFIT="exactfit",Stage.SCALE_SHOWALL="showall",Stage.SCALE_NOBORDER="noborder",Stage.SCALE_FULL="full",Stage.SCALE_FIXED_WIDTH="fixedwidth",Stage.SCALE_FIXED_HEIGHT="fixedheight",Stage.SCALE_FIXED_AUTO="fixedauto",Stage.ALIGN_LEFT="left",Stage.ALIGN_RIGHT="right",Stage.ALIGN_CENTER="center",Stage.ALIGN_TOP="top",Stage.ALIGN_MIDDLE="middle",Stage.ALIGN_BOTTOM="bottom",Stage.SCREEN_NONE="none",Stage.SCREEN_HORIZONTAL="horizontal",Stage.SCREEN_VERTICAL="vertical",Stage.FRAME_FAST="fast",Stage.FRAME_SLOW="slow",Stage.FRAME_MOUSE="mouse",Stage.FRAME_SLEEP="sleep",__static(Stage,["_dbgSprite",function(){return this._dbgSprite=new Sprite}]),Stage}(Sprite),HTMLCanvas=function(_super){function HTMLCanvas(createCanvas){HTMLCanvas.__super.call(this),void 0===createCanvas&&(createCanvas=!1),createCanvas||!Render.isWebGL?this._source=Browser.createElement("canvas"):this._source=this,this.lock=!0}__class(HTMLCanvas,"laya.resource.HTMLCanvas",Bitmap);var __proto=HTMLCanvas.prototype;return __proto._getSource=function(){return this._source},__proto.clear=function(){this._ctx&&this._ctx.clear(),this._texture&&(this._texture.destroy(),this._texture=null)},__proto.destroy=function(){this._ctx&&this._ctx.destroy(),this._ctx=null},__proto.release=function(){},__proto._setContext=function(context){this._ctx=context},__proto.getContext=function(contextID,other){return this.context},__proto.getMemSize=function(){return 0},__proto.size=function(w,h){(this._width!=w||this._height!=h||this._source&&(this._source.width!=w||this._source.height!=h))&&(this._width=w,this._height=h,this._setGPUMemory(w*h*4),this._ctx&&this._ctx.size&&this._ctx.size(w,h),this._source&&(this._source.height=h,this._source.width=w),this._texture&&(this._texture.destroy(),this._texture=null))},__proto.getTexture=function(){return this._texture||(this._texture=new Texture(this,Texture.DEF_UV)),this._texture},__proto.toBase64=function(type,encoderOptions,callBack){this._source&&(Render.isConchApp&&this._source.toBase64?this._source.toBase64(type,encoderOptions,callBack):callBack(this._source.toDataURL(type,encoderOptions)))},__getset(0,__proto,"source",function(){return this._source}),__getset(0,__proto,"context",function(){return this._ctx?this._ctx:(Render.isWebGL&&this._source==this?this._ctx=new laya.webgl.canvas.WebGLContext2D:this._ctx=this._source.getContext(Render.isConchApp?"layagl":"2d"),this._ctx._canvas=this,this._ctx)}),HTMLCanvas}(),HTMLImage=function(_super){function HTMLImage(){HTMLImage.__super.call(this)}__class(HTMLImage,"laya.resource.HTMLImage",Bitmap);var __proto=HTMLImage.prototype;return __proto.loadImageSource=function(source){var width=source.width,height=source.height;if(width<=0||height<=0)throw new Error("HTMLImage:width or height must large than 0.");this._width=width,this._height=height,this._source=source,this._setGPUMemory(width*height*4),this._activeResource()},__proto._disposeResource=function(){this._source&&(this._source=null,this._setGPUMemory(0))},__proto._getSource=function(){return this._source},HTMLImage.create=function(width,height){return new HTMLImage},HTMLImage}(),View=function(_super){function View(){this._watchMap={},this._widget=null,this._dataSource=null,this._anchorX=NaN,this._anchorY=NaN,this._widget=Widget.EMPTY,View.__super.call(this)}__class(View,"laya.ui.View",_super);var __proto=View.prototype;return __proto.destroy=function(destroyChild){void 0===destroyChild&&(destroyChild=!0),this._watchMap=null,_super.prototype.destroy.call(this,destroyChild)},__proto.changeData=function(key){var arr=this._watchMap[key];if(arr)for(var i=0,n=arr.length;i<n;i++)arr[i].exe(this)},__proto._sizeChanged=function(){isNaN(this._anchorX)||(this.pivotX=this.anchorX*this.width),isNaN(this._anchorY)||(this.pivotY=this.anchorY*this.height),this.event("resize")},__proto._getWidget=function(){return this._widget===Widget.EMPTY&&(this._widget=this.addComponent(Widget)),this._widget},__proto.loadUI=function(path){var uiView=View.uiMap[path];View.uiMap&&this.createView(uiView)},__getset(0,__proto,"anchorX",function(){return this._anchorX},function(value){this._anchorX!=value&&(this._anchorX=value,this.callLater(this._sizeChanged))}),__getset(0,__proto,"centerX",function(){return this._widget.centerX},function(value){value!=this._widget.centerX&&(this._getWidget().centerX=value)}),__getset(0,__proto,"top",function(){return this._widget.top},function(value){value!=this._widget.top&&(this._getWidget().top=value)}),__getset(0,__proto,"bottom",function(){return this._widget.bottom},function(value){value!=this._widget.bottom&&(this._getWidget().bottom=value)}),__getset(0,__proto,"dataSource",function(){return this._dataSource},function(value){for(var name in this._dataSource=value,value){var comp=this.getChildByName(name);comp instanceof laya.ui.UIComponent?comp.dataSource=value[name]:this.hasOwnProperty(name)&&"function"!=typeof this[name]&&(this[name]=value[name])}}),__getset(0,__proto,"left",function(){return this._widget.left},function(value){value!=this._widget.left&&(this._getWidget().left=value)}),__getset(0,__proto,"right",function(){return this._widget.right},function(value){value!=this._widget.right&&(this._getWidget().right=value)}),__getset(0,__proto,"anchorY",function(){return this._anchorY},function(value){this._anchorY!=value&&(this._anchorY=value,this.callLater(this._sizeChanged))}),__getset(0,__proto,"centerY",function(){return this._widget.centerY},function(value){value!=this._widget.centerY&&(this._getWidget().centerY=value)}),View.regComponent=function(key,compClass){ClassUtils.regClass(key,compClass)},View.regViewRuntime=function(key,compClass){ClassUtils.regClass(key,compClass)},View.regUI=function(url,json){Laya.loader.cacheRes(url,json)},View.uiMap={},View.__init$=function(){ClassUtils.regShortClassName([Button,Box,Button,Clip,UIComponent,HScrollBar,HSlider,Image,Label,List,Panel,ScrollBar,Slider,View,VScrollBar,VSlider,Sprite,Text,FontClip])},View}(Scene),Image=function(_super){function Image(skin){this._bitmap=null,this._skin=null,this._group=null,Image.__super.call(this),this.skin=skin}__class(Image,"laya.ui.Image",_super);var __proto=Image.prototype;return __proto.destroy=function(destroyChild){void 0===destroyChild&&(destroyChild=!0),_super.prototype.destroy.call(this,!0),this._bitmap&&this._bitmap.destroy(),this._bitmap=null},__proto.dispose=function(){this.destroy(!0),Laya.loader.clearRes(this._skin)},__proto.createChildren=function(){this.graphics=this._bitmap=new AutoBitmap,this._bitmap.autoCacheCmd=!1},__proto.setSource=function(url,img){url===this._skin&&img&&(this.source=img,this.onCompResize())},__proto.measureWidth=function(){return this._bitmap.width},__proto.measureHeight=function(){return this._bitmap.height},__getset(0,__proto,"dataSource",_super.prototype._$get_dataSource,function(value){this._dataSource=value,"string"==typeof value?this.skin=value:Laya.superSet(UIComponent,this,"dataSource",value)}),__getset(0,__proto,"source",function(){return this._bitmap.source},function(value){this._bitmap&&(this._bitmap.source=value,this.event("loaded"),this.repaint())}),__getset(0,__proto,"skin",function(){return this._skin},function(value){if(this._skin!=value)if(this._skin=value,value){var source=Loader.getRes(value);source?(this.source=source,this.onCompResize()):Laya.loader.load(this._skin,Handler.create(this,this.setSource,[this._skin]),null,"image",1,!0,this._group)}else this.source=null}),__getset(0,__proto,"sizeGrid",function(){return this._bitmap.sizeGrid?this._bitmap.sizeGrid.join(","):null},function(value){this._bitmap.sizeGrid=UIUtils.fillArray(Styles.defaultSizeGrid,value,Number)}),__getset(0,__proto,"group",function(){return this._group},function(value){value&&this._skin&&Loader.setGroup(this._skin,value),this._group=value}),__getset(0,__proto,"width",_super.prototype._$get_width,function(value){Laya.superSet(UIComponent,this,"width",value),this._bitmap.width=0==value?1e-7:value}),__getset(0,__proto,"height",_super.prototype._$get_height,function(value){Laya.superSet(UIComponent,this,"height",value),this._bitmap.height=0==value?1e-7:value}),Image}(UIComponent),Box=function(_super){function Box(){Box.__super.call(this)}__class(Box,"laya.ui.Box",_super);var __proto=Box.prototype;return Laya.imps(__proto,{"laya.ui.IBox":!0}),__getset(0,__proto,"dataSource",_super.prototype._$get_dataSource,function(value){for(var name in this._dataSource=value,value){var comp=this.getChildByName(name);comp?comp.dataSource=value[name]:this.hasOwnProperty(name)&&"function"!=typeof this[name]&&(this[name]=value[name])}}),Box}(UIComponent),Button=function(_super){function Button(skin,label){this.toggle=!1,this._bitmap=null,this._text=null,this._strokeColors=null,this._state=0,this._selected=!1,this._skin=null,this._autoSize=!0,this._sources=null,this._clickHandler=null,this._stateChanged=!1,Button.__super.call(this),this._labelColors=Styles.buttonLabelColors,this._stateNum=Styles.buttonStateNum,void 0===label&&(label=""),this.skin=skin,this.label=label}__class(Button,"laya.ui.Button",_super);var __proto=Button.prototype;return Laya.imps(__proto,{"laya.ui.ISelect":!0}),__proto.destroy=function(destroyChild){void 0===destroyChild&&(destroyChild=!0),_super.prototype.destroy.call(this,destroyChild),this._bitmap&&this._bitmap.destroy(),this._text&&this._text.destroy(destroyChild),this._bitmap=null,this._text=null,this._clickHandler=null,this._labelColors=this._sources=this._strokeColors=null},__proto.createChildren=function(){this.graphics=this._bitmap=new AutoBitmap},__proto.createText=function(){this._text||(this._text=new Text,this._text.overflow="hidden",this._text.align="center",this._text.valign="middle",this._text.width=this._width,this._text.height=this._height)},__proto.initialize=function(){1!==this._mouseState&&(this.mouseEnabled=!0,this._setBit(64,!0)),this._createListener("mouseover",this,this.onMouse,null,!1,!1),this._createListener("mouseout",this,this.onMouse,null,!1,!1),this._createListener("mousedown",this,this.onMouse,null,!1,!1),this._createListener("mouseup",this,this.onMouse,null,!1,!1),this._createListener("click",this,this.onMouse,null,!1,!1)},__proto.onMouse=function(e){if(!1!==this.toggle||!this._selected)return"click"===e.type?(this.toggle&&(this.selected=!this._selected),void(this._clickHandler&&this._clickHandler.run())):void(!this._selected&&(this.state=Button.stateMap[e.type]))},__proto._skinLoaded=function(){this.callLater(this.changeClips),this._setStateChanged(),this._sizeChanged(),this.event("loaded")},__proto.changeClips=function(){var img=Loader.getRes(this._skin);if(img){var width=img.sourceWidth,height=img.sourceHeight/this._stateNum;img.$_GID||(img.$_GID=Utils.getGID());var key=img.$_GID+"-"+this._stateNum,clips=WeakObject.I.get(key);if(Utils.isOkTextureList(clips)||(clips=null),clips)this._sources=clips;else{if(this._sources=[],1===this._stateNum)this._sources.push(img);else for(var i=0;i<this._stateNum;i++)this._sources.push(Texture.createFromTexture(img,0,height*i,width,height));WeakObject.I.set(key,this._sources)}this._autoSize?(this._bitmap.width=this._width||width,this._bitmap.height=this._height||height,this._text&&(this._text.width=this._bitmap.width,this._text.height=this._bitmap.height)):this._text&&(this._text.x=width)}else console.log("lose skin",this._skin)},__proto.measureWidth=function(){return this.runCallLater(this.changeClips),this._autoSize?this._bitmap.width:(this.runCallLater(this.changeState),this._bitmap.width+(this._text?this._text.width:0))},__proto.measureHeight=function(){return this.runCallLater(this.changeClips),this._text?Math.max(this._bitmap.height,this._text.height):this._bitmap.height},__proto.changeState=function(){this._stateChanged=!1,this.runCallLater(this.changeClips);var index=this._state<this._stateNum?this._state:this._stateNum-1;this._sources&&(this._bitmap.source=this._sources[index]),this.label&&(this._text.color=this._labelColors[index],this._strokeColors&&(this._text.strokeColor=this._strokeColors[index]))},__proto._setStateChanged=function(){this._stateChanged||(this._stateChanged=!0,this.callLater(this.changeState))},__getset(0,__proto,"skin",function(){return this._skin},function(value){this._skin!=value&&(this._skin=value,value?Loader.getRes(value)?this._skinLoaded():Laya.loader.load(this._skin,Handler.create(this,this._skinLoaded),null,"image",1):this._skinLoaded())}),__getset(0,__proto,"labelPadding",function(){return this.createText(),this._text.padding.join(",")},function(value){this.createText(),this._text.padding=UIUtils.fillArray(Styles.labelPadding,value,Number)}),__getset(0,__proto,"state",function(){return this._state},function(value){this._state!=value&&(this._state=value,this._setStateChanged())}),__getset(0,__proto,"text",function(){return this.createText(),this._text}),__getset(0,__proto,"stateNum",function(){return this._stateNum},function(value){"string"==typeof value&&(value=parseInt(value)),this._stateNum!=value&&(this._stateNum=value<1?1:value>3?3:value,this.callLater(this.changeClips))}),__getset(0,__proto,"label",function(){return this._text?this._text.text:null},function(value){(this._text||value)&&(this.createText(),this._text.text!=value&&(value&&!this._text.parent&&this.addChild(this._text),this._text.text=(value+"").replace(/\\n/g,"\n"),this._setStateChanged()))}),__getset(0,__proto,"labelSize",function(){return this.createText(),this._text.fontSize},function(value){this.createText(),this._text.fontSize=value}),__getset(0,__proto,"selected",function(){return this._selected},function(value){this._selected!=value&&(this._selected=value,this.state=this._selected?2:0,this.event("change"))}),__getset(0,__proto,"strokeColors",function(){return this._strokeColors?this._strokeColors.join(","):""},function(value){this._strokeColors=UIUtils.fillArray(Styles.buttonLabelColors,value,String),this._setStateChanged()}),__getset(0,__proto,"labelColors",function(){return this._labelColors.join(",")},function(value){this._labelColors=UIUtils.fillArray(Styles.buttonLabelColors,value,String),this._setStateChanged()}),__getset(0,__proto,"labelStroke",function(){return this.createText(),this._text.stroke},function(value){this.createText(),this._text.stroke=value}),__getset(0,__proto,"labelStrokeColor",function(){return this.createText(),this._text.strokeColor},function(value){this.createText(),this._text.strokeColor=value}),__getset(0,__proto,"labelBold",function(){return this.createText(),this._text.bold},function(value){this.createText(),this._text.bold=value}),__getset(0,__proto,"labelFont",function(){return this.createText(),this._text.font},function(value){this.createText(),this._text.font=value}),__getset(0,__proto,"labelAlign",function(){return this.createText(),this._text.align},function(value){this.createText(),this._text.align=value}),__getset(0,__proto,"clickHandler",function(){return this._clickHandler},function(value){this._clickHandler=value}),__getset(0,__proto,"sizeGrid",function(){return this._bitmap.sizeGrid?this._bitmap.sizeGrid.join(","):null},function(value){this._bitmap.sizeGrid=UIUtils.fillArray(Styles.defaultSizeGrid,value,Number)}),__getset(0,__proto,"width",_super.prototype._$get_width,function(value){Laya.superSet(UIComponent,this,"width",value),this._autoSize&&(this._bitmap.width=value,this._text&&(this._text.width=value))}),__getset(0,__proto,"height",_super.prototype._$get_height,function(value){Laya.superSet(UIComponent,this,"height",value),this._autoSize&&(this._bitmap.height=value,this._text&&(this._text.height=value))}),__getset(0,__proto,"dataSource",_super.prototype._$get_dataSource,function(value){this._dataSource=value,"number"==typeof value||"string"==typeof value?this.label=value+"":Laya.superSet(UIComponent,this,"dataSource",value)}),__getset(0,__proto,"iconOffset",function(){return this._bitmap._offset?this._bitmap._offset.join(","):null},function(value){this._bitmap._offset=value?UIUtils.fillArray([1,1],value,Number):[]}),__static(Button,["stateMap",function(){return this.stateMap={mouseup:0,mouseover:1,mousedown:2,mouseout:0}}]),Button}(UIComponent),Clip=function(_super){function Clip(url,clipX,clipY){this._sources=null,this._bitmap=null,this._skin=null,this._clipX=1,this._clipY=1,this._clipWidth=0,this._clipHeight=0,this._autoPlay=!1,this._interval=50,this._complete=null,this._isPlaying=!1,this._index=0,this._clipChanged=!1,this._group=null,this._toIndex=-1,Clip.__super.call(this),void 0===clipX&&(clipX=1),void 0===clipY&&(clipY=1),this._clipX=clipX,this._clipY=clipY,this.skin=url}__class(Clip,"laya.ui.Clip",_super);var __proto=Clip.prototype;return __proto.destroy=function(destroyChild){void 0===destroyChild&&(destroyChild=!0),_super.prototype.destroy.call(this,!0),this._bitmap&&this._bitmap.destroy(),this._bitmap=null,this._sources=null},__proto.dispose=function(){this.destroy(!0),Laya.loader.clearRes(this._skin)},__proto.createChildren=function(){this.graphics=this._bitmap=new AutoBitmap},__proto._onDisplay=function(e){this._isPlaying?this._getBit(128)?this.play():this.stop():this._autoPlay&&this.play()},__proto._skinLoaded=function(){this._setClipChanged(),this._sizeChanged(),this.event("loaded")},__proto.changeClip=function(){if(this._clipChanged=!1,this._skin){var img=Loader.getRes(this._skin);img?this.loadComplete(this._skin,img):Laya.loader.load(this._skin,Handler.create(this,this.loadComplete,[this._skin]))}},__proto.loadComplete=function(url,img){if(url===this._skin&&img){var w=this._clipWidth||Math.ceil(img.sourceWidth/this._clipX),h=this._clipHeight||Math.ceil(img.sourceHeight/this._clipY),key=this._skin+w+h,clips=WeakObject.I.get(key);if(Utils.isOkTextureList(clips)||(clips=null),clips)this._sources=clips;else{this._sources=[];for(var i=0;i<this._clipY;i++)for(var j=0;j<this._clipX;j++)this._sources.push(Texture.createFromTexture(img,w*j,h*i,w,h));WeakObject.I.set(key,this._sources)}this.index=this._index,this.event("loaded"),this.onCompResize()}},__proto.measureWidth=function(){return this.runCallLater(this.changeClip),this._bitmap.width},__proto.measureHeight=function(){return this.runCallLater(this.changeClip),this._bitmap.height},__proto.play=function(from,to){void 0===from&&(from=0),void 0===to&&(to=-1),this._isPlaying=!0,this.index=from,this._toIndex=to,this._index++,Laya.timer.loop(this.interval,this,this._loop),this.on("display",this,this._onDisplay),this.on("undisplay",this,this._onDisplay)},__proto._loop=function(){this._visible&&this._sources&&(this._index++,this._toIndex>-1&&this._index>=this._toIndex?this.stop():this._index>=this._sources.length&&(this._index=0),this.index=this._index)},__proto.stop=function(){this._isPlaying=!1,Laya.timer.clear(this,this._loop),this.event("complete")},__proto._setClipChanged=function(){this._clipChanged||(this._clipChanged=!0,this.callLater(this.changeClip))},__getset(0,__proto,"interval",function(){return this._interval},function(value){this._interval!=value&&(this._interval=value,this._isPlaying&&this.play())}),__getset(0,__proto,"skin",function(){return this._skin},function(value){this._skin!=value&&(this._skin=value,value?Loader.getRes(value)?this._skinLoaded():Laya.loader.load(this._skin,Handler.create(this,this._skinLoaded),null,"image",1):this._bitmap.source=null)}),__getset(0,__proto,"sources",function(){return this._sources},function(value){this._sources=value,this.index=this._index,this.event("loaded")}),__getset(0,__proto,"clipX",function(){return this._clipX},function(value){this._clipX=value||1,this._setClipChanged()}),__getset(0,__proto,"clipY",function(){return this._clipY},function(value){this._clipY=value||1,this._setClipChanged()}),__getset(0,__proto,"total",function(){return this.runCallLater(this.changeClip),this._sources?this._sources.length:0}),__getset(0,__proto,"clipWidth",function(){return this._clipWidth},function(value){this._clipWidth=value,this._setClipChanged()}),__getset(0,__proto,"sizeGrid",function(){return this._bitmap.sizeGrid?this._bitmap.sizeGrid.join(","):null},function(value){this._bitmap.sizeGrid=UIUtils.fillArray(Styles.defaultSizeGrid,value,Number)}),__getset(0,__proto,"group",function(){return this._group},function(value){value&&this._skin&&Loader.setGroup(this._skin,value),this._group=value}),__getset(0,__proto,"clipHeight",function(){return this._clipHeight},function(value){this._clipHeight=value,this._setClipChanged()}),__getset(0,__proto,"width",_super.prototype._$get_width,function(value){Laya.superSet(UIComponent,this,"width",value),this._bitmap.width=value}),__getset(0,__proto,"height",_super.prototype._$get_height,function(value){Laya.superSet(UIComponent,this,"height",value),this._bitmap.height=value}),__getset(0,__proto,"index",function(){return this._index},function(value){this._index=value,this._bitmap&&this._sources&&(this._bitmap.source=this._sources[value]),this.event("change")}),__getset(0,__proto,"autoPlay",function(){return this._autoPlay},function(value){this._autoPlay!=value&&(this._autoPlay=value,value?this.play():this.stop())}),__getset(0,__proto,"isPlaying",function(){return this._isPlaying},function(value){this._isPlaying=value}),__getset(0,__proto,"dataSource",_super.prototype._$get_dataSource,function(value){this._dataSource=value,"number"==typeof value&&Math.floor(value)==value||"string"==typeof value?this.index=parseInt(value):Laya.superSet(UIComponent,this,"dataSource",value)}),__getset(0,__proto,"bitmap",function(){return this._bitmap}),Clip}(UIComponent),Label=function(_super){function Label(text){this._tf=null,Label.__super.call(this),void 0===text&&(text=""),this.text=text}__class(Label,"laya.ui.Label",_super);var __proto=Label.prototype;return __proto.destroy=function(destroyChild){void 0===destroyChild&&(destroyChild=!0),_super.prototype.destroy.call(this,destroyChild),this._tf=null},__proto.createChildren=function(){this.addChild(this._tf=new Text)},__proto.changeText=function(text){this._tf.changeText(text)},__proto.measureWidth=function(){return this._tf.width},__proto.measureHeight=function(){return this._tf.height},__getset(0,__proto,"padding",function(){return this._tf.padding.join(",")},function(value){this._tf.padding=UIUtils.fillArray(Styles.labelPadding,value,Number)}),__getset(0,__proto,"bold",function(){return this._tf.bold},function(value){this._tf.bold=value}),__getset(0,__proto,"align",function(){return this._tf.align},function(value){this._tf.align=value}),__getset(0,__proto,"text",function(){return this._tf.text},function(value){this._tf.text!=value&&(value&&(value=UIUtils.adptString(value+"")),this._tf.text=value,this.event("change"),this._width&&this._height||this.onCompResize())}),__getset(0,__proto,"italic",function(){return this._tf.italic},function(value){this._tf.italic=value}),__getset(0,__proto,"wordWrap",function(){return this._tf.wordWrap},function(value){this._tf.wordWrap=value}),__getset(0,__proto,"font",function(){return this._tf.font},function(value){this._tf.font=value}),__getset(0,__proto,"dataSource",_super.prototype._$get_dataSource,function(value){this._dataSource=value,"number"==typeof value||"string"==typeof value?this.text=value+"":Laya.superSet(UIComponent,this,"dataSource",value)}),__getset(0,__proto,"color",function(){return this._tf.color},function(value){this._tf.color=value}),__getset(0,__proto,"valign",function(){return this._tf.valign},function(value){this._tf.valign=value}),__getset(0,__proto,"leading",function(){return this._tf.leading},function(value){this._tf.leading=value}),__getset(0,__proto,"fontSize",function(){return this._tf.fontSize},function(value){this._tf.fontSize=value}),__getset(0,__proto,"bgColor",function(){return this._tf.bgColor},function(value){this._tf.bgColor=value}),__getset(0,__proto,"borderColor",function(){return this._tf.borderColor},function(value){this._tf.borderColor=value}),__getset(0,__proto,"stroke",function(){return this._tf.stroke},function(value){this._tf.stroke=value}),__getset(0,__proto,"strokeColor",function(){return this._tf.strokeColor},function(value){this._tf.strokeColor=value}),__getset(0,__proto,"textField",function(){return this._tf}),__getset(0,__proto,"width",function(){return this._width||this._tf.text?Laya.superGet(UIComponent,this,"width"):0},function(value){Laya.superSet(UIComponent,this,"width",value),this._tf.width=value}),__getset(0,__proto,"height",function(){return this._height||this._tf.text?Laya.superGet(UIComponent,this,"height"):0},function(value){Laya.superSet(UIComponent,this,"height",value),this._tf.height=value}),__getset(0,__proto,"overflow",function(){return this._tf.overflow},function(value){this._tf.overflow=value}),__getset(0,__proto,"underline",function(){return this._tf.underline},function(value){this._tf.underline=value}),__getset(0,__proto,"underlineColor",function(){return this._tf.underlineColor},function(value){this._tf.underlineColor=value}),Label}(UIComponent),ScrollBar=function(_super){function ScrollBar(skin){this.rollRatio=.97,this.changeHandler=null,this.scaleBar=!0,this.autoHide=!1,this.elasticDistance=0,this.elasticBackTime=500,this.upButton=null,this.downButton=null,this.slider=null,this._scrollSize=1,this._skin=null,this._thumbPercent=1,this._target=null,this._lastPoint=null,this._lastOffset=0,this._checkElastic=!1,this._isElastic=!1,this._value=NaN,this._hide=!1,this._clickOnly=!0,this._offsets=null,this.isLockedFun=null,this.triggerDownDragLimit=null,this.triggerUpDragLimit=null,ScrollBar.__super.call(this),this._showButtons=UIConfig.showButtons,this._touchScrollEnable=UIConfig.touchScrollEnable,this._mouseWheelEnable=UIConfig.mouseWheelEnable,this.skin=skin,this.max=1}__class(ScrollBar,"laya.ui.ScrollBar",_super);var __proto=ScrollBar.prototype;return __proto.destroy=function(destroyChild){void 0===destroyChild&&(destroyChild=!0),this.stopScroll(),this.target=null,_super.prototype.destroy.call(this,destroyChild),this.upButton&&this.upButton.destroy(destroyChild),this.downButton&&this.downButton.destroy(destroyChild),this.slider&&this.slider.destroy(destroyChild),this.upButton=this.downButton=null,this.slider=null,this.changeHandler=null,this._offsets=null},__proto.createChildren=function(){this.addChild(this.slider=new Slider),this.addChild(this.upButton=new Button),this.addChild(this.downButton=new Button)},__proto.initialize=function(){this.slider.showLabel=!1,this.slider.tick=0,this.slider.on("change",this,this.onSliderChange),this.slider.setSlider(0,0,0),this.upButton.on("mousedown",this,this.onButtonMouseDown),this.downButton.on("mousedown",this,this.onButtonMouseDown)},__proto.onSliderChange=function(){this._value!=this.slider.value&&(this.value=this.slider.value)},__proto.onButtonMouseDown=function(e){var isUp=e.currentTarget===this.upButton;this.slide(isUp),Laya.timer.once(Styles.scrollBarDelayTime,this,this.startLoop,[isUp]),Laya.stage.once("mouseup",this,this.onStageMouseUp)},__proto.startLoop=function(isUp){Laya.timer.frameLoop(1,this,this.slide,[isUp])},__proto.slide=function(isUp){isUp?this.value-=this._scrollSize:this.value+=this._scrollSize},__proto.onStageMouseUp=function(e){Laya.timer.clear(this,this.startLoop),Laya.timer.clear(this,this.slide)},__proto._skinLoaded=function(){this.slider.skin=this._skin,this.callLater(this.changeScrollBar),this._sizeChanged(),this.event("loaded")},__proto.changeScrollBar=function(){this.upButton.visible=this._showButtons,this.downButton.visible=this._showButtons,this._showButtons&&(this.upButton.skin=this._skin.replace(".png","$up.png"),this.downButton.skin=this._skin.replace(".png","$down.png")),this.slider.isVertical?this.slider.y=this._showButtons?this.upButton.height:0:this.slider.x=this._showButtons?this.upButton.width:0,this.resetPositions(),this.repaint()},__proto._sizeChanged=function(){_super.prototype._sizeChanged.call(this),this.repaint(),this.resetPositions(),this.event("change"),this.changeHandler&&this.changeHandler.runWith(this.value)},__proto.resetPositions=function(){this.slider.isVertical?this.slider.height=this.height-(this._showButtons?this.upButton.height+this.downButton.height:0):this.slider.width=this.width-(this._showButtons?this.upButton.width+this.downButton.width:0),this.resetButtonPosition()},__proto.resetButtonPosition=function(){this.slider.isVertical?this.downButton.y=this.slider._y+this.slider.height:this.downButton.x=this.slider._x+this.slider.width},__proto.measureWidth=function(){return this.slider.isVertical?this.slider.width:100},__proto.measureHeight=function(){return this.slider.isVertical?100:this.slider.height},__proto.setScroll=function(min,max,value){this.runCallLater(this._sizeChanged),this.slider.setSlider(min,max,value),this.slider.bar.visible=max>0,!this._hide&&this.autoHide&&(this.visible=!1)},__proto.onTargetMouseWheel=function(e){this.value-=e.delta*this._scrollSize,this.target=this._target},__proto.onTargetMouseDown=function(e){this.isLockedFun&&!this.isLockedFun(e)||(this.event("end"),this._clickOnly=!0,this._lastOffset=0,this._checkElastic=!1,this._lastPoint||(this._lastPoint=new Point),this._lastPoint.setTo(Laya.stage.mouseX,Laya.stage.mouseY),Laya.timer.clear(this,this.tweenMove),Tween.clearTween(this),Laya.stage.once("mouseup",this,this.onStageMouseUp2),Laya.stage.once("mouseout",this,this.onStageMouseUp2),Laya.timer.frameLoop(1,this,this.loop))},__proto.startDragForce=function(){this._clickOnly=!0,this._lastOffset=0,this._checkElastic=!1,this._lastPoint||(this._lastPoint=new Point),this._lastPoint.setTo(Laya.stage.mouseX,Laya.stage.mouseY),Laya.timer.clear(this,this.tweenMove),Tween.clearTween(this),Laya.stage.once("mouseup",this,this.onStageMouseUp2),Laya.stage.once("mouseout",this,this.onStageMouseUp2),Laya.timer.frameLoop(1,this,this.loop)},__proto.cancelDragOp=function(){Laya.stage.off("mouseup",this,this.onStageMouseUp2),Laya.stage.off("mouseout",this,this.onStageMouseUp2),Laya.timer.clear(this,this.tweenMove),Laya.timer.clear(this,this.loop),this._target.mouseEnabled=!0},__proto.checkTriggers=function(isTweenMove){return void 0===isTweenMove&&(isTweenMove=!1),this.value>=0&&this.value-this._lastOffset<=0&&this.triggerDownDragLimit&&this.triggerDownDragLimit(isTweenMove)?(this.cancelDragOp(),this.value=0,!0):!!(this.value<=this.max&&this.value-this._lastOffset>=this.max&&this.triggerUpDragLimit&&this.triggerUpDragLimit(isTweenMove))&&(this.cancelDragOp(),this.value=this.max,!0)},__proto.startTweenMoveForce=function(lastOffset){this._lastOffset=lastOffset,Laya.timer.frameLoop(1,this,this.tweenMove,[200])},__proto.loop=function(){var mouseY=Laya.stage.mouseY,mouseX=Laya.stage.mouseX;if(this._lastOffset=this.isVertical?mouseY-this._lastPoint.y:mouseX-this._lastPoint.x,this._clickOnly){if(!(Math.abs(this._lastOffset*(this.isVertical?Laya.stage._canvasTransform.getScaleY():Laya.stage._canvasTransform.getScaleX()))>1))return;if(this._clickOnly=!1,this.checkTriggers())return;this._offsets||(this._offsets=[]),this._offsets.length=0,this._target.mouseEnabled=!1,!this.hide&&this.autoHide&&(this.alpha=1,this.visible=!0),this.event("start")}else if(this.checkTriggers())return;this._offsets.push(this._lastOffset),this._lastPoint.x=mouseX,this._lastPoint.y=mouseY,0!==this._lastOffset&&(this._checkElastic||(this.elasticDistance>0?this._checkElastic||0==this._lastOffset||(this._lastOffset>0&&this._value<=this.min||this._lastOffset<0&&this._value>=this.max?(this._isElastic=!0,this._checkElastic=!0):this._isElastic=!1):this._checkElastic=!0),this._isElastic?this._value<=this.min?this._lastOffset>0?this.value-=this._lastOffset*Math.max(0,1-(this.min-this._value)/this.elasticDistance):(this.value-=.5*this._lastOffset,this._value>=this.min&&(this._checkElastic=!1)):this._value>=this.max&&(this._lastOffset<0?this.value-=this._lastOffset*Math.max(0,1-(this._value-this.max)/this.elasticDistance):(this.value-=.5*this._lastOffset,this._value<=this.max&&(this._checkElastic=!1))):this.value-=this._lastOffset)},__proto.onStageMouseUp2=function(e){if(Laya.stage.off("mouseup",this,this.onStageMouseUp2),Laya.stage.off("mouseout",this,this.onStageMouseUp2),Laya.timer.clear(this,this.loop),!(this._clickOnly&&this._value>=this.min&&this._value<=this.max))if(this._target.mouseEnabled=!0,this._isElastic)this._value<this.min?Tween.to(this,{value:this.min},this.elasticBackTime,Ease.sineOut,Handler.create(this,this.elasticOver)):this._value>this.max&&Tween.to(this,{value:this.max},this.elasticBackTime,Ease.sineOut,Handler.create(this,this.elasticOver));else{if(!this._offsets)return;this._offsets.length<1&&(this._offsets[0]=this.isVertical?Laya.stage.mouseY-this._lastPoint.y:Laya.stage.mouseX-this._lastPoint.x);for(var offset=0,n=Math.min(this._offsets.length,3),i=0;i<n;i++)offset+=this._offsets[this._offsets.length-1-i];if(this._lastOffset=offset/n,(offset=Math.abs(this._lastOffset))<2)return void this.event("end");offset>250&&(this._lastOffset=this._lastOffset>0?250:-250);var dis=Math.round(Math.abs(this.elasticDistance*(this._lastOffset/150)));Laya.timer.frameLoop(1,this,this.tweenMove,[dis])}},__proto.elasticOver=function(){this._isElastic=!1,!this.hide&&this.autoHide&&Tween.to(this,{alpha:0},500),this.event("end")},__proto.tweenMove=function(maxDistance){if(this._lastOffset*=this.rollRatio,!this.checkTriggers(!0)){var tarSpeed=NaN;if(maxDistance>0&&(this._lastOffset>0&&this.value<=this.min?(this._isElastic=!0,tarSpeed=.5*-(this.min-maxDistance-this.value),this._lastOffset>tarSpeed&&(this._lastOffset=tarSpeed)):this._lastOffset<0&&this.value>=this.max&&(this._isElastic=!0,tarSpeed=.5*-(this.max+maxDistance-this.value),this._lastOffset<tarSpeed&&(this._lastOffset=tarSpeed))),this.value-=this._lastOffset,Math.abs(this._lastOffset)<.1){if(Laya.timer.clear(this,this.tweenMove),this._isElastic)return void(this._value<this.min?Tween.to(this,{value:this.min},this.elasticBackTime,Ease.sineOut,Handler.create(this,this.elasticOver)):this._value>this.max?Tween.to(this,{value:this.max},this.elasticBackTime,Ease.sineOut,Handler.create(this,this.elasticOver)):this.elasticOver());this.event("end"),!this.hide&&this.autoHide&&Tween.to(this,{alpha:0},500)}}},__proto.stopScroll=function(){this.onStageMouseUp2(null),Laya.timer.clear(this,this.tweenMove),Tween.clearTween(this)},__getset(0,__proto,"thumbPercent",function(){return this._thumbPercent},function(value){this.runCallLater(this.changeScrollBar),this.runCallLater(this._sizeChanged),value=value>=1?.99:value,this._thumbPercent=value,this.scaleBar&&(this.slider.isVertical?this.slider.bar.height=Math.max(this.slider.height*value,Styles.scrollBarMinNum):this.slider.bar.width=Math.max(this.slider.width*value,Styles.scrollBarMinNum))}),__getset(0,__proto,"dataSource",_super.prototype._$get_dataSource,function(value){this._dataSource=value,"number"==typeof value||"string"==typeof value?this.value=Number(value):Laya.superSet(UIComponent,this,"dataSource",value)}),__getset(0,__proto,"skin",function(){return this._skin},function(value){" "!=value&&this._skin!=value&&(this._skin=value,this._skin&&!Loader.getRes(this._skin)?Laya.loader.load([this._skin,this._skin.replace(".png","$up.png"),this._skin.replace(".png","$down.png"),this._skin.replace(".png","$bar.png")],Handler.create(this,this._skinLoaded)):this._skinLoaded())}),__getset(0,__proto,"max",function(){return this.slider.max},function(value){this.slider.max=value}),__getset(0,__proto,"min",function(){return this.slider.min},function(value){this.slider.min=value}),__getset(0,__proto,"value",function(){return this._value},function(v){v!==this._value&&(this._value=v,this._isElastic||(this.slider._value!=v&&(this.slider._value=v,this.slider.changeValue()),this._value=this.slider._value),this.event("change"),this.changeHandler&&this.changeHandler.runWith(this._value))}),__getset(0,__proto,"isVertical",function(){return this.slider.isVertical},function(value){this.slider.isVertical=value}),__getset(0,__proto,"sizeGrid",function(){return this.slider.sizeGrid},function(value){this.slider.sizeGrid=value}),__getset(0,__proto,"scrollSize",function(){return this._scrollSize},function(value){this._scrollSize=value}),__getset(0,__proto,"target",function(){return this._target},function(value){this._target&&(this._target.off("mousewheel",this,this.onTargetMouseWheel),this._target.off("mousedown",this,this.onTargetMouseDown)),this._target=value,value&&(this._mouseWheelEnable&&this._target.on("mousewheel",this,this.onTargetMouseWheel),this._touchScrollEnable&&this._target.on("mousedown",this,this.onTargetMouseDown))}),__getset(0,__proto,"hide",function(){return this._hide},function(value){this._hide=value,this.visible=!value}),__getset(0,__proto,"showButtons",function(){return this._showButtons},function(value){this._showButtons=value,this.callLater(this.changeScrollBar)}),__getset(0,__proto,"touchScrollEnable",function(){return this._touchScrollEnable},function(value){this._touchScrollEnable=value,this.target=this._target}),__getset(0,__proto,"mouseWheelEnable",function(){return this._mouseWheelEnable},function(value){this._mouseWheelEnable=value,this.target=this._target}),__getset(0,__proto,"lastOffset",function(){return this._lastOffset}),__getset(0,__proto,"tick",function(){return this.slider.tick},function(value){this.slider.tick=value}),ScrollBar}(UIComponent),Slider=function(_super){function Slider(skin){this.changeHandler=null,this.isVertical=!0,this.showLabel=!0,this._allowClickBack=!1,this._max=100,this._min=0,this._tick=1,this._value=0,this._skin=null,this._bg=null,this._progress=null,this._bar=null,this._tx=NaN,this._ty=NaN,this._maxMove=NaN,this._globalSacle=null,Slider.__super.call(this),this.skin=skin}__class(Slider,"laya.ui.Slider",_super);var __proto=Slider.prototype;return __proto.destroy=function(destroyChild){void 0===destroyChild&&(destroyChild=!0),_super.prototype.destroy.call(this,destroyChild),this._bg&&this._bg.destroy(destroyChild),this._bar&&this._bar.destroy(destroyChild),this._progress&&this._progress.destroy(destroyChild),this._bg=null,this._bar=null,this._progress=null,this.changeHandler=null},__proto.createChildren=function(){this.addChild(this._bg=new Image),this.addChild(this._bar=new Button)},__proto.initialize=function(){this._bar.on("mousedown",this,this.onBarMouseDown),this._bg.sizeGrid=this._bar.sizeGrid="4,4,4,4,0",this._progress&&(this._progress.sizeGrid=this._bar.sizeGrid),this.allowClickBack=!0},__proto.onBarMouseDown=function(e){this._globalSacle||(this._globalSacle=new Point),this._globalSacle.setTo(this.globalScaleX||.01,this.globalScaleY||.01),this._maxMove=this.isVertical?this.height-this._bar.height:this.width-this._bar.width,this._tx=Laya.stage.mouseX,this._ty=Laya.stage.mouseY,Laya.stage.on("mousemove",this,this.mouseMove),Laya.stage.once("mouseup",this,this.mouseUp),Laya.stage.once("mouseout",this,this.mouseUp),this.showValueText()},__proto.showValueText=function(){if(this.showLabel){var label=laya.ui.Slider.label;this.addChild(label),label.textField.changeText(this._value+""),this.isVertical?(label.x=this._bar._x+20,label.y=.5*(this._bar.height-label.height)+this._bar._y):(label.y=this._bar._y-20,label.x=.5*(this._bar.width-label.width)+this._bar._x)}},__proto.hideValueText=function(){laya.ui.Slider.label&&laya.ui.Slider.label.removeSelf()},__proto.mouseUp=function(e){Laya.stage.off("mousemove",this,this.mouseMove),Laya.stage.off("mouseup",this,this.mouseUp),Laya.stage.off("mouseout",this,this.mouseUp),this.sendChangeEvent("changed"),this.hideValueText()},__proto.mouseMove=function(e){var oldValue=this._value;if(this.isVertical?(this._bar.y+=(Laya.stage.mouseY-this._ty)/this._globalSacle.y,this._bar._y>this._maxMove?this._bar.y=this._maxMove:this._bar._y<0&&(this._bar.y=0),this._value=this._bar._y/this._maxMove*(this._max-this._min)+this._min,this._progress&&(this._progress.height=this._bar._y+.5*this._bar.height)):(this._bar.x+=(Laya.stage.mouseX-this._tx)/this._globalSacle.x,this._bar._x>this._maxMove?this._bar.x=this._maxMove:this._bar._x<0&&(this._bar.x=0),this._value=this._bar._x/this._maxMove*(this._max-this._min)+this._min,this._progress&&(this._progress.width=this._bar._x+.5*this._bar.width)),this._tx=Laya.stage.mouseX,this._ty=Laya.stage.mouseY,0!=this._tick){var pow=Math.pow(10,(this._tick+"").length-1);this._value=Math.round(Math.round(this._value/this._tick)*this._tick*pow)/pow}this._value!=oldValue&&this.sendChangeEvent(),this.showValueText()},__proto.sendChangeEvent=function(type){void 0===type&&(type="change"),this.event(type),this.changeHandler&&this.changeHandler.runWith(this._value)},__proto._skinLoaded=function(){this._bg.skin=this._skin,this._bar.skin=this._skin.replace(".png","$bar.png");var progressSkin=this._skin.replace(".png","$progress.png");Loader.getRes(progressSkin)&&(this._progress||(this.addChild(this._progress=new Image),this._progress.sizeGrid=this._bar.sizeGrid,this.setChildIndex(this._progress,1)),this._progress.skin=progressSkin),this.setBarPoint(),this.callLater(this.changeValue),this._sizeChanged(),this.event("loaded")},__proto.setBarPoint=function(){this.isVertical?this._bar.x=Math.round(.5*(this._bg.width-this._bar.width)):this._bar.y=Math.round(.5*(this._bg.height-this._bar.height))},__proto.measureWidth=function(){return Math.max(this._bg.width,this._bar.width)},__proto.measureHeight=function(){return Math.max(this._bg.height,this._bar.height)},__proto._sizeChanged=function(){_super.prototype._sizeChanged.call(this),this.isVertical?this._bg.height=this.height:this._bg.width=this.width,this.setBarPoint(),this.changeValue()},__proto.setSlider=function(min,max,value){this._value=-1,this._min=min,this._max=max>min?max:min,this.value=value<min?min:value>max?max:value},__proto.changeValue=function(){if(0!=this.tick){var pow=Math.pow(10,(this._tick+"").length-1);this._value=Math.round(Math.round(this._value/this._tick)*this._tick*pow)/pow}this._value=this._value>this._max?this._max:this._value<this._min?this._min:this._value;var num=this._max-this._min;0===num&&(num=1),this.isVertical?(this._bar.y=(this._value-this._min)/num*(this.height-this._bar.height),this._progress&&(this._progress.height=this._bar._y+.5*this._bar.height)):(this._bar.x=(this._value-this._min)/num*(this.width-this._bar.width),this._progress&&(this._progress.width=this._bar._x+.5*this._bar.width))},__proto.onBgMouseDown=function(e){var point=this._bg.getMousePoint();this.isVertical?this.value=point.y/(this.height-this._bar.height)*(this._max-this._min)+this._min:this.value=point.x/(this.width-this._bar.width)*(this._max-this._min)+this._min},__getset(0,__proto,"dataSource",_super.prototype._$get_dataSource,function(value){this._dataSource=value,"number"==typeof value||"string"==typeof value?this.value=Number(value):Laya.superSet(UIComponent,this,"dataSource",value)}),__getset(0,__proto,"skin",function(){return this._skin},function(value){this._skin!=value&&(this._skin=value,this._skin&&!Loader.getRes(this._skin)?Laya.loader.load([this._skin,this._skin.replace(".png","$bar.png")],Handler.create(this,this._skinLoaded)):this._skinLoaded())}),__getset(0,__proto,"tick",function(){return this._tick},function(value){this._tick!=value&&(this._tick=value,this.callLater(this.changeValue))}),__getset(0,__proto,"sizeGrid",function(){return this._bg.sizeGrid},function(value){this._bg.sizeGrid=value,this._bar.sizeGrid=value,this._progress&&(this._progress.sizeGrid=this._bar.sizeGrid)}),__getset(0,__proto,"allowClickBack",function(){return this._allowClickBack},function(value){this._allowClickBack!=value&&(this._allowClickBack=value,value?this._bg.on("mousedown",this,this.onBgMouseDown):this._bg.off("mousedown",this,this.onBgMouseDown))}),__getset(0,__proto,"max",function(){return this._max},function(value){this._max!=value&&(this._max=value,this.callLater(this.changeValue))}),__getset(0,__proto,"min",function(){return this._min},function(value){this._min!=value&&(this._min=value,this.callLater(this.changeValue))}),__getset(0,__proto,"bar",function(){return this._bar}),__getset(0,__proto,"value",function(){return this._value},function(num){if(this._value!=num){var oldValue=this._value;this._value=num,this.changeValue(),this._value!=oldValue&&this.sendChangeEvent()}}),__static(Slider,["label",function(){return this.label=new Label}]),Slider}(UIComponent),List=function(_super){function List(){this.selectHandler=null,this.renderHandler=null,this.mouseHandler=null,this.selectEnable=!1,this.totalPage=0,this._$componentType="List",this._content=null,this._scrollBar=null,this._itemRender=null,this._repeatX=0,this._repeatY=0,this._repeatX2=0,this._repeatY2=0,this._spaceX=0,this._spaceY=0,this._array=null,this._startIndex=0,this._selectedIndex=-1,this._page=0,this._isVertical=!0,this._cellSize=20,this._cellOffset=0,this._isMoved=!1,this.cacheContent=!1,this._createdLine=0,this._cellChanged=!1,this._usedCache=null,this._elasticEnabled=!1,this._preLen=0,List.__super.call(this),this._cells=[],this._offset=new Point}__class(List,"laya.ui.List",_super);var __proto=List.prototype;return Laya.imps(__proto,{"laya.ui.IRender":!0,"laya.ui.IItem":!0}),__proto.destroy=function(destroyChild){void 0===destroyChild&&(destroyChild=!0),this._content&&this._content.destroy(destroyChild),this._scrollBar&&this._scrollBar.destroy(destroyChild),laya.ui.UIComponent.prototype.destroy.call(this,destroyChild),this._content=null,this._scrollBar=null,this._itemRender=null,this._cells=null,this._array=null,this.selectHandler=this.renderHandler=this.mouseHandler=null},__proto.createChildren=function(){this.addChild(this._content=new Box)},__proto.onScrollStart=function(){this._usedCache||(this._usedCache=Laya.superGet(Box,this,"cacheAs")),Laya.superSet(Box,this,"cacheAs","none"),this._scrollBar.once("end",this,this.onScrollEnd)},__proto.onScrollEnd=function(){Laya.superSet(Box,this,"cacheAs",this._usedCache)},__proto._removePreScrollBar=function(){var preNode=this.removeChildByName("scrollBar");preNode&&preNode.destroy(!0)},__proto.changeCells=function(){if(this._cellChanged=!1,this._itemRender){this.scrollBar=this.getChildByName("scrollBar");var cell=this._getOneCell(),cellWidth=cell.width+this._spaceX||1,cellHeight=cell.height+this._spaceY||1;this._width>0&&(this._repeatX2=this._isVertical?Math.round(this._width/cellWidth):Math.ceil(this._width/cellWidth)),this._height>0&&(this._repeatY2=this._isVertical?Math.ceil(this._height/cellHeight):Math.round(this._height/cellHeight));var listWidth=this._width?this._width:cellWidth*this.repeatX-this._spaceX,listHeight=this._height?this._height:cellHeight*this.repeatY-this._spaceY;this._cellSize=this._isVertical?cellHeight:cellWidth,this._cellOffset=this._isVertical?cellHeight*Math.max(this._repeatY2,this._repeatY)-listHeight-this._spaceY:cellWidth*Math.max(this._repeatX2,this._repeatX)-listWidth-this._spaceX,this._isVertical&&this.vScrollBarSkin?this._scrollBar.height=listHeight:!this._isVertical&&this.hScrollBarSkin&&(this._scrollBar.width=listWidth),this.setContentSize(listWidth,listHeight);var numX=this._isVertical?this.repeatX:this.repeatY,numY=(this._isVertical?this.repeatY:this.repeatX)+(this._scrollBar?1:0);this._createItems(0,numX,numY),this._createdLine=numY,this._array&&(this.array=this._array,this.runCallLater(this.renderItems))}},__proto._getOneCell=function(){if(0===this._cells.length){var item=this.createItem();if(this._offset.setTo(item._x,item._y),this.cacheContent)return item;this._cells.push(item)}return this._cells[0]},__proto._createItems=function(startY,numX,numY){var box=this._content,cell=this._getOneCell(),cellWidth=cell.width+this._spaceX,cellHeight=cell.height+this._spaceY;if(this.cacheContent){var cacheBox=new Box;cacheBox.cacheAs="normal",cacheBox.pos((this._isVertical?0:startY)*cellWidth,(this._isVertical?startY:0)*cellHeight),this._content.addChild(cacheBox),box=cacheBox}else{for(var arr=[],i=this._cells.length-1;i>-1;i--){var item=this._cells[i];item.removeSelf(),arr.push(item)}this._cells.length=0}for(var k=startY;k<numY;k++)for(var l=0;l<numX;l++)(cell=arr&&arr.length?arr.pop():this.createItem()).x=(this._isVertical?l:k)*cellWidth-box._x,cell.y=(this._isVertical?k:l)*cellHeight-box._y,cell.name="item"+(k*numX+l),box.addChild(cell),this.addCell(cell)},__proto.createItem=function(){var arr=[];if("function"==typeof this._itemRender)var box=new this._itemRender;else box=SceneUtils.createComp(this._itemRender,null,null,arr);if(0==arr.length&&box._watchMap){var watchMap=box._watchMap;for(var name in watchMap)for(var a=watchMap[name],i=0;i<a.length;i++){var watcher=a[i];arr.push(watcher.comp,watcher.prop,watcher.value)}}return arr.length&&(box._$bindData=arr),box},__proto.addCell=function(cell){cell.on("click",this,this.onCellMouse),cell.on("rightclick",this,this.onCellMouse),cell.on("mouseover",this,this.onCellMouse),cell.on("mouseout",this,this.onCellMouse),cell.on("mousedown",this,this.onCellMouse),cell.on("mouseup",this,this.onCellMouse),this._cells.push(cell)},__proto._afterInited=function(){this.initItems()},__proto.initItems=function(){if(!this._itemRender&&null!=this.getChildByName("item0")){this.repeatX=1;var count=0;count=0;for(var i=0;i<1e4;i++){var cell=this.getChildByName("item"+i);if(!cell)break;this.addCell(cell),count++}this.repeatY=count}},__proto.setContentSize=function(width,height){this._content.width=width,this._content.height=height,(this._scrollBar||0!=this._offset.x||0!=this._offset.y)&&(this._content._style.scrollRect||(this._content.scrollRect=Rectangle.create()),this._content._style.scrollRect.setTo(-this._offset.x,-this._offset.y,width,height),this._content.scrollRect=this._content.scrollRect),this.event("resize")},__proto.onCellMouse=function(e){"mousedown"===e.type&&(this._isMoved=!1);var cell=e.currentTarget,index=this._startIndex+this._cells.indexOf(cell);index<0||("click"===e.type||"rightclick"===e.type?this.selectEnable&&!this._isMoved?this.selectedIndex=index:this.changeCellState(cell,!0,0):"mouseover"!==e.type&&"mouseout"!==e.type||this._selectedIndex===index||this.changeCellState(cell,"mouseover"===e.type,0),this.mouseHandler&&this.mouseHandler.runWith([e,index]))},__proto.changeCellState=function(cell,visible,index){var selectBox=cell.getChildByName("selectBox");selectBox&&(this.selectEnable=!0,selectBox.visible=visible,selectBox.index=index)},__proto._sizeChanged=function(){laya.ui.UIComponent.prototype._sizeChanged.call(this),this.setContentSize(this.width,this.height),this._scrollBar&&this.callLater(this.onScrollBarChange)},__proto.onScrollBarChange=function(e){this.runCallLater(this.changeCells);var scrollValue=this._scrollBar.value,lineX=this._isVertical?this.repeatX:this.repeatY,lineY=this._isVertical?this.repeatY:this.repeatX,scrollLine=Math.floor(scrollValue/this._cellSize);if(this.cacheContent)num=lineY+1,this._createdLine-scrollLine<num&&(this._createItems(this._createdLine,lineX,this._createdLine+num),this.renderItems(this._createdLine*lineX,0),this._createdLine+=num);else{var index=scrollLine*lineX,num=0;if(index>this._startIndex){num=index-this._startIndex;var down=!0,toIndex=this._startIndex+lineX*(lineY+1);this._isMoved=!0}else index<this._startIndex&&(num=this._startIndex-index,down=!1,toIndex=this._startIndex-1,this._isMoved=!0);for(var i=0;i<num;i++){if(down){var cell=this._cells.shift();this._cells[this._cells.length]=cell;var cellIndex=toIndex+i}else cell=this._cells.pop(),this._cells.unshift(cell),cellIndex=toIndex-i;var pos=Math.floor(cellIndex/lineX)*this._cellSize;this._isVertical?cell.y=pos:cell.x=pos,this.renderItem(cell,cellIndex)}this._startIndex=index,this.changeSelectStatus()}var r=this._content._style.scrollRect;this._isVertical?(r.y=scrollValue-this._offset.y,r.x=-this._offset.x):(r.y=-this._offset.y,r.x=scrollValue-this._offset.x),this._content.scrollRect=r},__proto.posCell=function(cell,cellIndex){if(this._scrollBar){var lineX=this._isVertical?this.repeatX:this.repeatY,pos=(this._isVertical?this.repeatY:this.repeatX,Math.floor(cellIndex/lineX)*this._cellSize);this._isVertical?cell._y=pos:cell.x=pos}},__proto.changeSelectStatus=function(){for(var i=0,n=this._cells.length;i<n;i++)this.changeCellState(this._cells[i],this._selectedIndex===this._startIndex+i,1)},__proto.renderItems=function(from,to){void 0===from&&(from=0),void 0===to&&(to=0);for(var i=from,n=to||this._cells.length;i<n;i++)this.renderItem(this._cells[i],this._startIndex+i);this.changeSelectStatus()},__proto.renderItem=function(cell,index){this._array&&index>=0&&index<this._array.length?(cell.visible=!0,cell._$bindData?(cell._dataSource=this._array[index],this._bindData(cell,this._array[index])):cell.dataSource=this._array[index],this.cacheContent||this.posCell(cell,index),this.hasListener("render")&&this.event("render",[cell,index]),this.renderHandler&&this.renderHandler.runWith([cell,index])):(cell.visible=!1,cell.dataSource=null)},__proto._bindData=function(cell,data){for(var arr=cell._$bindData,i=0,n=arr.length;i<n;i++){var ele=arr[i++],prop=arr[i++],value=arr[i],fun=UIUtils.getBindFun(value);ele[prop]=fun.call(this,data)}},__proto.updateArray=function(array){this._array=array;var freshStart=0;if(this._array&&((freshStart=this._preLen-this._startIndex)>=0&&this.renderItems(freshStart),this._preLen=this._array.length),this._scrollBar){var length=array.length,numX=this._isVertical?this.repeatX:this.repeatY,numY=this._isVertical?this.repeatY:this.repeatX,lineCount=Math.ceil(length/numX);lineCount>=numY&&(this._scrollBar.thumbPercent=numY/lineCount,this._scrollBar.slider._max=(lineCount-numY)*this._cellSize+this._cellOffset)}},__proto.refresh=function(){this.array=this._array},__proto.getItem=function(index){return index>-1&&index<this._array.length?this._array[index]:null},__proto.changeItem=function(index,source){index>-1&&index<this._array.length&&(this._array[index]=source,index>=this._startIndex&&index<this._startIndex+this._cells.length&&this.renderItem(this.getCell(index),index))},__proto.setItem=function(index,source){this.changeItem(index,source)},__proto.addItem=function(souce){this._array.push(souce),this.array=this._array},__proto.addItemAt=function(souce,index){this._array.splice(index,0,souce),this.array=this._array},__proto.deleteItem=function(index){this._array.splice(index,1),this.array=this._array},__proto.getCell=function(index){return this.runCallLater(this.changeCells),index>-1&&this._cells?this._cells[(index-this._startIndex)%this._cells.length]:null},__proto.scrollTo=function(index){if(this._scrollBar){var numX=this._isVertical?this.repeatX:this.repeatY;this._scrollBar.value=Math.floor(index/numX)*this._cellSize}else this.startIndex=index},__proto.tweenTo=function(index,time,complete){if(void 0===time&&(time=200),this._scrollBar){this._scrollBar.stopScroll();var numX=this._isVertical?this.repeatX:this.repeatY;Tween.to(this._scrollBar,{value:Math.floor(index/numX)*this._cellSize},time,null,complete,0,!0)}else this.startIndex=index,complete&&complete.run()},__proto._setCellChanged=function(){this._cellChanged||(this._cellChanged=!0,this.callLater(this.changeCells))},__proto.commitMeasure=function(){this.runCallLater(this.changeCells)},__getset(0,__proto,"cacheAs",_super.prototype._$get_cacheAs,function(value){Laya.superSet(Box,this,"cacheAs",value),this._scrollBar&&(this._usedCache=null,"none"!==value?this._scrollBar.on("start",this,this.onScrollStart):this._scrollBar.off("start",this,this.onScrollStart))}),__getset(0,__proto,"content",function(){return this._content}),__getset(0,__proto,"height",_super.prototype._$get_height,function(value){value!=this._height&&(Laya.superSet(Box,this,"height",value),this._setCellChanged())}),__getset(0,__proto,"itemRender",function(){return this._itemRender},function(value){if(this._itemRender!=value){this._itemRender=value;for(var i=this._cells.length-1;i>-1;i--)this._cells[i].destroy();this._cells.length=0,this._setCellChanged()}}),__getset(0,__proto,"vScrollBarSkin",function(){return this._scrollBar?this._scrollBar.skin:null},function(value){this._removePreScrollBar();var scrollBar=new VScrollBar;scrollBar.name="scrollBar",scrollBar.right=0,scrollBar.skin=value,scrollBar.elasticDistance=this._elasticEnabled?200:0,this.scrollBar=scrollBar,this.addChild(scrollBar),this._setCellChanged()}),__getset(0,__proto,"page",function(){return this._page},function(value){this._page=value,this._array&&(this._page=value>0?value:0,this._page=this._page<this.totalPage?this._page:this.totalPage-1,this.startIndex=this._page*this.repeatX*this.repeatY)}),__getset(0,__proto,"hScrollBarSkin",function(){return this._scrollBar?this._scrollBar.skin:null},function(value){this._removePreScrollBar();var scrollBar=new HScrollBar;scrollBar.name="scrollBar",scrollBar.bottom=0,scrollBar.skin=value,scrollBar.elasticDistance=this._elasticEnabled?200:0,this.scrollBar=scrollBar,this.addChild(scrollBar),this._setCellChanged()}),__getset(0,__proto,"repeatX",function(){return this._repeatX>0?this._repeatX:this._repeatX2>0?this._repeatX2:1},function(value){this._repeatX=value,this._setCellChanged()}),__getset(0,__proto,"scrollBar",function(){return this._scrollBar},function(value){this._scrollBar!=value&&(this._scrollBar=value,value&&(this._isVertical=this._scrollBar.isVertical,this.addChild(this._scrollBar),this._scrollBar.on("change",this,this.onScrollBarChange)))}),__getset(0,__proto,"width",_super.prototype._$get_width,function(value){value!=this._width&&(Laya.superSet(Box,this,"width",value),this._setCellChanged())}),__getset(0,__proto,"repeatY",function(){return this._repeatY>0?this._repeatY:this._repeatY2>0?this._repeatY2:1},function(value){this._repeatY=value,this._setCellChanged()}),__getset(0,__proto,"spaceX",function(){return this._spaceX},function(value){this._spaceX=value,this._setCellChanged()}),__getset(0,__proto,"spaceY",function(){return this._spaceY},function(value){this._spaceY=value,this._setCellChanged()}),__getset(0,__proto,"selectedIndex",function(){return this._selectedIndex},function(value){this._selectedIndex!=value&&(this._selectedIndex=value,this.changeSelectStatus(),this.event("change"),this.selectHandler&&this.selectHandler.runWith(value),this.startIndex=this._startIndex)}),__getset(0,__proto,"selectedItem",function(){return-1!=this._selectedIndex?this._array[this._selectedIndex]:null},function(value){this.selectedIndex=this._array.indexOf(value)}),__getset(0,__proto,"length",function(){return this._array?this._array.length:0}),__getset(0,__proto,"selection",function(){return this.getCell(this._selectedIndex)},function(value){this.selectedIndex=this._startIndex+this._cells.indexOf(value)}),__getset(0,__proto,"startIndex",function(){return this._startIndex},function(value){this._startIndex=value>0?value:0,this.callLater(this.renderItems)}),__getset(0,__proto,"array",function(){return this._array},function(value){this.runCallLater(this.changeCells),this._array=value||[],this._preLen=this._array.length;var length=this._array.length;if(this.totalPage=Math.ceil(length/(this.repeatX*this.repeatY)),this._selectedIndex=this._selectedIndex<length?this._selectedIndex:length-1,this.startIndex=this._startIndex,this._scrollBar){this._scrollBar.stopScroll();var numX=this._isVertical?this.repeatX:this.repeatY,numY=this._isVertical?this.repeatY:this.repeatX,lineCount=Math.ceil(length/numX);(this._cellOffset>0?this.totalPage+1:this.totalPage)>1&&lineCount>=numY?(this._scrollBar.scrollSize=this._cellSize,this._scrollBar.thumbPercent=numY/lineCount,this._scrollBar.setScroll(0,(lineCount-numY)*this._cellSize+this._cellOffset,this._scrollBar.value),this._scrollBar.target=this._content):(this._scrollBar.setScroll(0,0,0),this._scrollBar.target=this._content)}}),__getset(0,__proto,"dataSource",_super.prototype._$get_dataSource,function(value){this._dataSource=value,"number"==typeof value&&Math.floor(value)==value||"string"==typeof value?this.selectedIndex=parseInt(value):value instanceof Array?this.array=value:Laya.superSet(Box,this,"dataSource",value)}),__getset(0,__proto,"cells",function(){return this.runCallLater(this.changeCells),this._cells}),__getset(0,__proto,"elasticEnabled",function(){return this._elasticEnabled},function(value){this._elasticEnabled=value,this._scrollBar&&(this._scrollBar.elasticDistance=value?200:0)}),List}(Box),Panel=function(_super){function Panel(){this._content=null,this._vScrollBar=null,this._hScrollBar=null,this._scrollChanged=!1,this._usedCache=null,this._elasticEnabled=!1,Panel.__super.call(this),this.width=this.height=100}__class(Panel,"laya.ui.Panel",_super);var __proto=Panel.prototype;return __proto.destroy=function(destroyChild){void 0===destroyChild&&(destroyChild=!0),laya.ui.UIComponent.prototype.destroy.call(this,destroyChild),this._content&&this._content.destroy(destroyChild),this._vScrollBar&&this._vScrollBar.destroy(destroyChild),this._hScrollBar&&this._hScrollBar.destroy(destroyChild),this._vScrollBar=null,this._hScrollBar=null,this._content=null},__proto.destroyChildren=function(){this._content.destroyChildren()},__proto.createChildren=function(){laya.display.Node.prototype.addChild.call(this,this._content=new Box)},__proto.addChild=function(child){return child.on("resize",this,this.onResize),this._setScrollChanged(),this._content.addChild(child)},__proto.onResize=function(){this._setScrollChanged()},__proto.addChildAt=function(child,index){return child.on("resize",this,this.onResize),this._setScrollChanged(),this._content.addChildAt(child,index)},__proto.removeChild=function(child){return child.off("resize",this,this.onResize),this._setScrollChanged(),this._content.removeChild(child)},__proto.removeChildAt=function(index){return this.getChildAt(index).off("resize",this,this.onResize),this._setScrollChanged(),this._content.removeChildAt(index)},__proto.removeChildren=function(beginIndex,endIndex){return void 0===beginIndex&&(beginIndex=0),void 0===endIndex&&(endIndex=2147483647),this._content.removeChildren(beginIndex,endIndex),this._setScrollChanged(),this},__proto.getChildAt=function(index){return this._content.getChildAt(index)},__proto.getChildByName=function(name){return this._content.getChildByName(name)},__proto.getChildIndex=function(child){return this._content.getChildIndex(child)},__proto.changeScroll=function(){this._scrollChanged=!1;var contentW=this.contentWidth||1,contentH=this.contentHeight||1,vscroll=this._vScrollBar,hscroll=this._hScrollBar,vShow=vscroll&&contentH>this._height,hShow=hscroll&&contentW>this._width,showWidth=vShow?this._width-vscroll.width:this._width,showHeight=hShow?this._height-hscroll.height:this._height;vscroll&&(vscroll.x=this._width-vscroll.width,vscroll.y=0,vscroll.height=this._height-(hShow?hscroll.height:0),vscroll.scrollSize=Math.max(.033*this._height,1),vscroll.thumbPercent=showHeight/contentH,vscroll.setScroll(0,contentH-showHeight,vscroll.value)),hscroll&&(hscroll.x=0,hscroll.y=this._height-hscroll.height,hscroll.width=this._width-(vShow?vscroll.width:0),hscroll.scrollSize=Math.max(.033*this._width,1),hscroll.thumbPercent=showWidth/contentW,hscroll.setScroll(0,contentW-showWidth,hscroll.value))},__proto._sizeChanged=function(){laya.ui.UIComponent.prototype._sizeChanged.call(this),this.setContentSize(this._width,this._height)},__proto.setContentSize=function(width,height){var content=this._content;content.width=width,content.height=height,content._style.scrollRect||(content.scrollRect=Rectangle.create()),content._style.scrollRect.setTo(0,0,width,height),content.scrollRect=content.scrollRect},__proto.onScrollBarChange=function(scrollBar){var rect=this._content._style.scrollRect;if(rect){var start=Math.round(scrollBar.value);scrollBar.isVertical?rect.y=start:rect.x=start,this._content.scrollRect=rect}},__proto.scrollTo=function(x,y){void 0===x&&(x=0),void 0===y&&(y=0),this.vScrollBar&&(this.vScrollBar.value=y),this.hScrollBar&&(this.hScrollBar.value=x)},__proto.refresh=function(){this.changeScroll()},__proto.onScrollStart=function(){this._usedCache||(this._usedCache=Laya.superGet(Box,this,"cacheAs")),Laya.superSet(Box,this,"cacheAs","none"),this._hScrollBar&&this._hScrollBar.once("end",this,this.onScrollEnd),this._vScrollBar&&this._vScrollBar.once("end",this,this.onScrollEnd)},__proto.onScrollEnd=function(){Laya.superSet(Box,this,"cacheAs",this._usedCache)},__proto._setScrollChanged=function(){this._scrollChanged||(this._scrollChanged=!0,this.callLater(this.changeScroll))},__getset(0,__proto,"numChildren",function(){return this._content.numChildren}),__getset(0,__proto,"hScrollBarSkin",function(){return this._hScrollBar?this._hScrollBar.skin:null},function(value){null==this._hScrollBar&&(laya.display.Node.prototype.addChild.call(this,this._hScrollBar=new HScrollBar),this._hScrollBar.on("change",this,this.onScrollBarChange,[this._hScrollBar]),this._hScrollBar.target=this._content,this._hScrollBar.elasticDistance=this._elasticEnabled?200:0,this._setScrollChanged()),this._hScrollBar.skin=value}),__getset(0,__proto,"contentWidth",function(){for(var max=0,i=this._content.numChildren-1;i>-1;i--){var comp=this._content.getChildAt(i);max=Math.max(comp._x+comp.width*comp.scaleX-comp.pivotX,max)}return max}),__getset(0,__proto,"contentHeight",function(){for(var max=0,i=this._content.numChildren-1;i>-1;i--){var comp=this._content.getChildAt(i);max=Math.max(comp._y+comp.height*comp.scaleY-comp.pivotY,max)}return max}),__getset(0,__proto,"width",_super.prototype._$get_width,function(value){Laya.superSet(Box,this,"width",value),this._setScrollChanged()}),__getset(0,__proto,"hScrollBar",function(){return this._hScrollBar}),__getset(0,__proto,"content",function(){return this._content}),__getset(0,__proto,"height",_super.prototype._$get_height,function(value){Laya.superSet(Box,this,"height",value),this._setScrollChanged()}),__getset(0,__proto,"vScrollBarSkin",function(){return this._vScrollBar?this._vScrollBar.skin:null},function(value){null==this._vScrollBar&&(laya.display.Node.prototype.addChild.call(this,this._vScrollBar=new VScrollBar),this._vScrollBar.on("change",this,this.onScrollBarChange,[this._vScrollBar]),this._vScrollBar.target=this._content,this._vScrollBar.elasticDistance=this._elasticEnabled?200:0,this._setScrollChanged()),this._vScrollBar.skin=value}),__getset(0,__proto,"vScrollBar",function(){return this._vScrollBar}),__getset(0,__proto,"cacheAs",_super.prototype._$get_cacheAs,function(value){Laya.superSet(Box,this,"cacheAs",value),this._usedCache=null,"none"!==value?(this._hScrollBar&&this._hScrollBar.on("start",this,this.onScrollStart),this._vScrollBar&&this._vScrollBar.on("start",this,this.onScrollStart)):(this._hScrollBar&&this._hScrollBar.off("start",this,this.onScrollStart),this._vScrollBar&&this._vScrollBar.off("start",this,this.onScrollStart))}),__getset(0,__proto,"elasticEnabled",function(){return this._elasticEnabled},function(value){this._elasticEnabled=value,this._vScrollBar&&(this._vScrollBar.elasticDistance=value?200:0),this._hScrollBar&&(this._hScrollBar.elasticDistance=value?200:0)}),Panel}(Box),FontClip=function(_super){function FontClip(skin,sheet){this._valueArr=null,this._indexMap=null,this._sheet=null,this._direction="horizontal",this._spaceX=0,this._spaceY=0,this._align="left",this._wordsW=0,this._wordsH=0,FontClip.__super.call(this),skin&&(this.skin=skin),sheet&&(this.sheet=sheet)}__class(FontClip,"laya.ui.FontClip",_super);var __proto=FontClip.prototype;return __proto.createChildren=function(){this._bitmap=new AutoBitmap,this.on("loaded",this,this._onClipLoaded)},__proto._onClipLoaded=function(){this.callLater(this.changeValue)},__proto.changeValue=function(){var texture;if(this._sources&&this._valueArr&&(this.graphics.clear(!0),texture=this._sources[0])){var isHorizontal="horizontal"===this._direction;isHorizontal?(this._wordsW=this._valueArr.length*(texture.sourceWidth+this.spaceX),this._wordsH=texture.sourceHeight):(this._wordsW=texture.sourceWidth,this._wordsH=(texture.sourceHeight+this.spaceY)*this._valueArr.length);var dX=0;if(this._width)switch(this._align){case"center":dX=.5*(this._width-this._wordsW);break;case"right":dX=this._width-this._wordsW;break;default:dX=0}for(var i=0,sz=this._valueArr.length;i<sz;i++){var index=this._indexMap[this._valueArr.charAt(i)];this.sources[index]&&(texture=this.sources[index],isHorizontal?this.graphics.drawImage(texture,dX+i*(texture.sourceWidth+this.spaceX),0,texture.sourceWidth,texture.sourceHeight):this.graphics.drawImage(texture,0+dX,i*(texture.sourceHeight+this.spaceY),texture.sourceWidth,texture.sourceHeight))}this._width||(this._widget.resetLayoutX(),this.callLater(this._sizeChanged)),this._height||(this._widget.resetLayoutY(),this.callLater(this._sizeChanged))}},__proto.measureWidth=function(){return this._wordsW},__proto.measureHeight=function(){return this._wordsH},__proto.destroy=function(destroyChild){void 0===destroyChild&&(destroyChild=!0),this._valueArr=null,this._indexMap=null,this.graphics.clear(!0),this.removeSelf(),this.off("loaded",this,this._onClipLoaded),_super.prototype.destroy.call(this,destroyChild)},__getset(0,__proto,"sheet",function(){return this._sheet},function(value){value+="",this._sheet=value;var arr=value.split(" ");this._clipX=String(arr[0]).length,this.clipY=arr.length,this._indexMap={};for(var i=0;i<this._clipY;i++)for(var line=arr[i].split(""),j=0,n=line.length;j<n;j++)this._indexMap[line[j]]=i*this._clipX+j}),__getset(0,__proto,"height",_super.prototype._$get_height,function(value){Laya.superSet(Clip,this,"height",value),this.callLater(this.changeValue)}),__getset(0,__proto,"direction",function(){return this._direction},function(value){this._direction=value,this.callLater(this.changeValue)}),__getset(0,__proto,"value",function(){return this._valueArr?this._valueArr:""},function(value){value+="",this._valueArr=value,this.callLater(this.changeValue)}),__getset(0,__proto,"width",_super.prototype._$get_width,function(value){Laya.superSet(Clip,this,"width",value),this.callLater(this.changeValue)}),__getset(0,__proto,"spaceX",function(){return this._spaceX},function(value){this._spaceX=value,"horizontal"===this._direction&&this.callLater(this.changeValue)}),__getset(0,__proto,"spaceY",function(){return this._spaceY},function(value){this._spaceY=value,"horizontal"!==this._direction&&this.callLater(this.changeValue)}),__getset(0,__proto,"align",function(){return this._align},function(v){this._align=v,this.callLater(this.changeValue)}),FontClip}(Clip),VScrollBar=function(_super){function VScrollBar(){VScrollBar.__super.call(this)}return __class(VScrollBar,"laya.ui.VScrollBar",ScrollBar),VScrollBar}(),VSlider=function(_super){function VSlider(){VSlider.__super.call(this)}return __class(VSlider,"laya.ui.VSlider",Slider),VSlider}(),HScrollBar=function(_super){function HScrollBar(){HScrollBar.__super.call(this)}return __class(HScrollBar,"laya.ui.HScrollBar",_super),HScrollBar.prototype.initialize=function(){_super.prototype.initialize.call(this),this.slider.isVertical=!1},HScrollBar}(ScrollBar),HSlider=function(_super){function HSlider(skin){HSlider.__super.call(this,skin),this.isVertical=!1}return __class(HSlider,"laya.ui.HSlider",Slider),HSlider}();Laya.__init([SceneUtils,EventDispatcher,Timer,CallLater,LoaderManager,View,TimeLine])}(window,document,Laya),function(window,document,Laya){Laya.un,Laya.uns,Laya.static;var __class=Laya.class;Laya.getset,Laya.__newvec,new(function(){function LayaMain(){}return __class(LayaMain,"LayaMain"),LayaMain}())}(window,document,Laya);